const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ScanExitConfirmationModal-DP8K-vvG.js","assets/page-fridge-BvAjnJpI.js","assets/vendor-DX97-qL9.js","assets/utils-CUtLAp28.js","assets/supabase-C_rF2iqf.js","assets/page-fridge-scan-ZLPWYd6x.js","assets/stores-DcNfcD_j.js","assets/ui-components-DWjWyKd7.js","assets/motion-DLE-fuXv.js","assets/ui-components-BfdLI5ID.css","assets/page-fridge-scan-DAz6gEg3.css","assets/date-utils-sCOX3Ksr.js"])))=>i.map(i=>d[i]);
import{R as A,j as e,r as S,cY as ue,u as xe,e as ge,cU as pe}from"./vendor-DX97-qL9.js";import{n as le}from"./utils-CUtLAp28.js";import{b as ae}from"./stores-DcNfcD_j.js";import{G as O,S as x,I as c,r as ce,u as me,l as oe,q as be}from"./ui-components-DWjWyKd7.js";import{u as Z,l as u}from"./page-fridge-BvAjnJpI.js";import{_ as he}from"./page-fridge-scan-ZLPWYd6x.js";import{S as fe,u as ye,m as je}from"./ScanExitConfirmationModal-DP8K-vvG.js";import{m as p,u as X,A as re}from"./motion-DLE-fuXv.js";import"./supabase-C_rF2iqf.js";import"./date-utils-sCOX3Ksr.js";const ve=({isValidating:a,onCameraClick:t,onGalleryClick:s,onBarcodeClick:n,onBarcodeImageUpload:i})=>{const[o,l]=A.useState(!1);return A.useEffect(()=>{console.log("CaptureGuide mounted, isValidating:",a),console.log("CaptureGuide handlers:",{onCameraClick:t,onGalleryClick:s,onBarcodeClick:n});const h=N=>{console.log("üñ±Ô∏è GLOBAL CLICK DETECTED:",{target:N.target,currentTarget:N.currentTarget,clientX:N.clientX,clientY:N.clientY,tagName:N.target?.tagName,className:N.target?.className})};return document.addEventListener("click",h,!0),()=>{document.removeEventListener("click",h,!0)}},[]),A.useEffect(()=>{console.log("isValidating changed:",a)},[a]),console.log("üé® CaptureGuide RENDER",{isValidating:a}),e.jsxs(O,{interactive:!1,className:"p-6 relative glass-card--capture meal-capture-enter",style:{position:"relative",zIndex:10,background:`
          radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, rgba(34, 197, 94, 0.06) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"rgba(16, 185, 129, 0.25)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px rgba(16, 185, 129, 0.12),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                linear-gradient(135deg, rgba(16, 185, 129, 0.45), rgba(5, 150, 105, 0.35))
              `,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                0 0 20px rgba(16, 185, 129, 0.6),
                0 0 40px rgba(16, 185, 129, 0.3),
                inset 0 2px 0 rgba(255,255,255,0.35),
                inset 0 -2px 0 rgba(0,0,0,0.2)
              `},children:e.jsx(x,{Icon:c.Camera,size:18,style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(16, 185, 129, 0.9)) drop-shadow(0 0 4px rgba(255,255,255,0.5))"}})}),e.jsx("h4",{className:"text-white font-bold text-base",style:{textShadow:"0 2px 8px rgba(16, 185, 129, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:"Photo de votre repas"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",style:{background:`
              linear-gradient(135deg,
                rgba(59, 130, 246, 0.2),
                rgba(37, 99, 235, 0.15)
              )
            `,border:"2px solid rgba(59, 130, 246, 0.4)",borderRadius:"16px",backdropFilter:"blur(12px) saturate(130%)",boxShadow:`
              0 4px 16px rgba(59, 130, 246, 0.25),
              0 0 24px rgba(59, 130, 246, 0.15),
              inset 0 1px 0 rgba(255,255,255,0.2)
            `},children:[e.jsx(p.div,{className:"w-2 h-2 rounded-full",style:{backgroundColor:"#3B82F6",boxShadow:"0 0 10px #3B82F6"},animate:{scale:[1,1.3,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:"En attente"})]})]}),e.jsxs("div",{className:"space-y-6",style:{position:"relative",zIndex:1},children:[e.jsx("div",{className:"relative aspect-[4/3] rounded-xl overflow-visible meal-capture-guide",style:{background:`
              radial-gradient(circle at 40% 30%, rgba(16, 185, 129, 0.12) 0%, transparent 60%),
              radial-gradient(circle at 60% 70%, rgba(34, 197, 94, 0.08) 0%, transparent 50%),
              linear-gradient(135deg, rgba(16, 185, 129, 0.06), rgba(34, 197, 94, 0.04))
            `,border:"2px dashed rgba(16, 185, 129, 0.3)",backdropFilter:"blur(8px) saturate(120%)"},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{pointerEvents:"none !important"},children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"w-24 h-24 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 197, 94, 0.3))
                  `,border:"2px solid rgba(16, 185, 129, 0.4)",boxShadow:"0 0 30px rgba(16, 185, 129, 0.3)"},children:[e.jsx(x,{Icon:c.Camera,size:48,className:"text-green-400 icon-pulse-css",style:{filter:"drop-shadow(0 2px 8px rgba(16, 185, 129, 0.4))"}}),[...Array(3)].map((h,N)=>e.jsx("div",{className:`absolute w-2 h-2 rounded-full bg-green-400 particle-css particle-css--${N+1}`,style:{left:`${20+N*20}%`,top:`${20+N%2*60}%`,boxShadow:"0 0 8px rgba(16, 185, 129, 0.6)","--particle-color":"#10B981"}},N))]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-white font-semibold mb-2 text-base md:text-lg",children:"Forgez Votre Nutrition"}),e.jsx("p",{className:"text-green-200 text-xs md:text-sm leading-relaxed max-w-full sm:max-w-xs mx-auto px-2 sm:px-0",children:"Capturez votre repas pour une analyse compl√®te des nutriments et calories"})]})]})})}),e.jsx("button",{onClick:h=>{h.preventDefault(),h.stopPropagation(),console.log("CaptureGuide: Camera button onClick fired",h),console.log("isValidating:",a),console.log("Calling onCameraClick..."),t()},onMouseDown:h=>{console.log("Camera button mouseDown")},onTouchStart:h=>{console.log("Camera button touchStart")},className:"w-full btn-glass--primary touch-feedback-css",disabled:a,type:"button",style:{"--scan-primary":"#10B981",background:`
              linear-gradient(135deg, 
                rgba(16, 185, 129, 0.8), 
                rgba(34, 197, 94, 0.6)
              )
            `,backdropFilter:"blur(20px) saturate(160%)",boxShadow:`
              0 12px 40px rgba(16, 185, 129, 0.4),
              0 0 60px rgba(16, 185, 129, 0.3),
              inset 0 3px 0 rgba(255,255,255,0.3),
              inset 0 -3px 0 rgba(0,0,0,0.2)
            `,border:"2px solid rgba(16, 185, 129, 0.6)"},children:e.jsxs("div",{className:"relative flex items-center justify-center gap-3",children:[e.jsx("div",{className:a?"icon-spin-css":"",children:e.jsx(x,{Icon:a?c.Loader2:c.Camera,size:24,className:"text-white",style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.3))"}})}),e.jsx("span",{className:"font-bold text-lg",children:a?"Validation...":"Appareil photo"})]})}),e.jsx("button",{onClick:h=>{h.preventDefault(),h.stopPropagation(),console.log("CaptureGuide: Gallery button onClick fired",h),console.log("isValidating:",a),console.log("Calling onGalleryClick..."),s()},onMouseDown:h=>{console.log("Gallery button mouseDown")},onTouchStart:h=>{console.log("Gallery button touchStart")},className:"w-full btn-glass btn-glass--secondary-nav touch-feedback-css",disabled:a,type:"button",style:{background:"rgba(16, 185, 129, 0.08)",borderColor:"rgba(16, 185, 129, 0.25)",backdropFilter:"blur(12px) saturate(130%)",boxShadow:`
              0 4px 16px rgba(0, 0, 0, 0.15),
              0 0 20px rgba(16, 185, 129, 0.1),
              inset 0 1px 0 rgba(255, 255, 255, 0.15)
            `},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.Image,size:18}),e.jsx("span",{className:"font-medium",children:"Galerie"})]})})]})]})},Ne=({capturedPhoto:a,showSuccessAnimation:t,onRetake:s})=>{const n=X(),{glassClick:i}=Z();return e.jsxs(O,{className:"p-6 relative overflow-visible glass-card--capture",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, rgba(34, 197, 94, 0.06) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"rgba(16, 185, 129, 0.25)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px rgba(16, 185, 129, 0.12),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                linear-gradient(135deg, rgba(16, 185, 129, 0.45), rgba(5, 150, 105, 0.35))
              `,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                0 0 20px rgba(16, 185, 129, 0.6),
                0 0 40px rgba(16, 185, 129, 0.3),
                inset 0 2px 0 rgba(255,255,255,0.35),
                inset 0 -2px 0 rgba(0,0,0,0.2)
              `},children:e.jsx(x,{Icon:c.Camera,size:18,style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(16, 185, 129, 0.9)) drop-shadow(0 0 4px rgba(255,255,255,0.5))"}})}),e.jsx("h4",{className:"text-white font-bold text-base",style:{textShadow:"0 2px 8px rgba(16, 185, 129, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:"Photo de votre repas"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",style:{background:`
              linear-gradient(135deg,
                rgba(16, 185, 129, 0.25),
                rgba(5, 150, 105, 0.2)
              )
            `,border:"2px solid rgba(16, 185, 129, 0.5)",borderRadius:"16px",backdropFilter:"blur(12px) saturate(130%)",boxShadow:`
              0 4px 16px rgba(16, 185, 129, 0.3),
              0 0 24px rgba(16, 185, 129, 0.2),
              inset 0 1px 0 rgba(255,255,255,0.25)
            `},children:[e.jsx(p.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:n?"tween":"spring",stiffness:260,damping:20,duration:n?.1:void 0},style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(x,{Icon:c.Check,size:14,style:{color:"#fff",filter:"drop-shadow(0 0 6px rgba(16, 185, 129, 0.8))"}})}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:"Captur√©e"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative aspect-[4/3] rounded-xl overflow-hidden glass-card--capture-preview",children:[e.jsx(p.img,{src:a.url,alt:"Photo du repas",className:"w-full h-full object-cover bg-black/20 border border-green-400/20",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:n?.1:.6,ease:"easeOut"}}),e.jsx(re,{children:t&&e.jsx(p.div,{className:"absolute inset-0 flex items-center justify-center backdrop-blur-md rounded-xl success-overlay",style:{background:`
                    radial-gradient(circle at center, rgba(16, 185, 129, 0.3) 0%, rgba(16, 185, 129, 0.1) 70%),
                    linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 197, 94, 0.3))
                  `,border:"2px solid rgba(16, 185, 129, 0.6)",backdropFilter:"blur(16px) saturate(140%)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.1},transition:{duration:n?.1:.6,ease:"easeOut"},children:e.jsx(p.div,{className:"w-24 h-24 rounded-full flex items-center justify-center backdrop-blur-sm success-icon-container",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(34, 197, 94, 0.6))
                    `,border:"3px solid rgba(16, 185, 129, 0.8)",boxShadow:`
                      0 0 60px rgba(16, 185, 129, 0.8),
                      0 0 120px rgba(16, 185, 129, 0.4),
                      inset 0 3px 0 rgba(255,255,255,0.4),
                      inset 0 -3px 0 rgba(0,0,0,0.2)
                    `},initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:n?"tween":"spring",stiffness:300,damping:20,delay:n?0:.2,duration:n?.1:void 0},children:e.jsx(x,{Icon:c.Check,size:36,className:"text-white success-icon-glow",style:{filter:"drop-shadow(0 0 8px rgba(255,255,255,0.8))"}})})})})]}),e.jsx(p.button,{onClick:()=>{i(),s()},className:"w-full btn-glass btn-glass--secondary-nav",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.RotateCcw,size:14}),e.jsx("span",{children:"Reprendre"})]})})]})]})},we=({onProceedToProcessing:a,isProcessingInProgress:t,hasPhoto:s,hasScannedBarcodes:n,hasScannedProducts:i,scannedBarcodesCount:o,scannedProductsCount:l})=>{const{success:h}=Z(),r=(()=>{const y=o+l;return s&&(n||i)?{title:"Photo et codes-barres d√©tect√©s !",subtitle:`Votre photo${n?` et ${o} code${o>1?"s-barres":"-barre"}`:""}${i?` et ${l} produit${l>1?"s":""}`:""} sont pr√™ts pour l'analyse compl√®te.`}:n&&i?{title:`${y} √©l√©ment${y>1?"s":""} d√©tect√©${y>1?"s":""} !`,subtitle:`${o} code${o>1?"s-barres":"-barre"} et ${l} produit${l>1?"s":""} pr√™ts pour l'analyse.`}:n?{title:`${o} code${o>1?"s-barres":"-barre"} d√©tect√©${o>1?"s":""} !`,subtitle:"Vos codes-barres sont pr√™ts pour l'analyse nutritionnelle avanc√©e."}:i?{title:`${l} produit${l>1?"s":""} scann√©${l>1?"s":""} !`,subtitle:"Vos produits sont pr√™ts pour l'analyse nutritionnelle."}:{title:"Photo captur√©e avec succ√®s !",subtitle:"Votre carburant nutritionnel est pr√™t pour l'analyse TwinForge."}})();return e.jsx("div",{className:"meal-ready-processing meal-capture-enter",children:e.jsxs(O,{className:"p-6 text-center relative glass-card--ready-processing perf-critical",style:{background:`
            radial-gradient(circle at 25% 25%, rgba(16, 185, 129, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 75% 75%, rgba(34, 197, 94, 0.12) 0%, transparent 60%),
            radial-gradient(circle at 50% 50%, rgba(52, 211, 153, 0.08) 0%, transparent 70%),
            var(--glass-opacity)
          `,borderColor:"rgba(16, 185, 129, 0.4)",boxShadow:`
            0 16px 48px rgba(0, 0, 0, 0.3),
            0 0 40px rgba(16, 185, 129, 0.25),
            0 0 80px rgba(34, 197, 94, 0.15),
            inset 0 2px 0 rgba(255, 255, 255, 0.2)
          `},children:[e.jsx("div",{className:"absolute inset-0 rounded-inherit pointer-events-none",style:{background:"radial-gradient(circle at center, rgba(16, 185, 129, 0.08) 0%, transparent 70%)",filter:"blur(20px)",transform:"scale(1.2)",zIndex:-1,animation:"forge-nutritional-glow 3s ease-in-out infinite"}}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mb-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(34, 197, 94, 0.4))
                `,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                  0 0 40px rgba(16, 185, 129, 0.5),
                  inset 0 2px 0 rgba(255, 255, 255, 0.3)
                `},children:e.jsx(x,{Icon:c.Check,size:28,className:"text-white",style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.3))"}})}),e.jsx("h3",{className:"text-white text-xl font-bold text-center",children:r.title}),e.jsx("p",{className:"text-green-100 text-base leading-relaxed max-w-md mx-auto text-center",children:r.subtitle})]})}),e.jsx("button",{onClick:()=>{h(),a()},className:"w-full max-w-md mx-auto py-3 btn-breathing-css btn-touch-feedback touch-feedback-css",disabled:t,style:{"--scan-primary":"#10B981",position:"relative",overflow:"hidden",background:`
                linear-gradient(135deg, 
                  rgba(16, 185, 129, 0.9), 
                  rgba(34, 197, 94, 0.7),
                  rgba(52, 211, 153, 0.8)
                )
              `,backdropFilter:"blur(20px) saturate(160%)",boxShadow:`
                0 16px 48px rgba(16, 185, 129, 0.5),
                0 0 80px rgba(16, 185, 129, 0.4),
                0 0 120px rgba(34, 197, 94, 0.3),
                inset 0 3px 0 rgba(255,255,255,0.4),
                inset 0 -3px 0 rgba(0,0,0,0.2)
              `,borderRadius:"999px",border:"2px solid rgba(16, 185, 129, 0.8)"},children:e.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-3",children:[e.jsx("div",{className:t?"icon-spin-css":"",children:e.jsx(x,{Icon:t?c.Loader2:c.Zap,size:20,className:"text-white",style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.4))"}})}),e.jsx("span",{className:"text-lg font-bold text-white",children:t?"Analyse en cours...":"Lancer l'analyse avanc√©e"})]})})]})]})})},_e=({capturedPhoto:a,onBack:t})=>{const{click:s}=Z();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p.button,{onClick:()=>{s(),t()},className:"btn-glass--secondary-nav touch-target",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.ArrowLeft,size:16}),e.jsx("span",{children:"Retour"})]})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-white/60 text-sm",children:a?"‚úì Photo captur√©e":"√âtape 1 sur 3"})})]})},ke="_wrap_1ie0e_12",Ce="_card_1ie0e_19",Se="_grid_1ie0e_33",Ie="_icon_1ie0e_43",Ee="_iconHalo_1ie0e_62",Ae="_iconGlyph_1ie0e_68",Me="_center_1ie0e_74",Pe="_title_1ie0e_80",Be="_subtitle_1ie0e_91",Fe="_rail_1ie0e_101",De="_seg_1ie0e_106",Oe="_segGreen_1ie0e_110",Re="_segCyan_1ie0e_111",Le="_isCurrent_1ie0e_113",ze="_isComplete_1ie0e_114",$e="_fill_1ie0e_116",Te="_fillGreen_1ie0e_120",Ue="_fillCyan_1ie0e_125",We="_step_1ie0e_132",Ve="_percent_1ie0e_139",B={wrap:ke,card:Ce,grid:Se,icon:Ie,iconHalo:Ee,iconGlyph:Ae,center:Me,title:Pe,subtitle:Be,rail:Fe,seg:De,segGreen:Oe,segCyan:Re,isCurrent:Le,isComplete:ze,fill:$e,fillGreen:Te,fillCyan:Ue,step:We,percent:Ve},te=[{id:"capture",title:"Capture"},{id:"processing",title:"Analyse"},{id:"results",title:"R√©sultats"}],Ge={capture:"Camera",processing:"Scan",results:"Check"};function J({currentStep:a,progress:t,message:s,subMessage:n}){const i=Number.isFinite(t)?Math.min(100,Math.max(0,t)):0,o=100/te.length,l=Math.max(0,te.findIndex(y=>y.id===a)),h=l*o,N=Math.max(0,Math.min(1,(i-h)/o)),r=Ge[a]??"Camera";return e.jsx("div",{className:B.wrap,children:e.jsx(O,{className:B.card,children:e.jsxs("div",{className:B.grid,"data-dph":!0,children:[e.jsxs("div",{className:B.icon,children:[e.jsx("div",{className:B.iconHalo}),e.jsx(x,{Icon:c[r],size:26,className:B.iconGlyph})]}),e.jsxs("div",{className:B.center,children:[e.jsx("h2",{className:B.title,children:s||"Capture Nutritionnelle"}),n&&e.jsx("p",{className:B.subtitle,children:n}),e.jsx("div",{className:B.rail,role:"progressbar","aria-valuenow":Math.round(i),"aria-valuemin":0,"aria-valuemax":100,children:te.map((y,g)=>{const k=g<l,E=g===l,w=k?"100%":E?`${N*100}%`:"0%",F=g===0?B.segGreen:B.segCyan,T=g===0?B.fillGreen:B.fillCyan;return e.jsx("div",{className:`${B.seg} ${F} ${k?B.isComplete:""} ${E?B.isCurrent:""}`,children:(k||E)&&e.jsx(p.span,{className:`${B.fill} ${T}`,initial:{width:0},animate:{width:w},transition:{duration:.45,ease:"easeOut"}})},y.id)})}),e.jsxs("div",{className:B.step,children:["√âtape ",l+1," sur ",te.length]})]}),e.jsxs("div",{className:B.percent,"aria-hidden":"true",children:[Math.round(i),"%"]})]})})})}const qe=async a=>{try{const t=new Image,s=URL.createObjectURL(a);await new Promise((o,l)=>{t.onload=()=>o(),t.onerror=()=>l(new Error("Failed to load image")),t.src=s});const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");if(!i)return URL.revokeObjectURL(s),{success:!1,error:"Failed to get canvas context"};if(i.drawImage(t,0,0),URL.revokeObjectURL(s),"BarcodeDetector"in window)try{const l=await new window.BarcodeDetector({formats:["ean_13","ean_8","upc_a","upc_e","code_128","code_39"]}).detect(n);if(l.length>0)return{success:!0,barcode:l[0].rawValue,format:l[0].format}}catch(o){console.warn("BarcodeDetector failed, falling back to error:",o)}return{success:!1,error:"Aucun code-barre d√©tect√© dans l'image. La d√©tection de code-barres sur image n'est pas support√©e par votre navigateur."}}catch(t){return console.error("Error scanning barcode from image:",t),{success:!1,error:t instanceof Error?t.message:"Erreur lors du scan de l'image"}}},He=({onBarcodeDetected:a,onClose:t,mode:s,uploadedImage:n})=>{const[i,o]=S.useState(s==="camera"),[l,h]=S.useState(!1),[N,r]=S.useState(null),[y,g]=S.useState(null),[k,E]=S.useState(null),[w,F]=S.useState(null),[T,H]=S.useState(null),[I,L]=S.useState("loading");S.useEffect(()=>{s==="upload"&&n&&U(n)},[s,n]),S.useEffect(()=>()=>{w&&URL.revokeObjectURL(w)},[w]);const U=b=>{g(null),L("loading");const d=URL.createObjectURL(b);F(d),H(b),u.info("BARCODE_SCANNER","Image loaded for preview, starting auto-detection",{fileName:b.name,fileSize:b.size,timestamp:new Date().toISOString()}),L("ready"),R(b)},R=async b=>{h(!0),g(null),L("detecting"),u.info("BARCODE_SCANNER","Starting barcode detection",{fileName:b.name,timestamp:new Date().toISOString()});try{const d=await qe(b);if(!d.success||!d.barcode){u.warn("BARCODE_SCANNER","No barcode found in image",{error:d.error,timestamp:new Date().toISOString()}),g(d.error||"Aucun code-barre d√©tect√©"),L("ready"),h(!1);return}W(d.barcode)}catch(d){u.error("BARCODE_SCANNER","Error detecting barcode",{error:d instanceof Error?d.message:String(d),timestamp:new Date().toISOString()}),g("Erreur lors de la d√©tection du code-barre"),L("ready")}finally{h(!1)}},W=b=>{u.info("BARCODE_SCANNER","Barcode detected successfully",{barcode:b,timestamp:new Date().toISOString()});const d={barcode:b,image_url:w||void 0,scannedAt:new Date().toISOString(),portionMultiplier:1};a(d),E(`Code-barre ${b} d√©tect√© !`),L("complete"),setTimeout(()=>{E(null),o(!0),r(null),L("loading")},1500)},j=async b=>{if(!i||l||b.length===0)return;const d=b[0]?.rawValue;!d||d===N||(r(d),o(!1),W(d))},m=b=>{u.error("BARCODE_SCANNER","Camera error",{error:b?.message||String(b),timestamp:new Date().toISOString()}),g("Erreur d'acc√®s √† la cam√©ra")};return e.jsx(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"relative z-40 mt-4",children:e.jsx("div",{className:"w-full",children:e.jsxs(O,{className:"p-6 relative overflow-hidden",style:{background:`
              radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.12) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, rgba(79, 70, 229, 0.08) 0%, transparent 50%),
              rgba(17, 24, 39, 0.95)
            `,borderColor:"rgba(99, 102, 241, 0.3)",boxShadow:`
              0 20px 60px rgba(0, 0, 0, 0.5),
              0 0 40px rgba(99, 102, 241, 0.2),
              inset 0 2px 0 rgba(255, 255, 255, 0.15)
            `},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                    linear-gradient(135deg, rgba(99, 102, 241, 0.45), rgba(79, 70, 229, 0.35))
                  `,border:"2px solid rgba(99, 102, 241, 0.6)",boxShadow:`
                    0 0 20px rgba(99, 102, 241, 0.6),
                    0 0 40px rgba(99, 102, 241, 0.3)
                  `},children:e.jsx(x,{Icon:c.Scan,size:18,style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(99, 102, 241, 0.9))"}})}),e.jsx("h4",{className:"text-white font-bold text-base",children:"Scanner Code-Barre"})]}),e.jsx("button",{onClick:t,className:"w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-gray-700/50",style:{border:"1px solid rgba(156, 163, 175, 0.3)"},"aria-label":"Fermer",children:e.jsx(x,{Icon:c.X,size:16,className:"text-gray-400"})})]}),e.jsxs("div",{className:"relative aspect-square rounded-xl overflow-hidden mb-4",children:[s==="upload"&&w?e.jsx("img",{src:w,alt:"Uploaded barcode",className:"w-full h-full object-cover"}):i&&e.jsx(ue,{onScan:j,onError:m,formats:["ean_13","ean_8","upc_a","upc_e","code_128","code_39"],components:{audio:!1,finder:!0},styles:{container:{width:"100%",height:"100%"},video:{width:"100%",height:"100%",objectFit:"cover"}}}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"w-64 h-48 relative",style:{border:"3px solid rgba(99, 102, 241, 0.6)",borderRadius:"12px",boxShadow:"0 0 30px rgba(99, 102, 241, 0.4)"},children:[e.jsx("div",{className:"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-indigo-400 rounded-tl-lg"}),e.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-indigo-400 rounded-tr-lg"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-indigo-400 rounded-bl-lg"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-indigo-400 rounded-br-lg"}),i&&e.jsx(p.div,{className:"absolute inset-x-0 h-1 bg-gradient-to-r from-transparent via-indigo-400 to-transparent",style:{filter:"drop-shadow(0 0 8px rgba(99, 102, 241, 0.8))"},animate:{top:["10%","90%","10%"]},transition:{duration:2,repeat:1/0,ease:"linear"}})]})}),e.jsxs(re,{children:[l&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-indigo-400 border-t-transparent rounded-full mx-auto mb-3"}),e.jsx("p",{className:"text-white font-medium",children:"D√©tection du code-barre..."})]})}),k&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-green-500/20 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-500/30 flex items-center justify-center mx-auto mb-3",children:e.jsx(x,{Icon:c.Check,size:32,className:"text-green-400"})}),e.jsx("p",{className:"text-white font-bold text-lg",children:k}),e.jsx("p",{className:"text-green-200 text-sm mt-2",children:`Cliquez sur "Lancer l'analyse" pour continuer`})]})}),y&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-red-500/20 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-500/30 flex items-center justify-center mx-auto mb-3",children:e.jsx(x,{Icon:c.AlertCircle,size:32,className:"text-red-400"})}),e.jsx("p",{className:"text-white font-bold text-lg mb-2",children:"Erreur"}),e.jsx("p",{className:"text-red-200 text-sm",children:y})]})})]})]})]}),e.jsx("div",{className:"text-center",children:s==="camera"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Positionnez le code-barre dans le cadre"}),e.jsx("p",{className:"text-gray-500 text-xs",children:"Formats support√©s : EAN-13, EAN-8, UPC-A, UPC-E, Code 128, Code 39"})]})})]})})})},Xe="https://world.openfoodfacts.org/api/v2",Ke="TwinForge/1.0 (Nutrition Tracking App; contact@twinforge.app)";async function Qe(a,t={},s=8e3){const n=new AbortController,i=setTimeout(()=>n.abort(),s);try{const o=await fetch(a,{...t,signal:n.signal,headers:{"User-Agent":Ke,...t.headers}});return clearTimeout(i),o}catch(o){throw clearTimeout(i),o}}const Q={async getProductByBarcode(a){u.info("OFF_SERVICE","Fetching product from OpenFoodFacts",{barcode:a,timestamp:new Date().toISOString()});try{const t=`${Xe}/product/${a}?fields=code,product_name,brands,quantity,image_url,image_small_url,nutriments,serving_size,nutrition_grades,nutriscore_grade,nova_group,categories,allergens,ingredients_text`,s=await Qe(t,{},8e3);if(!s.ok)return u.warn("OFF_SERVICE","OpenFoodFacts API returned non-OK status",{barcode:a,status:s.status,statusText:s.statusText,timestamp:new Date().toISOString()}),{success:!1,error:`Produit non trouv√© (HTTP ${s.status})`};const n=await s.json();if(n.status!==1||!n.product)return u.info("OFF_SERVICE","Product not found in OpenFoodFacts database",{barcode:a,status:n.status,status_verbose:n.status_verbose,timestamp:new Date().toISOString()}),{success:!1,error:"Produit non trouv√© dans la base de donn√©es OpenFoodFacts"};const i=n.product;if(!i.product_name||!i.nutriments)return u.warn("OFF_SERVICE","Product found but missing essential data",{barcode:a,hasName:!!i.product_name,hasNutriments:!!i.nutriments,timestamp:new Date().toISOString()}),{success:!1,error:"Donn√©es nutritionnelles incompl√®tes"};const o=i.nutriments,l={success:!0,product:{barcode:i.code,name:i.product_name,brand:i.brands,image_url:i.image_url||i.image_small_url,portion_size:i.serving_size||i.quantity,nutrition_per_100g:{calories:o["energy-kcal_100g"]||0,proteins:o.proteins_100g||0,carbs:o.carbohydrates_100g||0,fats:o.fat_100g||0,fiber:o.fiber_100g,sugar:o.sugars_100g,sodium:o.sodium_100g},nutriscore:i.nutriscore_grade||i.nutrition_grades,nova_group:i.nova_group,categories:i.categories,allergens:i.allergens}};return(o["energy-kcal_serving"]||o.proteins_serving||o.carbohydrates_serving||o.fat_serving)&&(l.product.nutrition_per_serving={calories:o["energy-kcal_serving"]||0,proteins:o.proteins_serving||0,carbs:o.carbohydrates_serving||0,fats:o.fat_serving||0}),u.info("OFF_SERVICE","Product fetched successfully",{barcode:a,productName:i.product_name,brand:i.brands,hasNutritionPerServing:!!l.product?.nutrition_per_serving,nutriscore:l.product?.nutriscore,timestamp:new Date().toISOString()}),l}catch(t){return t instanceof Error&&t.name==="AbortError"?(u.error("OFF_SERVICE","Request timeout",{barcode:a,error:"Request timed out after 8 seconds",timestamp:new Date().toISOString()}),{success:!1,error:"D√©lai d'attente d√©pass√©. Veuillez r√©essayer."}):(u.error("OFF_SERVICE","Error fetching product",{barcode:a,error:t instanceof Error?t.message:String(t),errorStack:t instanceof Error?t.stack:void 0,timestamp:new Date().toISOString()}),{success:!1,error:"Erreur de connexion √† OpenFoodFacts"})}},convertToMealItem(a,t=1){if(!a)return null;const s=a.nutrition_per_serving&&t===1,n=s?a.nutrition_per_serving:a.nutrition_per_100g,i=n.calories*t,o=n.proteins*t,l=n.carbs*t,h=n.fats*t,N=s?a.portion_size||"1 portion":t===1?"100g":`${t*100}g`,r={name:a.brand?`${a.brand} ${a.name}`:a.name,confidence:1,calories:Math.round(i),proteins:Math.round(o*10)/10,carbs:Math.round(l*10)/10,fats:Math.round(h*10)/10,fiber:a.nutrition_per_100g.fiber?Math.round(a.nutrition_per_100g.fiber*t*10)/10:void 0,sugar:a.nutrition_per_100g.sugar?Math.round(a.nutrition_per_100g.sugar*t*10)/10:void 0,sodium:a.nutrition_per_100g.sodium?Math.round(a.nutrition_per_100g.sodium*t*1e3)/1e3:void 0,portion_size:N,category:"packaged_product"};return u.debug("OFF_SERVICE","Converted product to MealItem",{productName:a.name,portionMultiplier:t,useServing:s,mealItem:{name:r.name,calories:r.calories,portion_size:r.portion_size},timestamp:new Date().toISOString()}),r},getCommonPortionMultipliers(){return[{label:"¬º portion",value:.25},{label:"¬Ω portion",value:.5},{label:"1 portion",value:1},{label:"1.5 portions",value:1.5},{label:"2 portions",value:2},{label:"3 portions",value:3}]}},Ye=({product:a,onPortionChange:t,onRemove:s})=>{const n=Q.getCommonPortionMultipliers();return e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{duration:.3},children:e.jsx(O,{className:"p-4 relative",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.08) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, rgba(79, 70, 229, 0.06) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"rgba(99, 102, 241, 0.25)",boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.2),
            0 0 20px rgba(99, 102, 241, 0.1),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"flex gap-4",children:[a.image_url&&e.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden flex-shrink-0",style:{border:"2px solid rgba(99, 102, 241, 0.3)",background:"rgba(255, 255, 255, 0.05)"},children:e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("div",{className:"px-2 py-0.5 rounded-md flex items-center gap-1",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(79, 70, 229, 0.15))",border:"1px solid rgba(99, 102, 241, 0.3)"},children:[e.jsx(x,{Icon:c.Scan,size:12,className:"text-indigo-300"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-200",children:"Code-barre"})]})}),e.jsx("h4",{className:"text-white font-semibold text-sm mb-0.5 truncate",children:a.name}),a.brand&&e.jsx("p",{className:"text-gray-400 text-xs truncate",children:a.brand})]}),e.jsx("button",{onClick:()=>s(a.barcode),className:"flex-shrink-0 w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-red-500/20",style:{border:"1px solid rgba(239, 68, 68, 0.3)"},"aria-label":"Retirer le produit",children:e.jsx(x,{Icon:c.X,size:16,className:"text-red-400"})})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-0.5",children:"Calories"}),e.jsxs("p",{className:"text-white font-bold text-lg",children:[a.mealItem.calories,e.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"kcal"})]})]}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 mb-0.5",children:"P"}),e.jsxs("p",{className:"text-green-400 font-semibold",children:[a.mealItem.proteins,"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 mb-0.5",children:"G"}),e.jsxs("p",{className:"text-yellow-400 font-semibold",children:[a.mealItem.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 mb-0.5",children:"L"}),e.jsxs("p",{className:"text-orange-400 font-semibold",children:[a.mealItem.fats,"g"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Portion"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:n.map(i=>e.jsx("button",{onClick:()=>t(a.barcode,i.value),className:`
                      px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                      ${a.portionMultiplier===i.value?"bg-indigo-500/30 text-indigo-200 border-indigo-400":"bg-gray-800/50 text-gray-400 border-gray-700 hover:bg-gray-700/50"}
                    `,style:{border:"1px solid"},children:i.label},i.value))})]})]})]})})})},Ze=({scanType:a,onSelectScanType:t,capturedPhoto:s,scannedBarcodes:n,scannedProducts:i,onPhotoCapture:o,onBarcodeDetected:l,onProductScanned:h,onProductPortionChange:N,onProductRemove:r,onBarcodePortionChange:y,onBarcodeRemove:g,onRetake:k,onBack:E,onProceedToProcessing:w,isProcessingInProgress:F,readyForProcessingRef:T,progress:H,progressMessage:I,progressSubMessage:L})=>{const[U,R]=S.useState(!1),[W,j]=S.useState(!1),[m,b]=S.useState(!1),[d,D]=S.useState(null);A.useEffect(()=>{console.log("üîç BARCODE_SCANNER_STATE:",{showBarcodeScanner:m,barcodeScanMode:d})},[m,d]);const $=S.useRef(null),v=S.useRef(null),z=S.useRef(null),f=[{id:"nutrition-tracking",icon:"TrendingUp",color:"#22C55E",title:"Suivi Nutritionnel",description:"Analysez vos apports en macronutriments et calories"},{id:"ai-detection",icon:"Zap",color:"#10B981",title:"D√©tection IA",description:"Identification automatique des aliments et portions"},{id:"personalized-insights",icon:"Target",color:"#059669",title:"Conseils Personnalis√©s",description:"Recommandations adapt√©es √† vos objectifs"}],C=[{id:"instant-analysis",icon:"Zap",color:"#6366F1",title:"Analyse Instantan√©e",description:"R√©cup√©ration imm√©diate des donn√©es nutritionnelles"},{id:"accurate-data",icon:"Database",color:"#818CF8",title:"Donn√©es Pr√©cises",description:"Informations officielles des fabricants via OpenFoodFacts"},{id:"easy-tracking",icon:"Package",color:"#4F46E5",title:"Suivi Simplifi√©",description:"Id√©al pour les produits emball√©s et transform√©s"}],_=()=>{if(console.log("Camera button clicked"),console.log("fileInputRef.current:",$.current),!$.current){console.error("fileInputRef.current is null or undefined");return}try{console.log("Attempting to trigger file input click"),$.current.click(),console.log("File input click triggered successfully")}catch(M){console.error("Error clicking file input:",M)}},V=()=>{if(console.log("Gallery button clicked"),console.log("galleryInputRef.current:",v.current),!v.current){console.error("galleryInputRef.current is null or undefined");return}try{console.log("Attempting to reset and trigger gallery input"),v.current.value="",v.current.click(),console.log("Gallery input click triggered successfully")}catch(M){console.error("Error clicking gallery input:",M)}},G=()=>{b(!0),D("camera")},Y=()=>{z.current?.click()},ne=()=>{b(!1)},P=M=>{l(M),b(!1)},ee=async M=>{const q=M.target.files?.[0];if(console.log("File selected:",q?.name,"from:",M.target===$.current?"camera":"gallery"),!!q){R(!0);try{await new Promise(de=>setTimeout(de,1e3));const ie={validation:{isValid:!0,issues:[],confidence:.9},metadata:{fileSize:q.size,dimensions:{width:1920,height:1080},timestamp:new Date().toISOString()}};o(q,ie),j(!0),setTimeout(()=>j(!1),2e3)}catch(ie){console.error("Photo validation failed:",ie)}finally{R(!1),$.current&&($.current.value=""),v.current&&(v.current.value="")}}};return e.jsxs("div",{className:"space-y-6 pb-32",style:{minHeight:"100vh"},children:[e.jsx(J,{currentStep:"capture",progress:H,message:I,subMessage:L}),e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs(p.button,{onClick:()=>t("photo-analysis"),className:"flex-1 p-4 rounded-xl transition-all touch-feedback-css relative overflow-hidden",style:{background:a==="photo-analysis"?`
                  radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.3) 0%, transparent 60%),
                  radial-gradient(circle at 70% 80%, rgba(5, 150, 105, 0.2) 0%, transparent 50%),
                  linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(5, 150, 105, 0.15))
                `:`
                  linear-gradient(135deg, rgba(107, 114, 128, 0.08), rgba(75, 85, 99, 0.06))
                `,borderWidth:"2px",borderStyle:"solid",borderColor:a==="photo-analysis"?"rgba(16, 185, 129, 0.6)":"rgba(107, 114, 128, 0.25)",boxShadow:a==="photo-analysis"?`
                  0 8px 32px rgba(16, 185, 129, 0.25),
                  0 0 40px rgba(16, 185, 129, 0.15),
                  inset 0 2px 0 rgba(255, 255, 255, 0.15)
                `:"none"},whileTap:{scale:.97},children:[e.jsxs("div",{className:"flex flex-col items-center gap-2.5",children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:a==="photo-analysis"?`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(5, 150, 105, 0.3))
                    `:"rgba(107, 114, 128, 0.15)",border:a==="photo-analysis"?"2px solid rgba(16, 185, 129, 0.5)":"1px solid rgba(107, 114, 128, 0.3)",boxShadow:a==="photo-analysis"?"0 0 20px rgba(16, 185, 129, 0.4)":"none"},children:e.jsx(x,{Icon:c.Camera,size:24,className:a==="photo-analysis"?"text-white":"text-gray-400",style:{filter:a==="photo-analysis"?"drop-shadow(0 2px 4px rgba(0,0,0,0.3))":"none"}})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:`font-bold text-sm block ${a==="photo-analysis"?"text-white":"text-gray-400"}`,style:{textShadow:a==="photo-analysis"?"0 1px 4px rgba(0,0,0,0.3)":"none"},children:"Scan Repas IA"}),a==="photo-analysis"&&e.jsx(p.span,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"text-emerald-200 text-xs font-medium block",children:"Recommand√©"})]})]}),a==="photo-analysis"&&e.jsx(p.div,{layoutId:"activeIndicator",className:"absolute inset-0 rounded-xl",style:{background:"rgba(16, 185, 129, 0.05)",pointerEvents:"none"},transition:{type:"spring",bounce:.2,duration:.6}})]}),e.jsxs(p.button,{onClick:()=>t("barcode-scan"),className:"flex-1 p-4 rounded-xl transition-all touch-feedback-css relative overflow-hidden",style:{background:a==="barcode-scan"?`
                  radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.3) 0%, transparent 60%),
                  radial-gradient(circle at 70% 80%, rgba(79, 70, 229, 0.2) 0%, transparent 50%),
                  linear-gradient(135deg, rgba(99, 102, 241, 0.25), rgba(79, 70, 229, 0.15))
                `:`
                  linear-gradient(135deg, rgba(107, 114, 128, 0.08), rgba(75, 85, 99, 0.06))
                `,borderWidth:"2px",borderStyle:"solid",borderColor:a==="barcode-scan"?"rgba(99, 102, 241, 0.6)":"rgba(107, 114, 128, 0.25)",boxShadow:a==="barcode-scan"?`
                  0 8px 32px rgba(99, 102, 241, 0.25),
                  0 0 40px rgba(99, 102, 241, 0.15),
                  inset 0 2px 0 rgba(255, 255, 255, 0.15)
                `:"none"},whileTap:{scale:.97},children:[e.jsxs("div",{className:"flex flex-col items-center gap-2.5",children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:a==="barcode-scan"?`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, rgba(99, 102, 241, 0.4), rgba(79, 70, 229, 0.3))
                    `:"rgba(107, 114, 128, 0.15)",border:a==="barcode-scan"?"2px solid rgba(99, 102, 241, 0.5)":"1px solid rgba(107, 114, 128, 0.3)",boxShadow:a==="barcode-scan"?"0 0 20px rgba(99, 102, 241, 0.4)":"none"},children:e.jsx(x,{Icon:c.ScanBarcode,size:24,className:a==="barcode-scan"?"text-white":"text-gray-400",style:{filter:a==="barcode-scan"?"drop-shadow(0 2px 4px rgba(0,0,0,0.3))":"none"}})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:`font-bold text-sm block ${a==="barcode-scan"?"text-white":"text-gray-400"}`,style:{textShadow:a==="barcode-scan"?"0 1px 4px rgba(0,0,0,0.3)":"none"},children:"Code-Barre"}),a==="barcode-scan"&&e.jsx(p.span,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"text-indigo-200 text-xs font-medium block",children:"Rapide"})]})]}),a==="barcode-scan"&&e.jsx(p.div,{layoutId:"activeIndicator",className:"absolute inset-0 rounded-xl",style:{background:"rgba(99, 102, 241, 0.05)",pointerEvents:"none"},transition:{type:"spring",bounce:.2,duration:.6}})]})]}),e.jsxs("div",{className:"space-y-6",children:[a==="photo-analysis"&&!s&&e.jsx("div",{className:"mt-6",children:e.jsx(ve,{isValidating:U,onCameraClick:_,onGalleryClick:V,onBarcodeClick:G,onBarcodeImageUpload:Y})}),a==="photo-analysis"&&s&&e.jsx(re,{mode:"wait",children:e.jsx(p.div,{className:"mt-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsx(Ne,{capturedPhoto:s,showSuccessAnimation:W,onRetake:k})},"captured")}),a==="barcode-scan"&&n.length===0&&i.length===0&&e.jsx("div",{className:"mt-6",children:e.jsxs(O,{className:"p-6 rounded-3xl",style:{background:`
                    radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 60%),
                    radial-gradient(circle at 70% 80%, rgba(79, 70, 229, 0.1) 0%, transparent 50%),
                    rgba(17, 24, 39, 0.95)
                  `,borderColor:"rgba(99, 102, 241, 0.4)",borderWidth:"2px",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",boxShadow:`
                    0 20px 60px rgba(0, 0, 0, 0.3),
                    0 0 40px rgba(99, 102, 241, 0.2),
                    inset 0 2px 0 rgba(255, 255, 255, 0.15),
                    inset 0 -2px 0 rgba(0, 0, 0, 0.1)
                  `},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:`
                          radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                          linear-gradient(135deg, rgba(99, 102, 241, 0.45), rgba(79, 70, 229, 0.35))
                        `,border:"2px solid rgba(99, 102, 241, 0.6)",boxShadow:`
                          0 0 20px rgba(99, 102, 241, 0.6),
                          0 0 40px rgba(99, 102, 241, 0.3),
                          inset 0 2px 0 rgba(255,255,255,0.35),
                          inset 0 -2px 0 rgba(0,0,0,0.2)
                        `},children:e.jsx(x,{Icon:c.ScanBarcode,size:18,style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(99, 102, 241, 0.9)) drop-shadow(0 0 4px rgba(255,255,255,0.5))"}})}),e.jsx("h4",{className:"text-white font-bold text-base",style:{textShadow:"0 2px 8px rgba(99, 102, 241, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:"Scan Code-Barre"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",style:{background:`
                        linear-gradient(135deg,
                          rgba(59, 130, 246, 0.2),
                          rgba(37, 99, 235, 0.15)
                        )
                      `,border:"2px solid rgba(59, 130, 246, 0.4)",borderRadius:"16px",backdropFilter:"blur(12px) saturate(130%)",boxShadow:`
                        0 4px 16px rgba(59, 130, 246, 0.25),
                        0 0 24px rgba(59, 130, 246, 0.15),
                        inset 0 1px 0 rgba(255,255,255,0.2)
                      `},children:[e.jsx(p.div,{className:"w-2 h-2 rounded-full",style:{backgroundColor:"#3B82F6",boxShadow:"0 0 10px #3B82F6"},animate:{scale:[1,1.3,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:"En attente"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative aspect-[4/3] rounded-2xl overflow-visible",style:{background:`
                        radial-gradient(circle at 40% 30%, rgba(99, 102, 241, 0.15) 0%, transparent 60%),
                        radial-gradient(circle at 60% 70%, rgba(79, 70, 229, 0.1) 0%, transparent 50%),
                        linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(79, 70, 229, 0.08))
                      `,border:"2px dashed rgba(99, 102, 241, 0.4)",backdropFilter:"blur(12px) saturate(130%)",WebkitBackdropFilter:"blur(12px) saturate(130%)"},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                              linear-gradient(135deg, rgba(99, 102, 241, 0.25), rgba(79, 70, 229, 0.35))
                            `,border:"2px solid rgba(99, 102, 241, 0.5)",boxShadow:"0 0 30px rgba(99, 102, 241, 0.4)"},children:e.jsx(x,{Icon:c.ScanBarcode,size:48,className:"text-indigo-400",style:{filter:"drop-shadow(0 2px 8px rgba(99, 102, 241, 0.5))"}})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-white font-semibold mb-2 text-base md:text-lg",children:"Scan Rapide"}),e.jsx("p",{className:"text-indigo-200 text-xs md:text-sm leading-relaxed max-w-full sm:max-w-xs mx-auto px-2 sm:px-0",children:"Scannez le code-barre pour une analyse instantan√©e du produit"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:G,className:"btn-glass--primary touch-feedback-css",style:{background:`
                          linear-gradient(135deg,
                            rgba(99, 102, 241, 0.8),
                            rgba(79, 70, 229, 0.6)
                          )
                        `,backdropFilter:"blur(20px) saturate(160%)",boxShadow:`
                          0 12px 40px rgba(99, 102, 241, 0.4),
                          0 0 60px rgba(99, 102, 241, 0.3),
                          inset 0 3px 0 rgba(255,255,255,0.3),
                          inset 0 -3px 0 rgba(0,0,0,0.2)
                        `,border:"2px solid rgba(99, 102, 241, 0.6)"},children:e.jsxs("div",{className:"relative flex flex-col items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.Camera,size:24,className:"text-white",style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.3))"}}),e.jsx("span",{className:"font-bold text-sm",children:"Cam√©ra"})]})}),e.jsx("button",{onClick:Y,className:"btn-glass touch-feedback-css",style:{background:`
                          linear-gradient(135deg,
                            rgba(99, 102, 241, 0.25),
                            rgba(79, 70, 229, 0.15)
                          )
                        `,backdropFilter:"blur(20px) saturate(140%)",boxShadow:`
                          0 8px 32px rgba(99, 102, 241, 0.25),
                          0 0 40px rgba(99, 102, 241, 0.15),
                          inset 0 2px 0 rgba(255,255,255,0.15)
                        `,border:"2px solid rgba(99, 102, 241, 0.4)"},children:e.jsxs("div",{className:"relative flex flex-col items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.Image,size:24,className:"text-indigo-300",style:{filter:"drop-shadow(0 2px 8px rgba(99, 102, 241, 0.5))"}}),e.jsx("span",{className:"font-bold text-sm text-white",children:"Galerie"})]})})]})]})]})}),n.length>0&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-white font-semibold text-base flex items-center gap-2",children:[e.jsx(x,{Icon:c.ScanBarcode,size:20,className:"text-indigo-400"}),e.jsx("span",{children:"Codes-barres d√©tect√©s"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-300 text-xs font-bold",children:n.length})]})}),e.jsx("div",{className:"space-y-3",children:n.map((M,q)=>e.jsx(O,{className:"p-4",style:{background:"rgba(99, 102, 241, 0.08)",borderColor:"rgba(99, 102, 241, 0.3)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(79, 70, 229, 0.2))",border:"1px solid rgba(99, 102, 241, 0.4)"},children:e.jsx(x,{Icon:c.ScanBarcode,size:24,className:"text-indigo-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-semibold text-sm mb-1",children:M.barcode}),e.jsx("p",{className:"text-indigo-300 text-xs",children:"En attente d'analyse"})]})]}),e.jsx("button",{onClick:()=>g(M.barcode),className:"w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-red-500/20",style:{border:"1px solid rgba(239, 68, 68, 0.3)"},children:e.jsx(x,{Icon:c.X,size:16,className:"text-red-400"})})]})},`barcode-${M.barcode}-${q}-${M.scannedAt}`))}),!s&&n.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(O,{className:"p-4 text-center",style:{background:"rgba(99, 102, 241, 0.05)",borderColor:"rgba(99, 102, 241, 0.2)"},children:[e.jsx("p",{className:"text-gray-300 text-sm mb-3",children:"Ajouter une photo pour enrichir votre analyse nutritionnelle"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:_,className:"flex-1 btn-glass touch-feedback-css",style:{background:"rgba(16, 185, 129, 0.08)",borderColor:"rgba(16, 185, 129, 0.25)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.Camera,size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Appareil photo"})]})}),e.jsx("button",{onClick:V,className:"flex-1 btn-glass touch-feedback-css",style:{background:"rgba(16, 185, 129, 0.08)",borderColor:"rgba(16, 185, 129, 0.25)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.Image,size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Galerie"})]})})]})]})})]}),i.length>0&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-white font-semibold text-base flex items-center gap-2",children:[e.jsx(x,{Icon:c.Check,size:20,className:"text-green-400"}),e.jsx("span",{children:"Produits analys√©s"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-green-500/20 text-green-300 text-xs font-bold",children:i.length})]})}),e.jsx("div",{className:"space-y-3",children:i.map(M=>e.jsx(Ye,{product:M,onPortionChange:N,onRemove:r},M.barcode))})]}),(s||n.length>0||i.length>0)&&e.jsx("div",{ref:T,className:"mt-8",children:e.jsx(we,{onProceedToProcessing:w,isProcessingInProgress:F,hasPhoto:!!s,hasScannedBarcodes:n.length>0,hasScannedProducts:i.length>0,scannedBarcodesCount:n.length,scannedProductsCount:i.length})}),a==="photo-analysis"&&!s&&n.length===0&&i.length===0&&e.jsx(ce,{benefits:f,themeColor:"#10B981",title:"Pourquoi scanner mes repas ?"}),a==="barcode-scan"&&n.length===0&&i.length===0&&e.jsx(ce,{benefits:C,themeColor:"#6366F1",title:"Pourquoi scanner un code-barre ?"})]}),e.jsx("input",{ref:$,type:"file",accept:"image/*",onChange:ee,style:{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0",opacity:0,pointerEvents:"none"},capture:"environment","data-testid":"camera-file-input"}),e.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:ee,style:{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0",opacity:0,pointerEvents:"none"},"data-testid":"gallery-file-input"}),e.jsx("input",{ref:z,type:"file",accept:"image/*",onChange:M=>{M.target.files?.[0]&&(b(!0),D("upload"))},className:"hidden"}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 z-50",style:{pointerEvents:"none"},children:e.jsx("div",{style:{pointerEvents:"auto"},children:e.jsx(_e,{capturedPhoto:s,onBack:E})})}),m&&e.jsx(He,{onBarcodeDetected:P,onClose:ne,mode:d,uploadedImage:d==="upload"?z.current?.files?.[0]:void 0})]})},Je=({analysisZones:a,currentPhase:t,analysisColor:s})=>e.jsxs("div",{className:"absolute inset-0 analysis-overlays perf-heavy",children:[e.jsx("div",{className:"absolute top-0 w-1 h-full opacity-70 scan-line-vertical",style:{background:`linear-gradient(180deg, 
            transparent 0%, 
            ${s}CC 30%, 
            ${s}FF 50%, 
            ${s}CC 70%, 
            transparent 100%
          )`,left:"50%",transform:"translateX(-50%)",boxShadow:`0 0 8px ${s}80`}}),e.jsx("div",{className:"absolute left-0 w-full h-1 opacity-60 scan-line-horizontal",style:{background:`linear-gradient(90deg, 
            transparent 0%, 
            ${s}80 30%, 
            ${s}CC 50%, 
            ${s}80 70%, 
            transparent 100%
          )`,top:"50%",transform:"translateY(-50%)",boxShadow:`0 0 6px ${s}60`}}),e.jsx("div",{className:"absolute inset-0 opacity-25 analysis-grid",children:e.jsx("div",{className:"w-full h-full",style:{backgroundImage:`
              linear-gradient(${s}30 1px, transparent 1px),
              linear-gradient(90deg, ${s}30 1px, transparent 1px)
            `,backgroundSize:"32px 32px"}})}),e.jsx("div",{className:"absolute inset-0 nutrition-keypoints",children:[{x:25,y:30,label:"Prot√©ines",color:"#EF4444"},{x:75,y:25,label:"Lipides",color:"#8B5CF6"}].map((n,i)=>e.jsx("div",{className:`absolute w-4 h-4 rounded-full nutrition-keypoint particle-css particle-css--${i+1}`,style:{left:`${n.x}%`,top:`${n.y}%`,background:n.color,boxShadow:`
                0 0 16px ${n.color}80,
                0 0 32px ${n.color}40
              `,border:`1px solid ${n.color}CC`,"--particle-color":n.color},children:e.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 px-2 py-1 rounded text-xs font-medium whitespace-nowrap pointer-events-none",style:{background:`${n.color}20`,border:`1px solid ${n.color}40`,color:n.color,backdropFilter:"blur(8px)",opacity:t==="detection"?1:.3},children:n.label})},n.label))}),a.slice(0,3).map(n=>e.jsx("div",{className:"absolute w-16 h-16 rounded-full pointer-events-none",style:{left:`${n.x}%`,top:`${n.y}%`,background:`radial-gradient(circle, 
              ${s}${Math.round(n.intensity*80)} 0%, 
              ${s}${Math.round(n.intensity*40)} 50%, 
              transparent 70%
            )`,border:`1px solid ${s}40`,backdropFilter:"blur(4px)"}},n.id)),e.jsx("div",{className:"absolute inset-0 rounded-xl pointer-events-none ai-focus-overlay",style:{background:`
            radial-gradient(circle at center, 
              transparent 20%, 
              ${s}10 40%, 
              ${s}20 60%, 
              ${s}15 80%, 
              transparent 100%
            )
          `,mixBlendMode:"overlay"}})]}),ea=({capturedPhoto:a,analysisZones:t,currentPhase:s,analysisColor:n})=>{const i=X();return e.jsxs(O,{className:"p-6 relative overflow-visible glass-card--analysis",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.12) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, rgba(6, 182, 212, 0.08) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"rgba(16, 185, 129, 0.3)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px rgba(16, 185, 129, 0.15),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `,backdropFilter:"blur(20px) saturate(150%)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(5, 150, 105, 0.3))
              `,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                0 0 24px rgba(16, 185, 129, 0.5),
                inset 0 2px 0 rgba(255,255,255,0.3),
                inset 0 -2px 0 rgba(0,0,0,0.2)
              `},children:e.jsx(x,{Icon:c.Scan,size:20,style:{color:"#fff",filter:"drop-shadow(0 2px 6px rgba(16, 185, 129, 0.8))"}})}),e.jsx("h4",{className:"text-white font-bold text-lg",style:{textShadow:"0 2px 8px rgba(16, 185, 129, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:"Forge Nutritionnelle"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2",style:{background:`
              linear-gradient(135deg,
                rgba(16, 185, 129, 0.25),
                rgba(34, 197, 94, 0.2)
              )
            `,border:"2px solid rgba(16, 185, 129, 0.5)",borderRadius:"20px",backdropFilter:"blur(16px) saturate(140%)",boxShadow:`
              0 4px 20px rgba(16, 185, 129, 0.3),
              0 0 30px rgba(16, 185, 129, 0.2),
              inset 0 1px 0 rgba(255,255,255,0.25)
            `},children:[e.jsx(p.div,{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:n,boxShadow:`0 0 12px ${n}`},animate:i?{}:{scale:[1,1.4,1],opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsx("span",{className:"font-bold text-sm",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:s==="detection"?"D√©tection":s==="analysis"?"Analyse":"Calcul"})]})]}),e.jsxs("div",{className:"relative aspect-[4/3] rounded-xl overflow-hidden bg-black/20 analysis-viewport",children:[e.jsx("img",{src:a.url,alt:"Repas en cours d'analyse",className:"w-full h-full object-cover border border-green-400/20"}),!i&&e.jsx(Je,{analysisZones:t,currentPhase:s,analysisColor:n})]})]})},aa=({currentProgress:a,currentMessage:t,currentSubMessage:s,currentPhase:n,analysisColor:i})=>{const o=X();return e.jsx(O,{className:"p-6 text-center glass-card--progress",style:{background:`
          radial-gradient(circle at 50% 30%, rgba(16, 185, 129, 0.12) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, rgba(34, 197, 94, 0.08) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"rgba(16, 185, 129, 0.3)",borderRadius:"24px",backdropFilter:"blur(20px) saturate(150%)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px rgba(16, 185, 129, 0.15),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center relative",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, rgba(16, 185, 129, 0.35), rgba(34, 197, 94, 0.25))
              `,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                0 0 40px rgba(16, 185, 129, 0.5),
                inset 0 2px 0 rgba(255,255,255,0.3),
                inset 0 -2px 0 rgba(0,0,0,0.2)
              `},children:e.jsxs(p.div,{className:"relative",animate:o?{}:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:[e.jsx(x,{Icon:c.Loader2,size:28,className:"loader-essential",style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(16, 185, 129, 0.8))"}}),!o&&e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`conic-gradient(from 0deg,
                      transparent 0%,
                      ${i}40 25%,
                      transparent 50%,
                      ${i}60 75%,
                      transparent 100%
                    )`,animation:"spinHalo 3s linear infinite reverse"}})]})}),e.jsx("h3",{className:"text-2xl font-bold text-white",style:{textShadow:"0 2px 12px rgba(16, 185, 129, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:t})]}),e.jsx("p",{className:"text-green-100 text-sm mb-4 leading-relaxed max-w-sm mx-auto",children:s}),e.jsxs(p.div,{className:"inline-flex items-center justify-center gap-2 px-4 py-2 mx-auto",style:{background:`
              linear-gradient(135deg,
                rgba(16, 185, 129, 0.2),
                rgba(34, 197, 94, 0.15)
              )
            `,border:"2px solid rgba(16, 185, 129, 0.4)",borderRadius:"999px",boxShadow:`
              0 0 20px rgba(16, 185, 129, 0.3),
              inset 0 1px 0 rgba(255,255,255,0.2)
            `,backdropFilter:"blur(12px)"},initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.4},children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:i,boxShadow:`0 0 8px ${i}`,animation:"pulse 1.5s ease-in-out infinite"}}),e.jsx("span",{className:"text-sm font-bold",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:n==="detection"?"D√©tection":n==="analysis"?"Analyse":"Calcul"})]},n),e.jsx("div",{className:"flex items-center justify-center gap-1 mt-3",children:["detection","analysis","calculation"].map((l,h)=>e.jsx(p.div,{className:"w-2 h-2 rounded-full",style:{background:l===n?i:"rgba(255, 255, 255, 0.3)",boxShadow:l===n?`0 0 8px ${i}60`:"none"},animate:l===n?{scale:[1,1.2,1],opacity:[.8,1,.8]}:{},transition:{duration:1.5,repeat:l===n?1/0:0,ease:"easeInOut"}},l))}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-2 mt-4 overflow-hidden backdrop-blur-sm",children:e.jsx(p.div,{className:"h-full rounded-full relative",style:{background:`
                linear-gradient(90deg, 
                  ${i}, 
                  rgba(34, 197, 94, 0.9),
                  rgba(52, 211, 153, 0.8)
                )
              `,boxShadow:`
                0 0 16px ${i}80,
                inset 0 1px 0 rgba(255,255,255,0.3)
              `},initial:{width:0},animate:{width:`${a}%`},transition:{duration:.8,ease:"easeOut"},children:!o&&e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                    transparent 0%, 
                    rgba(255,255,255,0.4) 50%, 
                    transparent 100%
                  )`,animation:"progressShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-green-300 font-medium",children:[Math.round(a),"% termin√©"]}),e.jsxs("span",{className:"text-white/60",children:["Phase: ",n==="detection"?"D√©tection":n==="analysis"?"Analyse":"Calcul"]})]})]})})},ta=({analysisColor:a})=>e.jsxs("div",{className:"relative overflow-hidden data-flow-container h-16 perf-heavy",children:[Array.from({length:4}).map((t,s)=>e.jsx("div",{className:`absolute w-3 h-3 rounded-full particle-css particle-css--${s+1}`,style:{background:`linear-gradient(135deg, ${a}, rgba(34, 197, 94, 0.8))`,left:`${10+s*10}%`,top:`${40+s%3*20}%`,boxShadow:`
              0 0 12px ${a}80,
              0 0 24px ${a}40
            `,border:`1px solid ${a}CC`,"--particle-color":a}},s)),e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{opacity:.3},children:Array.from({length:2}).map((t,s)=>e.jsx("path",{d:`M ${20+s*30} 50 Q ${40+s*30} 20 ${60+s*30} 50`,stroke:a,strokeWidth:"2",fill:"none",strokeDasharray:"4 4",style:{animation:`data-flow-path 3s ease-in-out infinite ${s*.5}s`}},s))})]}),sa=`
@keyframes data-flow-path {
  0% { stroke-dashoffset: 20; }
  100% { stroke-dashoffset: -20; }
}
`;if(typeof document<"u"){const a=document.createElement("style");a.textContent=sa,document.head.appendChild(a)}const ra=({capturedPhoto:a,progress:t,progressMessage:s,progressSubMessage:n})=>{const[i,o]=S.useState([]),[l,h]=S.useState("detection"),N="#10B981";return S.useEffect(()=>{const r=()=>{const g=Array.from({length:6},(k,E)=>({x:Math.random()*80+10,y:Math.random()*80+10,intensity:Math.random()*.6+.4,id:`zone-${Date.now()}-${E}`}));o(g)};r();const y=setInterval(r,2e3);return()=>clearInterval(y)},[]),S.useEffect(()=>{const r=["detection","analysis","calculation"];let y=0;const g=setInterval(()=>{y=(y+1)%r.length,h(r[y]),u.debug("MEAL_ANALYSIS","Analysis phase changed",{phase:r[y],timestamp:new Date().toISOString()})},3e3);return()=>clearInterval(g)},[]),a?e.jsxs("div",{className:"space-y-6 w-full meal-processing-enter",children:[e.jsx(J,{currentStep:"processing",progress:t,message:s,subMessage:n}),e.jsx("div",{children:e.jsx(ea,{capturedPhoto:a,analysisZones:i,currentPhase:l,analysisColor:N})}),e.jsx("div",{children:e.jsx(aa,{currentProgress:t,currentMessage:s,currentSubMessage:n,currentPhase:l,analysisColor:N})}),e.jsx(ta,{analysisColor:N})]}):null},na=({mealName:a,totalCalories:t,confidence:s,analysisModel:n,celebrationActive:i,analysisMetadata:o})=>{const l=X(),[h,N]=S.useState(0);return S.useEffect(()=>{if(t===0)return;const r=800,y=30,g=t/y,k=r/y;let E=0;const w=setInterval(()=>{E++;const F=Math.min(t,Math.round(g*E));N(F),(E>=y||F>=t)&&(N(t),clearInterval(w))},k);return()=>clearInterval(w)},[t]),e.jsx("div",{className:"meal-results-enter",children:e.jsx(p.div,{animate:i?{boxShadow:["0 12px 40px rgba(0, 0, 0, 0.25), 0 0 40px color-mix(in srgb, #FF4500 20%, transparent)","0 12px 40px rgba(0, 0, 0, 0.25), 0 0 60px color-mix(in srgb, #FF4500 35%, transparent)","0 12px 40px rgba(0, 0, 0, 0.25), 0 0 40px color-mix(in srgb, #FF4500 20%, transparent)"]}:l?{}:{boxShadow:["0 12px 40px rgba(0, 0, 0, 0.25), 0 0 30px color-mix(in srgb, #FF4500 15%, transparent)","0 12px 40px rgba(0, 0, 0, 0.25), 0 0 45px color-mix(in srgb, #FF4500 25%, transparent)","0 12px 40px rgba(0, 0, 0, 0.25), 0 0 30px color-mix(in srgb, #FF4500 15%, transparent)"]},transition:{duration:i?1.5:3,repeat:1/0,ease:"easeInOut"},children:e.jsxs(O,{className:"p-6 md:p-8 text-center relative w-full perf-critical",style:{background:`
              radial-gradient(circle at 50% 50%, color-mix(in srgb, #FF4500 6%, transparent) 0%, transparent 70%),
              radial-gradient(circle at 80% 20%, color-mix(in srgb, #FF8C00 4%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #FF4500 30%, transparent)",boxShadow:`
              0 12px 40px rgba(0, 0, 0, 0.25),
              0 0 30px color-mix(in srgb, #FF4500 15%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.15)
            `,backdropFilter:"blur(20px) saturate(150%)",borderRadius:"24px",border:"2px solid color-mix(in srgb, #FF4500 40%, transparent)"},children:[e.jsx("div",{className:"absolute inset-0 rounded-inherit pointer-events-none",style:{background:"radial-gradient(circle at center, color-mix(in srgb, #FF4500 2%, transparent) 0%, transparent 70%)",filter:"blur(16px)",transform:"scale(1.1)",zIndex:-1,animation:i&&!l?"calorie-forge-glow 3s ease-in-out infinite":l?"none":"calorie-forge-glow-idle 4s ease-in-out infinite"}}),e.jsxs("div",{className:"relative z-10 space-y-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(p.div,{className:"w-24 h-24 rounded-full flex items-center justify-center relative",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #FF4500 50%, transparent), color-mix(in srgb, #FF8C00 40%, transparent))
                `,border:"2px solid color-mix(in srgb, #FF4500 70%, transparent)",boxShadow:`
                  0 0 50px color-mix(in srgb, #FF4500 60%, transparent),
                  0 0 80px color-mix(in srgb, #FF4500 40%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.35)
                `},animate:i?{scale:[1,1.12,1],boxShadow:["0 0 50px color-mix(in srgb, #FF4500 60%, transparent), 0 0 80px color-mix(in srgb, #FF4500 40%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.35)","0 0 70px color-mix(in srgb, #FF4500 80%, transparent), 0 0 120px color-mix(in srgb, #FF4500 60%, transparent), inset 0 3px 0 rgba(255, 255, 255, 0.45)","0 0 50px color-mix(in srgb, #FF4500 60%, transparent), 0 0 80px color-mix(in srgb, #FF4500 40%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.35)"]}:l?{}:{scale:[1,1.03,1],rotate:[0,2,-2,0]},transition:{duration:i?1.5:2.5,repeat:1/0,ease:"easeInOut"},children:e.jsx(p.div,{animate:l?{}:{scale:[1,1.1,.95,1],opacity:[1,.9,1,1]},transition:{duration:1.8,repeat:1/0,ease:"easeInOut",times:[0,.3,.6,1]},children:e.jsx(x,{Icon:c.Flame,size:48,className:"text-white",variant:"pure","aria-hidden":"true"})})})}),e.jsxs("div",{className:"text-center space-y-5",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white leading-normal",children:a}),e.jsx("p",{className:"text-white/70 text-base",children:"Repas analys√© par TwinForge"})]}),e.jsx("div",{className:"text-5xl md:text-6xl font-black leading-none",style:{background:`
                  linear-gradient(135deg, 
                    #FF4500, 
                    #FF8C00,
                    #FFD700
                  )
                `,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",textShadow:i?"0 0 40px color-mix(in srgb, #FF4500 60%, transparent)":"0 0 20px color-mix(in srgb, #FF4500 40%, transparent)",filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.3))"},children:h}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold text-white",children:"√ânergie Totale"}),e.jsx("p",{className:"text-white/80 text-base md:text-lg",children:"Kilocalories analys√©es"})]})]})]})]})})})},ia=({analysisResults:a,celebrationActive:t})=>{const s=X();return e.jsxs("div",{className:"macronutrients-card-container",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(p.div,{className:"macronutrients-header-icon",whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:20},children:e.jsx(x,{Icon:c.BarChart3,size:20,style:{color:"var(--nutrition-secondary)"}})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Macronutriments Forg√©s"})]}),e.jsxs("div",{className:"nutrition-stats-grid",children:[e.jsxs(p.div,{className:"nutrition-stat-card proteins",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:s?.1:.5,delay:s?0:.1},children:[e.jsx("div",{className:`nutrition-stat-icon ${t?"celebrating":""}`,children:e.jsx(x,{Icon:c.Activity,size:20,style:{color:"var(--nutrition-proteins)"}})}),e.jsxs(p.div,{className:"nutrition-stat-value",style:{color:"var(--nutrition-proteins)"},initial:{scale:0},animate:{scale:1},transition:{type:s?"tween":"spring",stiffness:300,delay:s?0:.3},children:[Math.round(a.macronutrients.proteins),"g"]}),e.jsx("div",{className:"text-white font-medium text-sm",children:"Prot√©ines"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"R√©cup√©ration"})]}),e.jsxs(p.div,{className:"nutrition-stat-card carbs",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:s?.1:.5,delay:s?0:.2},children:[e.jsx("div",{className:`nutrition-stat-icon ${t?"celebrating":""}`,children:e.jsx(x,{Icon:c.Zap,size:20,style:{color:"var(--nutrition-carbs)"}})}),e.jsxs(p.div,{className:"nutrition-stat-value",style:{color:"var(--nutrition-carbs)"},initial:{scale:0},animate:{scale:1},transition:{type:s?"tween":"spring",stiffness:300,delay:s?0:.4},children:[Math.round(a.macronutrients.carbs),"g"]}),e.jsx("div",{className:"text-white font-medium text-sm",children:"Glucides"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"√ânergie rapide"})]}),e.jsxs(p.div,{className:"nutrition-stat-card fats",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:s?.1:.5,delay:s?0:.3},children:[e.jsx("div",{className:`nutrition-stat-icon ${t?"celebrating":""}`,children:e.jsx(x,{Icon:c.Heart,size:20,style:{color:"var(--nutrition-fats)"}})}),e.jsxs(p.div,{className:"nutrition-stat-value",style:{color:"var(--nutrition-fats)"},initial:{scale:0},animate:{scale:1},transition:{type:s?"tween":"spring",stiffness:300,delay:s?0:.5},children:[Math.round(a.macronutrients.fats),"g"]}),e.jsx("div",{className:"text-white font-medium text-sm",children:"Lipides"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Graisses saines"})]})]}),e.jsxs(p.div,{className:"nutrition-confidence-indicator",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:s?.1:.6,delay:s?0:.6},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{Icon:c.BarChart3,size:16,style:{color:"var(--nutrition-secondary)",filter:"drop-shadow(0 0 8px color-mix(in srgb, var(--nutrition-secondary) 60%, transparent))"}}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"R√©partition Macronutritionnelle"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-lg",style:{color:"var(--nutrition-secondary)"},children:[Math.round((a.macronutrients.proteins+a.macronutrients.carbs+a.macronutrients.fats)/3),"g"]}),e.jsx("div",{className:"text-white/60 text-xs",children:"Moyenne"})]})]})]})};function se(a){const t={protein:"#EF4444",carbs:"#F59E0B",vegetables:"#22C55E",healthy_fats:"#8B5CF6",dairy:"#06B6D4",fruits:"#EC4899",grains:"#D97706",default:"#10B981"};return t[a]||t.default}const oa=({analysisResults:a})=>{const t=X();return e.jsxs("div",{className:"detected-foods-card-container",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(p.div,{className:"detected-foods-header-icon",whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:20},children:e.jsx(x,{Icon:c.Eye,size:20,style:{color:"var(--nutrition-accent)"}})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Aliments D√©tect√©s"})]}),e.jsx("div",{className:"space-y-3",children:a.detected_foods.map((s,n)=>e.jsx(p.div,{className:"food-item-card",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:t?.1:.4,delay:t?0:.3+n*.1},style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${se(s.category)} 8%, transparent) 0%, transparent 60%),
                rgba(255, 255, 255, 0.08)
              `,border:`2px solid color-mix(in srgb, ${se(s.category)} 25%, transparent)`,boxShadow:`
                0 4px 16px rgba(0, 0, 0, 0.15),
                0 0 12px color-mix(in srgb, ${se(s.category)} 15%, transparent),
                inset 0 1px 0 rgba(255, 255, 255, 0.12)
              `},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"food-category-indicator",style:{color:se(s.category)}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold text-lg",children:s.name}),s.portion_size&&e.jsx("div",{className:"text-white/60 text-sm mb-1",children:s.portion_size}),e.jsxs("div",{className:"text-white/70 text-sm",children:["P: ",Math.round(s.proteins),"g ‚Ä¢ G: ",Math.round(s.carbs),"g ‚Ä¢ L: ",Math.round(s.fats),"g"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-white font-bold text-xl",children:s.calories}),e.jsx("div",{className:"text-white/70 text-sm",children:"kcal"})]})]})},n))})]})},la=({capturedPhoto:a})=>(X(),e.jsxs(O,{className:"p-6 glass-card--photo-analyzed",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-primary) 12%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, var(--brand-primary) 35%, transparent)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px color-mix(in srgb, var(--brand-primary) 15%, transparent),
          0 0 60px color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent),
          inset 0 1px 0 rgba(255, 255, 255, 0.15)
        `,backdropFilter:"blur(20px) saturate(150%)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(p.div,{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, var(--brand-primary) 40%, transparent), color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent))
            `,border:"2px solid color-mix(in srgb, var(--brand-primary) 60%, transparent)",boxShadow:"0 0 25px color-mix(in srgb, var(--brand-primary) 40%, transparent)"},whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:20},children:e.jsx(x,{Icon:c.Camera,size:18,style:{color:"var(--color-plasma-cyan)"}})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Capture Nutritionnelle"})]}),e.jsxs("div",{className:"aspect-[4/3] rounded-2xl overflow-hidden relative",children:[e.jsx("img",{src:a.url,alt:"Repas analys√©",className:"w-full h-full object-cover",style:{border:"2px solid color-mix(in srgb, var(--brand-primary) 30%, transparent)"}}),e.jsx("div",{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{background:`
              radial-gradient(circle at center, color-mix(in srgb, var(--nutrition-primary) 8%, transparent) 0%, transparent 70%),
              radial-gradient(circle at 30% 30%, color-mix(in srgb, var(--color-plasma-cyan) 6%, transparent) 0%, transparent 50%)
            `,border:"1px solid color-mix(in srgb, var(--nutrition-primary) 20%, transparent)",backdropFilter:"blur(4px) saturate(120%)"}}),e.jsx("div",{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{background:`
              linear-gradient(135deg, 
                color-mix(in srgb, var(--color-plasma-cyan) 4%, transparent) 0%, 
                transparent 30%, 
                color-mix(in srgb, var(--nutrition-primary) 3%, transparent) 70%, 
                transparent 100%
              )
            `,mixBlendMode:"overlay"}})]})]})),ca=({isSaving:a,onSaveMeal:t,onRetake:s,onNewScan:n,analysisResults:i})=>{const o=X(),{click:l,formSubmit:h}=Z(),N=async()=>{h();try{await t()}catch(r){console.error("ActionButtons: Save meal failed:",r)}};return e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:o?.1:.6,delay:o?0:.4},className:"space-y-4",children:[e.jsx("button",{onClick:N,disabled:a,className:"btn-save-meal-cta touch-feedback-css",children:e.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-3",children:[e.jsx("div",{className:a?"icon-spin-css":"",children:e.jsx(x,{Icon:a?c.Loader2:c.Check,size:24})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:a?"Sauvegarde...":"Sauvegarder le Repas"})]})}),e.jsxs("div",{className:"meal-secondary-actions-grid",children:[e.jsx("button",{onClick:()=>{l(),s()},className:"btn-meal-secondary retake touch-target touch-feedback-css",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(x,{Icon:c.RotateCcw,size:18}),e.jsx("span",{className:"font-medium",children:"Reprendre"})]})}),e.jsx("button",{onClick:()=>{l(),n()},className:"btn-meal-secondary new-scan touch-target touch-feedback-css",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(x,{Icon:c.Plus,size:18}),e.jsx("span",{className:"font-medium",children:"Nouveau Scan"})]})})]})]})},da=({analysisResults:a,capturedPhoto:t,onSaveMeal:s,isSaving:n,onRetake:i,onNewScan:o,progress:l,progressMessage:h,progressSubMessage:N})=>{const[r,y]=A.useState(!1);return!a||!t?null:(A.useEffect(()=>{if(n)y(!0);else{const g=setTimeout(()=>y(!1),1e3);return()=>clearTimeout(g)}},[n]),e.jsxs("div",{className:`space-y-6 w-full meal-results-enter pb-6 ${r?"celebration-active celebration-glow-css":""}`,children:[e.jsx(J,{currentStep:"results",progress:l,message:h,subMessage:N,celebrationActive:r}),e.jsx("div",{children:e.jsx(na,{totalCalories:a.total_calories,mealName:a.meal_name,confidence:a.confidence,analysisModel:a.analysis_metadata?.analysis_model_used||"advanced",celebrationActive:r,analysisMetadata:a.analysis_metadata})}),e.jsx("div",{children:e.jsx(ia,{analysisResults:a,celebrationActive:r})}),e.jsx("div",{children:e.jsx(oa,{analysisResults:a})}),e.jsx("div",{children:e.jsx(la,{capturedPhoto:t})}),e.jsx("div",{children:e.jsx(ca,{isSaving:n,onSaveMeal:s,onRetake:i,onNewScan:o,analysisResults:a})})]}))},K={scanType:"photo-analysis",currentStep:"capture",captureMode:"photo",capturedPhoto:null,scannedBarcodes:[],scannedProducts:[],analysisResults:null,barcodeAnalysisResults:null,isProcessing:!1,progress:0,progressMessage:"Pr√™t √† scanner votre repas",progressSubMessage:"Prenez une photo ou s√©lectionnez depuis la galerie",analysisError:null,analysisMetadata:null,isScanningBarcode:!1};async function ua(a){return new Promise((t,s)=>{const n=new FileReader;n.onload=()=>{const o=n.result.split(",")[1];t(o)},n.onerror=s,n.readAsDataURL(a)})}function xa(a){return{sex:a?.sex,height_cm:a?.height_cm,weight_kg:a?.weight_kg,target_weight_kg:a?.target_weight_kg,activity_level:a?.activity_level,objective:a?.objective,birthdate:a?.birthdate,job_category:a?.job_category,nutrition:{diet:a?.nutrition?.diet,allergies:a?.nutrition?.allergies||[],intolerances:a?.nutrition?.intolerances||[],disliked:a?.nutrition?.disliked||[],budgetLevel:a?.nutrition?.budgetLevel,proteinTarget_g:a?.nutrition?.proteinTarget_g,fastingWindow:a?.nutrition?.fastingWindow},health:{bloodType:a?.health?.bloodType,conditions:a?.health?.conditions||[],medications:a?.health?.medications||[]},emotions:{chronotype:a?.emotions?.chronotype,stress:a?.emotions?.stress,sleepHours:a?.emotions?.sleepHours,moodBaseline:a?.emotionBaseline?.moodBaseline,sensitivities:a?.emotions?.sensitivities||[]},workout:{type:a?.preferences?.workout?.type,sessionsPerWeek:a?.preferences?.workout?.sessionsPerWeek,preferredDuration:a?.preferences?.workout?.preferredDuration,equipment:a?.preferences?.workout?.equipment||[],morningWorkouts:a?.preferences?.workout?.morningWorkouts,highIntensity:a?.preferences?.workout?.highIntensity,groupWorkouts:a?.preferences?.workout?.groupWorkouts,outdoorActivities:a?.preferences?.workout?.outdoorActivities},constraints:a?.constraints||{},calculated_metrics:(()=>{const t=a?.birthdate?new Date().getFullYear()-new Date(a.birthdate).getFullYear():void 0,s=a?.height_cm&&a?.weight_kg?a.weight_kg/Math.pow(a.height_cm/100,2):void 0,n=a?.height_cm&&a?.weight_kg&&t?a.sex==="male"?88.362+13.397*a.weight_kg+4.799*a.height_cm-5.677*t:447.593+9.247*a.weight_kg+3.098*a.height_cm-4.33*t:void 0,i=a?.activity_level==="sedentary"?1.2:a?.activity_level==="light"?1.375:a?.activity_level==="moderate"?1.55:a?.activity_level==="active"?1.725:a?.activity_level==="athlete"?1.9:1.55,o=n?n*i:void 0,l=a?.objective==="muscle_gain"?2.2:a?.objective==="fat_loss"?2:1.6,h=a?.weight_kg?a.weight_kg*l:void 0;return{age:t,bmi:s?Math.round(s*10)/10:void 0,bmr:n?Math.round(n):void 0,tdee:o?Math.round(o):void 0,protein_target_calculated:h?Math.round(h):void 0,daily_calorie_target:o?Math.round(o):void 0}})()}}function ga({scanFlowState:a,setScanFlowState:t,profile:s,userId:n,clientScanIdRef:i,processingGuardRef:o,readyForProcessingRef:l,showToast:h,success:N,errorSound:r,queryClient:y,onAnalysisError:g,onSuccess:k}){const E=A.useCallback(async(j,m)=>{const b={file:j,url:URL.createObjectURL(j),validationResult:{isValid:m.validation?.isValid??!0,issues:m.validation?.issues??[],confidence:m.validation?.confidence??.8},captureReport:m};t(d=>({...d,capturedPhoto:b,analysisError:null,progress:33,progressMessage:"Forge du Repas",progressSubMessage:"Photo captur√©e avec succ√®s"})),u.info("MEAL_SCAN_FLOW","Photo captured",{clientScanId:i.current,isValid:b.validationResult.isValid}),setTimeout(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth",block:"center"})},300)},[t,i,l]),w=A.useCallback(()=>{t(j=>({...j,capturedPhoto:null,analysisError:null,analysisMetadata:null,currentStep:"capture",progress:0,progressMessage:"Forge du Repas",progressSubMessage:"Pr√™t pour une nouvelle capture"})),u.info("MEAL_SCAN_FLOW","Photo retake requested",{clientScanId:i.current})},[t,i]),F=A.useCallback(async()=>{if(o.current||!a.capturedPhoto&&a.scannedBarcodes.length===0&&a.scannedProducts.length===0||!n)return;o.current=!0,t(m=>({...m,isProcessing:!0,currentStep:"processing",analysisError:null,progress:20,progressMessage:"Analyse du Carburant",progressSubMessage:"D√©marrage de l'analyse..."}));const j=i.current;try{if(a.scannedBarcodes.length>0){u.info("MEAL_SCAN_FLOW","Starting barcode analysis",{clientScanId:j,barcodesCount:a.scannedBarcodes.length,barcodes:a.scannedBarcodes.map(f=>f.barcode)}),t(f=>({...f,progress:30,progressSubMessage:`Analyse de ${a.scannedBarcodes.length} code${a.scannedBarcodes.length>1?"s-barres":"-barre"}...`}));const v=[],z=[];for(let f=0;f<a.scannedBarcodes.length;f++){const C=a.scannedBarcodes[f];u.info("MEAL_SCAN_FLOW",`Analyzing barcode ${f+1}/${a.scannedBarcodes.length}`,{clientScanId:j,barcode:C.barcode,portionMultiplier:C.portionMultiplier});try{const _=await Q.getProductByBarcode(C.barcode);if(_.success&&_.product){const V=Q.convertToMealItem(_.product,C.portionMultiplier);V?(v.push({barcode:_.product.barcode,name:_.product.name,brand:_.product.brand,image_url:_.product.image_url,mealItem:V,portionMultiplier:C.portionMultiplier,scannedAt:C.scannedAt}),u.info("MEAL_SCAN_FLOW","Barcode analyzed successfully",{clientScanId:j,barcode:C.barcode,productName:_.product.name,calories:V.calories})):(z.push({barcode:C.barcode,reason:"Failed to convert to meal item"}),u.warn("MEAL_SCAN_FLOW","Failed to convert product to meal item",{clientScanId:j,barcode:C.barcode}))}else z.push({barcode:C.barcode,reason:_.error||"Product not found"}),u.warn("MEAL_SCAN_FLOW","Product not found for barcode",{clientScanId:j,barcode:C.barcode,error:_.error})}catch(_){z.push({barcode:C.barcode,reason:_ instanceof Error?_.message:"Unknown error"}),u.error("MEAL_SCAN_FLOW","Exception during barcode analysis",{clientScanId:j,barcode:C.barcode,error:_ instanceof Error?_.message:String(_),stack:_ instanceof Error?_.stack:void 0})}t(_=>({..._,progress:30+15*(f+1)/a.scannedBarcodes.length,progressSubMessage:`Analyse ${f+1}/${a.scannedBarcodes.length} codes-barres...`}))}if(t(f=>({...f,scannedProducts:[...f.scannedProducts,...v],scannedBarcodes:[]})),u.info("MEAL_SCAN_FLOW","Barcodes analysis completed",{clientScanId:j,totalBarcodes:a.scannedBarcodes.length,analyzedCount:v.length,failedCount:z.length,failedDetails:z,analyzedProducts:v.map(f=>({barcode:f.barcode,name:f.name,calories:f.mealItem.calories}))}),v.length===0&&z.length>0){const f=`Impossible d'analyser les codes-barres: ${z.map(C=>C.reason).join(", ")}`;u.error("MEAL_SCAN_FLOW","All barcodes failed to analyze",{clientScanId:j,failedBarcodes:z}),g(f);return}}t(v=>({...v,progress:50,progressSubMessage:"Identification des aliments..."}));const m=xa(s),b={user_id:n,meal_type:"dinner",timestamp:new Date().toISOString(),user_profile_context:m};a.capturedPhoto&&(b.image_data=await ua(a.capturedPhoto.file)),a.scannedProducts.length>0&&(b.scanned_products=a.scannedProducts.map(v=>({barcode:v.barcode,name:v.name,brand:v.brand,mealItem:v.mealItem,portionMultiplier:v.portionMultiplier})),console.log("üîµ DEBUG - scannedProducts being sent:",{count:a.scannedProducts.length,products:b.scanned_products,analysisRequestKeys:Object.keys(b),hasScannedProducts:!!b.scanned_products})),u.info("MEAL_SCAN_FLOW","Transmitting complete user context to analysis",{clientScanId:j,contextKeys:Object.keys(m),philosophy:"complete_user_context_transmission_to_analysis"}),await new Promise(v=>setTimeout(v,1500)),t(v=>({...v,progress:60,progressSubMessage:"Analyse des nutriments..."}));const{mealsRepo:d}=await he(async()=>{const{mealsRepo:v}=await import("./ScanExitConfirmationModal-DP8K-vvG.js").then(z=>z.a);return{mealsRepo:v}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])),D=await d.analyzeMeal(b),$={model:D.analysis_metadata.ai_model_used,tokensUsed:D.analysis_metadata.tokens_used?.total||0,costUSD:D.analysis_metadata.tokens_used?.cost_estimate_usd||0,fallbackUsed:D.analysis_metadata.fallback_used||!1,photo_url:a.capturedPhoto?.url};t(v=>({...v,progress:70,progressSubMessage:"Calcul des macronutriments...",analysisMetadata:$})),await new Promise(v=>setTimeout(v,500)),t(v=>({...v,progress:85,progressSubMessage:"Optimisation pour vos objectifs..."})),await new Promise(v=>setTimeout(v,500)),t(v=>({...v,analysisResults:D,progress:95,progressMessage:"√ânergie Raffin√©e",progressSubMessage:"Finalisation des donn√©es..."})),await new Promise(v=>setTimeout(v,500)),t(v=>({...v,progress:100,currentStep:"results"})),k(),u.info("MEAL_SCAN_FLOW","Analysis completed",{clientScanId:j,totalCalories:D.total_calories,confidence:D.confidence,insightsCount:D.personalized_insights?.length||0,aiModelUsed:D.analysis_metadata?.ai_model_used,tokensUsed:D.analysis_metadata?.tokens_used,analysisId:D.analysis_id,hasPhoto:!!a.capturedPhoto,scannedProductsCount:a.scannedProducts.length,philosophy:"analysis_with_complete_user_context_and_hybrid_input"})}catch(m){u.error("MEAL_SCAN_FLOW","Analysis failed",{clientScanId:j,error:m instanceof Error?m.message:"Unknown error"}),g(m instanceof Error?m.message:"Unknown error occurred")}finally{t(m=>({...m,isProcessing:!1})),o.current=!1}},[a.capturedPhoto,a.scannedBarcodes,a.scannedProducts,n,s,t,i,o,g,k]),T=A.useCallback(j=>{t(m=>({...m,scannedProducts:[...m.scannedProducts,j],analysisError:null})),u.info("MEAL_SCAN_FLOW","Product scanned and added",{clientScanId:i.current,barcode:j.barcode,productName:j.name,totalScannedProducts:a.scannedProducts.length+1})},[t,i,a.scannedProducts.length]),H=A.useCallback((j,m)=>{t(b=>({...b,scannedProducts:b.scannedProducts.map(d=>{if(d.barcode===j){const D=Q.convertToMealItem({barcode:d.barcode,name:d.name,brand:d.brand,image_url:d.image_url,portion_size:d.mealItem.portion_size,nutrition_per_100g:{calories:d.mealItem.calories/d.portionMultiplier,proteins:d.mealItem.proteins/d.portionMultiplier,carbs:d.mealItem.carbs/d.portionMultiplier,fats:d.mealItem.fats/d.portionMultiplier,fiber:d.mealItem.fiber?d.mealItem.fiber/d.portionMultiplier:void 0,sugar:d.mealItem.sugar?d.mealItem.sugar/d.portionMultiplier:void 0,sodium:d.mealItem.sodium?d.mealItem.sodium/d.portionMultiplier:void 0}},m);return{...d,portionMultiplier:m,mealItem:D}}return d})})),u.info("MEAL_SCAN_FLOW","Product portion changed",{clientScanId:i.current,barcode:j,newMultiplier:m})},[t,i]),I=A.useCallback(j=>{t(m=>({...m,scannedProducts:m.scannedProducts.filter(b=>b.barcode!==j)})),u.info("MEAL_SCAN_FLOW","Product removed",{clientScanId:i.current,barcode:j,remainingProducts:a.scannedProducts.length-1})},[t,i,a.scannedProducts.length]),L=A.useRef(null),U=A.useCallback(j=>{t(m=>{const b=Date.now(),d=2e3;return L.current&&L.current.barcode===j.barcode&&b-L.current.timestamp<d?(u.warn("MEAL_SCAN_FLOW","Rapid duplicate barcode detected, applying cooldown",{clientScanId:i.current,barcode:j.barcode,timeSinceLastScan:b-L.current.timestamp,cooldownMs:d}),m):m.scannedBarcodes.some($=>$.barcode===j.barcode)?(u.warn("MEAL_SCAN_FLOW","Barcode already in session, skipping",{clientScanId:i.current,barcode:j.barcode,existingCount:m.scannedBarcodes.length}),m):(L.current={barcode:j.barcode,timestamp:b},u.info("MEAL_SCAN_FLOW","Barcode detected and added",{clientScanId:i.current,barcode:j.barcode,totalScannedBarcodes:m.scannedBarcodes.length+1,timestamp:j.scannedAt}),{...m,scannedBarcodes:[...m.scannedBarcodes,j],analysisError:null})})},[t,i]),R=A.useCallback((j,m)=>{t(b=>({...b,scannedBarcodes:b.scannedBarcodes.map(d=>d.barcode===j?{...d,portionMultiplier:m}:d)})),u.info("MEAL_SCAN_FLOW","Barcode portion changed",{clientScanId:i.current,barcode:j,newMultiplier:m})},[t,i]),W=A.useCallback(j=>{t(m=>({...m,scannedBarcodes:m.scannedBarcodes.filter(b=>b.barcode!==j)})),u.info("MEAL_SCAN_FLOW","Barcode removed",{clientScanId:i.current,barcode:j,remainingBarcodes:a.scannedBarcodes.length-1})},[t,i,a.scannedBarcodes.length]);return{handlePhotoCapture:E,handleRetake:w,handleProceedToProcessing:F,handleProductScanned:T,handleProductPortionChange:H,handleProductRemove:I,handleBarcodeDetected:U,handleBarcodePortionChange:R,handleBarcodeRemove:W}}function pa({scanFlowState:a,setScanFlowState:t,clientScanIdRef:s,processingGuardRef:n,onAnalysisError:i,onSuccess:o}){const l=A.useCallback(r=>{u.info("BARCODE_PIPELINE","Barcode detected",{clientScanId:s.current,barcode:r.barcode}),t(y=>({...y,scannedBarcodes:[r],analysisError:null,progress:33,progressMessage:"Code-Barre D√©tect√©",progressSubMessage:"Pr√™t pour l'analyse"}))},[t,s]),h=A.useCallback(async()=>{if(n.current||a.scannedBarcodes.length===0)return;n.current=!0;const r=a.scannedBarcodes[0],y=s.current;try{t(w=>({...w,isProcessing:!0,currentStep:"processing",analysisError:null,progress:20,progressMessage:"Analyse du Code-Barre",progressSubMessage:"Connexion √† OpenFoodFacts..."})),u.info("BARCODE_PIPELINE","Starting barcode analysis",{clientScanId:y,barcode:r.barcode}),await new Promise(w=>setTimeout(w,500)),t(w=>({...w,progress:40,progressSubMessage:"R√©cup√©ration du produit..."}));const g=await Q.getProductByBarcode(r.barcode);if(!g.success||!g.product)throw new Error(g.error||"Produit non trouv√© dans la base OpenFoodFacts");u.info("BARCODE_PIPELINE","Product found",{clientScanId:y,barcode:r.barcode,productName:g.product.name}),t(w=>({...w,progress:60,progressSubMessage:"Analyse des donn√©es nutritionnelles..."})),await new Promise(w=>setTimeout(w,500));const k=Q.convertToMealItem(g.product,r.portionMultiplier);if(!k)throw new Error("Impossible de convertir les donn√©es nutritionnelles");t(w=>({...w,progress:80,progressSubMessage:"Finalisation des donn√©es..."})),await new Promise(w=>setTimeout(w,500));const E={scannedProduct:{barcode:g.product.barcode,name:g.product.name,brand:g.product.brand,image_url:g.product.image_url,mealItem:k,portionMultiplier:r.portionMultiplier,scannedAt:r.scannedAt},totalCalories:k.calories,totalProteins:k.proteins,totalCarbs:k.carbs,totalFats:k.fats,productDetails:{name:g.product.name,brand:g.product.brand,image_url:g.product.image_url,barcode:g.product.barcode,portionSize:g.product.portion_size||"100g"}};t(w=>({...w,barcodeAnalysisResults:E,progress:100,progressMessage:"Analyse Termin√©e",progressSubMessage:"Produit identifi√© avec succ√®s"})),await new Promise(w=>setTimeout(w,500)),t(w=>({...w,currentStep:"results"})),o(),u.info("BARCODE_PIPELINE","Analysis completed",{clientScanId:y,barcode:r.barcode,productName:g.product.name,calories:k.calories})}catch(g){u.error("BARCODE_PIPELINE","Analysis failed",{clientScanId:y,barcode:r.barcode,error:g instanceof Error?g.message:"Unknown error"}),i(g instanceof Error?g.message:"Erreur lors de l'analyse du code-barre")}finally{t(g=>({...g,isProcessing:!1})),n.current=!1}},[a.scannedBarcodes,t,s,n,i,o]),N=A.useCallback(()=>{t(r=>({...r,scannedBarcodes:[],barcodeAnalysisResults:null,analysisError:null,currentStep:"capture",progress:0,progressMessage:"Scanner un Code-Barre",progressSubMessage:"Pr√™t pour un nouveau scan"})),u.info("BARCODE_PIPELINE","Barcode retake requested",{clientScanId:s.current})},[t,s]);return{handleBarcodeDetected:l,handleBarcodeScan:h,handleBarcodeRetake:N}}const ma=({barcode:a,productImage:t,progress:s,progressMessage:n,progressSubMessage:i})=>e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(J,{currentStep:"processing",progress:s,message:n,subMessage:i}),e.jsx(p.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4},children:e.jsx(O,{className:"p-6",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(79, 70, 229, 0.05))",borderColor:"rgba(99, 102, 241, 0.3)"},children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-6",children:[e.jsxs("div",{className:"w-32 h-32 rounded-3xl flex items-center justify-center relative overflow-hidden",style:{background:t?"rgba(99, 102, 241, 0.1)":"linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(79, 70, 229, 0.15))",border:"2px solid rgba(99, 102, 241, 0.4)"},children:[t?e.jsx(p.img,{src:t,alt:"Product",className:"w-full h-full object-contain p-2",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5}}):e.jsx(p.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(x,{Icon:c.ScanBarcode,size:64,className:"text-indigo-300"})}),e.jsx(p.div,{className:"absolute inset-0 rounded-3xl",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.2), transparent)"},animate:{opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-white font-bold text-xl",children:"Analyse du Code-Barre"}),e.jsx("p",{className:"text-indigo-300 text-sm font-mono",children:a}),e.jsx("p",{className:"text-gray-300 text-sm max-w-md",children:"R√©cup√©ration des donn√©es nutritionnelles depuis OpenFoodFacts..."})]}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"h-2 rounded-full overflow-hidden",style:{background:"rgba(99, 102, 241, 0.15)"},children:e.jsx(p.div,{className:"h-full rounded-full",style:{background:"linear-gradient(90deg, #6366F1, #818CF8)"},initial:{width:"0%"},animate:{width:`${s}%`},transition:{duration:.3}})}),e.jsxs("p",{className:"text-indigo-300 text-xs mt-2 text-center",children:[Math.round(s),"% compl√©t√©"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4 w-full max-w-md",children:[{icon:c.Database,label:"OpenFoodFacts"},{icon:c.Package,label:"Produit"},{icon:c.TrendingUp,label:"Nutrition"}].map((o,l)=>e.jsxs(p.div,{className:"flex flex-col items-center gap-2 p-3 rounded-xl",style:{background:"rgba(99, 102, 241, 0.08)",border:"1px solid rgba(99, 102, 241, 0.2)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:l*.1},children:[e.jsx(p.div,{animate:{scale:s>(l+1)*30?[1,1.2,1]:1},transition:{duration:.3},children:e.jsx(x,{Icon:o.icon,size:20,className:s>(l+1)*30?"text-indigo-300":"text-gray-500"})}),e.jsx("span",{className:`text-xs font-medium ${s>(l+1)*30?"text-indigo-300":"text-gray-500"}`,children:o.label})]},o.label))})]})})})]}),ba=({barcodeResults:a,onSaveMeal:t,isSaving:s,onRetake:n,onNewScan:i})=>{const[o,l]=S.useState(a.scannedProduct.portionMultiplier),h=k=>{l(k)},N=Math.round(a.totalCalories*o),r=Math.round(a.totalProteins*o),y=Math.round(a.totalCarbs*o),g=Math.round(a.totalFats*o);return e.jsxs("div",{className:"space-y-6 w-full pb-32",children:[e.jsx(J,{currentStep:"results",progress:100,message:"Analyse Termin√©e",subMessage:"Produit identifi√© avec succ√®s"}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsxs(O,{className:"p-6",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(79, 70, 229, 0.05))",borderColor:"rgba(99, 102, 241, 0.35)"},children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[a.productDetails.image_url&&e.jsx("div",{className:"w-24 h-24 rounded-2xl overflow-hidden flex-shrink-0",style:{background:"rgba(99, 102, 241, 0.1)",border:"2px solid rgba(99, 102, 241, 0.3)"},children:e.jsx("img",{src:a.productDetails.image_url,alt:a.productDetails.name,className:"w-full h-full object-contain p-2"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-white font-bold text-xl mb-1",children:a.productDetails.name}),a.productDetails.brand&&e.jsx("p",{className:"text-indigo-300 text-sm mb-2",children:a.productDetails.brand}),e.jsx("p",{className:"text-gray-400 text-xs font-mono",children:a.productDetails.barcode})]})]}),e.jsxs("div",{className:"p-4 rounded-xl mb-4",style:{background:"rgba(99, 102, 241, 0.08)",border:"1px solid rgba(99, 102, 241, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-gray-300 text-sm",children:"Portion"}),e.jsx("span",{className:"text-indigo-300 text-sm font-semibold",children:a.productDetails.portionSize})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>h(Math.max(.25,o-.25)),className:"w-10 h-10 rounded-lg flex items-center justify-center touch-feedback-css",style:{background:"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)"},children:e.jsx(x,{Icon:c.Minus,size:18,className:"text-indigo-300"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsxs("p",{className:"text-white font-bold text-2xl",children:[o,"x"]}),e.jsx("p",{className:"text-gray-400 text-xs",children:"Multiplicateur de portion"})]}),e.jsx("button",{onClick:()=>h(o+.25),className:"w-10 h-10 rounded-lg flex items-center justify-center touch-feedback-css",style:{background:"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)"},children:e.jsx(x,{Icon:c.Plus,size:18,className:"text-indigo-300"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"linear-gradient(135deg, rgba(251, 146, 60, 0.15), rgba(249, 115, 22, 0.08))",border:"1px solid rgba(251, 146, 60, 0.3)"},children:[e.jsx(x,{Icon:c.Flame,size:24,className:"text-orange-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-bold text-2xl mb-1",children:N}),e.jsx("p",{className:"text-orange-300 text-xs font-semibold",children:"Calories"})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.08))",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[e.jsx(x,{Icon:c.Drumstick,size:24,className:"text-red-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-white font-bold text-2xl mb-1",children:[r,"g"]}),e.jsx("p",{className:"text-red-300 text-xs font-semibold",children:"Prot√©ines"})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.08))",border:"1px solid rgba(59, 130, 246, 0.3)"},children:[e.jsx(x,{Icon:c.Wheat,size:24,className:"text-blue-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-white font-bold text-2xl mb-1",children:[y,"g"]}),e.jsx("p",{className:"text-blue-300 text-xs font-semibold",children:"Glucides"})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"linear-gradient(135deg, rgba(234, 179, 8, 0.15), rgba(202, 138, 4, 0.08))",border:"1px solid rgba(234, 179, 8, 0.3)"},children:[e.jsx(x,{Icon:c.Droplet,size:24,className:"text-yellow-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-white font-bold text-2xl mb-1",children:[g,"g"]}),e.jsx("p",{className:"text-yellow-300 text-xs font-semibold",children:"Lipides"})]})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 z-50",style:{background:"linear-gradient(to top, rgba(17, 24, 39, 0.98), rgba(17, 24, 39, 0.95), transparent)",pointerEvents:"none"},children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-3",style:{pointerEvents:"auto"},children:[e.jsx("button",{onClick:t,disabled:s,className:"w-full btn-glass touch-feedback-css disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(5, 150, 105, 0.15))",borderColor:"rgba(16, 185, 129, 0.4)"},children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-white font-semibold",children:"Sauvegarde en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{Icon:c.Check,size:20,className:"text-emerald-400"}),e.jsx("span",{className:"text-white font-semibold",children:"Sauvegarder dans mon historique"})]})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:n,disabled:s,className:"flex-1 btn-glass touch-feedback-css disabled:opacity-50",style:{background:"rgba(107, 114, 128, 0.1)",borderColor:"rgba(107, 114, 128, 0.3)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.RotateCcw,size:18,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-300 font-medium text-sm",children:"Rescanner"})]})}),e.jsx("button",{onClick:i,disabled:s,className:"flex-1 btn-glass touch-feedback-css disabled:opacity-50",style:{background:"rgba(99, 102, 241, 0.1)",borderColor:"rgba(99, 102, 241, 0.3)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.Plus,size:18,className:"text-indigo-400"}),e.jsx("span",{className:"text-indigo-300 font-medium text-sm",children:"Nouveau scan"})]})})]})]})})]})},Sa=()=>{const a=xe(),t=ge(),{profile:s,authReady:n,session:i,user:o}=ae(),{showToast:l}=me(),{success:h,error:N}=Z(),[r,y]=S.useState(K),[g,k]=S.useState(!1),[E,w]=S.useState(null),F=S.useRef(null),T=S.useRef(!1),H=S.useRef(null),I=i?.user?.id||o?.id||s?.userId,L=!!(r.capturedPhoto||r.isProcessing||r.analysisResults),U=pe(({currentLocation:f,nextLocation:C})=>f.pathname===C.pathname?!1:L);A.useEffect(()=>{U.state==="blocked"&&(u.info("MEAL_SCAN_EXIT","Navigation blocked - showing confirmation",{currentStep:r.currentStep,hasCapturedPhoto:!!r.capturedPhoto,isProcessing:r.isProcessing,hasResults:!!r.analysisResults,timestamp:new Date().toISOString()}),w(()=>()=>{U.proceed()}),k(!0))},[U.state,r]),A.useEffect(()=>{const C=setTimeout(()=>{const _=document.getElementById("main-content");_&&_.scrollTo({top:0,behavior:"smooth"}),window.scrollTo({top:0,behavior:"smooth"})},100);return u.debug("MEAL_SCAN_SCROLL","Auto scroll triggered on step change",{currentStep:r.currentStep,progress:r.progress,timestamp:new Date().toISOString()}),()=>clearTimeout(C)},[r.currentStep]),A.useEffect(()=>{u.info("MEAL_SCAN_FLOW_AUTH_DEBUG","Complete auth state in MealScanFlowPage",{hasSession:!!i,sessionUserId:i?.user?.id,sessionUserEmail:i?.user?.email,sessionAccessToken:i?.access_token?"present":"missing",sessionExpiresAt:i?.expires_at,hasUser:!!o,userIdDirect:o?.id,userEmail:o?.email,hasProfile:!!s,profileUserId:s?.userId,profileDisplayName:s?.displayName,profileKeys:s?Object.keys(s):[],authReady:n,userId:I})},[i,o,s,n,I]);const R=ga({scanFlowState:r,setScanFlowState:y,profile:s,userId:I,clientScanIdRef:F,processingGuardRef:T,readyForProcessingRef:H,showToast:l,success:h,errorSound:N,queryClient:t,onAnalysisError:f=>{y(C=>({...C,analysisError:f})),l(`Erreur d'analyse: ${f}`,"error"),N()},onSuccess:()=>{h()}}),W=pa({scanFlowState:r,setScanFlowState:y,clientScanIdRef:F,processingGuardRef:T,onAnalysisError:f=>{y(C=>({...C,analysisError:f})),l(`Erreur d'analyse: ${f}`,"error"),N()},onSuccess:()=>{h()}}),j=A.useCallback(f=>{y(C=>({...C,scanType:f,progressMessage:f==="photo-analysis"?"Forge du Repas":"Scanner un Code-Barre",progressSubMessage:f==="photo-analysis"?"Capturez votre carburant nutritionnel":"Scannez le code-barre d'un produit"})),u.info("MEAL_SCAN_FLOW","Scan type selected",{scanType:f,timestamp:new Date().toISOString()})},[y]),[m,b]=S.useState(!1),d=async()=>{if(!I||m)return;const f=!!r.analysisResults,C=!!r.barcodeAnalysisResults;if(!(!f&&!C)){b(!0);try{u.info("MEAL_SCAN_SAVE","Starting meal save and reset process",{userId:I,scanType:r.scanType,hasAnalysisResults:f,hasBarcodeResults:C,totalCalories:f?r.analysisResults.total_calories:r.barcodeAnalysisResults?.totalCalories,hasCapturedPhoto:!!r.capturedPhoto,timestamp:new Date().toISOString()});let _;if(r.capturedPhoto?.file){u.info("MEAL_SCAN_SAVE","Uploading meal photo to storage",{userId:I,fileSize:r.capturedPhoto.file.size,fileType:r.capturedPhoto.file.type,timestamp:new Date().toISOString()});try{const P=await ye(r.capturedPhoto.file,I);P.success&&P.publicUrl?(_=P.publicUrl,u.info("MEAL_SCAN_SAVE","Photo uploaded successfully",{publicUrl:_,uploadPath:P.uploadPath,userId:I,timestamp:new Date().toISOString()})):(u.warn("MEAL_SCAN_SAVE","Photo upload failed, continuing without photo",{error:P.error,userId:I,timestamp:new Date().toISOString()}),l({type:"warning",title:"Photo non sauvegard√©e",message:P.error||"La photo n'a pas pu √™tre sauvegard√©e, mais votre repas sera enregistr√©.",duration:4e3}))}catch(P){u.error("MEAL_SCAN_SAVE","Photo upload exception",{error:P instanceof Error?P.message:String(P),userId:I,timestamp:new Date().toISOString()})}}let V;if(r.scanType==="barcode-scan"&&C){const P=r.barcodeAnalysisResults.scannedProduct;V={user_id:I,timestamp:new Date().toISOString(),items:[P.mealItem],total_kcal:r.barcodeAnalysisResults.totalCalories,meal_type:"snack",meal_name:P.name,photo_url:_}}else if(f){const P=[...r.analysisResults.detected_foods||[],...r.scannedProducts.map(M=>M.mealItem)||[]],ee=P.reduce((M,q)=>M+q.calories,0);V={user_id:I,timestamp:new Date().toISOString(),items:P,total_kcal:ee||r.analysisResults.total_calories||0,meal_type:r.analysisResults.meal_type||"dinner",meal_name:r.analysisResults.meal_name,photo_url:_}}else throw new Error("Aucune donn√©e de repas √† sauvegarder");const G=await je.saveMeal(V);u.info("MEAL_SCAN_SAVE","Meal saved to database, starting cache update",{mealId:G.id,userId:I,timestamp:new Date().toISOString()});const Y=t.getQueryData(["meals-today",I])||[];t.setQueryData(["meals-today",I],[G,...Y]),u.info("MEAL_SCAN_SAVE","Optimistic cache update applied",{mealId:G.id,newMealsCount:Y.length+1,timestamp:new Date().toISOString()}),await Promise.all([t.refetchQueries({queryKey:["meals-today",I],type:"active"}),t.refetchQueries({queryKey:["meals-week",I],type:"active"}),t.refetchQueries({queryKey:["meals-recent",I],type:"active"}),t.refetchQueries({queryKey:["meals-history",I],type:"active"}),t.invalidateQueries({queryKey:["meals-month",I]}),t.invalidateQueries({queryKey:["daily-ai-summary",I]})]),u.info("MEAL_SCAN_SAVE","All meal queries refetched",{mealId:G.id,queries:["meals-today","meals-week","meals-recent","meals-history","meals-month","daily-ai-summary"],timestamp:new Date().toISOString()}),h();const ne=f?r.analysisResults.total_calories:r.barcodeAnalysisResults.totalCalories;l({type:"success",title:"Repas sauvegard√© !",message:`${ne} kcal ajout√©es √† votre forge nutritionnelle${_?" avec photo":""}`,duration:3e3}),u.info("MEAL_SCAN_SAVE","Meal saved successfully, resetting scan state",{mealId:G.id,userId:I,photoSaved:!!_,timestamp:new Date().toISOString()}),g||(y(K),F.current=null,T.current=!1,await new Promise(P=>setTimeout(P,150)),u.info("MEAL_SCAN_SAVE","Navigating to meals page with fresh cache",{mealId:G.id,timestamp:new Date().toISOString()}),a("/meals",{state:{freshMealSaved:!0,mealId:G.id}}))}catch(_){N(),u.error("MEAL_SCAN_SAVE","Failed to save meal",{error:_ instanceof Error?_.message:String(_),errorStack:_ instanceof Error?_.stack:void 0,userId:I,mealData:{totalCalories:r.analysisResults?.total_calories,itemsCount:r.analysisResults?.detected_foods?.length,mealType:r.analysisResults?.meal_type,hasPhoto:!!photoUrl},timestamp:new Date().toISOString()}),l({type:"error",title:"Erreur de sauvegarde",message:`Impossible de sauvegarder le repas: ${_ instanceof Error?_.message:"Erreur inconnue"}. Veuillez r√©essayer.`,duration:4e3})}finally{b(!1)}}},D=async()=>{try{r.analysisResults?(u.info("MEAL_SCAN_EXIT","Saving meal before exit",{hasResults:!!r.analysisResults,timestamp:new Date().toISOString()}),k(!1),y(K),F.current=null,T.current=!1,E&&(E(),w(null)),d().catch(f=>{u.error("MEAL_SCAN_EXIT","Background save failed",{error:f instanceof Error?f.message:String(f),timestamp:new Date().toISOString()})}),u.info("MEAL_SCAN_EXIT","Navigation allowed, saving in background",{timestamp:new Date().toISOString()})):(k(!1),y(K),F.current=null,E&&(E(),w(null)))}catch(f){u.error("MEAL_SCAN_EXIT","Failed to exit",{error:f instanceof Error?f.message:String(f),timestamp:new Date().toISOString()}),l("Erreur lors de la sortie","error"),k(!1)}},$=()=>{u.info("MEAL_SCAN_EXIT","User chose to discard scan and exit",{currentStep:r.currentStep,hasCapturedPhoto:!!r.capturedPhoto,hasResults:!!r.analysisResults,timestamp:new Date().toISOString()}),y(K),F.current=null,T.current=!1,k(!1),E&&(E(),w(null))},v=()=>{u.info("MEAL_SCAN_EXIT","User cancelled exit, continuing scan",{currentStep:r.currentStep,timestamp:new Date().toISOString()}),k(!1),w(null),U.state==="blocked"&&U.reset()};if(!n)return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(oe,{icon:"Loader",title:"Chargement...",subtitle:"Initialisation de votre session",circuit:"meal-scan"}),e.jsxs(O,{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-blue-400 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-300",children:"Chargement de votre session..."})]})]});if(!I)return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(oe,{icon:"LogIn",title:"Connexion Requise",subtitle:"Connectez-vous pour analyser vos repas",circuit:"meal-scan"}),e.jsxs(O,{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Connexion Requise"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Vous devez √™tre connect√© pour utiliser l'analyse de repas."}),e.jsx("button",{onClick:()=>a("/auth/login"),className:"btn-glass--primary w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.LogIn,size:16}),e.jsx("span",{children:"Se Connecter"})]})})]})]});if(!s)return u.warn("MEAL_SCAN_FLOW_NO_PROFILE","CRITICAL: No profile detected, showing incomplete profile",{hasProfile:!!s,hasSessionInfo:!!sessionInfo,authReady:n,userId:I,profileType:typeof s,profileStringified:s?JSON.stringify(s,null,2).substring(0,500)+"...":"null",userStoreProfileState:{profile:!!ae.getState().profile,profileUserId:ae.getState().profile?.userId,profileDisplayName:ae.getState().profile?.displayName},timestamp:new Date().toISOString()}),e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(oe,{icon:"User",title:"Profil Incomplet",subtitle:"Compl√©tez votre profil pour des analyses nutritionnelles personnalis√©es",circuit:"meal-scan"}),e.jsxs(O,{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Profil Incomplet"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Compl√©tez votre profil pour b√©n√©ficier d'analyses nutritionnelles personnalis√©es."}),e.jsx("button",{onClick:()=>a("/profile"),className:"btn-glass--primary w-full mb-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.User,size:16}),e.jsx("span",{children:"Compl√©ter le Profil"})]})}),e.jsx("button",{onClick:()=>a("/"),className:"btn-glass--secondary-nav w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.Home,size:16}),e.jsx("span",{children:"Retour √† l'accueil"})]})})]})]});const z=()=>{if(r.analysisError&&r.currentStep==="processing")return e.jsxs(O,{className:"p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(x,{Icon:c.AlertCircle,size:48,className:"text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Erreur d'analyse"}),e.jsx("p",{className:"text-gray-300",children:r.analysisError})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>a("/meals"),className:"flex-1 btn-glass--secondary-nav",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.ArrowLeft,size:16}),e.jsx("span",{children:"Retour"})]})}),e.jsx("button",{onClick:R.handleRetake,className:"flex-1 btn-glass--primary",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(x,{Icon:c.RotateCcw,size:16}),e.jsx("span",{children:"R√©essayer"})]})})]})]});switch(r.currentStep){case"capture":return e.jsx(Ze,{scanType:r.scanType,onSelectScanType:j,capturedPhoto:r.capturedPhoto,scannedBarcodes:r.scannedBarcodes,scannedProducts:r.scannedProducts,onPhotoCapture:R.handlePhotoCapture,onBarcodeDetected:r.scanType==="barcode-scan"?W.handleBarcodeDetected:R.handleBarcodeDetected,onProductScanned:R.handleProductScanned,onProductPortionChange:R.handleProductPortionChange,onProductRemove:R.handleProductRemove,onBarcodePortionChange:R.handleBarcodePortionChange,onBarcodeRemove:R.handleBarcodeRemove,onRetake:r.scanType==="barcode-scan"?W.handleBarcodeRetake:R.handleRetake,onBack:()=>a("/meals"),onProceedToProcessing:r.scanType==="barcode-scan"?W.handleBarcodeScan:R.handleProceedToProcessing,isProcessingInProgress:r.isProcessing,readyForProcessingRef:H,progress:r.progress,progressMessage:r.progressMessage,progressSubMessage:r.progressSubMessage});case"processing":return r.scanType==="barcode-scan"?e.jsx(ma,{barcode:r.scannedBarcodes[0]?.barcode||"",productImage:r.scannedBarcodes[0]?.image_url,progress:r.progress,progressMessage:r.progressMessage,progressSubMessage:r.progressSubMessage}):e.jsx(ra,{capturedPhoto:r.capturedPhoto,progress:r.progress,progressMessage:r.progressMessage,progressSubMessage:r.progressSubMessage});case"results":return r.scanType==="barcode-scan"&&r.barcodeAnalysisResults?e.jsx(ba,{barcodeResults:r.barcodeAnalysisResults,onSaveMeal:d,isSaving:m,onRetake:W.handleBarcodeRetake,onNewScan:()=>{y(K),F.current=le()}}):e.jsx(da,{analysisResults:r.analysisResults,capturedPhoto:r.capturedPhoto,progress:r.progress,progressMessage:r.progressMessage,progressSubMessage:r.progressSubMessage,onSaveMeal:d,isSaving:m,onRetake:R.handleRetake,onNewScan:()=>{y(K),F.current=le()}});default:return null}};return e.jsxs("div",{className:"w-full min-w-0 pb-8",style:{overflow:"visible !important"},children:[e.jsx(re,{mode:"wait",children:e.jsx(p.div,{className:"meal-scan-step pb-6","data-step":r.currentStep,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{minHeight:"auto",overflow:"visible"},children:z()},r.currentStep)}),e.jsx(be,{children:e.jsx(fe,{isOpen:g,onSaveAndExit:D,onDiscardAndExit:$,onCancel:v,hasResults:!!r.analysisResults,isProcessing:r.isProcessing,capturedPhoto:r.capturedPhoto})})]})};export{Sa as default};
