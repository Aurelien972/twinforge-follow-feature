import{r as y,j as e}from"./vendor-DX97-qL9.js";import{S as c,I as n,l as T,o as v,G as O}from"./ui-components-DWjWyKd7.js";import{P as A,U as I}from"./UnderConstructionCard-S84izt9v.js";import{b as U}from"./stores-DcNfcD_j.js";import{e as W}from"./page-fridge-scan-ZLPWYd6x.js";import{l as i}from"./page-fridge-BvAjnJpI.js";import{A as j,m}from"./motion-DLE-fuXv.js";import"./utils-CUtLAp28.js";import"./supabase-C_rF2iqf.js";import"./date-utils-sCOX3Ksr.js";const F=["apple_health","google_fit","strava"],g={strava:{id:"strava",name:"Strava",description:"Course, vélo, natation et autres activités",icon:"Activity",color:"#FC4C02",authUrl:"https://www.strava.com/oauth/authorize",scopes:["read","activity:read_all","activity:read"],dataTypes:["workout","distance","heart_rate","calories","elevation","pace","cadence"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},garmin:{id:"garmin",name:"Garmin Connect",description:"Montres Garmin et données fitness complètes",icon:"Watch",color:"#007CC3",authUrl:"https://connect.garmin.com/oauth/authorize",scopes:["activities","wellness","sleep"],dataTypes:["heart_rate","steps","calories","distance","sleep","workout","hrv","stress_level","body_battery","vo2max"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},fitbit:{id:"fitbit",name:"Fitbit",description:"Trackers Fitbit et montres Versa/Sense",icon:"Activity",color:"#00B0B9",authUrl:"https://www.fitbit.com/oauth2/authorize",scopes:["activity","heartrate","sleep","weight","nutrition"],dataTypes:["heart_rate","resting_heart_rate","steps","calories","distance","sleep","weight","active_minutes","spo2"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},apple_health:{id:"apple_health",name:"Apple Health",description:"Apple Watch et iPhone Health",icon:"Heart",color:"#FF3B30",authUrl:"",scopes:["health_read"],dataTypes:["heart_rate","steps","calories","distance","sleep","workout","weight","blood_pressure","spo2","hrv","vo2max"],supportsWebhooks:!1,requiresApp:!0,platform:"ios"},polar:{id:"polar",name:"Polar Flow",description:"Montres Polar et capteurs",icon:"Heart",color:"#E30613",authUrl:"https://flow.polar.com/oauth2/authorization",scopes:["accesslink.read_all"],dataTypes:["heart_rate","workout","calories","distance","sleep","hrv"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},wahoo:{id:"wahoo",name:"Wahoo",description:"Capteurs Wahoo et compteurs vélo",icon:"Bike",color:"#2E3192",authUrl:"https://api.wahooligan.com/oauth/authorize",scopes:["workouts_read","power_read"],dataTypes:["workout","heart_rate","power","cadence","distance","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},whoop:{id:"whoop",name:"WHOOP",description:"Bracelet WHOOP et métriques de récupération",icon:"Activity",color:"#000000",authUrl:"https://api.prod.whoop.com/oauth/authorize",scopes:["read:recovery","read:workout","read:sleep"],dataTypes:["heart_rate","hrv","sleep","workout","stress_level","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},oura:{id:"oura",name:"Oura Ring",description:"Bague Oura et données de sommeil",icon:"Moon",color:"#5E17EB",authUrl:"https://cloud.ouraring.com/oauth/authorize",scopes:["daily","personal","session"],dataTypes:["heart_rate","hrv","sleep","temperature","steps","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},suunto:{id:"suunto",name:"Suunto",description:"Montres Suunto pour sports outdoor",icon:"Watch",color:"#FF3B3F",authUrl:"https://cloudapi.suunto.com/oauth/authorize",scopes:["workout"],dataTypes:["workout","heart_rate","distance","elevation","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},coros:{id:"coros",name:"COROS",description:"Montres COROS pour endurance",icon:"Watch",color:"#FF6B00",authUrl:"https://open.coros.com/oauth2/authorize",scopes:["workouts:read"],dataTypes:["workout","heart_rate","distance","elevation","pace","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},google_fit:{id:"google_fit",name:"Google Fit",description:"Google Fit et Android Health",icon:"Activity",color:"#4285F4",authUrl:"https://accounts.google.com/o/oauth2/v2/auth",scopes:["https://www.googleapis.com/auth/fitness.activity.read","https://www.googleapis.com/auth/fitness.heart_rate.read"],dataTypes:["heart_rate","steps","calories","distance","workout","weight"],supportsWebhooks:!1,requiresApp:!0,platform:"android"}},P=()=>{const{user:o}=U(),{devices:u,loading:x,syncing:h,syncDevice:t,disconnectDevice:C}=W(o?.id||null),[E,N]=y.useState(null),[l,b]=y.useState(!1),w=()=>{const s=!l;i.info("[CONNECTED_DEVICES] Toggle simulation mode",{previousState:l,newState:s,userId:o?.id}),b(s)},S=s=>{i.info("[CONNECTED_DEVICES] Connect device initiated",{provider:s,showSimulator:l,userId:o?.id});const a=g[s];if(!a){i.error("[CONNECTED_DEVICES] Provider config not found",{provider:s});return}if(l){i.info("[CONNECTED_DEVICES] Simulation mode active - showing success alert",{provider:s,providerName:a.name}),alert(`Mode Simulation: Connexion à ${a.name} simulée avec succès!`);return}const r="https://kwipydbtjagypocpvbwn.supabase.co",d=crypto.randomUUID(),f=`${r}/functions/v1/wearable-oauth-callback?provider=${s}`;i.info("[CONNECTED_DEVICES] Building OAuth URL",{provider:s,supabaseUrl:r,redirectUri:f,state:d});const p=new URL(a.authUrl);p.searchParams.set("response_type","code"),p.searchParams.set("client_id","YOUR_CLIENT_ID"),p.searchParams.set("redirect_uri",f),p.searchParams.set("state",d),p.searchParams.set("scope",a.scopes.join(" ")),i.info("[CONNECTED_DEVICES] Redirecting to OAuth provider",{provider:s,authUrl:p.toString()}),window.location.href=p.toString()},D=async s=>{i.info("[CONNECTED_DEVICES] Sync initiated",{deviceId:s,userId:o?.id});try{await t(s),i.info("[CONNECTED_DEVICES] Sync successful",{deviceId:s}),alert("Synchronisation réussie!")}catch(a){i.error("[CONNECTED_DEVICES] Sync failed",{deviceId:s,error:a instanceof Error?a.message:"Unknown error"}),alert(`Erreur: ${a instanceof Error?a.message:"Synchronisation échouée"}`)}},_=async s=>{if(i.info("[CONNECTED_DEVICES] Disconnect initiated",{deviceId:s,userId:o?.id}),!confirm("Voulez-vous vraiment déconnecter cet appareil?")){i.info("[CONNECTED_DEVICES] Disconnect cancelled by user",{deviceId:s});return}try{await C(s),i.info("[CONNECTED_DEVICES] Disconnect successful",{deviceId:s})}catch(a){i.error("[CONNECTED_DEVICES] Disconnect failed",{deviceId:s,error:a instanceof Error?a.message:"Unknown error"}),alert(`Erreur: ${a instanceof Error?a.message:"Déconnexion échouée"}`)}},k=s=>({connected:"Connecté",syncing:"Synchronisation...",error:"Erreur",disconnected:"Déconnecté",pending_auth:"En attente",token_expired:"Expiré"})[s];return e.jsxs("div",{children:[e.jsx("div",{className:"devices-header",style:{marginBottom:"2rem"},children:e.jsx("button",{onClick:w,className:`simulation-toggle ${l?"active":""}`,style:{marginLeft:"auto"},children:e.jsxs("div",{className:"simulation-toggle-content",children:[e.jsx(c,{Icon:n.Wrench,size:18}),e.jsx("span",{children:l?"Mode Simulation ON":"Mode Dev"})]})})}),e.jsx(j,{children:l&&e.jsx(m.div,{initial:{opacity:0,y:-10,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.98},transition:{duration:.3,ease:[.4,0,.2,1]},className:"simulation-alert",children:e.jsxs("div",{className:"simulation-alert-content",children:[e.jsx("div",{className:"simulation-alert-icon",children:e.jsx(c,{Icon:n.AlertCircle,size:22,color:"#F59E0B"})}),e.jsxs("div",{className:"simulation-alert-text",children:[e.jsx("h4",{children:"Mode Simulation Activé"}),e.jsx("p",{children:"Les connexions aux appareils sont simulées. Idéal pour tester sans montres réelles."})]})]})})}),x?e.jsxs("div",{className:"devices-loading",children:[e.jsx("div",{className:"devices-loading-spinner",children:e.jsx(c,{Icon:n.Loader2,size:36,color:"#18E3FF"})}),e.jsx("p",{className:"devices-loading-text",children:"Chargement des appareils..."})]}):e.jsxs(e.Fragment,{children:[u.length>0&&e.jsxs("div",{style:{marginBottom:"2.5rem"},children:[e.jsxs("h3",{className:"providers-section-title",children:["Mes Appareils (",u.length,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:u.map(s=>{const a=g[s.provider],r=E===s.id;return e.jsxs(m.div,{className:"device-card",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"device-card-main",children:[e.jsxs("div",{className:"device-card-info",children:[e.jsx("div",{className:"device-icon-wrapper",style:{background:`linear-gradient(135deg, ${a.color}15 0%, ${a.color}30 100%)`},children:e.jsx(c,{Icon:n[a.icon],size:28,color:a.color})}),e.jsxs("div",{className:"device-details",children:[e.jsx("h4",{children:s.displayName||a.name}),e.jsxs("div",{className:"device-meta",children:[e.jsx("span",{className:`status-badge ${s.status}`,children:k(s.status)}),s.lastSyncAt&&e.jsxs("span",{className:"device-last-sync",children:["Dernière synchro: ",new Date(s.lastSyncAt).toLocaleDateString("fr-FR")]})]})]})]}),e.jsxs("div",{className:"device-actions",children:[e.jsx("button",{onClick:()=>D(s.id),disabled:h||s.status==="disconnected",className:"device-action-btn",title:"Synchroniser maintenant",children:e.jsx(c,{Icon:n.RefreshCw,size:20,className:h?"animate-spin":""})}),e.jsx("button",{onClick:()=>N(r?null:s.id),className:"device-action-btn",title:r?"Réduire":"Développer",children:e.jsx(c,{Icon:r?n.ChevronUp:n.ChevronDown,size:20})})]})]}),e.jsx(j,{children:r&&e.jsxs(m.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:[.4,0,.2,1]},className:"device-expanded",children:[e.jsxs("div",{className:"device-stats-grid",children:[e.jsxs("div",{className:"device-stat-item",children:[e.jsx("h5",{children:"Types de données"}),e.jsx("div",{className:"data-types-chips",children:a.dataTypes.slice(0,5).map(d=>e.jsx("span",{className:"data-type-chip",children:d},d))})]}),e.jsxs("div",{className:"device-stat-item",children:[e.jsx("h5",{children:"Connexion"}),e.jsx("p",{className:"device-stat-value",children:new Date(s.connectedAt).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]})]}),e.jsxs("button",{onClick:()=>_(s.id),className:"disconnect-btn",children:[e.jsx(c,{Icon:n.Unlink,size:18}),e.jsx("span",{children:"Déconnecter"})]})]})})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"providers-section-title",children:"Connecter un Appareil"}),e.jsx("div",{className:"providers-grid",children:Object.values(g).filter(s=>F.includes(s.id)).map((s,a)=>{const r=u.some(d=>d.provider===s.id);return e.jsxs(m.div,{className:`provider-card ${r?"connected":""}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:a*.05},children:[e.jsx("div",{className:"provider-icon-container",style:{background:`linear-gradient(135deg, ${s.color}15 0%, ${s.color}35 100%)`},children:e.jsx(c,{Icon:n[s.icon],size:26,color:s.color})}),e.jsxs("div",{className:"provider-info",children:[e.jsx("h4",{children:s.name}),e.jsx("p",{children:s.description})]}),e.jsx("button",{onClick:()=>S(s.id),disabled:r,className:"provider-connect-btn",style:{background:r?void 0:`radial-gradient(circle at 30% 20%, ${s.color}25 0%, transparent 60%),
                             radial-gradient(circle at 70% 80%, ${s.color}20 0%, transparent 50%),
                             linear-gradient(135deg, ${s.color}15 0%, ${s.color}30 100%)`,color:r?void 0:s.color,borderColor:r?void 0:`${s.color}50`},children:r?"Déjà connecté":"Connecter"})]},s.id)})}),e.jsxs("div",{style:{marginTop:"2rem",padding:"1.5rem",borderRadius:"16px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx(c,{Icon:n.Clock,size:20,style:{color:"#06B6D4"}}),e.jsx("h4",{style:{fontSize:"1rem",fontWeight:"600",color:"white",margin:0},children:"Prochainement"})]}),e.jsx("p",{style:{fontSize:"0.875rem",color:"rgba(255, 255, 255, 0.7)",margin:0,lineHeight:"1.5"},children:"Garmin, Polar, Fitbit, Whoop, Oura, Suunto, Coros, et Wahoo seront bientôt disponibles."})]})]})]})]})},Y=()=>{const o=A.settings,[u,x]=y.useState(o.tabs[0].value),h=o.tabs.find(t=>t.value===u)||o.tabs[0];return e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-6",children:[e.jsx(T,{icon:h.icon||o.icon,title:h.label,subtitle:h.description,circuit:o.circuit,iconColor:o.color}),e.jsxs(v,{defaultValue:o.tabs[0].value,className:"w-full settings-tabs",onValueChange:t=>x(t),children:[e.jsx(v.List,{role:"tablist","aria-label":"Sections des Réglages",className:"mb-6 w-full",children:o.tabs.map(t=>e.jsx(v.Trigger,{value:t.value,icon:t.icon,children:e.jsx("span",{className:"tab-text",children:t.label})},t.value))}),o.tabs.map(t=>e.jsx(v.Panel,{value:t.value,children:t.value==="appareils"?e.jsx(P,{}):e.jsx(O,{className:"p-6",children:e.jsx(I,{title:t.label,description:t.description,icon:t.icon,color:o.color,features:t.features})})},t.value))]})]})};export{Y as default};
