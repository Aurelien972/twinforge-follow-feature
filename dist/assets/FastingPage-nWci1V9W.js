import{u as q,j as e,c as B,R as _,e as Z,cT as ee,r as R,cU as U,cK as te}from"./vendor-DX97-qL9.js";import{p as se,G as y,S as p,I as h,u as K,m as re,l as ae,o as T,C as ne}from"./ui-components-DWjWyKd7.js";import{u as ie}from"./useScrollMemory-C8VkSb5_.js";import{a as V,b as oe,c as le,d as ce}from"./page-fridge-scan-ZLPWYd6x.js";import{b as A,a as de}from"./stores-DcNfcD_j.js";import{u as M,l as j,s as O}from"./page-fridge-BvAjnJpI.js";import{g as xe,f as me,a as ue,e as ge,b as he,F as pe,d as be,c as je}from"./FastingTipsCard-8yThwNr9.js";import{g as fe,F as W}from"./page-profile-Bm2vJ3_O.js";import{m as f,A as ve}from"./motion-DLE-fuXv.js";import{s as P,e as Y,f as w,g as G,p as S,h as $,j as Q,a as z,d as ye}from"./date-utils-sCOX3Ksr.js";import"./utils-CUtLAp28.js";import"./supabase-C_rF2iqf.js";import"./forms-BNC8g0IA.js";function Ne(t,a,r){return t?{priority:"medium",color:"#EF4444",icon:"Timer",animation:"breathing"}:a?{priority:"medium",color:"#F59E0B",icon:"Timer",animation:"breathing"}:{priority:"high",color:"#F59E0B",icon:"Timer",animation:"pulse"}}function we(t,a,r,s,l){return t?{title:"Session Active",subtitle:`Votre jeûne progresse${l?` - Phase ${l.name}`:""}`,buttonText:"Gérer ma session",encouragement:"Continuez votre excellent travail !"}:a&&r?{title:"Prêt à jeûner",subtitle:`Démarrez votre protocole ${fe(r)?.name||r}`,buttonText:"Commencer le jeûne",encouragement:"Votre protocole est configuré et prêt"}:{title:"Forgez votre métabolisme !",subtitle:"Commencez votre première session de jeûne intermittent",buttonText:"Démarrer une session",encouragement:"Maîtrisez votre sèche avec le jeûne"}}function Se(t,a,r,s){const l=[];if(t){if(a>0){const i=Math.floor(a),n=Math.floor((a-i)*60);l.push(`${i}h ${n}m écoulées`)}r>0&&l.push(`Objectif ${r}h`),s&&l.push(`Phase ${s.name}`)}return l}const Ie=({className:t=""})=>{const a=q(),{click:r}=M(),s=se()==="reduced",{profile:l}=A(),{isActive:i,session:n}=V();oe();const c=le(),o=ce(),m=c/3600,d=n?.targetHours||16,u=l?.nutrition?.fastingWindow?.protocol,b=!!(u&&u!==""),g=i?xe(m):null,x=Ne(i,b),v=we(i,b,u,m,g),I=Se(i,m,d,g),k=()=>{r(),a("/fasting/input")},F={background:`
      radial-gradient(circle at 30% 20%, color-mix(in srgb, ${x.color} 12%, transparent) 0%, transparent 60%),
      radial-gradient(circle at 70% 80%, color-mix(in srgb, ${x.color} 8%, transparent) 0%, transparent 50%),
      var(--glass-opacity)
    `,borderColor:`color-mix(in srgb, ${x.color} 25%, transparent)`,boxShadow:`
      0 12px 40px rgba(0, 0, 0, 0.25),
      0 0 30px color-mix(in srgb, ${x.color} 15%, transparent),
      inset 0 2px 0 rgba(255, 255, 255, 0.15)
    `,backdropFilter:"blur(20px) saturate(160%)"},E={background:`
      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
      radial-gradient(circle at 70% 70%, color-mix(in srgb, ${x.color} 15%, transparent) 0%, transparent 50%),
      linear-gradient(135deg, color-mix(in srgb, ${x.color} 35%, transparent), color-mix(in srgb, ${x.color} 25%, transparent))
    `,border:`2px solid color-mix(in srgb, ${x.color} 50%, transparent)`,boxShadow:`
      0 0 30px color-mix(in srgb, ${x.color} 40%, transparent),
      0 0 60px color-mix(in srgb, ${x.color} 25%, transparent),
      inset 0 2px 0 rgba(255,255,255,0.3)
    `},C={background:`linear-gradient(135deg, 
      color-mix(in srgb, ${x.color} 80%, transparent), 
      color-mix(in srgb, ${x.color} 60%, transparent)
    )`,border:`2px solid color-mix(in srgb, ${x.color} 60%, transparent)`,boxShadow:`
      0 12px 40px color-mix(in srgb, ${x.color} 40%, transparent),
      0 0 60px color-mix(in srgb, ${x.color} 30%, transparent),
      inset 0 3px 0 rgba(255,255,255,0.4)
    `,backdropFilter:"blur(20px) saturate(160%)",color:"#fff",transition:"all 0.2s ease"};return e.jsx("div",{className:`dynamic-fasting-cta w-full ${t}`,children:e.jsxs(y,{className:"p-6 md:p-8 text-center relative overflow-visible cursor-pointer w-full",onClick:k,interactive:!0,style:F,children:[e.jsx("div",{className:"training-hero-corners","aria-hidden":"true",children:[0,1,2,3].map(N=>e.jsx(f.div,{className:"corner-particle",style:{position:"absolute",width:"8px",height:"8px",borderRadius:"2px",background:`linear-gradient(135deg, ${x.color}, rgba(255, 255, 255, 0.8))`,boxShadow:`0 0 20px ${x.color}`,top:N<2?"12px":"auto",bottom:N>=2?"12px":"auto",left:N%2===0?"12px":"auto",right:N%2===1?"12px":"auto"},initial:{rotate:N%2===0?45:-45},animate:{scale:[1,1.3,1],opacity:[.6,1,.6],rotate:N%2===0?[45,60,45]:[-45,-60,-45]},transition:{duration:3,repeat:1/0,delay:N*.2,ease:[.4,0,.2,1]}},N))}),x.priority==="high"&&!s&&e.jsx("div",{className:"absolute inset-0 rounded-inherit pointer-events-none urgent-forge-glow-css",style:{background:`radial-gradient(circle at center, color-mix(in srgb, ${x.color} 8%, transparent) 0%, transparent 70%)`,filter:"blur(20px)",transform:"scale(1.2)",zIndex:-1}}),e.jsxs("div",{className:"relative z-10 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:`w-16 h-16 md:w-20 md:h-20 mx-auto rounded-full flex items-center justify-center relative ${x.animation==="pulse"&&!s?"icon-pulse-css":x.animation==="breathing"&&!s?"icon-breathing-css":""}`,style:E,children:[e.jsx(p,{Icon:h[x.icon],size:x.priority==="high"?36:32,style:{color:x.color}}),(x.priority==="high"||i)&&!s&&[...Array(i?4:6)].map((N,D)=>e.jsx("div",{className:`absolute w-2 h-2 rounded-full dynamic-particle-css dynamic-particle-css--${D+1}`,style:{left:`${15+D*15}%`,top:`${15+D%3*25}%`,background:x.color,boxShadow:`0 0 8px color-mix(in srgb, ${x.color} 60%, transparent)`}},D))]}),e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white",children:v.title}),i&&n&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl md:text-6xl font-black mb-2",style:{color:x.color},children:me(c)}),e.jsxs("div",{className:"text-lg md:text-xl text-white/90 font-semibold",children:["Objectif : ",n.targetHours,"h • ",Math.round(o),"% accompli"]})]}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(f.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${x.color}, color-mix(in srgb, ${x.color} 80%, white))`,boxShadow:`0 0 12px color-mix(in srgb, ${x.color} 60%, transparent)`,width:`${o}%`},initial:{width:0},animate:{width:`${o}%`},transition:{duration:.8,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                            transparent 0%, 
                            rgba(255,255,255,0.4) 50%, 
                            transparent 100%
                          )`,animation:"progressShimmer 2s ease-in-out infinite"}})})})})]}),e.jsx("p",{className:"text-white/80 text-base md:text-lg leading-relaxed max-w-md mx-auto",children:i&&g?`Phase ${g.name} • ${g.metabolicState}`:v.subtitle}),v.encouragement&&e.jsx("p",{className:"text-white/60 text-sm italic",children:v.encouragement})]}),I.length>0&&e.jsx("div",{className:"flex flex-wrap items-center justify-center gap-3 text-sm",children:I.map((N,D)=>e.jsx("div",{className:"px-3 py-1.5 rounded-full metric-badge-enter",style:{background:`color-mix(in srgb, ${x.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${x.color} 25%, transparent)`,color:x.color,backdropFilter:"blur(8px) saturate(120%)",animationDelay:`${D*.1}s`},children:e.jsx("span",{className:"font-medium",children:N})},D))}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:k,className:`px-6 md:px-8 py-3 md:py-4 text-lg md:text-xl font-bold relative overflow-hidden rounded-full ${x.animation==="pulse"&&!s?"btn-breathing-css":""}`,style:C,children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(p,{Icon:h[x.icon],size:24,className:"text-white"}),e.jsx("span",{children:v.buttonText})]}),x.priority==="medium"&&!s&&e.jsx("div",{className:"absolute inset-0 rounded-inherit pointer-events-none dynamic-shimmer-css",style:{background:`linear-gradient(90deg,
                      transparent 0%,
                      rgba(255,255,255,0.3) 50%,
                      transparent 100%
                    )`}})]})}),i&&g&&n&&e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-3 rounded-xl",style:{background:`color-mix(in srgb, ${g.color} 12%, transparent)`,border:`1px solid color-mix(in srgb, ${g.color} 25%, transparent)`},children:[e.jsxs("div",{className:"text-xl font-bold text-white mb-1",children:[Math.round(ue(m,g)),"%"]}),e.jsxs("div",{className:"text-xs font-medium",style:{color:g.color},children:["Phase ",g.name]}),e.jsx("div",{className:"text-white/50 text-xs mt-0.5",children:"Progression"})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl",style:{background:"color-mix(in srgb, #EF4444 12%, transparent)",border:"1px solid color-mix(in srgb, #EF4444 25%, transparent)"},children:[e.jsx("div",{className:"text-xl font-bold text-red-400 mb-1",children:ge(g,m,l?.weight_kg||70)}),e.jsx("div",{className:"text-red-300 text-xs font-medium",children:"Calories"}),e.jsx("div",{className:"text-white/50 text-xs mt-0.5",children:"Brûlées"})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-sm font-bold text-white mb-1 truncate",children:g.metabolicState}),e.jsx("div",{className:"text-white/70 text-xs font-medium",children:"État"}),e.jsx("div",{className:"text-white/50 text-xs mt-0.5",children:"Métabolique"})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-sm font-bold text-white mb-1 truncate",children:n.protocol}),e.jsx("div",{className:"text-white/70 text-xs font-medium",children:"Protocole"}),e.jsx("div",{className:"text-white/50 text-xs mt-0.5",children:"Actif"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl",style:{background:`color-mix(in srgb, ${g.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${g.color} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(p,{Icon:h.Heart,size:14,style:{color:g.color}}),e.jsx("span",{className:"text-sm font-semibold",style:{color:g.color},children:"Message de la Forge"})]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed",children:he(g)})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2 text-sm",children:[e.jsx(p,{Icon:h.Check,size:16,style:{color:g.color}}),"Bénéfices Actuels"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:g.benefits.slice(0,4).map((N,D)=>e.jsxs(f.div,{className:"flex items-center gap-2 p-2 rounded-lg",style:{background:`color-mix(in srgb, ${g.color} 6%, transparent)`,border:`1px solid color-mix(in srgb, ${g.color} 15%, transparent)`},initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4,delay:D*.1},children:[e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{background:g.color}}),e.jsx("span",{className:"text-white/80 text-xs",children:N})]},D))})]})]})]})]})})};function Ce(t){if(t.length===0)return{totalFastedHours:0,sessionsCount:0,averageDuration:0,longestSession:0,consistency:"needs_improvement",motivationalMessage:"Commencez votre première session de jeûne pour forger votre discipline temporelle !"};const a=t.filter(c=>c.status==="completed"&&c.actual_duration_hours),r=a.reduce((c,o)=>c+(o.actual_duration_hours||0),0),s=a.length>0?r/a.length:0,l=Math.max(0,...a.map(c=>c.actual_duration_hours||0));let i="needs_improvement",n="";return r>=16?(i="excellent",n="Excellente discipline ! Votre forge temporelle est parfaitement maîtrisée aujourd'hui."):r>=12?(i="good",n="Bonne progression ! Vous développez une solide discipline temporelle."):r>0?(i="needs_improvement",n="Bon début ! Continuez à forger votre discipline temporelle étape par étape."):n="Prêt à commencer votre forge temporelle ? Chaque session vous rapproche de vos objectifs.",{totalFastedHours:r,sessionsCount:a.length,averageDuration:s,longestSession:l,consistency:i,motivationalMessage:n}}function J(){const{session:t}=A(),a=t?.user?.id;return B({queryKey:["fasting","today",a],queryFn:async()=>{if(!a)throw new Error("User not authenticated");const r=new Date,s=P(r).toISOString(),l=Y(r).toISOString();j.info("FASTING_TODAY_SESSIONS","Fetching today fasting sessions",{userId:a,startDate:s,endDate:l,timestamp:new Date().toISOString()});const{data:i,error:n}=await O.from("fasting_sessions").select("*").eq("user_id",a).gte("start_time",s).lte("start_time",l).order("start_time",{ascending:!1});if(n)throw j.error("FASTING_TODAY_SESSIONS","Failed to fetch today sessions",{error:n.message,userId:a,timestamp:new Date().toISOString()}),n;const c=i||[],o=Ce(c);return j.info("FASTING_TODAY_SESSIONS","Today sessions fetched and stats calculated",{userId:a,sessionsCount:c.length,stats:o,timestamp:new Date().toISOString()}),{sessions:c,stats:o}},enabled:!!a,staleTime:2*60*1e3,refetchInterval:5*60*1e3,refetchOnWindowFocus:!0})}function De(t){switch(t){case"excellent":return{color:"#22C55E",icon:"Check",badge:"Excellent",description:"Discipline temporelle parfaite"};case"good":return{color:"#F59E0B",icon:"Target",badge:"Bien",description:"Bonne progression"};case"needs_improvement":return{color:"#F59E0B",icon:"TrendingUp",badge:"À améliorer",description:"Continuez vos efforts"}}}const Fe=({className:t=""})=>{const{data:a,isLoading:r,error:s}=J();if(r)return e.jsx(y,{className:`p-6 ${t}`,children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-48"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-32"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-20 bg-white/10 rounded-xl"}),e.jsx("div",{className:"h-20 bg-white/10 rounded-xl"}),e.jsx("div",{className:"h-20 bg-white/10 rounded-xl"})]})]})});if(s||!a)return e.jsx(y,{className:`p-6 ${t}`,style:{background:"color-mix(in srgb, #EF4444 8%, transparent)",borderColor:"color-mix(in srgb, #EF4444 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(p,{Icon:h.AlertCircle,size:16,className:"text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-300 font-semibold",children:"Erreur de Chargement"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Impossible de charger les données du jour"})]})]})});const{stats:l}=a,i=De(l.consistency),n=w(new Date,"dd MMMM yyyy");return e.jsx(f.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:[.25,.1,.25,1]},className:t,children:e.jsx(y,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i.color} 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #F59E0B 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${i.color} 25%, transparent)`,boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, ${i.color} 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `,backdropFilter:"blur(20px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${i.color} 35%, transparent), color-mix(in srgb, ${i.color} 25%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${i.color} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${i.color} 30%, transparent)`},children:e.jsx(p,{Icon:h[i.icon],size:20,style:{color:i.color}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Dernière Session Forgée"}),e.jsxs("p",{className:"text-white/80 text-sm mt-0.5",children:[n," • ",i.description]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"px-3 py-1.5 rounded-full",style:{background:`color-mix(in srgb, ${i.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${i.color} 25%, transparent)`},children:e.jsx("span",{className:"text-sm font-medium",style:{color:i.color},children:i.badge})})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 12%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 25%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:[l.totalFastedHours.toFixed(1),"h"]}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Temps Total"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Jeûné"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #10B981 12%, transparent)",border:"1px solid color-mix(in srgb, #10B981 25%, transparent)"},children:[e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:l.sessionsCount}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Sessions"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Complétées"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #8B5CF6 12%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 25%, transparent)"},children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:l.averageDuration>0?`${l.averageDuration.toFixed(1)}h`:"--"}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Moyenne"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Durée"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:l.longestSession>0?`${l.longestSession.toFixed(1)}h`:"--"}),e.jsx("div",{className:"text-white/70 text-sm font-medium",children:"Record"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Aujourd'hui"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl",style:{background:`color-mix(in srgb, ${i.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${i.color} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(p,{Icon:h.Lightbulb,size:14,style:{color:i.color}}),e.jsx("span",{className:"text-sm font-semibold",style:{color:i.color},children:"Motivation du Jour"})]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed",children:l.motivationalMessage})]})]})})})},_e=({onLoadingChange:t})=>{const{profile:a}=A(),{isActive:r,session:s}=V();return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ie,{}),!r&&e.jsx(Fe,{}),e.jsx(pe,{})]})};function ke(t,a,r){const s=[];j.debug("FASTING_INSIGHTS_MIN_DATA_CHECK","Checking minimum data requirements",{profileExists:!!t,sessionsCount:a,periodDays:r,profileData:t?{weight_kg:t.weight_kg,height_cm:t.height_cm,objective:t.objective,activity_level:t.activity_level}:null,minSessionsRequired:r===7?3:r===30?8:20,timestamp:new Date().toISOString()}),t?.weight_kg||s.push("Poids corporel"),t?.height_cm||s.push("Taille"),t?.objective||s.push("Objectif fitness"),t?.activity_level||s.push("Niveau d'activité");const l=r===7?3:r===30?8:20;return a<l&&s.push(`Au moins ${l} sessions de jeûne complétées`),j.debug("FASTING_INSIGHTS_MIN_DATA_RESULT","Minimum data check result",{sufficient:s.length===0,missingDataCount:s.length,missingData:s,minSessionsRequired:l,actualSessions:a,willProceedToEdgeFunction:s.length===0,timestamp:new Date().toISOString()}),{sufficient:s.length===0,missingData:s}}function Te(t=7){const{session:a,profile:r}=A(),s=a?.user?.id;return _.useEffect(()=>{j.debug("FASTING_INSIGHTS_HOOK_INIT","Hook initialized",{userId:s,periodDays:t,hasProfile:!!r,profileKeys:r?Object.keys(r):[],timestamp:new Date().toISOString()})},[s,t,r]),B({queryKey:["fasting","insights","ai",s,t],queryFn:async()=>{if(j.debug("FASTING_INSIGHTS_QUERY_START","Query function started",{userId:s,periodDays:t,timestamp:new Date().toISOString()}),!s)throw j.error("FASTING_INSIGHTS_QUERY_ERROR","User not authenticated",{userId:s,timestamp:new Date().toISOString()}),new Error("User not authenticated");const l=P(G(new Date,t)).toISOString(),i=new Date().toISOString();j.debug("FASTING_INSIGHTS_AI","Starting AI insights generation",{userId:s,periodDays:t,startDate:l,endDate:i,timestamp:new Date().toISOString()});const{data:n,error:c}=await O.from("fasting_sessions").select("id, status").eq("user_id",s).gte("start_time",l).lte("start_time",i);if(c)throw j.error("FASTING_INSIGHTS_AI","Failed to fetch sessions for data check",{error:c.message,userId:s,periodDays:t,timestamp:new Date().toISOString()}),c;const o=n||[],m=o.filter(v=>v.status==="completed").length;j.debug("FASTING_INSIGHTS_SESSIONS_DATA","Sessions fetched for insights",{userId:s,periodDays:t,totalSessions:o.length,completedSessions:m,sessionsData:o.map(v=>({id:v.id,status:v.status,date:v.start_time?v.start_time.split("T")[0]:"invalid"})),startDate:l,endDate:i,timestamp:new Date().toISOString()});const d=ke(r,m,t);if(j.debug("FASTING_INSIGHTS_DATA_CHECK","Data sufficiency check result",{userId:s,periodDays:t,completedSessionsCount:m,minRequired:t===7?3:t===30?8:20,dataCheckSufficient:d.sufficient,missingData:d.missingData,willProceedToEdgeFunction:d.sufficient,profileData:{hasWeightKg:!!r?.weight_kg,hasHeightCm:!!r?.height_cm,hasObjective:!!r?.objective,hasActivityLevel:!!r?.activity_level},timestamp:new Date().toISOString()}),j.debug("FASTING_INSIGHTS_AI_DATA_CHECK","Data sufficiency check completed",{userId:s,periodDays:t,profileData:{hasWeightKg:!!r?.weight_kg,weightKg:r?.weight_kg,hasHeightCm:!!r?.height_cm,heightCm:r?.height_cm,hasObjective:!!r?.objective,objective:r?.objective,hasActivityLevel:!!r?.activity_level,activityLevel:r?.activity_level,hasEmotions:!!r?.emotions,chronotype:r?.emotions?.chronotype,hasNutrition:!!r?.nutrition,fastingProtocol:r?.nutrition?.fastingWindow?.protocol},sessionsData:{totalSessions:o.length,completedSessions:m,minRequired:t===7?3:t===30?8:15},dataCheckResult:{sufficient:d.sufficient,missingDataCount:d.missingData.length,missingData:d.missingData},timestamp:new Date().toISOString()}),!d.sufficient)return j.warn("FASTING_INSIGHTS_AI","Insufficient data for AI insights generation - returning basic summary",{userId:s,periodDays:t,sessionsCount:m,missingData:d.missingData,willReturnBasicData:!0,timestamp:new Date().toISOString()}),{summary:{overallScore:0,keyFindings:["Données insuffisantes pour l'analyse IA"],mainRecommendation:"Complétez votre profil et ajoutez plus de sessions de jeûne pour débloquer les insights de la Forge Spatiale",sentiment:"encouraging"},insights:[],dataQuality:"insufficient",analysisDate:new Date().toISOString(),periodDays:t,aiModel:"gpt-5-mini",tokensUsed:0,cached:!1,missingData:d.missingData};const u={userId:s,periodDays:t,profile:{weight_kg:r?.weight_kg,height_cm:r?.height_cm,objective:r?.objective,activity_level:r?.activity_level,sex:r?.sex,birthdate:r?.birthdate,emotions:r?.emotions,nutrition:r?.nutrition}};j.debug("FASTING_INSIGHTS_EDGE_CALL_PAYLOAD","About to call Edge Function with payload",{userId:s,periodDays:t,payload:u,payloadSize:JSON.stringify(u).length,timestamp:new Date().toISOString()}),j.debug("FASTING_INSIGHTS_AI_EDGE_CALL","About to call AI insights generator Edge Function",{userId:s,periodDays:t,profileKeys:r?Object.keys(r):[],completedSessionsCount:m,dataCheckPassed:!0,timestamp:new Date().toISOString()}),j.debug("FASTING_INSIGHTS_AI","Calling AI insights generator Edge Function",{userId:s,periodDays:t,profileKeys:r?Object.keys(r):[],timestamp:new Date().toISOString()});const{data:b,error:g}=await O.functions.invoke("fasting-insights-generator",{body:u});if(j.debug("FASTING_INSIGHTS_EDGE_RESPONSE","Edge Function response received",{userId:s,periodDays:t,hasResponse:!!b,hasError:!!g,errorMessage:g?.message,responseKeys:b?Object.keys(b):[],timestamp:new Date().toISOString()}),g)throw j.error("FASTING_INSIGHTS_AI","AI insights generation failed",{error:g.message,userId:s,periodDays:t,timestamp:new Date().toISOString()}),new Error(`AI insights generation failed: ${g.message}`);const x=b;return j.debug("FASTING_INSIGHTS_AI","AI insights generated successfully",{userId:s,periodDays:t,insightsCount:x.insights.length,dataQuality:x.dataQuality,overallScore:x.summary.overallScore,tokensUsed:x.tokensUsed,cached:x.cached,aiModel:x.aiModel,timestamp:new Date().toISOString()}),x},enabled:!!s,staleTime:15*60*1e3,gcTime:30*60*1e3,retry:1,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,structuralSharing:!1})}function Ae(t){if(t.length===0)return{totalSessions:0,completedSessions:0,cancelledSessions:0,totalHours:0,averageDuration:0,longestSession:0,shortestSession:0,mostUsedProtocol:null,firstSessionDate:null,lastSessionDate:null};const a=t.filter(g=>g.status==="completed"&&g.actual_duration_hours),r=t.filter(g=>g.status==="cancelled"),s=a.reduce((g,x)=>g+(x.actual_duration_hours||0),0),l=a.length>0?s/a.length:0,i=a.map(g=>g.actual_duration_hours||0).filter(g=>g>0),n=i.length>0?Math.max(...i):0,c=i.length>0?Math.min(...i):0,o={};t.forEach(g=>{g.protocol_id&&(o[g.protocol_id]=(o[g.protocol_id]||0)+1)});const m=Object.entries(o).sort(([,g],[,x])=>x-g)[0]?.[0]||null,d=[...t].sort((g,x)=>new Date(g.start_time).getTime()-new Date(x.start_time).getTime()),u=d[0]?.start_time||null,b=d[d.length-1]?.start_time||null;return{totalSessions:t.length,completedSessions:a.length,cancelledSessions:r.length,totalHours:Math.round(s*10)/10,averageDuration:Math.round(l*10)/10,longestSession:Math.round(n*10)/10,shortestSession:Math.round(c*10)/10,mostUsedProtocol:m,firstSessionDate:u,lastSessionDate:b}}function Ee(t,a){let r=[...t];if(a.status&&a.status!=="all"&&(r=r.filter(s=>s.status===a.status)),a.protocol&&(r=r.filter(s=>s.protocol_id===a.protocol)),a.dateRange){const s=P(a.dateRange.start).toISOString(),l=Y(a.dateRange.end).toISOString();r=r.filter(i=>i.start_time>=s&&i.start_time<=l)}return a.minDuration!==void 0&&(r=r.filter(s=>s.actual_duration_hours&&s.actual_duration_hours>=a.minDuration)),a.maxDuration!==void 0&&(r=r.filter(s=>s.actual_duration_hours&&s.actual_duration_hours<=a.maxDuration)),r}function X(t=50,a={}){const{session:r}=A(),s=r?.user?.id;return B({queryKey:["fasting","history",s,t,a],queryFn:async()=>{if(!s)throw new Error("User not authenticated");j.debug("FASTING_HISTORY","Fetching fasting history",{userId:s,limit:t,filters:a,timestamp:new Date().toISOString()});let l=O.from("fasting_sessions").select("*").eq("user_id",s).order("start_time",{ascending:!1});t>0&&(l=l.limit(t));const{data:i,error:n}=await l;if(n)throw j.error("FASTING_HISTORY","Failed to fetch fasting history",{error:n.message,userId:s,timestamp:new Date().toISOString()}),n;const c=i||[],o=Ee(c,a),m=Ae(o);return j.debug("FASTING_HISTORY","History fetched and processed",{userId:s,totalSessions:c.length,filteredSessions:o.length,stats:m,timestamp:new Date().toISOString()}),{sessions:o,allSessions:c,stats:m,filters:a}},enabled:!!s,staleTime:15*60*1e3,cacheTime:30*60*1e3,retry:1,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,structuralSharing:!1})}function Oe(){const t=Z(),{session:a}=A(),{showToast:r}=K(),{success:s,error:l}=M();return ee({mutationFn:async i=>{if(!a?.user?.id)throw new Error("User not authenticated");j.info("FASTING_HISTORY","Deleting fasting session",{sessionId:i,userId:a.user.id,timestamp:new Date().toISOString()});const{error:n}=await O.from("fasting_sessions").delete().eq("id",i).eq("user_id",a.user.id);if(n)throw j.error("FASTING_HISTORY","Failed to delete session",{error:n.message,sessionId:i,userId:a.user.id,timestamp:new Date().toISOString()}),n;j.info("FASTING_HISTORY","Session deleted successfully",{sessionId:i,userId:a.user.id,timestamp:new Date().toISOString()})},onSuccess:()=>{t.invalidateQueries({queryKey:["fasting"]}),s(),r({type:"success",title:"Session supprimée",message:"La session de jeûne a été supprimée avec succès",duration:3e3})},onError:i=>{l(),r({type:"error",title:"Erreur de suppression",message:"Impossible de supprimer la session. Réessayez plus tard.",duration:4e3})}})}function $e(){const{session:t}=A(),a=t?.user?.id;return B({queryKey:["fasting","protocols",a],queryFn:async()=>{if(!a)throw new Error("User not authenticated");const{data:r,error:s}=await O.from("fasting_sessions").select("protocol_id").eq("user_id",a).not("protocol_id","is",null);if(s)throw s;return[...new Set((r||[]).map(i=>i.protocol_id))].filter(Boolean)},enabled:!!a,staleTime:10*60*1e3})}const Be=t=>{switch(t){case 7:return 3;case 30:return 8;case 90:return 20;default:return 3}};function H(t){switch(t){case 7:return"7 jours";case 30:return"30 jours";case 90:return"90 jours";default:return`${t} jours`}}const Me=({selectedPeriod:t,onPeriodChange:a,availableSessionsCount:r=0,getMinSessionsForPeriod:s=Be,className:l=""})=>{const{click:i}=M(),n=[{value:7,label:H(7)},{value:30,label:H(30)},{value:90,label:H(90)}],c=o=>{const m=s(o),d=r>=m;return j.debug("FASTING_PERIOD_SELECTOR","Period availability check",{periodValue:o,availableSessionsCount:r,threshold:m,available:d,calculation:`${r} >= ${m} = ${d}`,timestamp:new Date().toISOString()}),d};return e.jsx("div",{className:`flex justify-center ${l}`,children:e.jsx("div",{className:"inline-flex gap-2 p-1 rounded-lg",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:n.map(o=>{const m=c(o.value),d=t===o.value,u="#10B981";return e.jsx("button",{onClick:()=>{if(m)i(),a(o.value),j.info("FASTING_PERIOD_SELECTOR","Period changed",{newPeriod:o.value,availableSessionsCount:r,timestamp:new Date().toISOString()});else{const b=s(o.value);j.warn("FASTING_PERIOD_SELECTOR","Attempted to select unavailable period",{period:o.value,availableSessionsCount:r,requiredSessions:b,missingSessions:b-r,timestamp:new Date().toISOString()})}},disabled:!m,className:"px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200",style:{background:d?`${u}33`:"transparent",color:d?u:m?"rgba(255, 255, 255, 0.7)":"rgba(255, 255, 255, 0.4)",border:d?`1px solid ${u}66`:"1px solid transparent",boxShadow:d?`0 0 20px ${u}4D`:"none",opacity:m?1:.5,cursor:m?"pointer":"not-allowed"},children:o.label},o.value)})})})},Re=({className:t=""})=>e.jsxs("div",{className:`space-y-6 ${t}`,children:[e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsx(y,{className:"p-6 text-center",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 15%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #A855F7 12%, transparent) 0%, transparent 50%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #8B5CF6 30%, transparent)",boxShadow:`
              0 16px 48px rgba(0, 0, 0, 0.3),
              0 0 40px color-mix(in srgb, #8B5CF6 25%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.2)
            `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(f.div,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #8B5CF6 40%, transparent), color-mix(in srgb, #A855F7 30%, transparent))
                `,border:"3px solid color-mix(in srgb, #8B5CF6 60%, transparent)",boxShadow:`
                  0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent),
                  0 0 80px color-mix(in srgb, #8B5CF6 40%, transparent)
                `},animate:{scale:[1,1.05,1],boxShadow:["0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent)","0 0 60px color-mix(in srgb, #8B5CF6 80%, transparent)","0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(p,{Icon:h.Lightbulb,size:40,style:{color:"#8B5CF6"},className:"animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Génération IA en Cours"}),e.jsx("p",{className:"text-white/80 text-lg",children:"GPT-5 mini analyse vos patterns de jeûne..."})]}),e.jsx("div",{className:"space-y-2 max-w-md mx-auto",children:["Récupération des sessions de jeûne","Analyse des patterns avec GPT-5 mini","Génération d'insights personnalisés","Mise en cache pour optimisation"].map((a,r)=>e.jsxs(f.div,{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:r*.2},children:[e.jsx(f.div,{className:"w-2 h-2 rounded-full bg-purple-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,delay:r*.3}}),e.jsx("span",{className:"text-white/70 text-sm",children:a})]},r))})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-48 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-32 animate-pulse"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-3 bg-white/10 rounded w-full animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-3/4 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-1/2 animate-pulse"})]})]})}),[1,2,3].map(a=>e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3+a*.1},children:e.jsx(y,{className:"p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 animate-pulse flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-3/4 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-full animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-5/6 animate-pulse"})]}),e.jsx("div",{className:"h-8 bg-white/10 rounded w-32 animate-pulse"})]})]})})},a))]}),e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:1},className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-purple-500/10 border border-purple-400/20",children:[e.jsx(f.div,{className:"w-2 h-2 rounded-full bg-purple-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1,repeat:1/0}}),e.jsx("span",{className:"text-purple-300 text-sm font-medium",children:"Génération IA en cours... (~15-45 secondes)"})]})})]});function Pe(t,a){switch(t){case"positive":return{color:"#22C55E",icon:"Check",badge:"Excellent",description:"Performance exceptionnelle"};case"encouraging":return{color:"#F59E0B",icon:"TrendingUp",badge:"En progression",description:"Vous êtes sur la bonne voie"};case"neutral":default:return{color:"#06B6D4",icon:"Target",badge:"Stable",description:"Continuez vos efforts"}}}const Ge=({summary:t,periodDays:a,aiModel:r,tokensUsed:s,cached:l,className:i=""})=>{const n=Pe(t.sentiment,t.overallScore);return e.jsx(f.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:[.25,.1,.25,1]},className:i,children:e.jsx(y,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${n.color} 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, ${n.color} 10%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${n.color} 30%, transparent)`,boxShadow:`
            0 16px 48px rgba(0, 0, 0, 0.3),
            0 0 40px color-mix(in srgb, ${n.color} 25%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.2)
          `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center breathing-icon",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${n.color} 40%, transparent), color-mix(in srgb, ${n.color} 30%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${n.color} 60%, transparent)`,boxShadow:`0 0 25px color-mix(in srgb, ${n.color} 50%, transparent)`},children:e.jsx(p,{Icon:h[n.icon],size:20,style:{color:n.color},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Analyse de la Forge Temporelle"}),e.jsxs("p",{className:"text-white/80 text-sm mt-0.5",children:[a," derniers jours • ",n.description]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:n.color,boxShadow:`0 0 8px ${n.color}60`}}),e.jsx("span",{className:"text-white font-bold text-2xl",children:t.overallScore})]}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{background:`color-mix(in srgb, ${n.color} 15%, transparent)`,color:n.color},children:n.badge})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(p,{Icon:h.Search,size:16,style:{color:n.color}}),"Découvertes Clés"]}),e.jsx("div",{className:"space-y-2",children:t.keyFindings.map((c,o)=>e.jsxs(f.div,{className:"flex items-center gap-3 p-3 rounded-lg",style:{background:`color-mix(in srgb, ${n.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${n.color} 20%, transparent)`},initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4,delay:.2+o*.1},children:[e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{background:n.color}}),e.jsx("span",{className:"text-white/85 text-sm leading-relaxed",children:c})]},o))})]}),e.jsx(f.div,{className:"p-5 rounded-xl",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${n.color} 12%, transparent) 0%, transparent 60%),
                color-mix(in srgb, ${n.color} 6%, transparent)
              `,border:`2px solid color-mix(in srgb, ${n.color} 25%, transparent)`,boxShadow:`
                0 8px 32px rgba(0, 0, 0, 0.2),
                0 0 20px color-mix(in srgb, ${n.color} 20%, transparent),
                inset 0 1px 0 rgba(255, 255, 255, 0.15)
              `},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.5},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:`color-mix(in srgb, ${n.color} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${n.color} 30%, transparent)`},children:e.jsx(p,{Icon:h.Lightbulb,size:14,style:{color:n.color}})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold mb-2",style:{color:n.color},children:"Recommandation Principale"}),e.jsx("p",{className:"text-white/90 text-sm leading-relaxed",children:t.mainRecommendation})]})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs text-white/50 pt-2 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{Icon:h.Calendar,size:10}),e.jsxs("span",{children:["Période : ",a," jours"]})]}),r&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{Icon:h.Zap,size:10}),e.jsx("span",{children:r})]}),s&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{Icon:h.Activity,size:10}),e.jsxs("span",{children:[s," tokens"]})]}),l&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{Icon:h.Shield,size:10}),e.jsx("span",{children:"Mis en cache"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{Icon:h.Clock,size:10}),e.jsx("span",{children:"Mis à jour maintenant"})]})]})]})})})};function ze(t){switch(t){case"high":return{borderWidth:"2px",glowIntensity:"25%",backgroundIntensity:"12%"};case"medium":return{borderWidth:"1.5px",glowIntensity:"20%",backgroundIntensity:"10%"};case"low":default:return{borderWidth:"1px",glowIntensity:"15%",backgroundIntensity:"8%"}}}function He(t,a){return{pattern:"BarChart3",recommendation:"Lightbulb",achievement:"Check",warning:"AlertTriangle"}[t]||a||"Info"}const qe=({insight:t,index:a,className:r=""})=>{const s=ze(t.priority),l=He(t.type,t.icon);return e.jsx(f.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.5,delay:a*.1,ease:[.25,.1,.25,1]},className:r,children:e.jsxs(y,{className:"p-5 hover:scale-[1.01] transition-transform duration-200",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${t.color} ${s.backgroundIntensity}, transparent) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${t.color} 25%, transparent)`,borderWidth:s.borderWidth,boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.2),
            0 0 20px color-mix(in srgb, ${t.color} ${s.glowIntensity}, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `,backdropFilter:"blur(16px) saturate(150%)"},children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, ${t.color} 35%, transparent), color-mix(in srgb, ${t.color} 25%, transparent))
              `,border:`${s.borderWidth} solid color-mix(in srgb, ${t.color} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${t.color} 30%, transparent)`},children:e.jsx(p,{Icon:h[l],size:20,style:{color:t.color},variant:"pure"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-white font-bold text-lg leading-tight",children:t.title}),e.jsx("div",{className:"px-2 py-1 rounded-full flex-shrink-0",style:{background:`color-mix(in srgb, ${t.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${t.color} 25%, transparent)`},children:e.jsx("span",{className:"text-xs font-medium",style:{color:t.color},children:t.priority==="high"?"Priorité":t.priority==="medium"?"Important":"Info"})})]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed mb-4",children:t.content}),t.actionable&&e.jsx(f.div,{className:"p-3 rounded-lg",style:{background:`color-mix(in srgb, ${t.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${t.color} 20%, transparent)`},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2+a*.1},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(p,{Icon:h.Target,size:12,style:{color:t.color},className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium text-sm mb-1",style:{color:t.color},children:"Action Recommandée"}),e.jsx("p",{className:"text-white/80 text-xs leading-relaxed",children:t.actionable})]})]})})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-3 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{background:t.color}}),e.jsx("span",{className:"text-white/60 text-xs font-medium",children:t.type==="pattern"?"Pattern détecté":t.type==="recommendation"?"Recommandation":t.type==="achievement"?"Accomplissement":"Attention"})]}),e.jsxs("div",{className:"text-white/40 text-xs",children:["Insight #",a+1]})]})]})})},Le=t=>{switch(t){case 7:return 3;case 30:return 8;case 90:return 20;default:return 3}},Ue=()=>{const{profile:t}=A(),{showModal:a}=de(),{showToast:r}=K(),s=q(),[l,i]=R.useState(7),{data:n}=X(100,{dateRange:{start:new Date(Date.now()-l*24*60*60*1e3),end:new Date}}),c=n?.sessions?.filter(b=>b.status==="completed").length||0,{data:o,isLoading:m,error:d}=Te(l),u=U(({currentLocation:b,nextLocation:g})=>m&&b.pathname!==g.pathname&&!o?.cached);return _.useEffect(()=>{u.state==="blocked"&&a({title:"Quitter la génération IA en cours ?",message:"La Forge Spatiale génère vos insights personnalisés avec GPT-5 mini. Quitter maintenant annulera l'analyse et pourrait engendrer des coûts sans résultat.",processName:"Génération IA",onConfirm:()=>{u.proceed()},onCancel:()=>{u.reset()}})},[u,a]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Me,{selectedPeriod:l,onPeriodChange:i,availableSessionsCount:c,getMinSessionsForPeriod:Le}),m&&e.jsx(Re,{}),d&&e.jsx(y,{className:"p-6",style:{background:"color-mix(in srgb, #EF4444 8%, transparent)",borderColor:"color-mix(in srgb, #EF4444 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(p,{Icon:h.AlertCircle,size:16,className:"text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-300 font-semibold",children:"Erreur d'Analyse"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Impossible de générer les insights. Réessayez dans quelques instants."})]})]})}),o&&!m&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ge,{summary:o.summary,periodDays:l,aiModel:o.aiModel,tokensUsed:o.tokensUsed,cached:o.cached}),o.insights.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-white font-semibold text-lg flex items-center gap-2",children:[e.jsx(p,{Icon:h.Lightbulb,size:18,className:"text-green-400"}),"Insights Détaillés (",o.insights.length,")"]}),e.jsx("div",{className:"space-y-4",children:o.insights.map((b,g)=>e.jsx(qe,{insight:b,index:g},b.id))})]})]}),o&&o.insights.length===0&&!m&&e.jsx(y,{className:"p-8 text-center",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #10B981 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #10B981 12%, transparent) 0%, transparent 50%),
            linear-gradient(145deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.02) 100%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #10B981 30%, transparent)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #10B981 20%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #10B981 30%, transparent), color-mix(in srgb, #10B981 20%, transparent))
                  `,border:"2px solid color-mix(in srgb, #10B981 40%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(p,{Icon:h.Lightbulb,size:40,style:{color:"#10B981"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Insights en Construction"}),e.jsx("p",{className:"text-white/70 text-base",children:"Plus de sessions nécessaires"})]})]}),e.jsx("div",{children:e.jsx("p",{className:"text-white/70 text-base leading-relaxed max-w-lg mx-auto",children:"Enregistrez plus de sessions de jeûne pour débloquer des insights IA personnalisés et découvrir des analyses avancées de votre discipline temporelle."})}),e.jsx("button",{onClick:()=>s("/fasting/input"),className:"px-6 py-3 rounded-lg text-sm font-medium transition-all duration-200",style:{background:"linear-gradient(135deg, color-mix(in srgb, #10B981 80%, transparent), color-mix(in srgb, #10B981 60%, transparent))",border:"2px solid color-mix(in srgb, #10B981 60%, transparent)",boxShadow:"0 12px 40px color-mix(in srgb, #10B981 40%, transparent), 0 0 60px color-mix(in srgb, #10B981 30%, transparent)",color:"#fff"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{Icon:h.Timer,size:16}),e.jsx("span",{children:"Ajouter des Sessions"})]})})]})})]})};function Ke(t){if(t.length===0)return{totalSessions:0,totalFastedHours:0,averageDuration:0,longestFast:0,bestStreak:0,currentStreak:0,successRate:0,consistencyScore:0};const a=t.filter(x=>x.status==="completed"&&x.actual_duration_hours),r=a.reduce((x,v)=>x+(v.actual_duration_hours||0),0),s=a.length>0?r/a.length:0,l=Math.max(0,...a.map(x=>x.actual_duration_hours||0)),i=a.filter(x=>x.actual_duration_hours&&x.target_hours&&x.actual_duration_hours/x.target_hours>=.9),n=a.length>0?i.length/a.length*100:0,c=a.map(x=>{try{const v=S(x.start_time);return $(v)?w(v,"yyyy-MM-dd"):(j.warn("FASTING_PROGRESSION_METRICS","Invalid date in session",{sessionId:x.id,startTime:x.start_time,timestamp:new Date().toISOString()}),null)}catch(v){return j.error("FASTING_PROGRESSION_METRICS","Date parsing error",{sessionId:x.id,startTime:x.start_time,error:v instanceof Error?v.message:"Unknown error",timestamp:new Date().toISOString()}),null}}).filter(x=>x!==null),o=[...new Set(c)].sort();let m=0,d=0,u=0;for(let x=0;x<o.length;x++)x===0||(()=>{try{const v=S(o[x]),I=S(o[x-1]);return!$(v)||!$(I)?!1:v.getTime()-I.getTime()===24*60*60*1e3}catch{return!1}})()?u++:(d=Math.max(d,u),u=1);d=Math.max(d,u);const b=w(new Date,"yyyy-MM-dd");if(o.includes(b)){m=1;for(let x=o.length-2;x>=0;x--)try{const v=S(o[x+1]),I=S(o[x]);if(!$(v)||!$(I))break;if((v.getTime()-I.getTime())/(24*60*60*1e3)===1)m++;else break}catch{break}}const g=Math.round(n*.7+Math.min(100,o.length/30*100)*.3);return{totalSessions:t.length,totalFastedHours:Math.round(r*10)/10,averageDuration:Math.round(s*10)/10,longestFast:Math.round(l*10)/10,bestStreak:d,currentStreak:m,successRate:Math.round(n),consistencyScore:g}}function Ve(t,a){const r=new Date,s=G(r,a-1);return Q({start:s,end:r}).map(i=>{const n=w(i,"yyyy-MM-dd"),c=t.filter(u=>{try{const b=S(u.start_time);return $(b)?w(b,"yyyy-MM-dd")===n&&u.status==="completed":(j.warn("FASTING_PROGRESSION_CONSISTENCY","Invalid session date",{sessionId:u.id,startTime:u.start_time,timestamp:new Date().toISOString()}),!1)}catch(b){return j.error("FASTING_PROGRESSION_CONSISTENCY","Date filtering error",{sessionId:u.id,startTime:u.start_time,error:b instanceof Error?b.message:"Unknown error",timestamp:new Date().toISOString()}),!1}}),o=c.reduce((u,b)=>u+(b.actual_duration_hours||0),0),m=c.length>0?o/c.length:0;let d="none";if(c.length>0){const u=c.reduce((b,g)=>g.actual_duration_hours&&g.target_hours?b+g.actual_duration_hours/g.target_hours:b,0)/c.length;u>=.9?d="success":u>=.5?d="partial":d="missed"}return{date:n,hasFasted:c.length>0,totalHours:Math.round(o*10)/10,sessionsCount:c.length,averageDuration:Math.round(m*10)/10,outcome:d}})}function We(t,a){const r=new Date,s=G(r,a-1);return Q({start:s,end:r}).map(i=>{const n=w(i,"yyyy-MM-dd"),c=t.filter(d=>{try{const u=S(d.start_time);return $(u)?w(u,"yyyy-MM-dd")===n&&d.status==="completed":(j.warn("FASTING_PROGRESSION_TRENDS","Invalid session date",{sessionId:d.id,startTime:d.start_time,timestamp:new Date().toISOString()}),!1)}catch(u){return j.error("FASTING_PROGRESSION_TRENDS","Date filtering error",{sessionId:d.id,startTime:d.start_time,error:u instanceof Error?u.message:"Unknown error",timestamp:new Date().toISOString()}),!1}}),o=c.reduce((d,u)=>d+(u.actual_duration_hours||0),0),m=c.length>0?o/c.length:0;return{date:n,averageDuration:Math.round(m*10)/10,sessionsCount:c.length,totalHours:Math.round(o*10)/10}})}function Ye(t,a,r){const s=[];j.debug("FASTING_PROGRESSION_AI_DATA_CHECK_DETAILED","Checking minimum data requirements with full details",{profileExists:!!t,sessionsCount:a,periodDays:r,profileData:t?{weight_kg:t.weight_kg,height_cm:t.height_cm,objective:t.objective,activity_level:t.activity_level,sex:t.sex,hasEmotions:!!t.emotions,hasNutrition:!!t.nutrition}:null,timestamp:new Date().toISOString()}),t?.weight_kg||s.push("Poids corporel"),t?.height_cm||s.push("Taille"),t?.objective||s.push("Objectif fitness"),t?.activity_level||s.push("Niveau d'activité");const l=r===7?5:r===30?12:20;return a<l&&s.push(`Au moins ${l} sessions pour l'analyse IA`),j.debug("FASTING_PROGRESSION_AI_DATA_CHECK_RESULT","Minimum data check result (NO BYPASS)",{sufficient:s.length===0,missingDataCount:s.length,missingData:s,minSessionsRequired:l,actualSessions:a,willCallEdgeFunction:s.length===0,timestamp:new Date().toISOString()}),{sufficient:s.length===0,missingData:s}}function Qe(t=30){const{session:a,profile:r}=A(),s=a?.user?.id;return _.useEffect(()=>{j.debug("FASTING_PROGRESSION_HOOK_INIT","Hook initialized",{userId:s,periodDays:t,hasProfile:!!r,timestamp:new Date().toISOString()})},[s,t,r]),B({queryKey:["fasting","progression",s,t],queryFn:async()=>{if(j.debug("FASTING_PROGRESSION_QUERY_START","Query function started",{userId:s,periodDays:t,timestamp:new Date().toISOString()}),!s)throw j.error("FASTING_PROGRESSION_QUERY_ERROR","User not authenticated",{userId:s,timestamp:new Date().toISOString()}),new Error("User not authenticated");const l=P(G(new Date,t)).toISOString(),i=new Date().toISOString();j.debug("FASTING_PROGRESSION","Fetching progression data",{userId:s,periodDays:t,startDate:l,endDate:i,timestamp:new Date().toISOString()});const{data:n,error:c}=await O.from("fasting_sessions").select("*").eq("user_id",s).gte("start_time",l).lte("start_time",i).order("start_time",{ascending:!0});if(c)throw j.error("FASTING_PROGRESSION","Failed to fetch progression data",{error:c.message,userId:s,periodDays:t,timestamp:new Date().toISOString()}),c;const o=n||[];j.debug("FASTING_PROGRESSION_SESSIONS_DATA_DETAILED","Sessions fetched for progression with full details",{userId:s,periodDays:t,totalSessions:o.length,completedSessions:o.filter(C=>C.status==="completed").length,startDate:l,endDate:i,sessionsData:o.map(C=>({id:C.id,start_time:C.start_time,status:C.status,target_hours:C.target_hours,actual_duration_hours:C.actual_duration_hours,protocol_id:C.protocol_id})),timestamp:new Date().toISOString()});const m=Ke(o),d=Ve(o,t),u=We(o,t);j.debug("FASTING_PROGRESSION_METRICS_CALCULATED","Metrics calculated from sessions",{userId:s,periodDays:t,metrics:{totalSessions:m.totalSessions,totalFastedHours:m.totalFastedHours,averageDuration:m.averageDuration,successRate:m.successRate,consistencyScore:m.consistencyScore},timestamp:new Date().toISOString()});let b="insufficient";const g=o.filter(C=>C.status==="completed");g.length>=20?b="excellent":g.length>=10?b="good":g.length>=3&&(b="limited");const x=Ye(r,g.length,t);j.debug("FASTING_PROGRESSION_AI_DATA_CHECK_FINAL","AI data check result with bypass state",{userId:s,periodDays:t,completedSessions:g.length,aiDataCheckSufficient:x.sufficient,missingData:x.missingData,willProceedToEdgeFunction:x.sufficient,profileData:{hasWeightKg:!!r?.weight_kg,hasHeightCm:!!r?.height_cm,hasObjective:!!r?.objective,hasActivityLevel:!!r?.activity_level},timestamp:new Date().toISOString()});let v,I,k,F;if(x.sufficient)try{const C={userId:s,periodDays:t,profile:{weight_kg:r?.weight_kg,height_cm:r?.height_cm,objective:r?.objective,activity_level:r?.activity_level,sex:r?.sex,birthdate:r?.birthdate,emotions:r?.emotions,nutrition:r?.nutrition}};j.debug("FASTING_PROGRESSION_EDGE_CALL_PAYLOAD_DETAILED","About to call Edge Function with full payload",{userId:s,periodDays:t,profileComplete:{hasWeightKg:!!r?.weight_kg,weightKg:r?.weight_kg,hasHeightCm:!!r?.height_cm,heightCm:r?.height_cm,hasObjective:!!r?.objective,objective:r?.objective,hasActivityLevel:!!r?.activity_level,activityLevel:r?.activity_level,hasSex:!!r?.sex,sex:r?.sex},payloadSize:JSON.stringify(C).length,timestamp:new Date().toISOString()}),j.debug("FASTING_PROGRESSION_AI","Calling AI progression analyzer Edge Function",{userId:s,periodDays:t,completedSessions:g.length,profileKeys:r?Object.keys(r):[],edgeFunctionName:"fasting-progression-analyzer",timestamp:new Date().toISOString()});const{data:N,error:D}=await O.functions.invoke("fasting-progression-analyzer",{body:C});j.debug("FASTING_PROGRESSION_EDGE_RESPONSE","Edge Function response received",{userId:s,periodDays:t,hasResponse:!!N,hasError:!!D,errorMessage:D?.message,errorDetails:D?.details,responseKeys:N?Object.keys(N):[],responseType:typeof N,edgeFunctionCallCompleted:!0,timestamp:new Date().toISOString()}),D?j.error("FASTING_PROGRESSION_AI","AI progression analysis failed",{error:D.message,errorDetails:D.details,errorCode:D.code,userId:s,periodDays:t,timestamp:new Date().toISOString()}):(N&&typeof N=="object"?(v=N.aiAnalysis,I=N.aiModel,k=N.tokensUsed,F=N.cached,j.debug("FASTING_PROGRESSION_AI_SUCCESS","AI analysis extracted from response",{userId:s,periodDays:t,hasAiAnalysis:!!v,aiModel:I,tokensUsed:k,cached:F,timestamp:new Date().toISOString()})):j.warn("FASTING_PROGRESSION_AI","Invalid AI response format",{userId:s,periodDays:t,responseType:typeof N,responseValue:N,timestamp:new Date().toISOString()}),j.debug("FASTING_PROGRESSION_AI","AI progression analysis completed",{userId:s,periodDays:t,tokensUsed:k,cached:F,aiModel:I,timestamp:new Date().toISOString()}))}catch(C){j.error("FASTING_PROGRESSION_AI","AI progression analysis exception",{error:C instanceof Error?C.message:"Unknown error",errorStack:C instanceof Error?C.stack:void 0,userId:s,periodDays:t,timestamp:new Date().toISOString()})}else j.warn("FASTING_PROGRESSION_AI","Insufficient data for AI progression analysis - showing local metrics only",{userId:s,periodDays:t,completedSessions:g.length,missingData:x.missingData,aiDataCheckSufficient:x.sufficient,reasonForSkipping:"aiDataCheck.sufficient === false",willShowLocalMetrics:!0,localMetricsAvailable:m.totalSessions>0,timestamp:new Date().toISOString()});j.debug("FASTING_PROGRESSION_METRICS_CALCULATED","Metrics calculated",{userId:s,periodDays:t,metrics:{totalSessions:m.totalSessions,totalFastedHours:m.totalFastedHours,averageDuration:m.averageDuration,successRate:m.successRate,consistencyScore:m.consistencyScore},timestamp:new Date().toISOString()});const E={metrics:m,aiAnalysis:v,consistencyData:d,durationTrends:u,heatmapData:d,dataQuality:b,analysisDate:new Date().toISOString(),periodDays:t,aiModel:I,tokensUsed:k,cached:F};return j.debug("FASTING_PROGRESSION_FINAL","Progression data ready - metrics available",{userId:s,periodDays:t,hasMetrics:!!m,metricsSessionsCount:m.totalSessions,metricsTotalHours:m.totalFastedHours,metricsAvgDuration:m.averageDuration,metricsConsistencyScore:m.consistencyScore,hasAiAnalysis:!!v,dataQuality:b,willDisplayLocalMetrics:m.totalSessions>0,metricsKeys:Object.keys(m),consistencyDataLength:d.length,timestamp:new Date().toISOString()}),j.debug("FASTING_PROGRESSION_AI_DATA_CHECK","AI data check result",{periodDays:t,totalSessions:o.length,completedSessions:g.length,willProceedToEdgeFunction:x.sufficient,dataQuality:b,metrics:{totalFastedHours:m.totalFastedHours,successRate:m.successRate,currentStreak:m.currentStreak},hasAiAnalysis:!!v,aiModel:I,tokensUsed:k,cached:F,timestamp:new Date().toISOString()}),E},enabled:!!s,staleTime:15*60*1e3,gcTime:30*60*1e3,retry:1,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,structuralSharing:!1})}const Je=({className:t=""})=>e.jsxs("div",{className:`space-y-6 ${t}`,children:[e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsx(y,{className:"p-6 text-center",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 15%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #3B82F6 12%, transparent) 0%, transparent 50%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #06B6D4 30%, transparent)",boxShadow:`
              0 16px 48px rgba(0, 0, 0, 0.3),
              0 0 40px color-mix(in srgb, #06B6D4 25%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.2)
            `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(f.div,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #06B6D4 40%, transparent), color-mix(in srgb, #3B82F6 30%, transparent))
                `,border:"3px solid color-mix(in srgb, #06B6D4 60%, transparent)",boxShadow:`
                  0 0 40px color-mix(in srgb, #06B6D4 60%, transparent),
                  0 0 80px color-mix(in srgb, #06B6D4 40%, transparent)
                `},animate:{scale:[1,1.05,1],boxShadow:["0 0 40px color-mix(in srgb, #06B6D4 60%, transparent)","0 0 60px color-mix(in srgb, #06B6D4 80%, transparent)","0 0 40px color-mix(in srgb, #06B6D4 60%, transparent)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(p,{Icon:h.BarChart3,size:40,style:{color:"#06B6D4"},className:"animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Analyse IA de Progression"}),e.jsx("p",{className:"text-white/80 text-lg",children:"GPT-5 mini analyse vos données de progression..."})]}),e.jsx("div",{className:"space-y-2 max-w-md mx-auto",children:["Collecte des sessions de jeûne","Calcul des métriques de progression","Analyse narrative avec GPT-5 mini","Génération des recommandations IA"].map((a,r)=>e.jsxs(f.div,{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:r*.2},children:[e.jsx(f.div,{className:"w-2 h-2 rounded-full bg-cyan-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,delay:r*.3}}),e.jsx("span",{className:"text-white/70 text-sm",children:a})]},r))})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 bg-white/10 rounded w-48 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-32 animate-pulse"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[1,2,3,4].map(a=>e.jsxs("div",{className:"text-center p-4 rounded-xl bg-white/5",children:[e.jsx("div",{className:"h-8 bg-white/10 rounded w-16 mx-auto mb-2 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-20 mx-auto animate-pulse"})]},a))}),e.jsx("div",{className:"h-20 bg-white/10 rounded-xl animate-pulse"})]})}),[1,2].map(a=>e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3+a*.1},children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-40 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-24 animate-pulse"})]})]}),e.jsx("div",{className:"h-32 bg-white/10 rounded-xl animate-pulse mb-4"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[1,2,3,4].map(r=>e.jsx("div",{className:"h-3 bg-white/10 rounded animate-pulse"},r))})]})},a))]}),e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:1},className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-cyan-500/10 border border-cyan-400/20",children:[e.jsx(f.div,{className:"w-2 h-2 rounded-full bg-cyan-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1,repeat:1/0}}),e.jsx("span",{className:"text-cyan-300 text-sm font-medium",children:"Analyse IA en cours... (~20-60 secondes)"})]})})]});function Xe(t){return t>=80?{color:"#22C55E",icon:"Check",badge:"Excellent",description:"Performance exceptionnelle"}:t>=60?{color:"#F59E0B",icon:"TrendingUp",badge:"Bien",description:"Bonne progression"}:t>=40?{color:"#06B6D4",icon:"Target",badge:"Modéré",description:"En développement"}:{color:"#10B981",icon:"Timer",badge:"Débutant",description:"Commencez votre forge"}}const Ze=({metrics:t,periodDays:a,aiAnalysis:r,aiModel:s,tokensUsed:l,cached:i,className:n=""})=>{const c=Xe(t.consistencyScore);return e.jsx(f.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:[.25,.1,.25,1]},className:n,children:e.jsx(y,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${c.color} 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, ${c.color} 10%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${c.color} 30%, transparent)`,boxShadow:`
            0 16px 48px rgba(0, 0, 0, 0.3),
            0 0 40px color-mix(in srgb, ${c.color} 25%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.2)
          `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center breathing-icon",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${c.color} 40%, transparent), color-mix(in srgb, ${c.color} 30%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${c.color} 60%, transparent)`,boxShadow:`0 0 25px color-mix(in srgb, ${c.color} 50%, transparent)`},children:e.jsx(p,{Icon:h[c.icon],size:20,style:{color:c.color},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Progression Temporelle"}),e.jsxs("p",{className:"text-white/80 text-sm mt-0.5",children:[a," derniers jours • ",c.description]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:c.color,boxShadow:`0 0 8px ${c.color}60`}}),e.jsx("span",{className:"text-white font-bold text-2xl",children:t.consistencyScore})]}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{background:`color-mix(in srgb, ${c.color} 15%, transparent)`,color:c.color},children:c.badge})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(f.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 10%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1},children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:t.totalSessions}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Sessions"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Total"})]}),e.jsxs(f.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 10%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:[t.totalFastedHours,"h"]}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Temps Total"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Jeûné"})]}),e.jsxs(f.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #10B981 10%, transparent)",border:"1px solid color-mix(in srgb, #10B981 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.3},children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400 mb-1",children:[t.averageDuration,"h"]}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Moyenne"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Durée"})]}),e.jsxs(f.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #EF4444 10%, transparent)",border:"1px solid color-mix(in srgb, #EF4444 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.4},children:[e.jsxs("div",{className:"text-2xl font-bold text-red-400 mb-1",children:[t.longestFast,"h"]}),e.jsx("div",{className:"text-red-300 text-sm font-medium",children:"Record"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Personnel"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(f.div,{className:"p-4 rounded-xl",style:{background:`color-mix(in srgb, ${c.color} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${c.color} 20%, transparent)`},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`color-mix(in srgb, ${c.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${c.color} 25%, transparent)`},children:e.jsx(p,{Icon:h.Zap,size:16,style:{color:c.color}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t.currentStreak}),e.jsx("div",{className:"text-white/70 text-sm",children:"Série Actuelle"}),e.jsx("div",{className:"text-white/50 text-xs",children:"Jours consécutifs"})]})]})}),e.jsx(f.div,{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, #10B981 10%, transparent)",border:"1px solid color-mix(in srgb, #10B981 20%, transparent)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #10B981 15%, transparent)",border:"1px solid color-mix(in srgb, #10B981 25%, transparent)"},children:e.jsx(p,{Icon:h.Star,size:16,style:{color:"#10B981"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t.bestStreak}),e.jsx("div",{className:"text-white/70 text-sm",children:"Meilleure Série"}),e.jsx("div",{className:"text-white/50 text-xs",children:"Record personnel"})]})]})}),e.jsx(f.div,{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.7},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #22C55E 15%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 25%, transparent)"},children:e.jsx(p,{Icon:h.Target,size:16,style:{color:"#22C55E"}})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[t.successRate,"%"]}),e.jsx("div",{className:"text-white/70 text-sm",children:"Taux de Succès"}),e.jsx("div",{className:"text-white/50 text-xs",children:"Objectifs atteints"})]})]})})]}),e.jsxs(f.div,{className:"p-5 rounded-xl text-center",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${c.color} 12%, transparent) 0%, transparent 60%),
                color-mix(in srgb, ${c.color} 6%, transparent)
              `,border:`2px solid color-mix(in srgb, ${c.color} 25%, transparent)`,boxShadow:`
                0 8px 32px rgba(0, 0, 0, 0.2),
                0 0 20px color-mix(in srgb, ${c.color} 20%, transparent),
                inset 0 1px 0 rgba(255, 255, 255, 0.15)
              `},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.8},children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx(p,{Icon:h.Lightbulb,size:18,style:{color:c.color}}),e.jsx("h4",{className:"font-bold text-lg",style:{color:c.color},children:r?"Analyse IA de Performance":"Analyse de Performance"})]}),e.jsx("p",{className:"text-white/90 text-base leading-relaxed mb-4",children:r?r.motivationalMessage:t.consistencyScore>=80?`Excellente maîtrise ! Vous avez forgé une discipline temporelle remarquable avec ${t.totalSessions} sessions et ${t.totalFastedHours}h de jeûne total.`:t.consistencyScore>=60?`Bonne progression ! Votre régularité s'améliore avec ${t.currentStreak} jours de série actuelle. Continuez sur cette lancée.`:t.consistencyScore>=40?`Développement en cours. Votre record personnel est de ${t.longestFast}h. Visez la régularité pour optimiser les bénéfices.`:`Début de votre forge temporelle ! Chaque session compte. Votre meilleure série est de ${t.bestStreak} jours.`}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full",style:{background:`color-mix(in srgb, ${c.color} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${c.color} 20%, transparent)`},children:[e.jsx(p,{Icon:h.Target,size:14,style:{color:c.color}}),e.jsx("span",{className:"text-sm font-medium",style:{color:c.color},children:r?r.nextMilestone:t.currentStreak===0?"Objectif : Commencer une série":t.currentStreak<7?`Objectif : Atteindre 7 jours (${7-t.currentStreak} restants)`:t.bestStreak<14?"Objectif : Série de 14 jours":"Objectif : Maintenir l'excellence"})]})]}),r&&e.jsxs(f.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:1},children:[e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("h5",{className:"text-white font-semibold mb-2 flex items-center gap-2",children:[e.jsx(p,{Icon:h.FileText,size:14,className:"text-cyan-400"}),"Résumé Narratif IA"]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed",children:r.narrativeSummary})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("h5",{className:"text-white font-semibold mb-2 flex items-center gap-2",children:[e.jsx(p,{Icon:h.TrendingUp,size:14,className:"text-green-400"}),"Analyse de Tendances"]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed",children:r.trendAnalysis})]}),r.strategicRecommendations.length>0&&e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("h5",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(p,{Icon:h.Target,size:14,className:"text-green-400"}),"Recommandations Stratégiques IA"]}),e.jsx("div",{className:"space-y-2",children:r.strategicRecommendations.map((o,m)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mt-2 flex-shrink-0"}),e.jsx("span",{className:"text-white/85 text-sm leading-relaxed",children:o})]},m))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-white/80 font-medium text-sm flex items-center gap-2",children:[e.jsx(p,{Icon:h.Clock,size:14,className:"text-cyan-400"}),"Métriques Temporelles"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Temps total jeûné"}),e.jsxs("span",{className:"text-white font-medium",children:[t.totalFastedHours,"h"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Durée moyenne"}),e.jsxs("span",{className:"text-white font-medium",children:[t.averageDuration,"h"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Record personnel"}),e.jsxs("span",{className:"text-white font-medium",children:[t.longestFast,"h"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-white/80 font-medium text-sm flex items-center gap-2",children:[e.jsx(p,{Icon:h.TrendingUp,size:14,className:"text-green-400"}),"Performance"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Taux de succès"}),e.jsxs("span",{className:"text-white font-medium",children:[t.successRate,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Série actuelle"}),e.jsxs("span",{className:"text-white font-medium",children:[t.currentStreak," jours"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Meilleure série"}),e.jsxs("span",{className:"text-white font-medium",children:[t.bestStreak," jours"]})]})]})]})]}),(s||l||i!==void 0)&&e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs text-white/50 pt-2 border-t border-white/10",children:[s&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{Icon:h.Zap,size:10}),e.jsx("span",{children:s})]}),l&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{Icon:h.Activity,size:10}),e.jsxs("span",{children:[l," tokens"]})]}),i&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{Icon:h.Shield,size:10}),e.jsx("span",{children:"Résultat mis en cache"})]})]})]})})})};function et(t){switch(t){case"success":return"#22C55E";case"partial":return"#F59E0B";case"missed":return"#EF4444";case"none":return"rgba(255, 255, 255, 0.1)"}}function L(t){switch(t){case"success":return"Succès";case"partial":return"Partiel";case"missed":return"Manqué";case"none":return"Aucun jeûne"}}const tt=({data:t,periodDays:a,className:r=""})=>{const s=_.useMemo(()=>{if(a<14)return null;const i=[];for(let n=0;n<t.length;n+=7){const c=t.slice(n,n+7),o=c.reduce((b,g)=>b+g.sessionsCount,0),m=c.reduce((b,g)=>b+g.totalHours,0),u=c.filter(b=>b.outcome==="success").length/7*100;i.push({weekStart:c[0]?.date||"",weekEnd:c[c.length-1]?.date||"",sessionsCount:o,totalHours:Math.round(m*10)/10,successRate:Math.round(u)})}return i},[t,a]),l=_.useMemo(()=>{const i=t.length,n=t.filter(m=>m.hasFasted).length,c=t.filter(m=>m.outcome==="success").length,o=t.filter(m=>m.outcome==="partial").length;return{totalDays:i,fastedDays:n,successfulDays:c,partialDays:o,consistencyRate:i>0?Math.round(n/i*100):0,successRate:n>0?Math.round(c/n*100):0}},[t]);return e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:r,children:e.jsx(y,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #3B82F6 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #06B6D4 25%, transparent)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #06B6D4 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `,backdropFilter:"blur(20px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #06B6D4 35%, transparent), color-mix(in srgb, #06B6D4 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #06B6D4 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #06B6D4 30%, transparent)"},children:e.jsx(p,{Icon:h.BarChart3,size:20,style:{color:"#06B6D4"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Régularité du Jeûne"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[a," derniers jours • ",l.fastedDays,"/",l.totalDays," jours avec jeûne"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-cyan-400"}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[l.consistencyRate,"%"]})]}),e.jsx("div",{className:"text-cyan-300 text-xs",children:"Régularité"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(p,{Icon:h.Calendar,size:16,className:"text-cyan-400"}),"Consistance Quotidienne"]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-4",children:t.slice(-49).map((i,n)=>{const c=et(i.outcome),o=i.outcome==="none"?.3:.8;return e.jsxs(f.div,{className:"aspect-square rounded-lg flex items-center justify-center relative group cursor-pointer",style:{backgroundColor:c,opacity:o},initial:{scale:0,opacity:0},animate:{scale:1,opacity:o},transition:{duration:.3,delay:n*.02},title:`${w(S(i.date),"dd/MM")} - ${L(i.outcome)} ${i.totalHours>0?`(${i.totalHours}h)`:""}`,children:[i.sessionsCount>0&&e.jsx("span",{className:"text-white text-xs font-bold",children:i.sessionsCount}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black/80 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10",children:[w(S(i.date),"dd MMM")," - ",L(i.outcome),i.totalHours>0&&` (${i.totalHours}h)`]})]},i.date)})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-500"}),e.jsx("span",{className:"text-green-300",children:"Succès"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-orange-500"}),e.jsx("span",{className:"text-orange-300",children:"Partiel"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-red-500"}),e.jsx("span",{className:"text-red-300",children:"Manqué"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-white/20"}),e.jsx("span",{className:"text-white/60",children:"Aucun"})]})]})]}),s&&s.length>1&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(p,{Icon:h.CalendarRange,size:16,className:"text-cyan-400"}),"Résumé Hebdomadaire"]}),e.jsx("div",{className:"space-y-2",children:s.slice(-4).map((i,n)=>e.jsxs(f.div,{className:"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/10",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:n*.1},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-white font-medium text-sm",children:["Semaine du ",w(S(i.weekStart),"dd MMM")]}),e.jsxs("div",{className:"text-white/60 text-xs",children:[i.sessionsCount," sessions • ",i.totalHours,"h total"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:i.successRate>=70?"color-mix(in srgb, #22C55E 15%, transparent)":i.successRate>=40?"color-mix(in srgb, #F59E0B 15%, transparent)":"color-mix(in srgb, #EF4444 15%, transparent)",color:i.successRate>=70?"#22C55E":i.successRate>=40?"#F59E0B":"#EF4444"},children:[i.successRate,"% succès"]})})]},i.weekStart))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)"},children:[e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:l.successfulDays}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Jours Réussis"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 10%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},children:[e.jsx("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:l.partialDays}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Jours Partiels"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #06B6D4 10%, transparent)",border:"1px solid color-mix(in srgb, #06B6D4 20%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-cyan-400 mb-1",children:[l.consistencyRate,"%"]}),e.jsx("div",{className:"text-cyan-300 text-sm font-medium",children:"Régularité"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:[l.successRate,"%"]}),e.jsx("div",{className:"text-white/70 text-sm font-medium",children:"Taux Succès"})]})]})]})})})},st=({sessions:t,periodDays:a,className:r=""})=>{const s=_.useMemo(()=>{if(!t||t.length===0)return[];const o=[...t].filter(u=>u.status==="completed").sort((u,b)=>new Date(u.start_time).getTime()-new Date(b.start_time).getTime()),m=[];let d=null;return o.forEach((u,b)=>{const g=w(S(u.start_time),"yyyy-MM-dd");if(d?ye(S(g),S(d.endDate))===1?(d.endDate=g,d.length+=1):(d.status="completed",m.push(d),d={startDate:g,endDate:g,length:1,status:"active"}):d={startDate:g,endDate:g,length:1,status:"active"},b===o.length-1&&d){const x=w(new Date,"yyyy-MM-dd"),v=w(new Date(Date.now()-864e5),"yyyy-MM-dd");d.endDate===x||d.endDate===v?d.status="active":d.status="completed",m.push(d)}}),m.sort((u,b)=>b.length-u.length)},[t]);if(s.length===0)return e.jsx(y,{className:`p-6 text-center ${r}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(p,{Icon:h.Flame,size:32,className:"text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Aucune Série Détectée"}),e.jsx("p",{className:"text-white/70",children:"Complétez des sessions de jeûne consécutives pour créer des séries"})]})]})});const l=s.find(o=>o.status==="active"),i=s[0],n=s.length,c=s.reduce((o,m)=>o+m.length,0)/n;return e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},className:r,children:e.jsx(y,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #EC4899 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #8B5CF6 25%, transparent)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #8B5CF6 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `,backdropFilter:"blur(20px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #8B5CF6 35%, transparent), color-mix(in srgb, #EC4899 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #8B5CF6 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #8B5CF6 30%, transparent)"},children:e.jsx(p,{Icon:h.Flame,size:20,style:{color:"#8B5CF6"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Séries de Jeûne"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[n," série",n>1?"s":""," détectée",n>1?"s":""]})]})]}),l&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"px-3 py-1.5 rounded-full mb-1",style:{background:"color-mix(in srgb, #22C55E 15%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 25%, transparent)"},children:e.jsx("span",{className:"text-sm font-medium text-green-300",children:"🔥 Série active"})}),e.jsx("p",{className:"text-2xl font-bold text-white",children:l.length}),e.jsxs("p",{className:"text-white/60 text-xs",children:["jour",l.length>1?"s":""]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"color-mix(in srgb, #F59E0B 10%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},children:[e.jsx("div",{className:"text-3xl font-bold text-orange-400 mb-1",children:i.length}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Record"}),e.jsx("div",{className:"text-orange-200 text-xs mt-1",children:w(S(i.startDate),"dd MMM",{locale:z})})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"color-mix(in srgb, #8B5CF6 10%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 20%, transparent)"},children:[e.jsx("div",{className:"text-3xl font-bold text-purple-400 mb-1",children:c.toFixed(1)}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Moyenne"}),e.jsx("div",{className:"text-purple-200 text-xs mt-1",children:"par série"})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"color-mix(in srgb, #EC4899 10%, transparent)",border:"1px solid color-mix(in srgb, #EC4899 20%, transparent)"},children:[e.jsx("div",{className:"text-3xl font-bold text-pink-400 mb-1",children:n}),e.jsx("div",{className:"text-pink-300 text-sm font-medium",children:"Séries"}),e.jsx("div",{className:"text-pink-200 text-xs mt-1",children:"au total"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(p,{Icon:h.TrendingUp,size:16,className:"text-purple-400"}),"Top 5 des Séries"]}),e.jsx("div",{className:"space-y-3",children:s.slice(0,5).map((o,m)=>{const d=o.status==="active",u=o===i;return e.jsx(f.div,{className:"relative p-4 rounded-xl",style:{background:d?"color-mix(in srgb, #22C55E 8%, transparent)":"rgba(255, 255, 255, 0.03)",border:d?"1px solid color-mix(in srgb, #22C55E 20%, transparent)":"1px solid rgba(255, 255, 255, 0.05)"},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:m*.1},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:d?"linear-gradient(135deg, #22C55E, #10B981)":u?"linear-gradient(135deg, #F59E0B, #EF4444)":"linear-gradient(135deg, #8B5CF6, #EC4899)",boxShadow:d||u?`0 0 12px ${d?"#22C55E":"#F59E0B"}80`:"none"},children:e.jsx("span",{className:"text-white font-bold text-lg",children:m+1})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-white font-semibold text-lg",children:[o.length," jour",o.length>1?"s":""]}),u&&e.jsx("div",{className:"px-2 py-0.5 rounded-full bg-orange-500/20 border border-orange-400/30",children:e.jsx("span",{className:"text-orange-300 text-xs font-semibold",children:"🏆 Record"})}),d&&e.jsx("div",{className:"px-2 py-0.5 rounded-full bg-green-500/20 border border-green-400/30",children:e.jsx("span",{className:"text-green-300 text-xs font-semibold",children:"🔥 Active"})})]}),e.jsxs("div",{className:"text-white/60 text-xs mt-0.5",children:[w(S(o.startDate),"dd MMM",{locale:z})," - ",w(S(o.endDate),"dd MMM",{locale:z})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(p,{Icon:h.Flame,size:24,style:{color:d?"#22C55E":u?"#F59E0B":"#8B5CF6"}})})]})},`${o.startDate}-${m}`)})})]}),e.jsx("div",{className:"p-4 rounded-xl",style:{background:l?"color-mix(in srgb, #22C55E 6%, transparent)":"color-mix(in srgb, #8B5CF6 6%, transparent)",border:l?"1px solid color-mix(in srgb, #22C55E 18%, transparent)":"1px solid color-mix(in srgb, #8B5CF6 18%, transparent)",backdropFilter:"blur(8px) saturate(120%)"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(p,{Icon:l?h.TrendingUp:h.Info,size:14,style:{color:l?"#22C55E":"#8B5CF6"},className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:l?"#22C55E":"#8B5CF6"},children:l?`Série active de ${l.length} jour${l.length>1?"s":""} !`:"Démarrez une nouvelle série"}),e.jsx("p",{className:"text-xs mt-1",style:{color:l?"#22C55ECC":"#8B5CF6CC"},children:l?l.length>=i.length?"🎉 Nouveau record en cours ! Continuez ainsi !":`Plus que ${i.length-l.length} jour${i.length-l.length>1?"s":""} pour égaler votre record`:"Complétez une session de jeûne aujourd'hui pour commencer une nouvelle série"})]})]})})]})})})},rt=({data:t,periodDays:a,className:r=""})=>{const s=t.filter(c=>c.sessionsCount>0),l=_.useMemo(()=>{if(s.length===0)return{maxDuration:0,minDuration:0,averageDuration:0,trend:"stable",improvement:0};const c=s.map(F=>F.averageDuration),o=Math.max(...c),m=Math.min(...c),d=c.reduce((F,E)=>F+E,0)/c.length,u=Math.floor(s.length/2),b=s.slice(0,u),g=s.slice(u),x=b.length>0?b.reduce((F,E)=>F+E.averageDuration,0)/b.length:0,I=(g.length>0?g.reduce((F,E)=>F+E.averageDuration,0)/g.length:0)-x,k=I>.5?"improving":I<-.5?"declining":"stable";return{maxDuration:Math.round(o*10)/10,minDuration:Math.round(m*10)/10,averageDuration:Math.round(d*10)/10,trend:k,improvement:Math.round(I*10)/10}},[s]),n=(()=>{switch(l.trend){case"improving":return{color:"#22C55E",icon:"TrendingUp",label:"En amélioration",description:`+${l.improvement}h en moyenne`};case"declining":return{color:"#EF4444",icon:"TrendingDown",label:"En baisse",description:`${l.improvement}h en moyenne`};case"stable":default:return{color:"#06B6D4",icon:"Minus",label:"Stable",description:"Durées constantes"}}})();return s.length===0?e.jsx(y,{className:`p-6 text-center ${r}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-cyan-500/20 flex items-center justify-center",children:e.jsx(p,{Icon:h.LineChart,size:32,className:"text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Aucune Donnée de Tendance"}),e.jsx("p",{className:"text-white/70",children:"Complétez quelques sessions de jeûne pour voir l'évolution de vos durées"})]})]})}):e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:r,children:e.jsx(y,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${n.color} 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${n.color} 25%, transparent)`,boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, ${n.color} 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `,backdropFilter:"blur(20px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${n.color} 35%, transparent), color-mix(in srgb, ${n.color} 25%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${n.color} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${n.color} 30%, transparent)`},children:e.jsx(p,{Icon:h[n.icon],size:20,style:{color:n.color}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Évolution des Durées"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[s.length," jours avec données • ",n.label]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"px-3 py-1.5 rounded-full",style:{background:`color-mix(in srgb, ${n.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${n.color} 25%, transparent)`},children:e.jsx("span",{className:"text-sm font-medium",style:{color:n.color},children:n.description})})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(p,{Icon:h.LineChart,size:16,className:"text-purple-400"}),"Tendance des Durées"]}),e.jsx("div",{className:"relative h-32 bg-white/5 rounded-xl p-4 overflow-hidden",children:e.jsx("div",{className:"relative h-full flex items-end justify-between",children:s.slice(-14).map((c,o)=>{const m=l.maxDuration>0?c.averageDuration/l.maxDuration*100:0;return e.jsxs(f.div,{className:"flex flex-col items-center group cursor-pointer",style:{width:`${100/Math.min(s.length,14)}%`},initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},transition:{duration:.5,delay:o*.05},children:[e.jsx("div",{className:"w-2 bg-gradient-to-t from-cyan-500 to-purple-400 rounded-full mb-1 transition-all duration-200 group-hover:w-3",style:{height:`${Math.max(m,5)}%`}}),e.jsx("div",{className:"text-xs text-white/60 transform -rotate-45 origin-bottom-left whitespace-nowrap",children:w(S(c.date),"dd/MM")}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black/80 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10",children:[w(S(c.date),"dd MMM")," - ",c.averageDuration,"h",c.sessionsCount>1&&` (${c.sessionsCount} sessions)`]})]},c.date)})})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400 mb-1",children:[l.maxDuration,"h"]}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Maximum"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #06B6D4 10%, transparent)",border:"1px solid color-mix(in srgb, #06B6D4 20%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-cyan-400 mb-1",children:[l.averageDuration,"h"]}),e.jsx("div",{className:"text-cyan-300 text-sm font-medium",children:"Moyenne"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #8B5CF6 10%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 20%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:[l.minDuration,"h"]}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Minimum"})]})]})]})})})},at=t=>{switch(t){case 7:return 5;case 30:return 12;case 90:return 20;default:return 5}},nt=()=>{const{profile:t,session:a}=A(),r=q(),[s,l]=R.useState(7),{data:i}=J(),{data:n,isLoading:c,error:o}=Qe(s),m=n?.metrics?.totalSessions||0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"inline-flex gap-2 p-1 rounded-lg",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[7,30,90].map(d=>{const u=s===d,b="#06B6D4",g=at(d),x=m>=g;return e.jsx("button",{onClick:()=>{x&&l(d)},disabled:!x,className:"px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200",style:{background:u?`${b}33`:"transparent",color:u?b:x?"rgba(255, 255, 255, 0.7)":"rgba(255, 255, 255, 0.4)",border:u?`1px solid ${b}66`:"1px solid transparent",boxShadow:u?`0 0 20px ${b}4D`:"none",opacity:x?1:.5,cursor:x?"pointer":"not-allowed"},children:d===7?"7 jours":d===30?"30 jours":"90 jours"},d)})})}),c&&e.jsx(Je,{}),o&&e.jsx(y,{className:"p-6",style:{background:"color-mix(in srgb, #EF4444 8%, transparent)",borderColor:"color-mix(in srgb, #EF4444 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(p,{Icon:h.AlertCircle,size:16,className:"text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-300 font-semibold",children:"Erreur d'Analyse"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Impossible de charger les données de progression."})]})]})}),n&&n.metrics.totalSessions===0&&!c&&e.jsx(y,{className:"p-8 text-center",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #06B6D4 12%, transparent) 0%, transparent 50%),
            linear-gradient(145deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.02) 100%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #06B6D4 30%, transparent)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #06B6D4 20%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #06B6D4 30%, transparent), color-mix(in srgb, #06B6D4 20%, transparent))
                  `,border:"2px solid color-mix(in srgb, #06B6D4 40%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, #06B6D4 30%, transparent)"},children:e.jsx(p,{Icon:h.TrendingUp,size:40,style:{color:"#06B6D4"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Progression en Construction"}),e.jsx("p",{className:"text-white/70 text-base",children:"Plus de sessions nécessaires"})]})]}),e.jsx("div",{children:e.jsx("p",{className:"text-white/70 text-base leading-relaxed max-w-lg mx-auto",children:"Enregistrez plus de sessions de jeûne pour débloquer une analyse de progression complète et visualiser l'évolution de votre discipline temporelle."})}),e.jsx("button",{onClick:()=>r("/fasting/input"),className:"px-6 py-3 rounded-lg text-sm font-medium transition-all duration-200",style:{background:"linear-gradient(135deg, color-mix(in srgb, #06B6D4 80%, transparent), color-mix(in srgb, #06B6D4 60%, transparent))",border:"2px solid color-mix(in srgb, #06B6D4 60%, transparent)",boxShadow:"0 12px 40px color-mix(in srgb, #06B6D4 40%, transparent), 0 0 60px color-mix(in srgb, #06B6D4 30%, transparent)",color:"#fff"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{Icon:h.Timer,size:16}),e.jsx("span",{children:"Ajouter des Sessions"})]})})]})}),n&&n.metrics.totalSessions>0&&!c&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ze,{metrics:n.metrics,periodDays:s,aiAnalysis:n.aiAnalysis,aiModel:n.aiModel,tokensUsed:n.tokensUsed,cached:n.cached}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(tt,{data:n.consistencyData,periodDays:s}),e.jsx(rt,{data:n.durationTrend||[],periodDays:s})]}),n.sessions&&e.jsx(st,{sessions:n.sessions,periodDays:s})]})]})},it=({filters:t,onFiltersChange:a,totalSessions:r,filteredSessions:s,className:l=""})=>{const{data:i}=$e(),[n,c]=_.useState(!1),o=(u,b)=>{a({...t,[u]:b})},m=()=>{a({})},d=Object.keys(t).some(u=>{const b=t[u];return b!==void 0&&b!==""&&b!=="all"});return e.jsx(f.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},className:l,children:e.jsx(y,{className:"p-4",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #8B5CF6 20%, transparent)",boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.2),
            0 0 20px color-mix(in srgb, #8B5CF6 12%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #8B5CF6 15%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 25%, transparent)"},children:e.jsx(p,{Icon:h.Search,size:14,style:{color:"#8B5CF6"}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-purple-300 font-semibold",children:"Filtres d'Historique"}),e.jsxs("p",{className:"text-purple-200 text-sm",children:[s," / ",r," sessions"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("button",{onClick:m,className:"btn-glass--secondary-nav px-3 py-1.5 text-xs",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{Icon:h.RotateCcw,size:12}),e.jsx("span",{children:"Reset"})]})}),e.jsx("button",{onClick:()=>c(!n),className:"btn-glass px-3 py-1.5",children:e.jsx(p,{Icon:n?h.ChevronUp:h.ChevronDown,size:14})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:t.status||"all",onChange:u=>o("status",u.target.value==="all"?void 0:u.target.value),className:"glass-input text-sm py-2 px-3",style:{minWidth:"120px"},children:[e.jsx("option",{value:"all",children:"Tous les statuts"}),e.jsx("option",{value:"completed",children:"Complétées"}),e.jsx("option",{value:"cancelled",children:"Annulées"})]}),i&&i.length>0&&e.jsxs("select",{value:t.protocol||"",onChange:u=>o("protocol",u.target.value||void 0),className:"glass-input text-sm py-2 px-3",style:{minWidth:"140px"},children:[e.jsx("option",{value:"",children:"Tous les protocoles"}),i.map(u=>{const b=W.find(g=>g.id===u);return e.jsx("option",{value:u,children:b?.name||u},u)})]})]}),n&&e.jsxs(f.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"space-y-4 pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Durée minimale (heures)"}),e.jsx("input",{type:"number",min:"0",max:"48",step:"0.5",value:t.minDuration||"",onChange:u=>o("minDuration",u.target.value?Number(u.target.value):void 0),className:"glass-input text-sm",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Durée maximale (heures)"}),e.jsx("input",{type:"number",min:"0",max:"48",step:"0.5",value:t.maxDuration||"",onChange:u=>o("maxDuration",u.target.value?Number(u.target.value):void 0),className:"glass-input text-sm",placeholder:"48"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Date de début"}),e.jsx("input",{type:"date",value:t.dateRange?.start?format(t.dateRange.start,"yyyy-MM-dd"):"",onChange:u=>{if(u.target.value)o("dateRange",{...t.dateRange,start:new Date(u.target.value)});else{const{start:b,...g}=t.dateRange||{};o("dateRange",Object.keys(g).length>0?g:void 0)}},className:"glass-input text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Date de fin"}),e.jsx("input",{type:"date",value:t.dateRange?.end?format(t.dateRange.end,"yyyy-MM-dd"):"",onChange:u=>{if(u.target.value)o("dateRange",{...t.dateRange,end:new Date(u.target.value)});else{const{end:b,...g}=t.dateRange||{};o("dateRange",Object.keys(g).length>0?g:void 0)}},className:"glass-input text-sm"})]})]})]}),d&&e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 border-t border-white/10",children:[t.status&&t.status!=="all"&&e.jsxs("div",{className:"chip chip--on flex items-center gap-1",children:[e.jsxs("span",{children:["Statut: ",t.status==="completed"?"Complétées":"Annulées"]}),e.jsx("button",{onClick:()=>o("status",void 0),children:e.jsx(p,{Icon:h.X,size:10})})]}),t.protocol&&e.jsxs("div",{className:"chip chip--on flex items-center gap-1",children:[e.jsxs("span",{children:["Protocole: ",t.protocol]}),e.jsx("button",{onClick:()=>o("protocol",void 0),children:e.jsx(p,{Icon:h.X,size:10})})]}),t.minDuration!==void 0&&e.jsxs("div",{className:"chip chip--on flex items-center gap-1",children:[e.jsxs("span",{children:["Min: ",t.minDuration,"h"]}),e.jsx("button",{onClick:()=>o("minDuration",void 0),children:e.jsx(p,{Icon:h.X,size:10})})]}),t.maxDuration!==void 0&&e.jsxs("div",{className:"chip chip--on flex items-center gap-1",children:[e.jsxs("span",{children:["Max: ",t.maxDuration,"h"]}),e.jsx("button",{onClick:()=>o("maxDuration",void 0),children:e.jsx(p,{Icon:h.X,size:10})})]})]})]})})})};function ot(t){return t>=90?{color:"#22C55E",icon:"Check",badge:"Excellent",description:"Discipline exceptionnelle"}:t>=70?{color:"#F59E0B",icon:"Target",badge:"Bien",description:"Bonne régularité"}:t>=50?{color:"#06B6D4",icon:"TrendingUp",badge:"Modéré",description:"En progression"}:{color:"#8B5CF6",icon:"Timer",badge:"Débutant",description:"Développement en cours"}}const lt=({stats:t,className:a=""})=>{const r=t.totalSessions>0?t.completedSessions/t.totalSessions*100:0,s=ot(r);return e.jsx(f.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:[.25,.1,.25,1]},className:a,children:e.jsx(y,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${s.color} 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, ${s.color} 10%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${s.color} 30%, transparent)`,boxShadow:`
            0 16px 48px rgba(0, 0, 0, 0.3),
            0 0 40px color-mix(in srgb, ${s.color} 25%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.2)
          `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center breathing-icon",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${s.color} 40%, transparent), color-mix(in srgb, ${s.color} 30%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${s.color} 60%, transparent)`,boxShadow:`0 0 25px color-mix(in srgb, ${s.color} 50%, transparent)`},children:e.jsx(p,{Icon:h[s.icon],size:20,style:{color:s.color},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Statistiques Globales"}),e.jsxs("p",{className:"text-white/80 text-sm mt-0.5",children:["Toutes vos sessions • ",s.description]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:s.color,boxShadow:`0 0 8px ${s.color}60`}}),e.jsxs("span",{className:"text-white font-bold text-2xl",children:[Math.round(r),"%"]})]}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{background:`color-mix(in srgb, ${s.color} 15%, transparent)`,color:s.color},children:s.badge})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(f.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 10%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1},children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:t.totalSessions}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Sessions"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Total"})]}),e.jsxs(f.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},children:[e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:t.completedSessions}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Complétées"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Succès"})]}),e.jsxs(f.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 10%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.3},children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:[t.totalHours,"h"]}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Temps Total"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Jeûné"})]}),e.jsxs(f.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #8B5CF6 10%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.4},children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:[t.averageDuration,"h"]}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Moyenne"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Durée"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-white/80 font-medium text-sm flex items-center gap-2",children:[e.jsx(p,{Icon:h.Star,size:14,className:"text-yellow-400"}),"Records Personnels"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Session la plus longue"}),e.jsxs("span",{className:"text-white font-bold",children:[t.longestSession,"h"]})]}),t.shortestSession>0&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Session la plus courte"}),e.jsxs("span",{className:"text-white font-bold",children:[t.shortestSession,"h"]})]}),t.mostUsedProtocol&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Protocole favori"}),e.jsx("span",{className:"text-white font-bold",children:t.mostUsedProtocol})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-white/80 font-medium text-sm flex items-center gap-2",children:[e.jsx(p,{Icon:h.Calendar,size:14,className:"text-cyan-400"}),"Historique"]}),e.jsxs("div",{className:"space-y-2",children:[t.firstSessionDate&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Première session"}),e.jsx("span",{className:"text-white font-bold",children:w(S(t.firstSessionDate),"dd/MM/yyyy")})]}),t.lastSessionDate&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Dernière session"}),e.jsx("span",{className:"text-white font-bold",children:w(S(t.lastSessionDate),"dd/MM/yyyy")})]}),t.cancelledSessions>0&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Sessions annulées"}),e.jsx("span",{className:"text-red-400 font-bold",children:t.cancelledSessions})]})]})]})]}),e.jsxs(f.div,{className:"p-5 rounded-xl text-center",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${s.color} 12%, transparent) 0%, transparent 60%),
                color-mix(in srgb, ${s.color} 6%, transparent)
              `,border:`2px solid color-mix(in srgb, ${s.color} 25%, transparent)`,boxShadow:`
                0 8px 32px rgba(0, 0, 0, 0.2),
                0 0 20px color-mix(in srgb, ${s.color} 20%, transparent),
                inset 0 1px 0 rgba(255, 255, 255, 0.15)
              `},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.5},children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx(p,{Icon:h.Lightbulb,size:18,style:{color:s.color}}),e.jsx("h4",{className:"font-bold text-lg",style:{color:s.color},children:"Bilan de votre Forge Temporelle"})]}),e.jsx("p",{className:"text-white/90 text-base leading-relaxed",children:r>=90?`Maîtrise exceptionnelle ! Vous avez complété ${t.completedSessions} sessions sur ${t.totalSessions} avec ${t.totalHours}h de jeûne total. Votre discipline temporelle est remarquable.`:r>=70?`Excellente progression ! ${Math.round(r)}% de taux de réussite avec une moyenne de ${t.averageDuration}h par session. Continuez cette régularité.`:r>=50?`Développement solide ! Votre record personnel est de ${t.longestSession}h. Visez plus de régularité pour optimiser les bénéfices métaboliques.`:`Début prometteur ! Chaque session forge votre discipline. Votre parcours temporel commence avec ${t.totalSessions} sessions tentées.`})]})]})})})};function ct(t){return t?W.find(r=>r.id===t)?.name||t:"Protocole personnalisé"}function dt(t){if(!t||t<=0)return"--";const a=Math.floor(t),r=Math.floor((t-a)*60);return`${a}h ${r.toString().padStart(2,"0")}m`}const xt=({session:t,index:a,onDelete:r,className:s=""})=>{const{click:l,error:i}=M(),n=Oe(),[c,o]=_.useState(!1),m=t.actual_duration_hours&&t.target_hours?be(t.actual_duration_hours,t.target_hours):"missed",d=je(m),u=ct(t.protocol_id),b=dt(t.actual_duration_hours),g=`${t.target_hours}h`,x=t.actual_duration_hours&&t.target_hours?Math.round(t.actual_duration_hours/t.target_hours*100):0,v=async()=>{try{await n.mutateAsync(t.id),r?.(t.id),o(!1)}catch{}},I=()=>{l(),o(!0)},k=()=>{l(),o(!1)};return e.jsx(f.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,delay:a*.05,ease:[.25,.1,.25,1]},className:s,children:e.jsxs(y,{className:"p-5 relative overflow-visible",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${d.primaryColor} 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${d.primaryColor} 20%, transparent)`,boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.2),
            0 0 20px color-mix(in srgb, ${d.primaryColor} 12%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `,backdropFilter:"blur(16px) saturate(150%)"},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${d.primaryColor} 30%, transparent), color-mix(in srgb, ${d.primaryColor} 20%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${d.primaryColor} 40%, transparent)`,boxShadow:`0 0 16px color-mix(in srgb, ${d.primaryColor} 25%, transparent)`},children:e.jsx(p,{Icon:h[d.icon],size:16,style:{color:d.primaryColor}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold",children:w(S(t.start_time),"dd MMM yyyy")}),e.jsxs("p",{className:"text-white/70 text-sm",children:[u," • ",w(S(t.start_time),"HH:mm")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-3 py-1.5 rounded-full",style:{background:`color-mix(in srgb, ${d.primaryColor} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d.primaryColor} 25%, transparent)`},children:e.jsx("span",{className:"text-xs font-medium",style:{color:d.primaryColor},children:t.status==="completed"?"Complétée":t.status==="cancelled"?"Annulée":"Active"})}),e.jsx("button",{onClick:I,className:"p-2 rounded-full hover:bg-red-500/20 transition-colors",title:"Supprimer cette session",children:e.jsx(p,{Icon:h.Trash2,size:14,className:"text-red-400"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg",style:{background:`color-mix(in srgb, ${d.primaryColor} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${d.primaryColor} 15%, transparent)`},children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:b}),e.jsx("div",{className:"text-white/70 text-xs",children:"Durée Réelle"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:g}),e.jsx("div",{className:"text-white/70 text-xs",children:"Objectif"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"text-lg font-bold text-white mb-1",children:[x,"%"]}),e.jsx("div",{className:"text-white/70 text-xs",children:"Progression"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:t.end_time?w(S(t.end_time),"HH:mm"):"--:--"}),e.jsx("div",{className:"text-white/70 text-xs",children:"Fin"})]})]}),t.notes&&e.jsx("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(p,{Icon:h.FileText,size:14,className:"text-white/60 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-white/80 font-medium text-sm mb-1",children:"Notes"}),e.jsx("p",{className:"text-white/70 text-sm leading-relaxed",children:t.notes})]})]})}),t.status==="completed"&&t.actual_duration_hours&&t.target_hours&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm text-white/70 mb-2",children:[e.jsx("span",{children:"Progression vers l'objectif"}),e.jsxs("span",{children:[x,"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 overflow-hidden",children:e.jsx(f.div,{className:"h-2 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${d.primaryColor}, ${d.secondaryColor})`,boxShadow:`0 0 8px color-mix(in srgb, ${d.primaryColor} 60%, transparent)`,width:`${Math.min(100,x)}%`},initial:{width:0},animate:{width:`${Math.min(100,x)}%`},transition:{duration:.8,ease:"easeOut",delay:.2+a*.05},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                        transparent 0%, 
                        rgba(255,255,255,0.4) 50%, 
                        transparent 100%
                      )`,animation:"progressShimmer 2s ease-in-out infinite"}})})})]})]}),c&&e.jsx(f.div,{className:"absolute inset-0 rounded-inherit flex items-center justify-center",style:{background:"rgba(0, 0, 0, 0.9)",backdropFilter:"blur(8px)",zIndex:10},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs("div",{className:"text-center space-y-4 p-4",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #EF4444 20%, transparent)",border:"2px solid color-mix(in srgb, #EF4444 40%, transparent)"},children:e.jsx(p,{Icon:h.AlertTriangle,size:20,style:{color:"#EF4444"}})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-white font-bold mb-2",children:"Supprimer cette session ?"}),e.jsxs("p",{className:"text-white/80 text-sm",children:["Session du ",w(S(t.start_time),"dd/MM/yyyy")," • ",b]})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:v,disabled:n.isPending,className:"btn-glass--warning px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[n.isPending?e.jsx(p,{Icon:h.Loader2,size:12,className:"animate-spin"}):e.jsx(p,{Icon:h.Trash2,size:12}),e.jsx("span",{children:n.isPending?"Suppression...":"Supprimer"})]})}),e.jsx("button",{onClick:k,className:"btn-glass--secondary-nav px-4 py-2 text-sm",children:e.jsx("span",{children:"Annuler"})})]})]})})]})})},mt=({className:t=""})=>e.jsxs("div",{className:`space-y-6 ${t}`,children:[e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsx(y,{className:"p-6 text-center",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 15%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #A855F7 12%, transparent) 0%, transparent 50%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #8B5CF6 30%, transparent)",boxShadow:`
              0 16px 48px rgba(0, 0, 0, 0.3),
              0 0 40px color-mix(in srgb, #8B5CF6 25%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.2)
            `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(f.div,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #8B5CF6 40%, transparent), color-mix(in srgb, #A855F7 30%, transparent))
                `,border:"3px solid color-mix(in srgb, #8B5CF6 60%, transparent)",boxShadow:`
                  0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent),
                  0 0 80px color-mix(in srgb, #8B5CF6 40%, transparent)
                `},animate:{scale:[1,1.05,1],boxShadow:["0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent)","0 0 60px color-mix(in srgb, #8B5CF6 80%, transparent)","0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(p,{Icon:h.History,size:40,style:{color:"#8B5CF6"},className:"animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Chargement de l'Historique"}),e.jsx("p",{className:"text-white/80 text-lg",children:"Récupération de vos sessions temporelles..."})]}),e.jsx("div",{className:"space-y-2 max-w-md mx-auto",children:["Récupération des sessions historiques","Calcul des statistiques globales","Organisation chronologique","Préparation de l'affichage"].map((a,r)=>e.jsxs(f.div,{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:r*.2},children:[e.jsx(f.div,{className:"w-2 h-2 rounded-full bg-purple-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,delay:r*.3}}),e.jsx("span",{className:"text-white/70 text-sm",children:a})]},r))})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 bg-white/10 rounded w-48 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-32 animate-pulse"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(a=>e.jsxs("div",{className:"text-center p-4 rounded-xl bg-white/5",children:[e.jsx("div",{className:"h-8 bg-white/10 rounded w-16 mx-auto mb-2 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-20 mx-auto animate-pulse"})]},a))})]})}),[1,2,3,4,5].map(a=>e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3+a*.1},children:e.jsxs(y,{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-32 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-24 animate-pulse"})]})]}),e.jsx("div",{className:"h-6 bg-white/10 rounded w-20 animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[1,2,3,4].map(r=>e.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"h-5 bg-white/10 rounded w-12 mx-auto mb-1 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-16 mx-auto animate-pulse"})]},r))})]})},a))]}),e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:1},className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-purple-500/10 border border-purple-400/20",children:[e.jsx(f.div,{className:"w-2 h-2 rounded-full bg-purple-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1,repeat:1/0}}),e.jsx("span",{className:"text-purple-300 text-sm font-medium",children:"Chargement de l'historique..."})]})})]}),ut=()=>{const[t,a]=R.useState({}),[r,s]=R.useState(!1),{data:l,isLoading:i,error:n}=X(100,t),c=o=>{};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-white font-semibold text-lg",children:"Historique Temporel"}),l&&e.jsxs("div",{className:"text-white/60 text-sm",children:[l.sessions.length," session",l.sessions.length>1?"s":"",l.sessions.length!==l.allSessions.length&&` sur ${l.allSessions.length}`]})]}),e.jsx("button",{onClick:()=>s(!r),className:"btn-glass px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{Icon:h.Search,size:14}),e.jsx("span",{children:"Filtres"}),e.jsx(p,{Icon:r?h.ChevronUp:h.ChevronDown,size:12})]})})]}),e.jsx(ve,{children:r&&e.jsx(it,{filters:t,onFiltersChange:a,totalSessions:l?.allSessions.length||0,filteredSessions:l?.sessions.length||0})}),i&&e.jsx(mt,{}),n&&e.jsx(y,{className:"p-6",style:{background:"color-mix(in srgb, #EF4444 8%, transparent)",borderColor:"color-mix(in srgb, #EF4444 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(p,{Icon:h.AlertCircle,size:16,className:"text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-300 font-semibold",children:"Erreur de Chargement"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Impossible de charger l'historique. Réessayez dans quelques instants."})]})]})}),l&&!i&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(lt,{stats:l.stats}),l.sessions.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-white font-semibold text-lg flex items-center gap-2",children:[e.jsx(p,{Icon:h.History,size:18,className:"text-purple-400"}),"Sessions (",l.sessions.length,")"]}),e.jsx("div",{className:"space-y-3",children:l.sessions.map((o,m)=>e.jsx(xt,{session:o,index:m,onDelete:c},o.id))}),l.allSessions.length>l.sessions.length&&e.jsx("div",{className:"text-center pt-4",children:e.jsx("button",{onClick:()=>{},className:"btn-glass--secondary-nav px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{Icon:h.ChevronDown,size:16}),e.jsx("span",{children:"Charger plus de sessions"})]})})})]}):e.jsx(y,{className:"p-8 text-center",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 15%, transparent) 0%, transparent 60%),
                radial-gradient(circle at 70% 80%, color-mix(in srgb, #8B5CF6 12%, transparent) 0%, transparent 50%),
                linear-gradient(145deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.02) 100%),
                var(--glass-opacity)
              `,borderColor:"color-mix(in srgb, #8B5CF6 30%, transparent)",boxShadow:`
                0 12px 40px rgba(0, 0, 0, 0.25),
                0 0 30px color-mix(in srgb, #8B5CF6 20%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.15)
              `},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center",style:{background:`
                        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                        linear-gradient(135deg, color-mix(in srgb, #8B5CF6 30%, transparent), color-mix(in srgb, #8B5CF6 20%, transparent))
                      `,border:"2px solid color-mix(in srgb, #8B5CF6 40%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, #8B5CF6 30%, transparent)"},children:e.jsx(p,{Icon:h.History,size:40,style:{color:"#8B5CF6"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:Object.keys(t).length>0?"Aucune Session Trouvée":"Commencez Votre Historique"}),e.jsx("p",{className:"text-white/70 text-base",children:Object.keys(t).length>0?"Aucun résultat":"Vos sessions vous attendent"})]})]}),e.jsx("div",{children:e.jsx("p",{className:"text-white/70 text-base leading-relaxed max-w-lg mx-auto",children:Object.keys(t).length>0?"Aucune session ne correspond aux filtres sélectionnés. Essayez de modifier vos critères de recherche.":"Votre historique de jeûne apparaîtra ici après vos premières sessions. Commencez dès maintenant votre forge temporelle !"})}),Object.keys(t).length===0&&e.jsx("button",{onClick:()=>window.location.href="/fasting/input",className:"px-6 py-3 rounded-lg text-sm font-medium transition-all duration-200",style:{background:"linear-gradient(135deg, color-mix(in srgb, #8B5CF6 80%, transparent), color-mix(in srgb, #8B5CF6 60%, transparent))",border:"2px solid color-mix(in srgb, #8B5CF6 60%, transparent)",boxShadow:"0 12px 40px color-mix(in srgb, #8B5CF6 40%, transparent), 0 0 60px color-mix(in srgb, #8B5CF6 30%, transparent)",color:"#fff"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{Icon:h.Timer,size:16}),e.jsx("span",{children:"Démarrer une Session"})]})})]})})]})]})};function gt(t){switch(t){case"daily":return{icon:"Timer",title:"Forge Temporelle du Jour",subtitle:"Votre discipline du jeûne au quotidien",circuit:"fasting",color:"#F59E0B"};case"insights":return{icon:"TrendingUp",title:"Insights de Jeûne",subtitle:"Analyses et patterns de votre discipline temporelle",circuit:"fasting",color:"#10B981"};case"progression":return{icon:"BarChart3",title:"Progression Temporelle",subtitle:"Métriques et tendances de votre évolution",circuit:"fasting",color:"#06B6D4"};case"history":return{icon:"History",title:"Historique des Sessions",subtitle:"Toutes vos sessions de jeûne enregistrées",circuit:"fasting",color:"#8B5CF6"};default:return{icon:"Timer",title:"Forge Temporelle",subtitle:"Maîtrisez le temps avec le jeûne intermittent",circuit:"fasting",color:"#F59E0B"}}}const Ft=()=>{const t=te(),{click:a}=M(),[r,s]=_.useState(!1),[l,i]=_.useState(!1),[n,c]=_.useState(null),o=_.useMemo(()=>{const v=t.hash.replace("#","");return v&&["daily","insights","progression","history"].includes(v)?v:"daily"},[t.hash]),m=U(({currentLocation:v,nextLocation:I})=>v.pathname===I.pathname?!1:r);_.useEffect(()=>{m.state==="blocked"&&(j.info("FASTING_PAGE_AI_EXIT","Navigation blocked - AI generation in progress",{activeTab:o,isAIGenerationLoading:r,timestamp:new Date().toISOString()}),c(()=>()=>{m.proceed()}),i(!0))},[m.state,o,r]),re(),ie(`fasting:${o}`);const d=gt(o),u=_.useCallback(v=>{s(v),j.debug("FASTING_PAGE_AI_LOADING","AI generation loading state changed",{activeTab:o,isLoading:v,timestamp:new Date().toISOString()})},[o]),b=()=>{j.info("FASTING_PAGE_AI_EXIT","User chose to stop AI generation and exit",{activeTab:o,timestamp:new Date().toISOString()}),s(!1),i(!1),n&&(n(),c(null))},g=()=>{j.info("FASTING_PAGE_AI_EXIT","User chose to continue AI generation",{activeTab:o,timestamp:new Date().toISOString()}),i(!1),c(null),m.state==="blocked"&&m.reset()},x=v=>{a(),j.debug("FASTING_PAGE","Tab change triggered",{newTab:v})};return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(ae,{icon:d.icon,title:d.title,subtitle:d.subtitle,circuit:d.circuit,iconColor:d.color}),e.jsxs(T,{defaultValue:o,className:"w-full min-w-0 fasting-tabs",onValueChange:x,forgeContext:"fasting",children:[e.jsxs(T.List,{role:"tablist","aria-label":"Sections du jeûne",className:"mb-6 w-full",children:[e.jsx(T.Trigger,{value:"daily",icon:"Calendar",children:e.jsx("span",{className:"tab-text",children:"Tracker"})}),e.jsx(T.Trigger,{value:"insights",icon:"TrendingUp",children:e.jsx("span",{className:"tab-text",children:"Insights"})}),e.jsx(T.Trigger,{value:"progression",icon:"BarChart3",children:e.jsx("span",{className:"tab-text",children:"Progression"})}),e.jsx(T.Trigger,{value:"history",icon:"History",children:e.jsx("span",{className:"tab-text",children:"Historique"})})]}),e.jsx(T.Panel,{value:"daily",children:e.jsx(_e,{onLoadingChange:u})}),e.jsx(T.Panel,{value:"insights",children:e.jsx(Ue,{onLoadingChange:u})}),e.jsx(T.Panel,{value:"progression",children:e.jsx(nt,{onLoadingChange:u})}),e.jsx(T.Panel,{value:"history",children:e.jsx(ut,{})})]}),l&&e.jsx(ne,{isOpen:l,title:"Analyse IA en cours",message:"Une analyse IA est en cours de génération. Êtes-vous sûr de vouloir quitter ?",confirmLabel:"Quitter",cancelLabel:"Continuer l'analyse",onConfirm:b,onCancel:g})]})};export{Ft as default};
