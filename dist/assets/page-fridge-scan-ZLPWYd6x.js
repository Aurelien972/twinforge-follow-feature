const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/page-fridge-BvAjnJpI.js","assets/vendor-DX97-qL9.js","assets/utils-CUtLAp28.js","assets/supabase-C_rF2iqf.js","assets/ui-components-DWjWyKd7.js","assets/motion-DLE-fuXv.js","assets/stores-DcNfcD_j.js","assets/ui-components-BfdLI5ID.css","assets/date-utils-sCOX3Ksr.js"])))=>i.map(i=>d[i]);
import{c as me,r as j,d as ge,u as ne,e as xe,R as Y,j as e}from"./vendor-DX97-qL9.js";import{b as te,a as ue,F as se,u as de,c as he}from"./stores-DcNfcD_j.js";import{s as N,l as n,u as J}from"./page-fridge-BvAjnJpI.js";import{u as X,G as M,S as v,I as y,P as be}from"./ui-components-DWjWyKd7.js";import{m as g,A as ie}from"./motion-DLE-fuXv.js";import{p as ye}from"./utils-CUtLAp28.js";const fe="modulepreload",ve=function(r){return"/"+r},le={},we=function(t,a,s){let i=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),d=c?.nonce||c?.getAttribute("nonce");i=Promise.allSettled(a.map(l=>{if(l=ve(l),l in le)return;le[l]=!0;const x=l.endsWith(".css"),_=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${_}`))return;const p=document.createElement("link");if(p.rel=x?"stylesheet":fe,x||(p.as="script"),p.crossOrigin="",p.href=l,d&&p.setAttribute("nonce",d),document.head.appendChild(p),x)return new Promise((u,f)=>{p.addEventListener("load",u),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return i.then(c=>{for(const d of c||[])d.status==="rejected"&&o(d.reason);return t().catch(o)})};function dt(){const{session:r}=te(),t=r?.user?.id,{data:a,isLoading:s,error:i}=me({queryKey:["connected-wearables",t],queryFn:async()=>{if(!t)return{hasConnectedWearable:!1,connectedDevicesCount:0};try{const{data:o,error:c}=await N.from("connected_devices").select("id, status, provider").eq("user_id",t).eq("status","connected");if(c)throw n.error("USE_HAS_CONNECTED_WEARABLE","Failed to fetch connected devices",{error:c.message,userId:t,timestamp:new Date().toISOString()}),c;const d=o?.length||0,l=d>0;return n.info("USE_HAS_CONNECTED_WEARABLE","Connected devices checked",{hasConnectedWearable:l,connectedDevicesCount:d,userId:t,timestamp:new Date().toISOString()}),{hasConnectedWearable:l,connectedDevicesCount:d}}catch(o){throw n.error("USE_HAS_CONNECTED_WEARABLE","Error checking connected devices",{error:o instanceof Error?o.message:"Unknown error",userId:t,timestamp:new Date().toISOString()}),o}},enabled:!!t,staleTime:2*60*1e3,refetchOnWindowFocus:!0,retry:2});return{hasConnectedWearable:a?.hasConnectedWearable||!1,connectedDevicesCount:a?.connectedDevicesCount||0,loading:s,error:i}}class _e{async getConnectedDevices(t){const{data:a,error:s}=await N.from("connected_devices").select("*").eq("user_id",t).order("connected_at",{ascending:!1});if(s)throw n.error("WEARABLE","Failed to fetch connected devices",{error:s}),s;return a.map(this.mapDevice)}async getDevice(t){const{data:a,error:s}=await N.from("connected_devices").select("*").eq("id",t).single();return s?(n.error("WEARABLE","Failed to fetch device",{error:s,deviceId:t}),null):this.mapDevice(a)}async disconnectDevice(t){const{error:a}=await N.from("connected_devices").update({status:"disconnected"}).eq("id",t);if(a)throw n.error("WEARABLE","Failed to disconnect device",{error:a,deviceId:t}),a;n.info("WEARABLE","Device disconnected successfully",{deviceId:t})}async deleteDevice(t){const{error:a}=await N.from("connected_devices").delete().eq("id",t);if(a)throw n.error("WEARABLE","Failed to delete device",{error:a,deviceId:t}),a;n.info("WEARABLE","Device deleted successfully",{deviceId:t})}async getSyncHistory(t,a=20){const{data:s,error:i}=await N.from("device_sync_history").select("*").eq("device_id",t).order("started_at",{ascending:!1}).limit(a);if(i)throw n.error("WEARABLE","Failed to fetch sync history",{error:i,deviceId:t}),i;return s.map(this.mapSyncHistory)}async triggerSync(t,a){const{data:s}=await N.auth.getSession();if(!s.session)throw new Error("Not authenticated");const i=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/wearable-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.session.access_token}`},body:JSON.stringify({deviceId:t,dataTypes:a})});if(!i.ok){const o=await i.json();throw new Error(o.error||"Sync failed")}n.info("WEARABLE","Sync triggered successfully",{deviceId:t,dataTypes:a})}async getHealthData(t,a,s,i){let o=N.from("wearable_health_data").select("*").eq("user_id",t).eq("data_type",a).order("timestamp",{ascending:!1});s&&(o=o.gte("timestamp",s.toISOString())),i&&(o=o.lte("timestamp",i.toISOString()));const{data:c,error:d}=await o.limit(1e3);if(d)throw n.error("WEARABLE","Failed to fetch health data",{error:d,dataType:a}),d;return c.map(this.mapHealthData)}async getSyncPreferences(t){const{data:a,error:s}=await N.from("sync_preferences").select("*").eq("device_id",t).single();return s?(n.error("WEARABLE","Failed to fetch sync preferences",{error:s,deviceId:t}),null):this.mapSyncPreferences(a)}async updateSyncPreferences(t,a){const{error:s}=await N.from("sync_preferences").update({auto_sync_enabled:a.autoSyncEnabled,sync_frequency_minutes:a.syncFrequencyMinutes,data_types_enabled:a.dataTypesEnabled,sync_only_wifi:a.syncOnlyWifi,notify_on_sync:a.notifyOnSync,notify_on_error:a.notifyOnError,backfill_days:a.backfillDays}).eq("device_id",t);if(s)throw n.error("WEARABLE","Failed to update sync preferences",{error:s,deviceId:t}),s;n.info("WEARABLE","Sync preferences updated",{deviceId:t})}async getLatestWorkouts(t,a=10){const{data:s,error:i}=await N.from("wearable_health_data").select("*").eq("user_id",t).eq("data_type","workout").order("timestamp",{ascending:!1}).limit(a);return i?(n.error("WEARABLE","Failed to fetch workouts",{error:i}),[]):s.map(o=>this.normalizeWorkout(o)).filter(o=>o!==null)}async getAggregatedData(t,a,s,i){const o=await this.getHealthData(t,a,s,i),c=new Map;for(const d of o){const l=new Date(d.timestamp).toISOString().split("T")[0],x=d.valueNumeric||0;c.has(l)||c.set(l,[]),c.get(l).push(x)}return Array.from(c.entries()).map(([d,l])=>({date:d,value:l.reduce((x,_)=>x+_,0)/l.length})).sort((d,l)=>d.date.localeCompare(l.date))}mapDevice(t){return{id:t.id,userId:t.user_id,provider:t.provider,providerUserId:t.provider_user_id,displayName:t.display_name,deviceType:t.device_type,status:t.status,scopes:t.scopes||[],lastSyncAt:t.last_sync_at,lastError:t.last_error,errorCount:t.error_count||0,metadata:t.metadata||{},connectedAt:t.connected_at,createdAt:t.created_at,updatedAt:t.updated_at}}mapSyncHistory(t){return{id:t.id,deviceId:t.device_id,userId:t.user_id,syncType:t.sync_type,status:t.status,dataTypesSynced:t.data_types_synced||[],recordsFetched:t.records_fetched||0,recordsStored:t.records_stored||0,durationMs:t.duration_ms,errorMessage:t.error_message,errorCode:t.error_code,startedAt:t.started_at,completedAt:t.completed_at,createdAt:t.created_at}}mapHealthData(t){return{id:t.id,userId:t.user_id,deviceId:t.device_id,dataType:t.data_type,timestamp:t.timestamp,valueNumeric:t.value_numeric,valueText:t.value_text,valueJson:t.value_json,unit:t.unit,qualityScore:t.quality_score,sourceWorkoutId:t.source_workout_id,rawData:t.raw_data,syncedAt:t.synced_at,createdAt:t.created_at}}mapSyncPreferences(t){return{id:t.id,userId:t.user_id,deviceId:t.device_id,autoSyncEnabled:t.auto_sync_enabled,syncFrequencyMinutes:t.sync_frequency_minutes,dataTypesEnabled:t.data_types_enabled||[],syncOnlyWifi:t.sync_only_wifi,notifyOnSync:t.notify_on_sync,notifyOnError:t.notify_on_error,backfillDays:t.backfill_days,createdAt:t.created_at,updatedAt:t.updated_at}}normalizeWorkout(t){if(!t.valueJson)return null;const a=t.valueJson;return{id:t.id,userId:t.userId,deviceId:t.deviceId,provider:"unknown",startTime:t.timestamp,endTime:a.endTime||t.timestamp,durationSeconds:a.durationSeconds||0,activityType:a.activityType||"unknown",distanceMeters:a.distanceMeters,caloriesBurned:a.caloriesBurned,avgHeartRate:a.avgHeartRate,maxHeartRate:a.maxHeartRate,elevationGainMeters:a.elevationGainMeters,avgPace:a.avgPace,avgCadence:a.avgCadence,avgPower:a.avgPower,zones:a.zones,rawData:t.rawData||{}}}}const W=new _e;function pt(r){const[t,a]=j.useState([]),[s,i]=j.useState(!0),[o,c]=j.useState(!1),[d,l]=j.useState(null),x=j.useCallback(async()=>{if(!r){a([]),i(!1);return}try{i(!0),l(null);const h=await W.getConnectedDevices(r);a(h),n.info("WEARABLE_HOOK","Devices refreshed",{count:h.length})}catch(h){const S=h instanceof Error?h:new Error("Failed to fetch devices");l(S),n.error("WEARABLE_HOOK","Failed to refresh devices",{error:h})}finally{i(!1)}},[r]),_=j.useCallback(async(h,S)=>{try{c(!0),l(null),n.info("WEARABLE_HOOK","Starting sync",{deviceId:h,dataTypes:S}),await W.triggerSync(h,S),await x(),n.info("WEARABLE_HOOK","Sync completed successfully",{deviceId:h})}catch(E){const G=E instanceof Error?E:new Error("Sync failed");throw l(G),n.error("WEARABLE_HOOK","Sync failed",{error:E,deviceId:h}),G}finally{c(!1)}},[x]),p=j.useCallback(async h=>{try{l(null),n.info("WEARABLE_HOOK","Disconnecting device",{deviceId:h}),await W.disconnectDevice(h),await x(),n.info("WEARABLE_HOOK","Device disconnected",{deviceId:h})}catch(S){const E=S instanceof Error?S:new Error("Failed to disconnect device");throw l(E),n.error("WEARABLE_HOOK","Failed to disconnect device",{error:S,deviceId:h}),E}},[x]),u=j.useCallback(async h=>{try{l(null),n.info("WEARABLE_HOOK","Deleting device",{deviceId:h}),await W.deleteDevice(h),await x(),n.info("WEARABLE_HOOK","Device deleted",{deviceId:h})}catch(S){const E=S instanceof Error?S:new Error("Failed to delete device");throw l(E),n.error("WEARABLE_HOOK","Failed to delete device",{error:S,deviceId:h}),E}},[x]),f=j.useCallback(async h=>{try{return n.info("WEARABLE_HOOK","Fetching sync history",{deviceId:h}),await W.getSyncHistory(h)}catch(S){throw n.error("WEARABLE_HOOK","Failed to fetch sync history",{error:S,deviceId:h}),S}},[]),F=j.useCallback(async h=>{try{return n.info("WEARABLE_HOOK","Fetching sync preferences",{deviceId:h}),await W.getSyncPreferences(h)}catch(S){throw n.error("WEARABLE_HOOK","Failed to fetch sync preferences",{error:S,deviceId:h}),S}},[]),m=j.useCallback(async(h,S)=>{try{n.info("WEARABLE_HOOK","Updating sync preferences",{deviceId:h,prefs:S}),await W.updateSyncPreferences(h,S),await x()}catch(E){throw n.error("WEARABLE_HOOK","Failed to update sync preferences",{error:E,deviceId:h}),E}},[x]);return j.useEffect(()=>{x()},[x]),{devices:t,loading:s,syncing:o,error:d,refreshDevices:x,syncDevice:_,disconnectDevice:p,deleteDevice:u,getSyncHistory:f,getSyncPreferences:F,updateSyncPreferences:m}}const mt={async estimate(r){n.info("Calling scan-estimate edge function",{clientScanId:r.clientScanId,resolvedGender:r.resolvedGender,userId:r.user_id,photosCount:r.photos?.length||0,userMetrics:{height_cm:r.user_declared_height_cm,weight_kg:r.user_declared_weight_kg,gender:r.user_declared_gender,resolvedGender:r.resolvedGender},timestamp:new Date().toISOString()});const{data:t,error:a}=await N.functions.invoke("scan-estimate",{body:r});if(n.info("Scan-estimate response received",{clientScanId:r.clientScanId,hasResponse:!!t,hasError:!!a,responseKeys:t?Object.keys(t):[],errorMessage:a?.message,timestamp:new Date().toISOString()}),a)throw n.error("Scan-estimate failed",{clientScanId:r.clientScanId,error:a.message||a,timestamp:new Date().toISOString()}),new Error(`Scan estimate failed: ${a.message}`);return n.info("Scan-estimate completed successfully",{clientScanId:r.clientScanId,hasExtractedData:!!t?.extracted_data,confidence:t?.extracted_data?.processing_confidence,hasSkinTone:!!t?.extracted_data?.skin_tone,measurementsKeys:t.extracted_data?.raw_measurements?Object.keys(t.extracted_data.raw_measurements):[]}),t},async semantic(r){n.info("Calling scan-semantic edge function",{clientScanId:r.clientScanId,resolvedGender:r.resolvedGender,userId:r.user_id,photosCount:r.photos?.length||0,hasExtractedData:!!r.extracted_data,userGender:r.user_declared_gender,timestamp:new Date().toISOString()});const{data:t,error:a}=await N.functions.invoke("scan-semantic",{body:r});if(n.info("Scan-semantic response received",{clientScanId:r.clientScanId,hasResponse:!!t,hasError:!!a,responseKeys:t?Object.keys(t):[],errorMessage:a?.message,timestamp:new Date().toISOString()}),a)throw n.error("Scan-semantic failed",{clientScanId:r.clientScanId,error:a.message||a,timestamp:new Date().toISOString()}),new Error(`Scan semantic failed: ${a.message}`);return n.info("Scan-semantic completed successfully",{clientScanId:r.clientScanId,hasSemanticProfile:!!t?.semantic_profile,semanticConfidence:t?.semantic_confidence,adjustmentsMade:t?.adjustments_made?.length||0,timestamp:new Date().toISOString()}),t},async match(r){n.info("Calling scan-match edge function",{clientScanId:r.clientScanId,resolvedGender:r.resolvedGender,userId:r.user_id,hasExtractedData:!!r.extracted_data,hasSemanticProfile:!!r.semantic_profile,matchingConfig:r.matching_config,timestamp:new Date().toISOString()});const{data:t,error:a}=await N.functions.invoke("scan-match",{body:r});if(n.info("Scan-match response received",{gender:r.resolvedGender,clientScanId:r.clientScanId,hasResponse:!!t,hasError:!!a,responseKeys:t?Object.keys(t):[],errorMessage:a?.message,auditData:t?{selectedArchetypesCount:t.selected_archetypes?.length||0,strategyUsed:t.strategy_used,semanticCoherenceScore:t.semantic_coherence_score,filteringStats:t.debug_phase_a?.filtering_stats,mappingMetadata:t.mapping_metadata,degradedMode:t.mapping_metadata?.fallback_used||!1,bmiFilteringAnalysis:{userBMI:r.extracted_data?.estimated_bmi,bmiRelaxationApplied:t.debug_phase_a?.filtering_stats?.bmiRelaxationApplied,totalArchetypesEvaluated:t.debug_phase_a?.filtering_stats?.totalArchetypes,afterBMIFilter:t.debug_phase_a?.filtering_stats?.afterBMIFilter,rejectedByBMI:t.debug_phase_a?.filtering_stats?t.debug_phase_a.filtering_stats.totalArchetypes-t.debug_phase_a.filtering_stats.afterBMIFilter:"unknown"}}:null,timestamp:new Date().toISOString()}),t?.mapping_metadata?.fallback_used&&n.warn("Scan-match AUDIT: DEGRADED MODE detected",{clientScanId:r.clientScanId,mapping_source:t.mapping_metadata.mapping_source,fallback_reason:t.mapping_metadata.fallback_reason,impact:"using_hardcoded_mapping_data",recommendation:"check_database_connectivity",philosophy:"degraded_mode_telemetry"}),a)throw n.error("Scan-match AUDIT: Function failed",{clientScanId:r.clientScanId,userBMI:r.extracted_data?.estimated_bmi,semanticProfile:r.semantic_profile?{obesity:r.semantic_profile.obesity,muscularity:r.semantic_profile.muscularity,morphotype:r.semantic_profile.morphotype}:null,error:a.message||a,errorType:typeof a,possibleCauses:["BMI filtering too restrictive","Semantic classification mismatch","Database connectivity issue","Archetype coverage insufficient"],timestamp:new Date().toISOString()}),new Error(`Scan match failed: ${a.message}`);return n.info("Scan-match AUDIT: Completed successfully",{clientScanId:r.clientScanId,userBMI:r.extracted_data?.estimated_bmi,selectedArchetypesCount:t?.selected_archetypes?.length||0,strategyUsed:t?.strategy_used,semanticCoherenceScore:t?.semantic_coherence_score,filteringStats:t?.debug_phase_a?.filtering_stats,mappingSource:t?.mapping_metadata?.mapping_source||"unknown",degradedMode:t?.mapping_metadata?.fallback_used||!1,bmiFilteringSuccess:{bmiRelaxationApplied:t?.debug_phase_a?.filtering_stats?.bmiRelaxationApplied,finalArchetypesFound:t?.selected_archetypes?.length||0,primaryArchetype:t?.selected_archetypes?.[0]?{id:t.selected_archetypes[0].id,bmiRange:t.selected_archetypes[0].bmi_range,obesity:t.selected_archetypes[0].obesity}:null},timestamp:new Date().toISOString()}),t},async refine(r){const t={};for(const[i,o]of Object.entries(r.blend_limb_masses))typeof o=="number"&&Number.isFinite(o)&&(t[i]=o);n.info("Filtering blend_limb_masses for Edge Function",{scanId:r.scan_id,originalKeys:Object.keys(r.blend_limb_masses),filteredKeys:Object.keys(t),removedKeys:Object.keys(r.blend_limb_masses).filter(i=>!(i in t)),hasUserMeasurements:!!r.user_measurements,philosophy:"ai_refinement_data_filtering",timestamp:new Date().toISOString()});const{data:a,error:s}=await N.functions.invoke("scan-refine-morphs",{body:{...r,blend_limb_masses:t,k5_envelope:r.k5_envelope,vision_classification:r.vision_classification,user_measurements:r.user_measurements}});if(n.info("Scan-refine-morphs response received",{scanId:r.scan_id,hasResponse:!!a,hasError:!!s,responseKeys:a?Object.keys(a):[],errorMessage:s?.message,aiRefine:a?.ai_refine,finalShapeParamsCount:a?.final_shape_params?Object.keys(a.final_shape_params).length:0,finalLimbMassesCount:a?.final_limb_masses?Object.keys(a.final_limb_masses).length:0,envelopeViolationsCount:a?.envelope_violations?.length||0,dbViolationsCount:a?.db_violations?.length||0,missingKeysAddedCount:a?.missing_keys_added?.length||0,extraKeysRemovedCount:a?.extra_keys_removed?.length||0,philosophy:"phase_b_ai_refinement_response",timestamp:new Date().toISOString()}),s)throw n.error("Scan-refine-morphs failed",{scanId:r.scan_id,error:s.message||s,philosophy:"phase_b_ai_refinement_failed",timestamp:new Date().toISOString()}),new Error(`AI morphological refinement failed: ${s.message}`);return n.info("Scan-refine-morphs completed successfully",{scanId:r.scan_id,aiRefine:a.ai_refine,finalShapeParamsCount:Object.keys(a.final_shape_params||{}).length,finalLimbMassesCount:Object.keys(a.final_limb_masses||{}).length,clampedKeysCount:a.clamped_keys?.length||0,envelopeViolationsCount:a.envelope_violations?.length||0,dbViolationsCount:a.db_violations?.length||0,outOfRangeCount:a.out_of_range_count||0,missingKeysAddedCount:a.missing_keys_added?.length||0,extraKeysRemovedCount:a.extra_keys_removed?.length||0,activeKeysCount:a.active_keys_count||0,aiConfidence:a.ai_confidence,mappingVersion:a.mapping_version,philosophy:"phase_b_ai_refinement_success",timestamp:new Date().toISOString()}),a},async commit(r){let s=null;n.info("Calling scan-commit edge function",{clientScanId:r.clientScanId,resolvedGender:r.resolvedGender,userId:r.user_id,hasEstimateResult:!!r.estimate_result,hasMatchResult:!!r.match_result,hasSemanticResult:!!r.semantic_result,hasAIRefinement:!!r.ai_refinement_result,hasFinalShapeParams:!!r.final_shape_params,finalShapeParamsCount:r.final_shape_params?Object.keys(r.final_shape_params).length:0,hasFinalLimbMasses:!!r.final_limb_masses,finalLimbMassesCount:r.final_limb_masses?Object.keys(r.final_limb_masses).length:0,hasSkinTone:!!r.skin_tone,maxRetries:3,philosophy:"scan_commit_with_retry_v2"});for(let i=1;i<=3;i++)try{i>1&&(n.info(`Scan-commit retry attempt ${i}/3`,{clientScanId:r.clientScanId,previousError:s?.message||"Unknown error",delayMs:2e3,philosophy:"retry_attempt"}),await new Promise(c=>setTimeout(c,2e3)));const o=await N.functions.invoke("scan-commit",{body:r});if(n.info("Scan-commit response received",{clientScanId:r.clientScanId,attempt:i,hasResponse:!!o,responseKeys:o?Object.keys(o):[],hasData:!!o?.data,hasError:!!o?.error,timestamp:new Date().toISOString()}),!o)throw new Error("No response received from scan-commit function");if(o.error){const c=o.error?.message||o.error||"Unknown commit error";throw n.error("Scan-commit returned error",{clientScanId:r.clientScanId,attempt:i,error:o.error,errorMessage:c,timestamp:new Date().toISOString()}),new Error(`Scan commit failed: ${c}`)}return o.data?(n.info("Scan-commit completed successfully",{clientScanId:r.clientScanId,attempt:i,serverScanId:o.data.scan_id,commitSuccess:!!o.data.success,processingComplete:!!o.data.processing_complete,philosophy:"commit_success"}),o.data):(n.warn("Scan-commit returned no data",{clientScanId:r.clientScanId,attempt:i,response:o}),{success:!0,message:"Commit completed without data"})}catch(o){if(s=o,n.error(`Scan-commit attempt ${i}/3 failed`,{clientScanId:r.clientScanId,attempt:i,error:o instanceof Error?o.message:"Unknown error",willRetry:i<3,philosophy:"commit_attempt_failed"}),i===3)throw n.error("Scan-commit all retry attempts exhausted",{clientScanId:r.clientScanId,totalAttempts:3,finalError:s instanceof Error?s.message:"Unknown error",philosophy:"commit_retry_exhausted"}),s}throw s||new Error("Scan commit failed after all retries")},async getLatest(r){const{data:t,error:a}=await N.functions.invoke("scan-latest",{method:"GET",query:{user_id:r}});if(a)throw new Error(`Get latest scan failed: ${a.message}`);return t},async getHistory(r,t=1e3){const{data:a,error:s}=await N.from("body_scans").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(t);if(s)throw new Error(`Get scan history failed: ${s.message}`);return a},async getById(r){const{data:t,error:a}=await N.from("body_scans").select("*").eq("id",r).single();if(a)throw new Error(`Get scan by ID failed: ${a.message}`);return t},async getLatestWithMorphData(r){n.info("BODY_SCAN_REPO","Fetching latest body scan with morph data",{userId:r,philosophy:"get_latest_with_morph_data"});const{data:t,error:a}=await N.from("body_scans").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(a)throw n.error("BODY_SCAN_REPO","Error fetching latest scan with morph data",{userId:r,error:a.message,philosophy:"get_latest_with_morph_data_error"}),new Error(`Get latest scan with morph data failed: ${a.message}`);return t?(n.info("BODY_SCAN_REPO","Latest body scan with morph data retrieved",{userId:r,scanId:t.id,hasMorphValues:!!t.morph_values,morphValuesCount:t.morph_values?Object.keys(t.morph_values).length:0,hasLimbMasses:!!t.limb_masses,limbMassesCount:t.limb_masses?Object.keys(t.limb_masses).length:0,hasWeight:!!t.weight,hasSkinTone:!!t.skin_tone,timestamp:t.timestamp,philosophy:"get_latest_with_morph_data_success"}),t):(n.info("BODY_SCAN_REPO","No body scan found",{userId:r,philosophy:"no_scan_found"}),null)}},Se=[{id:"setup",title:"Configuration Temporelle",subtitle:"Paramétrez votre protocole de jeûne",icon:"Settings",color:"#F59E0B"},{id:"active",title:"Session Active",subtitle:"Votre jeûne est en cours",icon:"Timer",color:"#EF4444"},{id:"completion",title:"Forge Accomplie",subtitle:"Session terminée avec succès",icon:"Check",color:"#22C55E"}],Ee="twinforge:fasting:pipeline",K=ge()(ye((r,t)=>({currentStep:"setup",isActive:!1,session:null,steps:Se,lastTick:Date.now(),startFasting:(a,s)=>{const o=te.getState().session;if(!o?.user?.id){console.error("User not authenticated for fasting session");return}const c=new Date,d={userId:o.user.id,startTime:c,targetHours:a,protocol:s,status:"active"};r({currentStep:"active",isActive:!0,session:d}),n.info("FASTING_PIPELINE","Fasting session started",{userId:o.user.id,targetHours:a,protocol:s,startTime:c.toISOString(),timestamp:new Date().toISOString()})},stopFasting:()=>{const a=t();if(!a.session)return;const s=new Date,i=new Date(a.session.startTime).getTime(),o=Math.floor((s.getTime()-i)/1e3),c=o/3600,d={...a.session,endTime:s,actualDurationHours:c,status:"completed"};r({currentStep:"completion",isActive:!0,session:d}),n.info("FASTING_PIPELINE","Fasting session completed",{userId:a.session.userId,sessionId:a.session.id,actualDurationMinutes:(o/60).toFixed(1),actualDurationHours:c.toFixed(3),targetHours:a.session.targetHours,timestamp:new Date().toISOString()})},cancelFasting:()=>{const a=t();n.info("FASTING_PIPELINE","Fasting session cancelled",{userId:a.session?.userId,sessionDuration:a.getElapsedMinutes(),timestamp:new Date().toISOString()}),r({currentStep:"setup",isActive:!1,session:null})},saveFastingSession:async()=>{const a=t();if(a.session)try{n.info("FASTING_PIPELINE","Saving fasting session to database",{userId:a.session.userId,sessionId:a.session.id,actualDurationHours:a.session.actualDurationHours,targetHours:a.session.targetHours,timestamp:new Date().toISOString()});const{supabase:s}=await we(async()=>{const{supabase:d}=await import("./page-fridge-BvAjnJpI.js").then(l=>l.j);return{supabase:d}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),i={user_id:a.session.userId,start_time:new Date(a.session.startTime).toISOString(),end_time:a.session.endTime?new Date(a.session.endTime).toISOString():null,target_hours:a.session.targetHours,actual_duration_hours:a.session.actualDurationHours||null,protocol_id:a.session.protocol||null,status:a.session.status,notes:a.session.notes||null},{data:o,error:c}=await s.from("fasting_sessions").insert([i]).select().single();if(c)throw new Error(`Database insertion failed: ${c.message}`);n.info("FASTING_PIPELINE","Session successfully saved to database",{userId:a.session.userId,sessionId:o?.id,actualDurationHours:a.session.actualDurationHours,timestamp:new Date().toISOString()}),r({currentStep:"setup",isActive:!1,session:null}),n.info("FASTING_PIPELINE","Session saved and pipeline reset",{userId:a.session.userId,timestamp:new Date().toISOString()})}catch(s){throw n.error("FASTING_PIPELINE","Failed to save fasting session",{error:s instanceof Error?s.message:"Unknown error",userId:a.session?.userId,timestamp:new Date().toISOString()}),s}},tick:()=>{r({lastTick:Date.now()})}}),{name:Ee,partialize:r=>({currentStep:r.currentStep,isActive:r.isActive,session:r.session,lastTick:r.lastTick}),merge:(r,t)=>({...t,...r,steps:t.steps,lastTick:Date.now(),session:r.session?{...r.session,startTime:r.session.startTime?(()=>{const a=new Date(r.session.startTime);return isNaN(a.getTime())?new Date:a})():r.session.startTime,endTime:r.session.endTime?(()=>{const a=new Date(r.session.endTime);return isNaN(a.getTime())?void 0:a})():r.session.endTime}:null})})),gt=()=>K(r=>{if(!r.isActive||!r.session?.startTime)return 0;const t=Date.now(),a=new Date(r.session.startTime).getTime();return Math.floor((t-a)/1e3)}),xt=()=>K(r=>{if(!r.session?.targetHours||!r.isActive||!r.session?.startTime)return 0;const t=Date.now(),a=new Date(r.session.startTime).getTime(),s=Math.floor((t-a)/1e3),i=r.session.targetHours*60*60;return Math.min(100,s/i*100)}),ut=()=>{const r=K(a=>a.isActive),t=K(a=>a.tick);Y.useEffect(()=>{if(!r)return;t();const a=setInterval(()=>{t()},1e3);return()=>{clearInterval(a)}},[r,t])};function ht(){const r=ne(),t=xe(),{session:a}=te(),{success:s,error:i}=J(),{showToast:o}=X(),c=K();return{...c,actions:{startFasting:(p,u)=>{if(!a?.user?.id){i(),o({type:"error",title:"Erreur d'authentification",message:"Vous devez être connecté pour démarrer un jeûne",duration:4e3});return}c.startFasting(p,u),s(),o({type:"success",title:"Forge du Temps Activée",message:`Session de jeûne ${p}h démarrée`,duration:4e3})},stopFasting:()=>{const p=c,u=p.session?Math.floor((Date.now()-new Date(p.session.startTime).getTime())/1e3):0;c.stopFasting(),s(),o({type:"success",title:"Session Terminée",message:`Jeûne de ${Math.floor(u/60)} minutes complété`,duration:4e3})},cancelFasting:()=>{c.cancelFasting();const p=c,u=p.session?Math.floor((Date.now()-new Date(p.session.startTime).getTime())/6e4):0;n.info("FASTING_PIPELINE","Fasting session cancelled",{userId:p.session?.userId,sessionDuration:u,timestamp:new Date().toISOString()}),r("/fasting")},saveFastingSession:async()=>{try{await c.saveFastingSession(),t.invalidateQueries({queryKey:["fasting"]}),s(),o({type:"success",title:"Session Sauvegardée",message:"Votre session de jeûne a été enregistrée",duration:3e3}),r("/fasting#daily")}catch{i(),o({type:"error",title:"Erreur de Sauvegarde",message:"Impossible de sauvegarder votre session",duration:4e3})}}}}}const bt=({isActive:r,currentStep:t,currentSessionId:a,simulatedOverallProgress:s,loadingState:i,capturedPhotos:o,startScan:c,resumePipeline:d})=>{j.useEffect(()=>{n.debug("FRIDGE_SCAN_PAGE","Component mounted, checking store state after hydration",{isActive:r,currentStep:t,currentSessionId:a,simulatedOverallProgress:s,loadingState:i,capturedPhotosCount:o.length,timestamp:new Date().toISOString()}),n.info("FRIDGE_SCAN_PAGE","Component mounted, checking pipeline state",{isActive:r,currentStep:t,loadingState:i,capturedPhotosCount:o.length,currentSessionId:a,timestamp:new Date().toISOString()}),!r&&!a?(n.info("FRIDGE_SCAN_PAGE","Pipeline not active, starting new scan",{currentStep:t,loadingState:i,currentSessionId:a,timestamp:new Date().toISOString()}),c()):!r&&a?(n.info("FRIDGE_SCAN_PAGE","Resuming persisted session",{currentSessionId:a,currentStep:t,timestamp:new Date().toISOString()}),d()):n.info("FRIDGE_SCAN_PAGE","Pipeline already active, maintaining current state",{currentStep:t,loadingState:i,isActive:r,currentSessionId:a,capturedPhotosCount:o.length,timestamp:new Date().toISOString()})},[]),j.useEffect(()=>{n.debug("FRIDGE_SCAN_PAGE","Captured photos count changed",{capturedPhotosCount:o.length,currentStep:t,isActive:r,currentSessionId:a,timestamp:new Date().toISOString()})},[o.length]),j.useEffect(()=>()=>{n.info("FRIDGE_SCAN_PAGE","Component unmounting, cleaning up pipeline",{currentStep:t,isActive:r,timestamp:new Date().toISOString()})},[]),j.useEffect(()=>{const x=setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"});const _=document.getElementById("main-content");_&&_.scrollTo({top:0,behavior:"smooth"})},150);return n.debug("FRIDGE_SCAN_PAGE","Auto-scroll triggered on step change",{currentStep:t,timestamp:new Date().toISOString()}),()=>clearTimeout(x)},[t]),j.useEffect(()=>{if(o.length>0){const x=setTimeout(()=>{const _=document.getElementById("analyze-cta");_?(_.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),n.debug("FRIDGE_SCAN_PAGE","Auto-scroll to AnalyzeCTA successful",{capturedPhotosCount:o.length,ctaElementFound:!0,timestamp:new Date().toISOString()})):(n.debug("FRIDGE_SCAN_PAGE","AnalyzeCTA not found, retrying...",{capturedPhotosCount:o.length,timestamp:new Date().toISOString()}),setTimeout(()=>{const p=document.getElementById("analyze-cta");p&&p.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},200))},500);return n.debug("FRIDGE_SCAN_PAGE","Scheduling auto-scroll to AnalyzeCTA",{capturedPhotosCount:o.length,timestamp:new Date().toISOString()}),()=>clearTimeout(x)}},[o.length])},yt=({currentStep:r,loadingState:t,isActive:a,currentSessionId:s,capturedPhotos:i,rawDetectedItems:o,suggestedComplementaryItems:c,goToStep:d,setLoadingState:l,startProgressSimulation:x,processVisionResults:_,setSuggestedComplementaryItems:p,addCapturedPhotos:u,updateInventory:f,removeCapturedPhoto:F,resetPipeline:m})=>{const h=ne(),{profile:S,session:E}=te(),{success:G,error:Q,click:T}=J(),{showToast:R}=X(),{showModal:H}=ue(),re=()=>{n.info("FRIDGE_SCAN_PAGE","User requested manual exit from pipeline",{currentStep:r,loadingState:t,isActive:a,sessionId:s,timestamp:new Date().toISOString()}),H({title:"Quitter l'Atelier de Recettes",message:"Votre session de scan et de génération de recettes est en cours. Quitter maintenant entraînera une perte de progression et pourrait générer des coûts IA inutiles.",processName:"Scanner de Frigo",onConfirm:()=>{n.info("FRIDGE_SCAN_PAGE","User confirmed manual exit, resetting pipeline",{currentStep:r,loadingState:t,sessionId:s,timestamp:new Date().toISOString()}),m(),h("/fridge"),R({type:"info",title:"Atelier Réinitialisé",message:"Votre session a été annulée et l'atelier a été réinitialisé",duration:3e3})},onCancel:()=>{n.info("FRIDGE_SCAN_PAGE","User cancelled manual exit, continuing pipeline",{currentStep:r,loadingState:t,timestamp:new Date().toISOString()})}})},Z=async k=>{try{n.info("FRIDGE_SCAN_PAGE","Photos uploaded, starting analysis",{photosCount:k.length,sessionId:s,timestamp:new Date().toISOString()}),d("analyze"),l("analyzing");const O=se.find(b=>b.id==="analyze"),q=se.find(b=>b.id==="validation");x([{message:"Initialisation de l'analyse IA...",duration:2e3,icon:"Zap"},{message:"Traitement des images avec GPT-4o...",duration:8e3,icon:"Eye"},{message:"Détection des ingrédients...",duration:4e3,icon:"Search"},{message:"Normalisation de l'inventaire...",duration:3e3,icon:"CheckCircle"}],O?.startProgress||33,q?.startProgress||66),n.info("FRIDGE_SCAN_PAGE","Starting vision analysis with OpenAI",{photosCount:k.length,sessionId:s,aiModel:"gpt-4o",timestamp:new Date().toISOString()});const B=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/fridge-scan-vision",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U","Content-Type":"application/json"},body:JSON.stringify({image_base64:k,user_id:E?.user?.id})});if(!B.ok)throw new Error(`Vision analysis failed: ${B.status} ${B.statusText}`);const A=await B.json();n.info("FRIDGE_SCAN_PAGE","Vision data received from Edge Function",{sessionId:s,hasDetectedItems:!!A.detected_items,detectedItemsCount:A.detected_items?.length||0,allDetectedItems:A.detected_items?.map(b=>({label:b.label,confidence:b.confidence,category:b.category,quantity:b.estimated_quantity,freshness:b.freshness_score})),detectionQuality:(A.detected_items?.length||0)>=15?"EXCELLENT":(A.detected_items?.length||0)>=10?"GOOD":(A.detected_items?.length||0)>=6?"ACCEPTABLE":"POOR",visionDataKeys:Object.keys(A),processingTimeMs:A.processing_time_ms,costUsd:A.cost_usd,cacheHit:A.cache_hit,timestamp:new Date().toISOString()}),n.info("FRIDGE_SCAN_PAGE","Vision analysis completed",{sessionId:s,itemsDetected:A.detected_items?.length||0,processingTimeMs:A.processing_time_ms,costUsd:A.cost_usd,imagesProcessed:A.images_processed,cacheHit:A.cache_hit,aiModel:"gpt-4o",timestamp:new Date().toISOString()}),n.info("FRIDGE_SCAN_PAGE","Starting inventory processing",{rawItemsCount:A.detected_items?.length||0,sessionId:s,timestamp:new Date().toISOString()});const P=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/inventory-processor",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U","Content-Type":"application/json"},body:JSON.stringify({raw_detected_items:A.detected_items||[],user_id:E?.user?.id})});if(!P.ok){const b=await P.text();throw n.error("FRIDGE_SCAN_PAGE","Inventory processor response error",{status:P.status,statusText:P.statusText,errorBody:b,sessionId:s,timestamp:new Date().toISOString()}),new Error(`Inventory processing failed: ${P.status} ${P.statusText}`)}const D=await P.json();n.info("FRIDGE_SCAN_PAGE","Processor data received from Edge Function",{sessionId:s,hasInventoryNormalized:!!D.inventory_normalized,inventoryNormalizedCount:D.inventory_normalized?.length||0,allNormalizedInventory:D.inventory_normalized?.map(b=>({name:b.name,category:b.category,quantity:b.quantity,freshness:b.freshness})),quantityAdjustmentCheck:D.inventory_normalized?.some(b=>b.quantity?.includes("pour")||b.quantity?.includes("personnes"))?"DETECTED_HOUSEHOLD_ADJUSTMENT":"RAW_QUANTITIES_PRESERVED",processorDataKeys:Object.keys(D),processingTimeMs:D.processing_time_ms,cacheHit:D.cache_hit,timestamp:new Date().toISOString()}),n.info("FRIDGE_SCAN_PAGE","Inventory processing completed",{sessionId:s,itemsProcessed:D.items_processed,itemsNormalized:D.inventory_normalized?.length||0,processingTimeMs:D.processing_time_ms,cacheHit:D.cache_hit,timestamp:new Date().toISOString()});let V=[];const ee=10,L=D.inventory_normalized?.length||0;if(L<ee){n.info("FRIDGE_SCAN_PAGE","Inventory insufficient, calling complementer",{sessionId:s,normalizedItemsCount:L,threshold:ee,timestamp:new Date().toISOString()});try{const b=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/inventory-complementer",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U","Content-Type":"application/json"},body:JSON.stringify({user_id:E?.user?.id,current_inventory:D.inventory_normalized||[],user_profile:S})});if(!b.ok)throw new Error(`Complementer failed: ${b.status} ${b.statusText}`);const U=await b.json();n.info("FRIDGE_SCAN_PAGE","Complementer suggestions received",{sessionId:s,suggestionsCount:U.suggested_items?.length||0,processingTimeMs:U.processing_time_ms,timestamp:new Date().toISOString()}),V=(U.suggested_items||[]).map(($,at)=>({id:crypto.randomUUID(),userId:E?.user?.id||"",sessionId:s||"",name:$.label,category:$.category,quantity:$.quantity,confidence:$.confidence||.85,freshnessScore:$.freshness||90,isUserEdited:!1,isSuggested:!0,suggestionReason:$.reason||"Recommandé par notre IA nutritionniste",suggestionPriority:$.priority||"medium",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})),p(V)}catch(b){n.error("FRIDGE_SCAN_PAGE","Complementer call failed",{error:b instanceof Error?b.message:"Unknown error",sessionId:s,timestamp:new Date().toISOString()}),R({type:"warning",title:"Suggestions indisponibles",message:"Impossible de suggérer des aliments complémentaires, mais vous pouvez continuer.",duration:4e3})}}n.debug("FRIDGE_SCAN_PAGE","Converting normalized inventory to FridgeItem format",{sessionId:s,normalizedItemsCount:D.inventory_normalized?.length||0,timestamp:new Date().toISOString()});const ae=(D.inventory_normalized||[]).map((b,U)=>({id:`item-${U}`,userId:E?.user?.id||"",sessionId:s||"",name:b.name,category:b.category,quantity:b.quantity,confidence:.9,freshnessScore:b.freshness==="Excellent"?90:b.freshness==="Bon"?75:b.freshness==="Moyen"?50:30,expiryDate:b.estimated_expiry_days?new Date(Date.now()+b.estimated_expiry_days*24*60*60*1e3).toISOString().split("T")[0]:void 0,isUserEdited:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}));n.info("FRIDGE_SCAN_PAGE","FridgeItems created successfully",{sessionId:s,fridgeItemsCount:ae.length,fridgeItemsPreview:ae.slice(0,3).map(b=>({id:b.id,name:b.name,category:b.category,quantity:b.quantity,freshnessScore:b.freshnessScore})),timestamp:new Date().toISOString()}),_(ae,V),l("idle")}catch(O){n.error("FRIDGE_SCAN_PAGE","Photo analysis failed",{error:O instanceof Error?O.message:"Unknown error",photosCount:k.length,sessionId:s,loadingState:t,currentStep:r,timestamp:new Date().toISOString(),stack:O instanceof Error?O.stack:void 0}),Q(),R({type:"error",title:"Erreur d'analyse",message:O instanceof Error&&O.message.includes("unsupported image")?"Format d'image non supporté. Utilisez PNG, JPEG, GIF ou WebP.":"Impossible d'analyser les photos. Veuillez réessayer.",duration:5e3}),l("idle"),d("photo")}};return{handleManualExit:re,handlePhotosUploaded:Z,handleInventoryUpdate:k=>{n.debug("FRIDGE_SCAN_PAGE","Inventory updated by user",{inventoryCount:k.length,sessionId:s,timestamp:new Date().toISOString()}),f(k)},handleFileSelect:async k=>{if(!k||k.length===0)return;const O=["image/png","image/jpeg","image/jpg","image/gif","image/webp"],q=Array.from(k).filter(B=>O.includes(B.type.toLowerCase())?B.size>10*1024*1024?(R({type:"error",title:"Fichier trop volumineux",message:`${B.name} dépasse la limite de 10MB`,duration:3e3}),!1):!0:(R({type:"error",title:"Format non supporté",message:`${B.name} doit être au format PNG, JPEG, GIF ou WebP`,duration:4e3}),!1));if(q.length!==0)try{const A=q.slice(0,6).map(D=>new Promise((V,ee)=>{const L=new FileReader;L.onload=()=>V(L.result),L.onerror=ee,L.readAsDataURL(D)})),P=await Promise.all(A);n.info("FRIDGE_SCAN_PAGE","Photos captured for analysis",{photosCount:P.length,maxSupported:6,timestamp:new Date().toISOString()}),u(P),G(),R({type:"success",title:"Photos capturées !",message:`${P.length} photo${P.length>1?"s":""} prête${P.length>1?"s":""} pour l'analyse`,duration:3e3})}catch{R({type:"error",title:"Erreur de traitement",message:"Impossible de traiter les photos sélectionnées",duration:4e3})}},removePhoto:k=>{F(k)},handleAnalyzePhotos:()=>{i.length!==0&&(T(),n.info("FRIDGE_SCAN_PAGE","User clicked analyze photos button",{capturedPhotosCount:i.length,sessionId:s,timestamp:new Date().toISOString()}),Z(i))}}},je="_wrap_2h7el_11",Ie="_card_2h7el_18",Ce="_grid_2h7el_32",Ne="_icon_2h7el_42",ke="_iconHalo_2h7el_66",Ae="_iconGlyph_2h7el_77",Fe="_center_2h7el_83",De="_title_2h7el_91",Te="_subtitle_2h7el_102",Oe="_rail_2h7el_112",Pe="_seg_2h7el_120",Re="_segPink_2h7el_128",Me="_segPinkLight_2h7el_132",Be="_isCurrent_2h7el_136",Ge="_isComplete_2h7el_140",ze="_fill_2h7el_144",Le="_fillPink_2h7el_152",$e="_fillPinkLight_2h7el_158",We="_step_2h7el_165",He="_percent_2h7el_174",C={wrap:je,card:Ie,grid:Ce,icon:Ne,iconHalo:ke,iconGlyph:Ae,center:Fe,title:De,subtitle:Te,rail:Oe,seg:Pe,segPink:Re,segPinkLight:Me,isCurrent:Be,isComplete:Ge,fill:ze,fillPink:Le,fillPinkLight:$e,step:We,percent:He},Ve={photo:"Camera",analysis:"Scan",complement:"Lightbulb",validation:"Check"},ft=({currentStep:r,overallProgress:t,stepProgress:a,loadingMessage:s})=>{const i=Number.isFinite(t)?Math.min(100,Math.max(0,t)):0,o=se.slice(0,4).map(p=>({id:p.id,title:p.title})),c=100/o.length,d=Math.max(0,o.findIndex(p=>p.id===r.id)),l=d*c,x=Math.max(0,Math.min(1,(i-l)/c)),_=Ve[r.id]||"Refrigerator";return e.jsxs("div",{className:`${C.wrap}`,children:[e.jsx(M,{className:C.card,children:e.jsxs("div",{className:C.grid,"data-fridge-forge":!0,children:[e.jsxs("div",{className:C.icon,children:[e.jsx("div",{className:C.iconHalo}),e.jsx(v,{Icon:y[_],size:26,className:C.iconGlyph})]}),e.jsxs("div",{className:C.center,children:[e.jsx("h2",{className:C.title,children:r.title||"Forge Culinaire"}),r.subtitle&&e.jsx("p",{className:C.subtitle,children:r.subtitle}),e.jsx("div",{className:C.rail,role:"progressbar","aria-valuenow":Math.round(i),"aria-valuemin":0,"aria-valuemax":100,children:o.map((p,u)=>{const f=u<d,F=u===d,m=f?"100%":F?`${x*100}%`:"0%",h=u%2===0?C.segPink:C.segPinkLight,S=u%2===0?C.fillPink:C.fillPinkLight;return e.jsx("div",{className:`${C.seg} ${h} ${f?C.isComplete:""} ${F?C.isCurrent:""}`,children:(f||F)&&e.jsx(g.span,{className:`${C.fill} ${S}`,initial:{width:0},animate:{width:m},transition:{duration:.45,ease:"easeOut"}})},p.id)})}),e.jsxs("div",{className:C.step,children:["Atelier ",d+1," sur ",o.length]})]}),e.jsxs("div",{className:C.percent,"aria-hidden":"true",children:[Math.round(i),"%"]})]})}),s&&e.jsx("div",{className:"mt-3 text-sm text-gray-300 animate-pulse text-center",children:s})]})},vt=({isActive:r,currentStep:t,onManualExit:a})=>!r||t==="photo"||t==="validation"?null:e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx("button",{onClick:a,className:"btn-glass--warning px-6 py-3",title:"Quitter l'atelier de recettes",style:{background:"color-mix(in srgb, #EF4444 15%, transparent)",borderColor:"color-mix(in srgb, #EF4444 30%, transparent)",color:"#EF4444"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{Icon:y.X,size:16}),e.jsx("span",{children:"Quitter l'Atelier de Recettes"})]})})}),ce=({onCameraCapture:r,onFileUpload:t,fileInputRef:a})=>e.jsxs(M,{className:"p-8 text-center",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 18%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #F472B6 15%, transparent) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, color-mix(in srgb, #DB2777 12%, transparent) 0%, transparent 70%),
          linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.10)),
          rgba(11, 14, 23, 0.85)
        `,borderColor:"color-mix(in srgb, #EC4899 40%, transparent)",boxShadow:`
          0 25px 80px rgba(0, 0, 0, 0.5),
          0 0 60px color-mix(in srgb, #EC4899 30%, transparent),
          0 0 120px color-mix(in srgb, #F472B6 25%, transparent),
          0 0 180px color-mix(in srgb, #DB2777 20%, transparent),
          inset 0 3px 0 rgba(255, 255, 255, 0.3),
          inset 0 -2px 0 rgba(0, 0, 0, 0.2)
        `,backdropFilter:"blur(32px) saturate(180%)",WebkitBackdropFilter:"blur(32px) saturate(180%)"},children:[e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"relative flex justify-center",children:e.jsxs(g.div,{className:"w-32 h-32 rounded-full flex items-center justify-center relative",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.35) 0%, transparent 60%),
                radial-gradient(circle at 70% 70%, color-mix(in srgb, #EC4899 30%, transparent) 0%, transparent 50%),
                linear-gradient(135deg, color-mix(in srgb, #EC4899 55%, transparent), color-mix(in srgb, #F472B6 45%, transparent))
              `,border:"4px solid color-mix(in srgb, #EC4899 85%, transparent)",boxShadow:`
                0 0 60px color-mix(in srgb, #EC4899 90%, transparent),
                0 0 120px color-mix(in srgb, #EC4899 70%, transparent),
                0 0 180px color-mix(in srgb, #F472B6 60%, transparent),
                inset 0 5px 0 rgba(255,255,255,0.7),
                inset 0 -4px 0 rgba(0,0,0,0.35)
              `,backdropFilter:"blur(28px) saturate(180%)",WebkitBackdropFilter:"blur(28px) saturate(180%)"},animate:{scale:[1,1.05,1],boxShadow:[`0 0 60px color-mix(in srgb, #EC4899 90%, transparent),
                 0 0 120px color-mix(in srgb, #EC4899 70%, transparent),
                 0 0 180px color-mix(in srgb, #F472B6 60%, transparent)`,`0 0 70px color-mix(in srgb, #EC4899 100%, transparent),
                 0 0 140px color-mix(in srgb, #EC4899 80%, transparent),
                 0 0 210px color-mix(in srgb, #F472B6 70%, transparent)`,`0 0 60px color-mix(in srgb, #EC4899 90%, transparent),
                 0 0 120px color-mix(in srgb, #EC4899 70%, transparent),
                 0 0 180px color-mix(in srgb, #F472B6 60%, transparent)`]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},children:[e.jsx(v,{Icon:y.Camera,size:56,color:"rgba(255, 255, 255, 0.95)",variant:"pure"}),[0,.6,1.2].map((s,i)=>e.jsx(g.div,{className:"absolute inset-0 rounded-full border-2 pointer-events-none",style:{borderColor:i===0?"color-mix(in srgb, #EC4899 65%, transparent)":i===1?"color-mix(in srgb, #F472B6 55%, transparent)":"color-mix(in srgb, #DB2777 45%, transparent)"},animate:{scale:[1,1.8,1.8],opacity:[.8,0,0]},transition:{duration:2.5,repeat:1/0,delay:s,ease:"easeOut"}},i))]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-white",style:{textShadow:"0 0 25px color-mix(in srgb, #EC4899 70%, transparent)"},children:"Scanner votre Frigo"}),e.jsx("p",{className:"text-white/85 text-lg max-w-md mx-auto leading-relaxed",children:"Prenez 1 à 6 photos de votre frigo, garde-manger, ou armoire pour que la Forge Spatiale analyse vos ingrédients disponibles."})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("button",{onClick:r,className:"relative overflow-hidden px-10 py-5 text-xl font-bold rounded-2xl transition-all duration-300 group",style:{background:`
                linear-gradient(135deg,
                  color-mix(in srgb, #EC4899 90%, transparent),
                  color-mix(in srgb, #F472B6 75%, transparent),
                  color-mix(in srgb, #DB2777 65%, transparent)
                )
              `,border:"3px solid color-mix(in srgb, #EC4899 75%, transparent)",boxShadow:`
                0 18px 60px color-mix(in srgb, #EC4899 60%, transparent),
                0 0 100px color-mix(in srgb, #EC4899 50%, transparent),
                0 0 150px color-mix(in srgb, #F472B6 40%, transparent),
                inset 0 5px 0 rgba(255,255,255,0.6)
              `,backdropFilter:"blur(28px) saturate(170%)",color:"#fff",minWidth:"260px"},onMouseEnter:s=>{window.matchMedia("(hover: hover)").matches&&(s.currentTarget.style.transform="translateY(-4px) scale(1.05)",s.currentTarget.style.boxShadow=`
                  0 24px 80px color-mix(in srgb, #EC4899 75%, transparent),
                  0 0 130px color-mix(in srgb, #EC4899 65%, transparent),
                  0 0 200px color-mix(in srgb, #F472B6 55%, transparent),
                  inset 0 5px 0 rgba(255,255,255,0.7)
                `)},onMouseLeave:s=>{window.matchMedia("(hover: hover)").matches&&(s.currentTarget.style.transform="translateY(0) scale(1)",s.currentTarget.style.boxShadow=`
                  0 18px 60px color-mix(in srgb, #EC4899 60%, transparent),
                  0 0 100px color-mix(in srgb, #EC4899 50%, transparent),
                  0 0 150px color-mix(in srgb, #F472B6 40%, transparent),
                  inset 0 5px 0 rgba(255,255,255,0.6)
                `)},children:[e.jsx(g.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{background:`linear-gradient(90deg,
                  transparent 0%,
                  rgba(255,255,255,0.45) 50%,
                  transparent 100%
                )`},animate:{x:["-200%","200%"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"}}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx(v,{Icon:y.Camera,size:28,color:"white",variant:"pure"}),e.jsx("span",{children:"Prendre une Photo"})]})]}),e.jsxs("button",{onClick:t,className:"text-pink-300 hover:text-pink-100 text-base font-medium transition-all duration-300 flex items-center gap-2 group",children:[e.jsx(v,{Icon:y.Image,size:18,className:"group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"underline decoration-pink-400/40 hover:decoration-pink-300/60",children:"ou choisir depuis la galerie"})]})]}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-full",style:{background:"color-mix(in srgb, #EC4899 18%, transparent)",border:"2px solid color-mix(in srgb, #EC4899 35%, transparent)",backdropFilter:"blur(18px) saturate(150%)"},children:[e.jsx(g.div,{className:"w-2.5 h-2.5 rounded-full",style:{background:"#EC4899"},animate:{opacity:[1,.4,1],scale:[1,1.2,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),e.jsx("span",{className:"text-pink-200 text-sm font-semibold",children:"Forge Spatiale Prête"})]})})]}),e.jsx("input",{ref:a,type:"file",accept:"image/png,image/jpeg,image/jpg,image/gif,image/webp",multiple:!0,className:"hidden"})]}),Ue=({capturedPhotos:r,onRemovePhoto:t})=>r.length===0?null:e.jsxs(M,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 12%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #F472B6 10%, transparent) 0%, transparent 50%),
          rgba(255, 255, 255, 0.06)
        `,borderColor:"color-mix(in srgb, #EC4899 28%, transparent)",boxShadow:`
          0 12px 36px rgba(0, 0, 0, 0.25),
          0 0 24px color-mix(in srgb, #EC4899 18%, transparent),
          inset 0 2px 0 rgba(255, 255, 255, 0.12)
        `,backdropFilter:"blur(24px) saturate(160%)",WebkitBackdropFilter:"blur(24px) saturate(160%)"},children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(g.div,{className:"w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0 relative",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.18) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #EC4899 35%, transparent), color-mix(in srgb, #F472B6 28%, transparent))
            `,border:"2.5px solid color-mix(in srgb, #EC4899 50%, transparent)",boxShadow:`
              0 0 24px color-mix(in srgb, #EC4899 35%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.25)
            `},animate:{boxShadow:["0 0 24px color-mix(in srgb, #EC4899 35%, transparent)","0 0 32px color-mix(in srgb, #EC4899 45%, transparent)","0 0 24px color-mix(in srgb, #EC4899 35%, transparent)"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},children:e.jsx(v,{Icon:y.Image,size:24,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-bold text-xl mb-1",style:{textShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:"Photos Capturées"}),e.jsxs("p",{className:"text-pink-200/80 text-sm",children:[r.length," / 6 photo",r.length>1?"s":""]})]}),e.jsxs("div",{className:"px-4 py-2 rounded-xl text-center",style:{background:"color-mix(in srgb, #EC4899 20%, transparent)",border:"2px solid color-mix(in srgb, #EC4899 40%, transparent)",backdropFilter:"blur(12px)"},children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:r.length}),e.jsxs("div",{className:"text-xs text-pink-200/70 font-medium",children:["photo",r.length>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:e.jsx(ie,{children:r.map((a,s)=>e.jsx(g.div,{initial:{opacity:0,scale:.85,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.85,y:-20},transition:{duration:.45,delay:s*.08,ease:[.4,0,.2,1]},className:"group relative",children:e.jsxs("div",{className:"relative aspect-square rounded-2xl overflow-hidden",style:{background:"rgba(255, 255, 255, 0.05)",border:"2px solid color-mix(in srgb, #EC4899 25%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease"},onMouseEnter:i=>{window.matchMedia("(hover: hover)").matches&&(i.currentTarget.style.transform="translateY(-4px) scale(1.02)",i.currentTarget.style.boxShadow=`
                      0 8px 24px rgba(0, 0, 0, 0.3),
                      0 0 24px color-mix(in srgb, #EC4899 35%, transparent)
                    `,i.currentTarget.style.borderColor="color-mix(in srgb, #EC4899 45%, transparent)")},onMouseLeave:i=>{window.matchMedia("(hover: hover)").matches&&(i.currentTarget.style.transform="translateY(0) scale(1)",i.currentTarget.style.boxShadow="0 4px 16px rgba(0, 0, 0, 0.2)",i.currentTarget.style.borderColor="color-mix(in srgb, #EC4899 25%, transparent)")},children:[e.jsx("img",{src:a,alt:`Photo du frigo ${s+1}`,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",style:{background:"linear-gradient(180deg, transparent 0%, rgba(236, 72, 153, 0.15) 100%)"}}),e.jsx(g.button,{onClick:()=>t(s),className:"absolute top-2 right-2 w-9 h-9 rounded-full flex items-center justify-center z-10",style:{background:"radial-gradient(circle at center, rgba(239, 68, 68, 0.95) 0%, rgba(239, 68, 68, 0.85) 100%)",border:"2.5px solid rgba(255, 255, 255, 0.9)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.7), 0 4px 12px rgba(0, 0, 0, 0.3)",backdropFilter:"blur(8px)",cursor:"pointer"},whileHover:{scale:1.15,boxShadow:"0 0 30px rgba(239, 68, 68, 0.9), 0 6px 16px rgba(0, 0, 0, 0.4)"},whileTap:{scale:.95},"aria-label":"Supprimer la photo",children:e.jsx(v,{Icon:y.X,size:16,color:"white",variant:"pure"})}),e.jsx("div",{className:"absolute bottom-2 left-2 px-3 py-1.5 rounded-full",style:{background:"rgba(0, 0, 0, 0.85)",border:"1.5px solid rgba(255, 255, 255, 0.35)",backdropFilter:"blur(12px)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:e.jsxs("span",{className:"text-white text-xs font-semibold",children:["Photo ",s+1]})})]})},`${a}-${s}`))})}),r.length<6&&e.jsx(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r.length*.08+.3},className:"mt-6 p-4 rounded-xl",style:{background:"color-mix(in srgb, #EC4899 15%, transparent)",border:"2px solid color-mix(in srgb, #EC4899 30%, transparent)",backdropFilter:"blur(16px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:"color-mix(in srgb, #EC4899 25%, transparent)",border:"1.5px solid color-mix(in srgb, #EC4899 45%, transparent)"},children:e.jsx(v,{Icon:y.Info,size:16,color:"#EC4899",variant:"pure"})}),e.jsxs("span",{className:"text-pink-100 text-sm font-medium",children:["Vous pouvez ajouter encore ",6-r.length," photo",6-r.length>1?"s":""," supplémentaire",6-r.length>1?"s":""]})]})})]}),Ye=({capturedPhotosCount:r,onAnalyzePhotos:t})=>r===0?null:e.jsx(M,{id:"analyze-cta",className:"p-8 text-center",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 18%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #F472B6 15%, transparent) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, color-mix(in srgb, #DB2777 12%, transparent) 0%, transparent 70%),
          linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.10)),
          rgba(11, 14, 23, 0.85)
        `,borderColor:"color-mix(in srgb, #EC4899 40%, transparent)",boxShadow:`
          0 25px 80px rgba(0, 0, 0, 0.5),
          0 0 60px color-mix(in srgb, #EC4899 30%, transparent),
          0 0 120px color-mix(in srgb, #F472B6 25%, transparent),
          0 0 180px color-mix(in srgb, #DB2777 20%, transparent),
          inset 0 3px 0 rgba(255, 255, 255, 0.3),
          inset 0 -2px 0 rgba(0, 0, 0, 0.2)
        `,backdropFilter:"blur(32px) saturate(180%)",WebkitBackdropFilter:"blur(32px) saturate(180%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"relative flex justify-center",children:e.jsxs("div",{className:"w-24 h-24 rounded-full flex items-center justify-center breathing-icon relative",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3) 0%, transparent 60%),
                radial-gradient(circle at 70% 70%, color-mix(in srgb, #EC4899 25%, transparent) 0%, transparent 50%),
                linear-gradient(135deg, color-mix(in srgb, #EC4899 50%, transparent), color-mix(in srgb, #F472B6 40%, transparent))
              `,border:"4px solid color-mix(in srgb, #EC4899 80%, transparent)",boxShadow:`
                0 0 50px color-mix(in srgb, #EC4899 80%, transparent),
                0 0 100px color-mix(in srgb, #EC4899 60%, transparent),
                0 0 150px color-mix(in srgb, #F472B6 50%, transparent),
                inset 0 4px 0 rgba(255,255,255,0.6),
                inset 0 -3px 0 rgba(0,0,0,0.3)
              `,backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)"},children:[e.jsx(v,{Icon:y.Zap,size:40,color:"rgba(255, 255, 255, 0.9)",variant:"pure"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 pointer-events-none",style:{borderColor:"color-mix(in srgb, #EC4899 60%, transparent)",animation:"scan-completion-ripple 2s ease-out infinite"}}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 pointer-events-none",style:{borderColor:"color-mix(in srgb, #F472B6 50%, transparent)",animation:"scan-completion-ripple 2.5s ease-out infinite",animationDelay:"0.5s"}}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 pointer-events-none",style:{borderColor:"color-mix(in srgb, #DB2777 40%, transparent)",animation:"scan-completion-ripple 3s ease-out infinite",animationDelay:"1s"}})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",style:{textShadow:"0 0 20px color-mix(in srgb, #EC4899 60%, transparent)"},children:"Prêt pour l'Analyse"}),e.jsxs("p",{className:"text-white/90 text-lg",children:[r," photo",r>1?"s":""," prête",r>1?"s":""," à être analysée",r>1?"s":""," par la Forge Spatiale"]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:t,disabled:r===0,className:"relative overflow-hidden px-10 py-4 text-xl font-bold rounded-full transition-all duration-300",style:{background:`
                linear-gradient(135deg, 
                  color-mix(in srgb, #EC4899 85%, transparent), 
                  color-mix(in srgb, #F472B6 70%, transparent),
                  color-mix(in srgb, #DB2777 60%, transparent)
                )
              `,border:"3px solid color-mix(in srgb, #EC4899 70%, transparent)",boxShadow:`
                0 16px 50px color-mix(in srgb, #EC4899 50%, transparent),
                0 0 80px color-mix(in srgb, #EC4899 40%, transparent),
                0 0 120px color-mix(in srgb, #F472B6 30%, transparent),
                inset 0 4px 0 rgba(255,255,255,0.5)
              `,backdropFilter:"blur(24px) saturate(170%)",color:"#fff"},onMouseEnter:a=>{window.matchMedia("(hover: hover)").matches&&(a.currentTarget.style.transform="translateY(-3px) scale(1.05)",a.currentTarget.style.boxShadow=`
                  0 20px 60px color-mix(in srgb, #EC4899 60%, transparent),
                  0 0 100px color-mix(in srgb, #EC4899 50%, transparent),
                  0 0 150px color-mix(in srgb, #F472B6 40%, transparent),
                  inset 0 4px 0 rgba(255,255,255,0.6)
                `)},onMouseLeave:a=>{window.matchMedia("(hover: hover)").matches&&(a.currentTarget.style.transform="translateY(0) scale(1)",a.currentTarget.style.boxShadow=`
                  0 16px 50px color-mix(in srgb, #EC4899 50%, transparent),
                  0 0 80px color-mix(in srgb, #EC4899 40%, transparent),
                  0 0 120px color-mix(in srgb, #F472B6 30%, transparent),
                  inset 0 4px 0 rgba(255,255,255,0.5)
                `)},children:[e.jsx("div",{className:"absolute inset-0 rounded-full pointer-events-none",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,animation:"fridge-spatial-shimmer 2s ease-in-out infinite"}}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx(v,{Icon:y.Zap,size:24,color:"white",variant:"pure"}),e.jsx("span",{children:"Analyser mes Photos"})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full",style:{background:"color-mix(in srgb, #EC4899 15%, transparent)",border:"2px solid color-mix(in srgb, #EC4899 30%, transparent)",backdropFilter:"blur(16px) saturate(140%)"},children:[e.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{background:"#EC4899"}}),e.jsx("span",{className:"text-pink-300 text-sm font-bold",children:"Forge Spatiale Prête"})]})})]})}),Ke=()=>{const r=[{icon:"ChefHat",title:"Recettes Personnalisées",description:"Générez des recettes adaptées à vos ingrédients disponibles",color:"var(--color-fridge-primary)"},{icon:"TrendingDown",title:"Réduction du Gaspillage",description:"Utilisez vos aliments avant leur péremption",color:"var(--color-nutrition-primary)"},{icon:"DollarSign",title:"Économies Intelligentes",description:"Optimisez vos courses et votre budget alimentaire",color:"var(--color-fasting-primary)"},{icon:"Calendar",title:"Planification Facile",description:"Créez des plans de repas hebdomadaires automatiquement",color:"var(--color-training-primary)"},{icon:"ShoppingCart",title:"Listes de Courses",description:"Générez des listes précises basées sur vos besoins",color:"var(--color-ember-copper)"},{icon:"Heart",title:"Santé & Nutrition",description:"Suivez votre équilibre nutritionnel et vos objectifs",color:"var(--color-health-primary)"}];return e.jsx(g.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},children:e.jsxs(M,{className:"p-6",style:{background:`
            radial-gradient(circle at 20% 30%, color-mix(in srgb, var(--brand-primary) 10%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 80% 70%, color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, var(--brand-primary) 25%, transparent)",boxShadow:`
            0 8px 32px color-mix(in srgb, var(--brand-primary) 12%, transparent),
            0 0 0 1px color-mix(in srgb, var(--brand-primary) 20%, transparent),
            inset 0 1px 0 color-mix(in srgb, white 10%, transparent)
          `,backdropFilter:"blur(20px) saturate(180%)"},children:[e.jsx(g.div,{className:"flex justify-center mb-6",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.6},children:e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle, color-mix(in srgb, var(--brand-primary) 25%, transparent) 0%,
                color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent) 70%)
              `,border:"3px solid color-mix(in srgb, var(--brand-primary) 35%, transparent)",boxShadow:`
                0 0 30px color-mix(in srgb, var(--brand-primary) 30%, transparent),
                inset 0 2px 0 color-mix(in srgb, white 20%, transparent)
              `},children:e.jsx(v,{Icon:y.Lightbulb,size:48,style:{color:"var(--brand-primary)",filter:"drop-shadow(0 0 12px color-mix(in srgb, var(--brand-primary) 50%, transparent))"}})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(g.h4,{className:"text-xl font-bold mb-3 text-white",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},children:"Pourquoi Scanner Mon Frigo ?"}),e.jsx(g.p,{className:"text-sm text-white/70 max-w-md mx-auto",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},children:"Transformez votre inventaire en opportunités culinaires et économies intelligentes"})]}),e.jsx(g.div,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.5}}},children:r.map((t,a)=>e.jsxs(g.div,{className:"flex items-start gap-4 p-4 rounded-lg",style:{background:"color-mix(in srgb, var(--glass-opacity) 60%, transparent)",border:"1px solid color-mix(in srgb, white 12%, transparent)"},variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},transition:{duration:.5},children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle, color-mix(in srgb, ${t.color} 20%, transparent) 0%,
                    color-mix(in srgb, ${t.color} 5%, transparent) 70%)
                  `,border:`2px solid color-mix(in srgb, ${t.color} 25%, transparent)`,boxShadow:`0 0 16px color-mix(in srgb, ${t.color} 20%, transparent)`},children:e.jsx(v,{Icon:y[t.icon],size:20,style:{color:t.color,filter:`drop-shadow(0 0 6px color-mix(in srgb, ${t.color} 35%, transparent))`}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold text-sm mb-1 text-white",children:t.title}),e.jsx("p",{className:"text-xs text-white/75 leading-relaxed",children:t.description})]})]},a))}),e.jsx(g.div,{className:"mt-6 pt-6 border-t border-white/10",initial:{opacity:0},animate:{opacity:1},transition:{delay:1,duration:.5},children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:"30%"}),e.jsx("div",{className:"text-xs text-white/60",children:"Économies moyennes"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:"50%"}),e.jsx("div",{className:"text-xs text-white/60",children:"Réduction gaspillage"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:"2h"}),e.jsx("div",{className:"text-xs text-white/60",children:"Temps gagné/semaine"})]})]})})]})})};function Je(r=768){const[t,a]=Y.useState(!1);return Y.useEffect(()=>{if(typeof window>"u")return;const s=window.matchMedia(`(max-width: ${r}px)`),i=o=>a(("matches"in o,o.matches));return i(s),"addEventListener"in s?s.addEventListener("change",i):s.addListener(i),()=>{"removeEventListener"in s?s.removeEventListener("change",i):s.removeListener(i)}},[r]),t}const Xe=({simulatedLoadingStep:r,simulatedScanProgress:t,loadingMessage:a})=>{const s=Je(),i=[{message:"Téléchargement des photos...",duration:3e3,icon:"Upload"},{message:"Analyse des ingrédients par la Forge...",duration:12e3,icon:"Zap"},{message:"Détection des aliments...",duration:8e3,icon:"Search"},{message:"Évaluation de la fraîcheur...",duration:6e3,icon:"Heart"},{message:"Normalisation des données...",duration:4e3,icon:"Settings"},{message:"Préparation de l'inventaire...",duration:3e3,icon:"Check"}];return e.jsx(g.div,{initial:{opacity:0,y:30,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.8,ease:[.25,.1,.25,1]},children:e.jsxs(M,{className:"p-8 text-center relative overflow-hidden",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-fridge-primary) 18%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, color-mix(in srgb, var(--brand-primary) 12%, transparent) 0%, transparent 70%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, var(--color-fridge-primary) 35%, transparent)",boxShadow:`
            0 25px 80px rgba(0, 0, 0, 0.4),
            0 0 60px color-mix(in srgb, var(--color-fridge-primary) 30%, transparent),
            0 0 120px color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent),
            inset 0 3px 0 rgba(255, 255, 255, 0.25),
            inset 0 -2px 0 rgba(0, 0, 0, 0.15)
          `,backdropFilter:"blur(32px) saturate(180%)",WebkitBackdropFilter:"blur(32px) saturate(180%)",minHeight:"400px"},children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20 fridge-grid-pulse",style:{background:`
              linear-gradient(90deg, transparent 0%, color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent) 1px, transparent 2px),
              linear-gradient(0deg, transparent 0%, color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent) 1px, transparent 2px)
            `,backgroundSize:"40px 40px"}}),e.jsx(g.div,{className:"absolute top-0 left-0 w-1 h-full pointer-events-none fridge-scan-analysis-line",style:{background:`linear-gradient(180deg, 
              transparent 0%, 
              color-mix(in srgb, var(--color-plasma-cyan) 80%, transparent) 30%, 
              color-mix(in srgb, var(--color-plasma-cyan) 100%, transparent) 50%, 
              color-mix(in srgb, var(--color-plasma-cyan) 80%, transparent) 70%, 
              transparent 100%
            )`,boxShadow:"0 0 20px color-mix(in srgb, var(--color-plasma-cyan) 80%, transparent)"}}),[...Array(8)].map((o,c)=>e.jsx(g.div,{className:"absolute w-2 h-2 rounded-full pointer-events-none fridge-data-particle",style:{background:c%2===0?"var(--color-fridge-primary)":"var(--color-plasma-cyan)",boxShadow:`0 0 12px ${c%2===0?"var(--color-fridge-primary)":"var(--color-plasma-cyan)"}`,left:`${15+c*12}%`,top:`${20+c%3*25}%`}},c)),e.jsxs("div",{className:"relative z-10 space-y-8",children:[e.jsx("div",{className:"relative",children:e.jsxs(g.div,{className:"w-32 h-32 mx-auto rounded-full flex items-center justify-center relative fridge-ai-focus",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3) 0%, transparent 60%),
                  radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--color-fridge-primary) 25%, transparent) 0%, transparent 50%),
                  linear-gradient(135deg, color-mix(in srgb, var(--color-fridge-primary) 50%, transparent), color-mix(in srgb, var(--color-plasma-cyan) 40%, transparent))
                `,border:"4px solid color-mix(in srgb, var(--color-fridge-primary) 80%, transparent)",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)"},children:[e.jsx(g.div,{animate:{rotate:[0,360],scale:[1,1.1,1]},transition:{duration:s?6:3,repeat:1/0,ease:"linear"},children:e.jsx(v,{Icon:y[i[r]?.icon]||y.Camera,size:56,style:{color:"var(--color-fridge-primary)",filter:`
                      drop-shadow(0 0 20px color-mix(in srgb, var(--color-fridge-primary) 90%, transparent))
                      drop-shadow(0 0 40px color-mix(in srgb, var(--color-fridge-primary) 70%, transparent))
                      drop-shadow(0 0 60px color-mix(in srgb, var(--color-plasma-cyan) 50%, transparent))
                    `},variant:"pure"})}),e.jsx(g.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:"color-mix(in srgb, var(--color-fridge-primary) 60%, transparent)"},animate:{scale:[1,1.4,1],opacity:[.8,0,.8]},transition:{duration:2,repeat:1/0,ease:"easeOut"}}),e.jsx(g.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:"color-mix(in srgb, var(--color-plasma-cyan) 50%, transparent)"},animate:{scale:[1,1.6,1],opacity:[.6,0,.6]},transition:{duration:2.5,repeat:1/0,ease:"easeOut",delay:.5}}),e.jsx(g.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:"color-mix(in srgb, var(--brand-primary) 40%, transparent)"},animate:{scale:[1,1.8,1],opacity:[.4,0,.4]},transition:{duration:3,repeat:1/0,ease:"easeOut",delay:1}})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-3xl font-bold text-white",style:{textShadow:"0 0 20px color-mix(in srgb, var(--color-fridge-primary) 60%, transparent)"},children:"Forge Spatiale Active"}),e.jsx("p",{className:"text-white/90 text-xl",children:i[r]?.message||a}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm text-white/70",children:[e.jsx("span",{children:"Progression de l'analyse"}),e.jsxs("span",{children:[Math.round(t),"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(g.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, 
                      var(--color-fridge-primary), 
                      var(--color-plasma-cyan), 
                      var(--brand-primary)
                    )`,boxShadow:`
                      0 0 16px color-mix(in srgb, var(--color-fridge-primary) 70%, transparent),
                      inset 0 1px 0 rgba(255,255,255,0.4)
                    `,width:`${t}%`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:.3,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full fridge-spatial-shimmer",style:{background:`linear-gradient(90deg, 
                        transparent 0%, 
                        rgba(255,255,255,0.6) 50%, 
                        transparent 100%
                      )`}})})})]})]}),e.jsxs("div",{className:"space-y-3 max-w-lg mx-auto",children:[e.jsxs("h4",{className:"text-white/80 font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(v,{Icon:y.Zap,size:16,style:{color:"var(--color-plasma-cyan)"}}),"Processus d'Analyse de la Forge"]}),e.jsx("div",{className:"space-y-2",children:i.map((o,c)=>{const d=c===r,l=c<r;return e.jsxs(g.div,{className:"flex items-center gap-3 p-3 rounded-xl transition-all duration-300",style:{background:d?"color-mix(in srgb, var(--color-fridge-primary) 15%, transparent)":l?"color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent)":"rgba(255, 255, 255, 0.05)",border:d?"2px solid color-mix(in srgb, var(--color-fridge-primary) 40%, transparent)":l?"1px solid color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent)":"1px solid rgba(255, 255, 255, 0.1)",boxShadow:d?"0 0 20px color-mix(in srgb, var(--color-fridge-primary) 30%, transparent)":"none"},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:c*.1},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:d?"color-mix(in srgb, var(--color-fridge-primary) 25%, transparent)":l?"color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent)":"rgba(255, 255, 255, 0.1)",border:d?"2px solid color-mix(in srgb, var(--color-fridge-primary) 50%, transparent)":l?"1px solid color-mix(in srgb, var(--color-plasma-cyan) 40%, transparent)":"1px solid rgba(255, 255, 255, 0.2)"},children:l?e.jsx(v,{Icon:y.Check,size:14,style:{color:"var(--color-plasma-cyan)"}}):d?e.jsx(g.div,{className:"w-3 h-3 rounded-full",style:{background:"var(--color-fridge-primary)"},animate:{scale:[1,1.3,1],opacity:[.8,1,.8]},transition:{duration:1,repeat:1/0}}):e.jsx("span",{className:"text-xs font-bold text-white/60",children:c+1})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("span",{className:`text-sm font-medium ${d?"text-white":l?"text-white/90":"text-white/60"}`,children:o.message})}),e.jsx(v,{Icon:y[o.icon],size:16,style:{color:d?"var(--color-fridge-primary)":l?"var(--color-plasma-cyan)":"rgba(255, 255, 255, 0.4)"}})]},c)})})]}),e.jsxs(g.div,{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)",backdropFilter:"blur(12px) saturate(140%)"},animate:{scale:[1,1.02,1],opacity:[.8,1,.8]},transition:{duration:2,repeat:1/0},children:[e.jsx(g.div,{className:"w-2 h-2 rounded-full",style:{background:"var(--color-plasma-cyan)"},animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1,repeat:1/0}}),e.jsx("span",{className:"text-cyan-300 text-sm font-medium",children:"Analyse de la Forge en cours... (~15-45 secondes)"})]})]})]})})},Qe=()=>e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsx(M,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent)",boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.2),
            0 0 20px color-mix(in srgb, var(--color-plasma-cyan) 12%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mt-1",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent)",border:"2px solid color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent)"},children:e.jsx(v,{Icon:y.Info,size:12,style:{color:"var(--color-plasma-cyan)"}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-cyan-300 font-semibold mb-2",children:"Que fait la Forge Spatiale ?"}),e.jsxs("div",{className:"space-y-2 text-sm text-cyan-200",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Vision de la Forge :"})," Détection précise des aliments et ingrédients"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Analyse Nutritionnelle :"})," Évaluation de la fraîcheur et des quantités"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Cartographie de la Forge :"})," Catégorisation et normalisation des données"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Préparation Recettes :"})," Optimisation pour la génération de recettes"]})]})]})]})})}),pe=({suggestedItems:r,onAddSelectedItems:t,onSelectionChange:a})=>{const[s,i]=j.useState(new Set),o=p=>{const u=new Set(s);u.has(p)?u.delete(p):u.add(p),i(u),a&&a(u.size>0)},c=()=>{const p=new Set(r.map((u,f)=>f));i(p),a&&a(p.size>0)},d=()=>{i(new Set),a&&a(!1)},l=()=>{const p=r.filter((u,f)=>s.has(f)).map(u=>({id:u.id,userId:u.userId,sessionId:u.sessionId,name:u.name,category:u.category,quantity:u.quantity,confidence:u.confidence,freshnessScore:u.freshnessScore,expiryDate:u.expiryDate,isUserEdited:!1,createdAt:u.createdAt,updatedAt:u.updatedAt}));t(p),i(new Set),a&&a(!1)},x=p=>{switch(p??"medium"){case"high":return"text-red-600 bg-red-50";case"medium":return"text-orange-600 bg-orange-50";case"low":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},_=p=>{switch(p??"medium"){case"high":return"Priorité haute";case"medium":return"Priorité moyenne";case"low":return"Priorité basse";default:return"Priorité inconnue"}};return r.length===0?null:e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 flex items-center justify-center",children:e.jsx(v,{Icon:y.Lightbulb,size:16,className:"text-blue-400",glowColor:"rgba(59, 130, 246, 0.6)"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Aliments complémentaires suggérés"})]}),e.jsx("p",{className:"text-sm text-white/70 mb-2",children:"Notre IA nutritionniste recommande ces aliments pour compléter votre inventaire"}),e.jsxs("p",{className:"text-sm text-white/60 mb-4",children:[s.size," / ",r.length," sélectionnés"]}),e.jsx("div",{className:"rounded-xl bg-black/20 p-3 mb-4 max-h-64 overflow-y-auto",style:{boxShadow:"inset 0 2px 8px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(255, 255, 255, 0.1)"},children:e.jsx("div",{className:"space-y-2",children:r.map((p,u)=>e.jsxs(M,{className:`no-scale-hover flex items-center gap-3 p-2 transition-all cursor-pointer ${s.has(u)?"ring-2 ring-blue-400/50 bg-blue-50/5":""}`,onClick:()=>o(u),children:[e.jsx("input",{type:"checkbox",checked:s.has(u),onChange:()=>o(u),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-xs font-medium text-white truncate",children:p.name}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full flex-shrink-0 ml-2 ${x(p.suggestionPriority)}`,children:_(p.suggestionPriority)})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xxs text-white/70 mb-1",children:[e.jsx("span",{className:"bg-white/10 px-2 py-1 rounded",children:p.category}),e.jsx("span",{children:p.quantity})]}),e.jsx("p",{className:"text-xxs text-white/60 leading-relaxed line-clamp-1",children:p.suggestionReason})]})]},p.id))})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("button",{onClick:c,className:"px-3 py-2 text-sm text-white/70 hover:text-white transition-colors bg-white/10 rounded-lg",children:"Tout sélectionner"}),e.jsx("button",{onClick:d,className:"px-3 py-2 text-sm text-white/70 hover:text-white transition-colors bg-white/10 rounded-lg",children:"Tout désélectionner"})]}),s.size>0&&e.jsx("div",{className:"w-full",children:e.jsxs("button",{onClick:l,className:"w-full btn-glass--primary px-4 py-3 text-sm font-medium",children:["Ajouter ",s.size," aliment",s.size>1?"s":""]})})]})},Ze=({userEditedInventory:r,suggestedComplementaryItems:t,addSelectedComplementaryItems:a,onContinueToValidation:s,onBackToPhoto:i})=>{const{click:o,success:c}=J(),{showToast:d}=X(),[l,x]=j.useState(!1),_=f=>{n.info("COMPLEMENT_STAGE","Adding selected complementary items",{selectedItemsCount:f.length,selectedItems:f.map(F=>({id:F.id,name:F.name,category:F.category,quantity:F.quantity})),timestamp:new Date().toISOString()}),a(f),c(),x(!1),d({type:"success",title:"Ingrédients ajoutés !",message:`${f.length} ingrédient${f.length>1?"s":""} ajouté${f.length>1?"s":""} à votre inventaire`,duration:3e3}),setTimeout(()=>{s()},1e3)},p=()=>{o(),n.info("COMPLEMENT_STAGE","User chose to continue to validation",{currentInventoryCount:r.length,suggestedItemsCount:t.length,hasUnaddedSelections:l,timestamp:new Date().toISOString()}),s()},u=()=>{o(),n.info("COMPLEMENT_STAGE","User chose to go back to photo capture",{timestamp:new Date().toISOString()}),i()};return e.jsx("div",{className:"glass-card p-6 space-y-6",style:{background:`
             radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 18%, transparent) 0%, transparent 60%),
             radial-gradient(circle at 70% 80%, color-mix(in srgb, #18E3FF 15%, transparent) 0%, transparent 50%),
             linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08)),
             rgba(11, 14, 23, 0.85)
           `,borderColor:"color-mix(in srgb, #EC4899 35%, transparent)",boxShadow:`
             0 16px 48px rgba(0, 0, 0, 0.3),
             0 0 36px color-mix(in srgb, #EC4899 25%, transparent),
             inset 0 2px 0 rgba(255, 255, 255, 0.18)
           `,backdropFilter:"blur(28px) saturate(160%)",WebkitBackdropFilter:"blur(28px) saturate(160%)"},children:e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4,ease:[.4,0,.2,1]},className:"space-y-6",children:[e.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1},className:"glass-card p-5",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #A78BFA 18%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #8B5CF6 15%, transparent) 0%, transparent 50%),
              rgba(255, 255, 255, 0.06)
            `,borderColor:"color-mix(in srgb, #8B5CF6 35%, transparent)",boxShadow:`
              0 8px 24px rgba(0, 0, 0, 0.2),
              0 0 24px color-mix(in srgb, #8B5CF6 20%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.15)
            `,backdropFilter:"blur(20px) saturate(150%)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(g.div,{className:"flex-shrink-0",animate:{scale:[1,1.05,1],boxShadow:["0 0 20px rgba(147, 51, 234, 0.3)","0 0 28px rgba(147, 51, 234, 0.5)","0 0 20px rgba(147, 51, 234, 0.3)"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},children:e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(147, 51, 234, 0.25) 0%, rgba(168, 85, 247, 0.35) 100%)",border:"2px solid rgba(147, 51, 234, 0.5)",boxShadow:"0 0 24px rgba(147, 51, 234, 0.4), inset 0 2px 0 rgba(255, 255, 255, 0.2)",backdropFilter:"blur(12px)"},children:e.jsx(v,{Icon:y.AlertCircle,size:22,className:"text-purple-300"})})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Inventaire Insuffisant Détecté"}),e.jsxs("p",{className:"text-sm text-gray-200 leading-relaxed",children:["Votre frigo contient seulement ",e.jsxs("span",{className:"font-bold text-purple-300",children:[r.length," ingrédient",r.length>1?"s":""]}),"."]}),e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed",children:"Pour optimiser vos possibilités culinaires, nous vous suggérons d'ajouter quelques ingrédients complémentaires."})]})]})}),t.length>0&&e.jsx(pe,{suggestedItems:t,onAddSelectedItems:_,onSelectionChange:x}),e.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("button",{onClick:p,className:"flex-1 px-7 py-4 rounded-2xl font-semibold text-base transition-all duration-300 group",style:{background:`
                linear-gradient(135deg,
                  color-mix(in srgb, #EC4899 75%, transparent),
                  color-mix(in srgb, #F472B6 60%, transparent)
                )
              `,border:"2px solid color-mix(in srgb, #EC4899 60%, transparent)",boxShadow:`
                0 8px 24px color-mix(in srgb, #EC4899 40%, transparent),
                0 0 32px color-mix(in srgb, #EC4899 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.4)
              `,color:"white"},onMouseEnter:f=>{window.matchMedia("(hover: hover)").matches&&(f.currentTarget.style.transform="translateY(-2px) scale(1.02)",f.currentTarget.style.boxShadow=`
                  0 12px 32px color-mix(in srgb, #EC4899 55%, transparent),
                  0 0 40px color-mix(in srgb, #EC4899 35%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.5)
                `)},onMouseLeave:f=>{window.matchMedia("(hover: hover)").matches&&(f.currentTarget.style.transform="translateY(0) scale(1)",f.currentTarget.style.boxShadow=`
                  0 8px 24px color-mix(in srgb, #EC4899 40%, transparent),
                  0 0 32px color-mix(in srgb, #EC4899 25%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.4)
                `)},children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(v,{Icon:y.ArrowRight,size:22}),e.jsx("span",{children:"Continuer la Validation"})]})}),e.jsx("button",{onClick:u,className:"flex-1 px-7 py-4 rounded-2xl font-semibold text-base transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",backdropFilter:"blur(16px)",color:"white"},onMouseEnter:f=>{window.matchMedia("(hover: hover)").matches&&(f.currentTarget.style.transform="translateY(-2px)",f.currentTarget.style.background="rgba(255, 255, 255, 0.12)",f.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)")},onMouseLeave:f=>{window.matchMedia("(hover: hover)").matches&&(f.currentTarget.style.transform="translateY(0)",f.currentTarget.style.background="rgba(255, 255, 255, 0.08)",f.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)")},children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(v,{Icon:y.Camera,size:22}),e.jsx("span",{children:"Reprendre des Photos"})]})})]}),l&&e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-sm text-orange-300 bg-orange-500/10 border border-orange-500/20 rounded-lg px-4 py-2",children:'💡 Vous avez sélectionné des aliments mais ne les avez pas encore ajoutés. Cliquez sur "Ajouter X aliments" ou continuez sans les ajouter.'})}),e.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.4},className:"glass-card p-5",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #18E3FF 18%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #06B6D4 15%, transparent) 0%, transparent 50%),
              rgba(255, 255, 255, 0.06)
            `,borderColor:"color-mix(in srgb, #18E3FF 35%, transparent)",boxShadow:`
              0 8px 24px rgba(0, 0, 0, 0.2),
              0 0 24px color-mix(in srgb, #18E3FF 20%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.15)
            `,backdropFilter:"blur(20px) saturate(150%)"},children:e.jsxs("div",{className:"grid grid-cols-2 gap-6 text-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g.div,{className:"text-4xl font-bold",style:{color:"#A78BFA",textShadow:"0 0 16px rgba(167, 139, 250, 0.5)"},animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:r.length}),e.jsx("div",{className:"text-sm font-medium text-gray-300",children:"Ingrédients détectés"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g.div,{className:"text-4xl font-bold",style:{color:"#18E3FF",textShadow:"0 0 16px rgba(24, 227, 255, 0.5)"},animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut",delay:.5},children:t.length}),e.jsx("div",{className:"text-sm font-medium text-gray-300",children:"Suggestions disponibles"})]})]})})]})})},qe=({inventoryCount:r,searchFilter:t,setSearchFilter:a,onAddCustomItem:s})=>e.jsxs(M,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-plasma-cyan) 12%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, var(--color-plasma-cyan) 35%, transparent), color-mix(in srgb, var(--color-fridge-primary) 25%, transparent))
              `,border:"2px solid color-mix(in srgb, var(--color-plasma-cyan) 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent)"},children:e.jsx(v,{Icon:y.Edit,size:20,style:{color:"var(--color-plasma-cyan)"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Vérifier l'Inventaire"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[r," ingrédient",r>1?"s":""," détecté",r>1?"s":""]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:s,className:"btn-glass px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{Icon:y.Plus,size:14}),e.jsx("span",{children:"Ajouter"})]})})})]}),e.jsx("div",{className:"relative mb-4",children:e.jsx("input",{type:"text",placeholder:"Rechercher un ingrédient...",value:t,onChange:i=>a(i.target.value),className:"glass-input w-full"})})]}),et=({item:r,index:t,isEditing:a,onEdit:s,onRemove:i,onStartEdit:o,onStopEdit:c})=>{const l=(x=>({Légumes:"#22C55E",Fruits:"#F59E0B",Viandes:"#EF4444",Poissons:"#06B6D4","Produits laitiers":"#8B5CF6",Céréales:"#D97706",Épices:"#EC4899",Autre:"#6B7280"})[x]||"#6B7280")(r.category);return e.jsx(g.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.35,delay:t*.04,ease:[.4,0,.2,1]},className:"group",children:e.jsx(M,{className:"p-4",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${l} 8%, transparent) 0%, transparent 60%),
            rgba(255, 255, 255, 0.06)
          `,borderColor:`color-mix(in srgb, ${l} 25%, transparent)`,boxShadow:`
            0 4px 16px rgba(0, 0, 0, 0.2),
            0 0 16px color-mix(in srgb, ${l} 15%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `,backdropFilter:"blur(20px) saturate(150%)",WebkitBackdropFilter:"blur(20px) saturate(150%)",transition:"all 0.3s ease"},onMouseEnter:x=>{window.matchMedia("(hover: hover)").matches&&(x.currentTarget.style.transform="translateY(-3px) scale(1.01)",x.currentTarget.style.boxShadow=`
              0 8px 24px rgba(0, 0, 0, 0.3),
              0 0 24px color-mix(in srgb, ${l} 25%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.18)
            `,x.currentTarget.style.borderColor=`color-mix(in srgb, ${l} 40%, transparent)`)},onMouseLeave:x=>{window.matchMedia("(hover: hover)").matches&&(x.currentTarget.style.transform="translateY(0) scale(1)",x.currentTarget.style.boxShadow=`
              0 4px 16px rgba(0, 0, 0, 0.2),
              0 0 16px color-mix(in srgb, ${l} 15%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.12)
            `,x.currentTarget.style.borderColor=`color-mix(in srgb, ${l} 25%, transparent)`)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g.div,{className:"flex-shrink-0",whileHover:{scale:1.1,rotate:5},transition:{type:"spring",stiffness:400,damping:17},children:e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.15) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${l} 30%, transparent), color-mix(in srgb, ${l} 20%, transparent))
                `,border:`2px solid color-mix(in srgb, ${l} 50%, transparent)`,boxShadow:`
                  0 0 20px color-mix(in srgb, ${l} 30%, transparent),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2)
                `},children:e.jsx(v,{Icon:y.Utensils,size:22,style:{color:l,filter:`drop-shadow(0 0 8px ${l})`}})})}),e.jsx("div",{className:"flex-1 min-w-0",children:a?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:r.name,onChange:x=>s(r.id,"name",x.target.value),className:"w-full bg-white/10 border-2 border-white/20 rounded-xl px-4 py-2.5 text-white text-base font-medium outline-none focus:border-pink-400/50 focus:bg-white/15 transition-all",placeholder:"Nom de l'ingrédient",autoFocus:!0,style:{backdropFilter:"blur(12px)"}}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",value:r.quantity,onChange:x=>s(r.id,"quantity",x.target.value),className:"w-full bg-white/10 border-2 border-white/20 rounded-xl px-4 py-2.5 text-white text-sm font-medium outline-none focus:border-pink-400/50 focus:bg-white/15 transition-all",placeholder:"Quantité",style:{backdropFilter:"blur(12px)"}}),e.jsxs("select",{value:r.category,onChange:x=>s(r.id,"category",x.target.value),className:"w-full bg-white/10 border-2 border-white/20 rounded-xl px-4 py-2.5 text-white text-sm font-medium outline-none focus:border-pink-400/50 focus:bg-white/15 transition-all",style:{backdropFilter:"blur(12px)"},children:[e.jsx("option",{value:"Légumes",children:"Légumes"}),e.jsx("option",{value:"Fruits",children:"Fruits"}),e.jsx("option",{value:"Viandes",children:"Viandes"}),e.jsx("option",{value:"Poissons",children:"Poissons"}),e.jsx("option",{value:"Produits laitiers",children:"Produits laitiers"}),e.jsx("option",{value:"Céréales",children:"Céréales"}),e.jsx("option",{value:"Épices",children:"Épices"}),e.jsx("option",{value:"Autre",children:"Autre"})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-white font-bold text-lg truncate",style:{textShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r.name}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-white/80 text-sm font-medium",children:r.quantity}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold",style:{background:`color-mix(in srgb, ${l} 18%, transparent)`,color:l,border:`1.5px solid color-mix(in srgb, ${l} 35%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${l} 20%, transparent)`},children:r.category}),r.confidence<.7&&e.jsxs("span",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-orange-500/15 border border-orange-400/30 text-orange-300 text-xs font-medium",children:[e.jsx(v,{Icon:y.AlertTriangle,size:12}),"Incertain"]})]})]})}),e.jsx("div",{className:"flex items-center gap-2 ml-2",children:a?e.jsx(g.button,{onClick:c,className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(34, 197, 94, 0.25), rgba(34, 197, 94, 0.15))",border:"2px solid rgba(34, 197, 94, 0.4)",boxShadow:"0 0 16px rgba(34, 197, 94, 0.3)",backdropFilter:"blur(12px)"},whileHover:{scale:1.1},whileTap:{scale:.95},"aria-label":"Valider",children:e.jsx(v,{Icon:y.Check,size:18,className:"text-green-400"})}):e.jsxs(e.Fragment,{children:[e.jsx(g.button,{onClick:()=>o(r.id),className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.18)",backdropFilter:"blur(12px)"},whileHover:{scale:1.08,backgroundColor:"rgba(255, 255, 255, 0.12)",borderColor:"rgba(255, 255, 255, 0.3)"},whileTap:{scale:.95},"aria-label":"Modifier",children:e.jsx(v,{Icon:y.Edit,size:16,className:"text-white/90"})}),e.jsx(g.button,{onClick:()=>i(r.id),className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(239, 68, 68, 0.15)",border:"2px solid rgba(239, 68, 68, 0.3)",backdropFilter:"blur(12px)"},whileHover:{scale:1.08,backgroundColor:"rgba(239, 68, 68, 0.25)",borderColor:"rgba(239, 68, 68, 0.5)",boxShadow:"0 0 16px rgba(239, 68, 68, 0.4)"},whileTap:{scale:.95},"aria-label":"Supprimer",children:e.jsx(v,{Icon:y.Trash2,size:16,className:"text-red-400"})})]})})]})})})},tt=({userEditedInventory:r,onBack:t,handleManualExit:a,onValidateInventory:s})=>{const{click:i}=J(),{showToast:o}=X(),c=ne(),{currentSessionId:d}=de(),{selectInventory:l,loadAvailableInventories:x}=he(),[_,p]=j.useState(!1),u=()=>{s(),p(!0)},f=async()=>{try{n.info("REVIEW_EDIT_ACTIONS","Starting meal plan generation",{inventoryCount:r.length,timestamp:new Date().toISOString()}),d&&l(d),c("/fridge#plan")}catch(m){n.error("REVIEW_EDIT_ACTIONS","Meal plan generation failed",{error:m instanceof Error?m.message:"Unknown error",inventoryCount:r.length,timestamp:new Date().toISOString()}),o({type:"error",title:"Erreur de Navigation",message:"Impossible d'accéder à l'onglet plan. Veuillez réessayer.",duration:4e3})}},F=async()=>{try{n.info("REVIEW_EDIT_ACTIONS","Starting recipe generation",{inventoryCount:r.length,timestamp:new Date().toISOString()}),d&&l(d),c("/fridge#recipes")}catch(m){n.error("REVIEW_EDIT_ACTIONS","Recipe generation failed",{error:m instanceof Error?m.message:"Unknown error",inventoryCount:r.length,timestamp:new Date().toISOString()}),o({type:"error",title:"Erreur de Navigation",message:"Impossible d'accéder à l'onglet recettes. Veuillez réessayer.",duration:4e3})}};return e.jsx(ie,{mode:"wait",children:_?e.jsx(g.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.5,ease:[.4,0,.2,1]},children:e.jsx(M,{className:"p-8 text-center w-full",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 20%, transparent) 0%, transparent 60%),
                radial-gradient(circle at 70% 80%, color-mix(in srgb, #8B5CF6 18%, transparent) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, color-mix(in srgb, #F472B6 15%, transparent) 0%, transparent 70%),
                linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.10)),
                rgba(11, 14, 23, 0.85)
              `,borderColor:"color-mix(in srgb, #EC4899 45%, transparent)",boxShadow:`
                0 20px 60px rgba(0, 0, 0, 0.35),
                0 0 40px color-mix(in srgb, #EC4899 30%, transparent),
                0 0 80px color-mix(in srgb, #8B5CF6 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.2)
              `,backdropFilter:"blur(32px) saturate(170%)",WebkitBackdropFilter:"blur(32px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(g.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15},children:e.jsx(g.div,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.35) 0%, transparent 60%),
                      radial-gradient(circle at 70% 70%, color-mix(in srgb, #8B5CF6 30%, transparent) 0%, transparent 50%),
                      linear-gradient(135deg, color-mix(in srgb, #EC4899 55%, transparent), color-mix(in srgb, #8B5CF6 45%, transparent))
                    `,border:"3px solid color-mix(in srgb, #EC4899 70%, transparent)",boxShadow:`
                      0 0 40px color-mix(in srgb, #EC4899 60%, transparent),
                      0 0 80px color-mix(in srgb, #8B5CF6 40%, transparent),
                      inset 0 3px 0 rgba(255,255,255,0.5)
                    `},animate:{scale:[1,1.05,1],boxShadow:["0 0 40px color-mix(in srgb, #EC4899 60%, transparent), 0 0 80px color-mix(in srgb, #8B5CF6 40%, transparent)","0 0 50px color-mix(in srgb, #EC4899 75%, transparent), 0 0 100px color-mix(in srgb, #8B5CF6 55%, transparent)","0 0 40px color-mix(in srgb, #EC4899 60%, transparent), 0 0 80px color-mix(in srgb, #8B5CF6 40%, transparent)"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},children:e.jsx(v,{Icon:y.Sparkles,size:36,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})})}),e.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsx("h4",{className:"text-2xl font-bold text-white mb-3",style:{textShadow:"0 0 20px color-mix(in srgb, #EC4899 50%, transparent)"},children:"Générer vos Recettes"}),e.jsx("p",{className:"text-white/85 text-base leading-relaxed max-w-lg mx-auto",children:"Inventaire validé avec succès ! Choisissez votre prochaine étape pour exploiter vos ingrédients."})]}),e.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex flex-col sm:flex-row gap-4 justify-center max-w-2xl mx-auto",children:[e.jsx("button",{onClick:()=>{i(),f()},className:"relative overflow-hidden px-8 py-4 text-base font-bold rounded-2xl transition-all duration-300 group flex-1",style:{background:`
                      linear-gradient(135deg,
                        color-mix(in srgb, #EC4899 85%, transparent),
                        color-mix(in srgb, #F472B6 70%, transparent)
                      )
                    `,border:"2.5px solid color-mix(in srgb, #EC4899 70%, transparent)",boxShadow:`
                      0 12px 40px color-mix(in srgb, #EC4899 50%, transparent),
                      0 0 60px color-mix(in srgb, #EC4899 35%, transparent),
                      inset 0 3px 0 rgba(255,255,255,0.5)
                    `,color:"white"},onMouseEnter:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(-3px) scale(1.02)",m.currentTarget.style.boxShadow=`
                        0 16px 50px color-mix(in srgb, #EC4899 65%, transparent),
                        0 0 80px color-mix(in srgb, #EC4899 50%, transparent),
                        inset 0 3px 0 rgba(255,255,255,0.6)
                      `)},onMouseLeave:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(0) scale(1)",m.currentTarget.style.boxShadow=`
                        0 12px 40px color-mix(in srgb, #EC4899 50%, transparent),
                        0 0 60px color-mix(in srgb, #EC4899 35%, transparent),
                        inset 0 3px 0 rgba(255,255,255,0.5)
                      `)},children:e.jsxs("div",{className:"flex items-center justify-center gap-2.5 relative z-10",children:[e.jsx(v,{Icon:y.Calendar,size:20,color:"white",variant:"pure"}),e.jsx("span",{children:"Plan Repas"})]})}),e.jsx("button",{onClick:()=>{i(),F()},className:"relative overflow-hidden px-8 py-4 text-base font-bold rounded-2xl transition-all duration-300 group flex-1",style:{background:`
                      linear-gradient(135deg,
                        color-mix(in srgb, #8B5CF6 85%, transparent),
                        color-mix(in srgb, #A78BFA 70%, transparent)
                      )
                    `,border:"2.5px solid color-mix(in srgb, #8B5CF6 70%, transparent)",boxShadow:`
                      0 12px 40px color-mix(in srgb, #8B5CF6 50%, transparent),
                      0 0 60px color-mix(in srgb, #8B5CF6 35%, transparent),
                      inset 0 3px 0 rgba(255,255,255,0.5)
                    `,color:"white"},onMouseEnter:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(-3px) scale(1.02)",m.currentTarget.style.boxShadow=`
                        0 16px 50px color-mix(in srgb, #8B5CF6 65%, transparent),
                        0 0 80px color-mix(in srgb, #8B5CF6 50%, transparent),
                        inset 0 3px 0 rgba(255,255,255,0.6)
                      `)},onMouseLeave:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(0) scale(1)",m.currentTarget.style.boxShadow=`
                        0 12px 40px color-mix(in srgb, #8B5CF6 50%, transparent),
                        0 0 60px color-mix(in srgb, #8B5CF6 35%, transparent),
                        inset 0 3px 0 rgba(255,255,255,0.5)
                      `)},children:e.jsxs("div",{className:"flex items-center justify-center gap-2.5 relative z-10",children:[e.jsx(v,{Icon:y.Sparkles,size:20,color:"white",variant:"pure"}),e.jsx("span",{children:"Recettes"})]})}),e.jsx("button",{onClick:()=>{i(),c("/")},className:"px-8 py-4 rounded-2xl font-semibold text-base transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",backdropFilter:"blur(16px)",color:"white"},onMouseEnter:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(-2px)",m.currentTarget.style.background="rgba(255, 255, 255, 0.12)",m.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)")},onMouseLeave:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(0)",m.currentTarget.style.background="rgba(255, 255, 255, 0.08)",m.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)")},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(v,{Icon:y.Home,size:18}),e.jsx("span",{children:"Tableau de bord"})]})})]})]})})},"validated-state"):e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4,ease:[.4,0,.2,1]},className:"space-y-4",children:[e.jsx(M,{className:"p-8 text-center w-full",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 18%, transparent) 0%, transparent 60%),
                radial-gradient(circle at 70% 80%, color-mix(in srgb, #F472B6 15%, transparent) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, color-mix(in srgb, #DB2777 12%, transparent) 0%, transparent 70%),
                linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.10)),
                rgba(11, 14, 23, 0.85)
              `,borderColor:"color-mix(in srgb, #EC4899 40%, transparent)",boxShadow:`
                0 16px 48px rgba(0, 0, 0, 0.3),
                0 0 36px color-mix(in srgb, #EC4899 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.18)
              `,backdropFilter:"blur(28px) saturate(160%)",WebkitBackdropFilter:"blur(28px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(g.div,{className:"relative inline-block",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.1},children:e.jsxs(g.div,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.35) 0%, transparent 60%),
                      radial-gradient(circle at 70% 70%, color-mix(in srgb, #EC4899 30%, transparent) 0%, transparent 50%),
                      linear-gradient(135deg, color-mix(in srgb, #EC4899 55%, transparent), color-mix(in srgb, #F472B6 45%, transparent))
                    `,border:"3px solid color-mix(in srgb, #EC4899 70%, transparent)",boxShadow:`
                      0 0 40px color-mix(in srgb, #EC4899 60%, transparent),
                      inset 0 3px 0 rgba(255,255,255,0.5)
                    `},animate:{scale:[1,1.05,1],boxShadow:["0 0 40px color-mix(in srgb, #EC4899 60%, transparent)","0 0 50px color-mix(in srgb, #EC4899 75%, transparent)","0 0 40px color-mix(in srgb, #EC4899 60%, transparent)"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},children:[e.jsx(v,{Icon:y.Check,size:36,color:"rgba(255, 255, 255, 0.95)",variant:"pure"}),e.jsx(g.div,{className:"absolute inset-0 rounded-full border-2",style:{borderColor:"color-mix(in srgb, #EC4899 65%, transparent)"},animate:{scale:[1,1.5,1.5],opacity:[.8,0,0]},transition:{duration:2,repeat:1/0,ease:"easeOut"}})]})}),e.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},children:[e.jsx("h4",{className:"text-2xl font-bold text-white mb-3",style:{textShadow:"0 0 20px color-mix(in srgb, #EC4899 50%, transparent)"},children:"Valider votre inventaire"}),e.jsxs("p",{className:"text-white/85 text-base leading-relaxed max-w-lg mx-auto",children:[e.jsxs("span",{className:"font-bold text-pink-300",children:[r.length," ingrédient",r.length>1?"s":""]})," prêt",r.length>1?"s":""," à être validé",r.length>1?"s":"",". Confirmez pour continuer vers la génération."]})]}),e.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.3},children:e.jsxs("button",{onClick:()=>{i(),u()},disabled:r.length===0,className:"relative overflow-hidden px-10 py-4 text-lg font-bold rounded-2xl transition-all duration-300 group",style:{background:`
                      linear-gradient(135deg,
                        color-mix(in srgb, #EC4899 90%, transparent),
                        color-mix(in srgb, #F472B6 75%, transparent),
                        color-mix(in srgb, #DB2777 65%, transparent)
                      )
                    `,border:"3px solid color-mix(in srgb, #EC4899 75%, transparent)",boxShadow:`
                      0 18px 60px color-mix(in srgb, #EC4899 60%, transparent),
                      0 0 100px color-mix(in srgb, #EC4899 50%, transparent),
                      inset 0 5px 0 rgba(255,255,255,0.6)
                    `,color:"white"},onMouseEnter:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(-3px) scale(1.03)",m.currentTarget.style.boxShadow=`
                        0 24px 80px color-mix(in srgb, #EC4899 75%, transparent),
                        0 0 130px color-mix(in srgb, #EC4899 65%, transparent),
                        inset 0 5px 0 rgba(255,255,255,0.7)
                      `)},onMouseLeave:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(0) scale(1)",m.currentTarget.style.boxShadow=`
                        0 18px 60px color-mix(in srgb, #EC4899 60%, transparent),
                        0 0 100px color-mix(in srgb, #EC4899 50%, transparent),
                        inset 0 5px 0 rgba(255,255,255,0.6)
                      `)},children:[e.jsx(g.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{background:"linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.45) 50%, transparent 100%)"},animate:{x:["-200%","200%"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"}}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx(v,{Icon:y.Check,size:22,color:"white",variant:"pure"}),e.jsx("span",{children:"Valider l'inventaire"})]})]})}),e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-full",style:{background:"color-mix(in srgb, #EC4899 18%, transparent)",border:"2px solid color-mix(in srgb, #EC4899 35%, transparent)",backdropFilter:"blur(18px) saturate(150%)"},children:[e.jsx(v,{Icon:y.Package,size:16,className:"text-pink-300"}),e.jsxs("span",{className:"text-pink-200 text-sm font-semibold",children:[r.length," ingrédient",r.length>1?"s":""," en attente"]})]})]})}),e.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.35},className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsx("button",{onClick:t,className:"px-7 py-4 rounded-2xl font-semibold text-base transition-all duration-300 flex-1",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",backdropFilter:"blur(16px)",color:"white"},onMouseEnter:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(-2px)",m.currentTarget.style.background="rgba(255, 255, 255, 0.12)",m.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)")},onMouseLeave:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(0)",m.currentTarget.style.background="rgba(255, 255, 255, 0.08)",m.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)")},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(v,{Icon:y.ArrowLeft,size:18}),e.jsx("span",{children:"Retour"})]})}),e.jsx("button",{onClick:()=>{i(),a()},className:"px-7 py-4 rounded-2xl font-semibold text-base transition-all duration-300 flex-1",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",backdropFilter:"blur(16px)",color:"white"},onMouseEnter:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(-2px)",m.currentTarget.style.background="rgba(255, 255, 255, 0.12)",m.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)")},onMouseLeave:m=>{window.matchMedia("(hover: hover)").matches&&(m.currentTarget.style.transform="translateY(0)",m.currentTarget.style.background="rgba(255, 255, 255, 0.08)",m.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)")},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(v,{Icon:y.X,size:18}),e.jsx("span",{children:"Quitter l'Atelier"})]})})]})]},"validation-state")})},rt=({rawDetectedItems:r,userEditedInventory:t,suggestedComplementaryItems:a,addSelectedComplementaryItems:s,onInventoryUpdate:i,onContinue:o,onBack:c,isLoading:d,handleManualExit:l})=>{const[x,_]=j.useState(null),[p,u]=j.useState(""),[f,F]=j.useState(!1),[m,h]=j.useState(!1),{click:S}=J(),{showToast:E}=X(),{saveRecipeSession:G}=de(),Q=async()=>{try{h(!0),n.info("REVIEW_EDIT_STAGE","Starting inventory validation",{inventoryCount:T.length,timestamp:new Date().toISOString()}),await G(),F(!0),E({type:"success",title:"Inventaire Validé",message:"Votre inventaire a été sauvegardé avec succès",duration:3e3}),n.info("REVIEW_EDIT_STAGE","Inventory validated successfully",{inventoryCount:T.length,timestamp:new Date().toISOString()})}catch(w){n.error("REVIEW_EDIT_STAGE","Failed to validate inventory",{error:w instanceof Error?w.message:"Unknown error",inventoryCount:T.length,timestamp:new Date().toISOString()}),E({type:"error",title:"Erreur de Validation",message:"Impossible de valider l'inventaire. Veuillez réessayer.",duration:4e3})}finally{h(!1)}},T=Array.isArray(t)?t:[];j.useEffect(()=>{if(T.length===0&&r.length>0){n.info("REVIEW_EDIT_STAGE","Initializing inventory from detected items",{rawItemsCount:r.length,timestamp:new Date().toISOString()});const w=r.map((I,z)=>({id:`item-${z}`,userId:"",sessionId:"",name:I.label||I.name||"Ingrédient inconnu",category:I.category||"Autre",quantity:I.estimatedQuantity||I.quantity||"1",confidence:I.confidence||.8,freshnessScore:I.freshnessScore||85,expiryDate:I.expiryDate,photoUrl:I.photoUrl,isUserEdited:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}));i(w),n.debug("REVIEW_EDIT_STAGE","Initial inventory created",{inventoryCount:w.length,categories:[...new Set(w.map(I=>I.category))],timestamp:new Date().toISOString()})}},[r,T.length,i]);const R=T.filter(w=>w.name.toLowerCase().includes(p.toLowerCase())||w.category.toLowerCase().includes(p.toLowerCase())),H=(w,I,z)=>{n.debug("REVIEW_EDIT_STAGE","Item edited by user",{itemId:w,field:I,newValue:z,timestamp:new Date().toISOString()});const k=T.map(O=>O.id===w?{...O,[I]:z,isUserEdited:!0,updatedAt:new Date().toISOString()}:O);i(k)},re=w=>{const I=T.find(k=>k.id===w);n.info("REVIEW_EDIT_STAGE","Item removed by user",{itemId:w,itemName:I?.name,itemCategory:I?.category,timestamp:new Date().toISOString()});const z=T.filter(k=>k.id!==w);i(z),E({type:"success",title:"Ingrédient supprimé",message:"L'ingrédient a été retiré de votre inventaire",duration:2e3})},Z=()=>{n.info("REVIEW_EDIT_STAGE","Custom item added by user",{currentInventoryCount:T.length,timestamp:new Date().toISOString()});const w={id:`custom-${Date.now()}`,userId:"",sessionId:"",name:"Nouvel ingrédient",category:"Autre",quantity:"1",confidence:1,freshnessScore:90,isUserEdited:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};i([...T,w]),_(w.id),E({type:"success",title:"Ingrédient ajouté",message:"Nouvel ingrédient ajouté à votre inventaire",duration:2e3})},oe=w=>{n.info("REVIEW_EDIT_STAGE","Adding selected complementary items",{itemsCount:w.length,itemNames:w.map(I=>I.name),timestamp:new Date().toISOString()}),s(w),E({type:"success",title:"Ingrédients ajoutés",message:`${w.length} ingrédient${w.length>1?"s":""} ajouté${w.length>1?"s":""} à votre inventaire`,duration:3e3})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(qe,{inventoryCount:R.length,searchFilter:p,setSearchFilter:u,onAddCustomItem:Z}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(ie,{children:R.map((w,I)=>e.jsx(et,{item:w,index:I,isEditing:x===w.id,onEdit:H,onRemove:re,onStartEdit:_,onStopEdit:()=>_(null)},w.id))})}),a&&a.length>0&&e.jsxs("details",{className:"glass-card",children:[e.jsxs("summary",{className:"cursor-pointer p-4 flex items-center gap-3 hover:bg-white/5 transition-colors",children:[e.jsx(v,{Icon:y.ChevronDown,size:16,className:"text-blue-400 transition-transform"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{Icon:y.Lightbulb,size:16,className:"text-blue-400"}),e.jsx("span",{className:"text-white font-medium",children:"Suggestions complémentaires (cliquez pour voir)"})]}),e.jsxs("span",{className:"text-sm text-white/70 ml-auto",children:[a.length," suggestion",a.length>1?"s":""]})]}),e.jsx("div",{className:"p-4 pt-0",children:e.jsx(pe,{suggestedItems:a,onAddSelectedItems:oe})})]}),e.jsx(tt,{userEditedInventory:T,onBack:c,handleManualExit:l,onValidateInventory:Q})]})},wt=({currentStep:r,capturedPhotos:t,simulatedLoadingStep:a,simulatedScanProgress:s,loadingMessage:i,userEditedInventory:o,suggestedComplementaryItems:c,rawDetectedItems:d,profileCompletion:l,nudgeDismissed:x,onCameraCapture:_,onFileUpload:p,onRemovePhoto:u,onAnalyzePhotos:f,onInventoryUpdate:F,onContinueToValidation:m,onBackToPhoto:h,onBack:S,onNudgeDismiss:E,addSelectedComplementaryItems:G,goToStep:Q,previousStep:T,handleManualExit:R})=>{const H=()=>{switch(r){case"photo":return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{onCameraCapture:_,onFileUpload:p,fileInputRef:Y.createRef()}),t.length>0&&e.jsx(Ue,{capturedPhotos:t,onRemovePhoto:u}),t.length>0&&e.jsx(Ye,{capturedPhotosCount:t.length,onAnalyzePhotos:f}),l&&!l.isSufficient&&!x&&e.jsx(be,{completion:l,variant:"card",onDismiss:E,showDismiss:!0}),e.jsx(Ke,{})]});case"analyze":return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Xe,{simulatedLoadingStep:a,simulatedScanProgress:s,loadingMessage:i}),e.jsx(Qe,{})]});case"complement":return e.jsx(Ze,{userEditedInventory:o,suggestedComplementaryItems:c,addSelectedComplementaryItems:G,onContinueToValidation:m,onBackToPhoto:h});case"validation":return e.jsx(rt,{rawDetectedItems:d,userEditedInventory:o,suggestedComplementaryItems:c,addSelectedComplementaryItems:G,onInventoryUpdate:F,onContinue:()=>{},onBack:S,isLoading:!1,handleManualExit:R});case"recipes":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Génération des recettes en cours..."}),e.jsx("p",{className:"text-gray-600",children:"Cette fonctionnalité sera bientôt disponible."})]})});default:return e.jsx("div",{className:"space-y-6",children:e.jsx(ce,{onCameraCapture:_,onFileUpload:p,fileInputRef:Y.createRef()})})}};return e.jsx("div",{className:"fridge-scan-stage-container",children:H()})};export{ft as F,we as _,K as a,ut as b,gt as c,xt as d,pt as e,mt as f,ht as g,bt as h,yt as i,vt as j,wt as k,dt as u,W as w};
