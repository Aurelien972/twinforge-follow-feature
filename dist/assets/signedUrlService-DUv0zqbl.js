import{l as t,s as l}from"./page-fridge-Cp-W9isk.js";const E=new Map,c=3600,d=5*60*1e3;typeof window<"u"&&setInterval(()=>{g()},d);function g(){const r=Date.now();let e=0;for(const[s,n]of E.entries())n.expiresAt<r&&(E.delete(s),e++);e>0&&t.debug("SIGNED_URL_SERVICE",`Cleaned up ${e} expired URLs from cache`)}function a(r,e){return`${r}:${e}`}function U(r,e){const s=a(r,e),n=E.get(s);if(!n)return null;const o=Date.now(),i=5*60*1e3;return n.expiresAt-i<o?(E.delete(s),null):(t.debug("SIGNED_URL_SERVICE","Using cached signed URL",{bucket:r,path:e,expiresIn:Math.round((n.expiresAt-o)/1e3)+"s"}),n.url)}function R(r,e,s,n){const o=a(r,e),i=Date.now()+n*1e3;E.set(o,{url:s,expiresAt:i}),t.debug("SIGNED_URL_SERVICE","Cached signed URL",{bucket:r,path:e,expiresIn:n+"s"})}async function f(r,e,s=c){try{const n=U(r,e);if(n)return n;t.debug("SIGNED_URL_SERVICE","Generating signed URL",{bucket:r,path:e,expirySeconds:s});const{data:o,error:i}=await l.storage.from(r).createSignedUrl(e,s);return i?(t.error("SIGNED_URL_SERVICE","Failed to generate signed URL",{bucket:r,path:e,error:i.message}),null):o?.signedUrl?(R(r,e,o.signedUrl,s),t.info("SIGNED_URL_SERVICE","Signed URL generated successfully",{bucket:r,path:e,expiresIn:s+"s"}),o.signedUrl):(t.error("SIGNED_URL_SERVICE","No signed URL returned",{bucket:r,path:e}),null)}catch(n){return t.error("SIGNED_URL_SERVICE","Error generating signed URL",{bucket:r,path:e,error:n instanceof Error?n.message:"Unknown error"}),null}}const u={BODY_SCANS:"body-scans",MODELS_3D:"3d-models",SILHOUETTES:"silhouettes",FAST_ARCHETYPE:"fast-archetype",MEAL_PHOTOS:"meal-photos",TRAINING_LOCATIONS:"training-locations"};export{u as P,f as g};
