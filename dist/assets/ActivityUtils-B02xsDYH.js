import{l as s,s as d}from"./page-fridge-BvAjnJpI.js";import{s as y,e as S,f as h}from"./date-utils-sCOX3Ksr.js";async function I(e,t=new Date){const r=y(t).toISOString(),o=S(t).toISOString();s.info("ACTIVITIES_REPO","Fetching activities for date",{userId:e,date:h(t,"yyyy-MM-dd"),startDate:r,endDate:o,timestamp:new Date().toISOString()});try{const{data:i,error:n}=await d.from("activities").select("*").eq("user_id",e).gte("timestamp",r).lte("timestamp",o).order("timestamp",{ascending:!1});if(n)throw s.error("ACTIVITIES_REPO","Failed to fetch activities",{error:n.message,errorCode:n.code,userId:e,date:h(t,"yyyy-MM-dd"),timestamp:new Date().toISOString()}),n;return s.info("ACTIVITIES_REPO","Activities fetched successfully",{userId:e,date:h(t,"yyyy-MM-dd"),activitiesCount:i?.length||0,timestamp:new Date().toISOString()}),i||[]}catch(i){throw s.error("ACTIVITIES_REPO","Exception during activities fetch",{error:i instanceof Error?i.message:"Unknown error",userId:e,date:h(t,"yyyy-MM-dd"),timestamp:new Date().toISOString()}),i}}function v(e){if(e.length===0)return{totalCalories:0,activitiesCount:0,totalDuration:0,averageIntensity:void 0,mostFrequentType:void 0,lastActivityTime:void 0};const t=e.reduce((c,m)=>c+m.calories_est,0),r=e.reduce((c,m)=>c+m.duration_min,0),o={low:1,medium:2,high:3,very_high:4},i={1:"low",2:"medium",3:"high",4:"very_high"},n=e.reduce((c,m)=>c+o[m.intensity],0)/e.length,a=i[Math.round(n)],u={};e.forEach(c=>{u[c.type]=(u[c.type]||0)+1});const l=Object.entries(u).sort(([,c],[,m])=>m-c)[0]?.[0],f=e.length>0?new Date(e[0].timestamp):void 0;return{totalCalories:t,activitiesCount:e.length,totalDuration:r,averageIntensity:a,mostFrequentType:l,lastActivityTime:f}}async function _(e,t){s.info("ACTIVITIES_REPO","Deleting activity",{activityId:e,userId:t,timestamp:new Date().toISOString()});try{const{error:r}=await d.from("activities").delete().eq("id",e).eq("user_id",t);if(r)throw s.error("ACTIVITIES_REPO","Failed to delete activity",{error:r.message,errorCode:r.code,activityId:e,userId:t,timestamp:new Date().toISOString()}),r;s.info("ACTIVITIES_REPO","Activity deleted successfully",{activityId:e,userId:t,timestamp:new Date().toISOString()})}catch(r){throw s.error("ACTIVITIES_REPO","Exception during activity deletion",{error:r instanceof Error?r.message:"Unknown error",activityId:e,userId:t,timestamp:new Date().toISOString()}),r}}async function E(e,t,r,o=100){const i=t.toISOString(),n=r.toISOString();s.info("ACTIVITIES_REPO","Fetching user activities for date range",{userId:e,startDate:i,endDate:n,limit:o,timestamp:new Date().toISOString()});try{const{data:a,error:u}=await d.from("activities").select("*").eq("user_id",e).gte("timestamp",i).lte("timestamp",n).order("timestamp",{ascending:!1}).limit(o);if(u)throw s.error("ACTIVITIES_REPO","Failed to fetch user activities",{error:u.message,errorCode:u.code,userId:e,startDate:i,endDate:n,limit:o,timestamp:new Date().toISOString()}),u;return s.info("ACTIVITIES_REPO","User activities fetched successfully",{userId:e,activitiesCount:a?.length||0,startDate:i,endDate:n,limit:o,timestamp:new Date().toISOString()}),a||[]}catch(a){throw s.error("ACTIVITIES_REPO","Exception during user activities fetch",{error:a instanceof Error?a.message:"Unknown error",userId:e,startDate:i,endDate:n,limit:o,timestamp:new Date().toISOString()}),a}}function D(e){const t=[];return(!e.type||e.type.trim().length===0)&&t.push("Le type d'activité est requis"),(!e.duration_min||e.duration_min<=0)&&t.push("La durée doit être supérieure à 0 minutes"),e.duration_min&&e.duration_min>600&&t.push("La durée ne peut pas dépasser 10 heures (600 minutes)"),(!e.intensity||!["low","medium","high","very_high"].includes(e.intensity))&&t.push("L'intensité doit être low, medium, high ou very_high"),t.push("Les calories estimées doivent être supérieures ou égales à 0"),{isValid:t.length===0,errors:t}}const g={course:{low:6,medium:8,high:10,very_high:12},marche:{low:2.5,medium:3.5,high:4.5,very_high:5},vélo:{low:4,medium:6,high:8,very_high:10},musculation:{low:3,medium:4,high:5,very_high:6},yoga:{low:2,medium:2.5,high:3,very_high:3.5},natation:{low:4,medium:6,high:8,very_high:10},football:{low:4,medium:6,high:8,very_high:10},tennis:{low:4,medium:5.5,high:7,very_high:8.5},danse:{low:3,medium:4.5,high:6,very_high:7.5},étirements:{low:2,medium:2.5,high:3,very_high:3.5},default:{low:3,medium:4,high:5,very_high:6}};function O(e,t,r,o){const i=e.toLowerCase();let n=g.default[t]||4;for(const[u,l]of Object.entries(g))if(i.includes(u)){n=l[t]||l.medium;break}const a=r/60;return Math.round(n*o*a)}function T(e){switch(e){case"low":return"#22C55E";case"medium":return"#F59E0B";case"high":return"#EF4444";case"very_high":return"#DC2626";default:return"#3B82F6"}}function A(e){const t=e.toLowerCase();return t.includes("course")||t.includes("running")||t.includes("marche")||t.includes("walk")||t.includes("vélo")||t.includes("bike")||t.includes("natation")||t.includes("swim")?"Activity":t.includes("musculation")?"Dumbbell":t.includes("yoga")?"Smile":t.includes("football")||t.includes("sport")||t.includes("tennis")?"Target":t.includes("danse")||t.includes("étirement")?"Smile":"Zap"}function C(e){switch(e){case"low":return"Faible";case"medium":return"Modérée";case"high":return"Intense";case"very_high":return"Très Intense";default:return"Modérée"}}export{T as a,A as b,v as c,_ as d,C as e,I as f,E as g,O as h,D as v};
