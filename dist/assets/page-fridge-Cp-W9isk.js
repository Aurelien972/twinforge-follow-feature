import{r as v,j as e,u as ce,X as hs,R as fe,b as fs}from"./vendor-BefW7Bxj.js";import{u as vs,a as je,b as we,c as ys,d as Ce,g as Ke,e as js,f as Pe}from"./stores-Dp3vmZ5-.js";import{G as I,S as m,I as c,P as ws,u as Te,a as Ns}from"./ui-components-lrK_WhZu.js";import{m as j,A as le}from"./motion-BQvLDPOm.js";import{f as Qe,a as Ze}from"./date-utils-BlBdbPk_.js";import{c as ks}from"./supabase-pyFrrmXL.js";const Xe={development:{level:"info"},staging:{level:"info"},production:{level:"warn"}};function Ss(){return Xe["production"]||Xe.development}let os=null;function Cs(s){os=s}function Is(){try{return os?.()||{}}catch(s){return console.warn("Failed to get context from provider:",s),{}}}function xe(s){const t=Ss(),r={trace:0,debug:1,info:2,warn:3,error:4},a=r[t.level];return r[s]>=a}function me(s,t,r,a){const n=Is();let i,o,l;a!==void 0?(i=t,o=r,l=a):typeof r=="string"?(i=t,o=r,l=void 0):(i=void 0,o=t,l=r),l&&typeof l!="object"&&(o=`${o} — ${String(l)}`,l=void 0);const x=i?`${i} — ${o}`:o,d={...n,...i&&{category:i},...l||{}};return{level:s,message:x,timestamp:new Date().toISOString(),context:d}}function ls(s,t,r){if(!xe("trace"))return;const a=me("trace",s,t,r);console.trace(JSON.stringify(a,null,2))}function cs(s,t,r){if(!xe("debug"))return;const a=me("debug",s,t,r);console.debug(JSON.stringify(a,null,2))}function ds(s,t,r){if(!xe("info"))return;const a=me("info",s,t,r);console.log(JSON.stringify(a,null,2))}function xs(s,t,r){if(!xe("warn"))return;const a=me("warn",s,t,r);console.warn(JSON.stringify(a,null,2))}function ms(s,t,r){if(!xe("error"))return;const a=me("error",s,t,r);console.error(JSON.stringify(a,null,2))}function Es(s,t,r,a){if(!xe("info"))return;const n=Number.isFinite(t)&&!Number.isNaN(t)?Math.max(0,Math.min(100,t)):0,i=me("info",`${s}: ${n}% - ${r}`,{category:s,progress:n,message:r,...a&&{subMessage:a}});console.log(JSON.stringify(i,null,2))}function Fs(s,t,r={}){if(!xe("error"))return;const a=t,n=me("error",s,{error:{name:a?.name||"Unknown",message:a?.message||"No message",stack:a?.stack||"No stack trace"},...r});console.error(JSON.stringify(n,null,2))}const y={trace:ls,info:ds,warn:xs,debug:cs,error:ms,progress:Es,logError:Fs,logOnce:Ds,setContextProvider:Cs,jsonLog:As},es=new Set;function Ds(s,t,r,a){if(!es.has(s))switch(es.add(s),t){case"trace":ls(r,a);break;case"debug":cs(r,a);break;case"info":ds(r,a);break;case"warn":xs(r,a);break;case"error":ms(r,a);break}}function As(s,t,r){if(!xe("info"))return;const a=me("info",`${s}: ${t}`,{category:s,data:r,structured:!0});console.log(JSON.stringify(a,null,2))}const se={supabaseUrl:(()=>{const s="https://kwipydbtjagypocpvbwn.supabase.co".trim()||"";return s&&(s.includes("supabase.co")||s.includes("supabase.in"))?s.replace(/^http:\/\//,"https://"):s})(),supabaseAnon:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U".trim()||""},Rs=()=>{const s=se.supabaseUrl&&se.supabaseUrl.length>0,t=se.supabaseAnon&&se.supabaseAnon.length>0,r=s&&(se.supabaseUrl.includes("supabase.co")||se.supabaseUrl.includes("supabase.in"));return s&&t&&r};function Ps(){try{const s=new URL(se.supabaseUrl).hostname.split(".")[0],t=window.location.hostname.toLowerCase();let r="default";if(t.includes("localhost")||t.includes("127.0.0.1"))r="dev";else if(t.includes("webcontainer")||t.includes("stackblitz"))r="preview";else{const n=t.split(".");n.length>2,r=n[0]}const a=r.replace(/[^a-z0-9-]/gi,"").toLowerCase();return`sb-${s}-${a}-auth-token`}catch(s){return console.warn("Failed to generate auth storage key:",s),"sb-auth-token-fallback"}}const Ts=()=>{if(!se.supabaseUrl||!se.supabaseAnon)throw console.error("Missing environment variables. Please check your .env file."),console.error("Required: VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY"),new Error("Supabase configuration missing");const s=se.supabaseUrl,t=se.supabaseAnon,r=Ps();try{return ks(s,t,{auth:{storage:window.localStorage,storageKey:r,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"fastlift-pwa@9.77"}}})}catch(a){throw console.error("SUPABASE","Failed to create client",{error:a}),a}},H=Ts();Rs();const ur=Object.freeze(Object.defineProperty({__proto__:null,supabase:H},Symbol.toStringTag,{value:"Module"}));function ss(){const s=window.innerWidth,t=window.innerHeight,r=window.devicePixelRatio||1,a=s<768,n=s>=768&&s<1024,i=s>=1024,o=window.matchMedia("(hover: hover) and (pointer: fine)").matches,l="ontouchstart"in window||navigator.maxTouchPoints>0,x=navigator.deviceMemory||4,d=navigator.hardwareConcurrency||4,p=navigator.connection;let g="medium";if(p){const h=p.effectiveType;h==="slow-2g"||h==="2g"?g="slow":h==="3g"?g="medium":(h==="4g"||h==="5g")&&(g="fast")}let u="balanced";return a?u="high-performance":i&&x>=8&&d>=8?u="quality":u="balanced",{isMobile:a,isTablet:n,isDesktop:i,supportsHover:o,supportsTouch:l,screenWidth:s,screenHeight:t,devicePixelRatio:r,memoryGB:x,cores:d,connectionSpeed:g,recommendedMode:u}}function Bs(){const[s,t]=v.useState(()=>ss());return v.useEffect(()=>{const r=()=>{t(ss())};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),s}const ps=v.createContext({mode:"balanced",recommendedMode:null,isPerformanceMode:!1,isLoading:!0,setMode:async()=>{},togglePerformanceMode:async()=>{}}),q=()=>v.useContext(ps),br=({children:s})=>{const{mode:t,recommendedMode:r,isPerformanceMode:a,isLoading:n,setMode:i,loadMode:o}=vs(),{profile:l}=je(),x=Bs();v.useEffect(()=>{o(l?.id,x.recommendedMode)},[l?.id,x.recommendedMode,o]);const d=async u=>{await i(u,l?.id)},g={mode:t,recommendedMode:r,isPerformanceMode:a,isLoading:n,setMode:d,togglePerformanceMode:async()=>{await d(a?"balanced":"high-performance")}};return e.jsx(ps.Provider,{value:g,children:s})};let ue=null;function _s(){return ue||(ue=new(window.AudioContext||window.webkitAudioContext)),ue.state==="suspended"&&ue.resume().catch(s=>{console.error("AUDIO_FEEDBACK_ERROR","Failed to resume AudioContext",{error:s instanceof Error?s.message:"Unknown error",contextState:ue?.state,timestamp:new Date().toISOString()})}),ue}function Ms(){return ue?.state==="running"}function zs(s,t,r){const a=s.createOscillator(),n=s.createGain();a.frequency.setValueAtTime(t.frequency,r),a.type=t.waveform;let i=null;t.filter&&(i=s.createBiquadFilter(),i.type=t.filter.type,i.frequency.setValueAtTime(t.filter.frequency,r),t.filter.Q!==void 0&&i.Q.setValueAtTime(t.filter.Q,r)),i?(a.connect(i),i.connect(n)):a.connect(n);const{attack:o,decay:l,sustain:x,release:d}=t.adsr,p=t.gain,g=p*x,u=r+o,h=u+l,w=h+d,F=o+l+d;return n.gain.setValueAtTime(0,r),n.gain.linearRampToValueAtTime(p,u),x>0?n.gain.exponentialRampToValueAtTime(Math.max(.001,g),h):n.gain.exponentialRampToValueAtTime(.001,h),n.gain.exponentialRampToValueAtTime(.001,w),{oscillator:a,gainNode:n,duration:F}}function Ie(s,t="click",r){try{const a=_s();if(!Ms())return;const n=a.currentTime,i=a.createGain();i.connect(a.destination);const o=(s.masterGain||1)*.1;i.gain.setValueAtTime(o,n);const l=[];let x=0;s.layers.forEach(p=>{const g=zs(a,p,n);l.push(g),g.gainNode.connect(i),x=Math.max(x,g.duration)}),l.forEach(({oscillator:p})=>{p.start(n)});const d=n+x;l.forEach(({oscillator:p})=>{p.stop(d)}),y.trace("TWINFORGE_AUDIO: Layered sound played",{layersCount:s.layers.length,totalDuration:(x*1e3).toFixed(1)+"ms",masterGain:o.toFixed(3),soundType:t,soundId:r})}catch(a){y.error("AUDIO_FEEDBACK_ERROR: Layered audio playback failed",{error:a instanceof Error?a.message:"Unknown error",layersCount:s.layers.length,soundType:t,audioContextSupported:!!(window.AudioContext||window.webkitAudioContext)})}}const $={frequency:290,waveform:"square",adsr:{attack:.003,decay:.085,sustain:0,release:.02},gain:.85,filter:{type:"lowpass",frequency:1600,Q:1.2}},oe={frequency:102,waveform:"sine",adsr:{attack:.008,decay:.055,sustain:0,release:.012},gain:.6,filter:{type:"highpass",frequency:60,Q:1}},te={frequency:1500,waveform:"triangle",adsr:{attack:.01,decay:.15,sustain:0,release:.03},gain:.4,filter:{type:"lowpass",frequency:6e3,Q:1}},ye={frequency:440,waveform:"sawtooth",adsr:{attack:.015,decay:.18,sustain:.1,release:.25},gain:.25,filter:{type:"bandpass",frequency:800,Q:3.5}},Ae={frequency:1800,waveform:"sawtooth",adsr:{attack:.002,decay:.05,sustain:0,release:.01},gain:.15,filter:{type:"highpass",frequency:1200,Q:1}},be={enabled:!0,volume:1,reducedMotion:!1};function $s(){return{...be}}function ts(s){Object.assign(be,s)}function Be(){return be.enabled}function _e(s){if(!be.enabled)return s;const t={...s,masterGain:(s.masterGain||1)*be.volume};return be.reducedMotion&&t.layers&&(t.layers=t.layers.map(r=>({...r,adsr:r.adsr?{...r.adsr,attack:Math.max(r.adsr.attack,.01),release:Math.max(r.adsr.release,.01)}:r.adsr}))),t}function E(s,t=2){if(be.reducedMotion)return s;const r=(Math.random()-.5)*2*(t/100);return s*(1+r)}function hr(s){Ie(s)}const rs=new Map,Ls=50;function Me(s,t){const r=t||s,a=Date.now(),n=rs.get(r);return n&&a-n<Ls?!1:(rs.set(r,a),!0)}function Ne(s,t="click",r){if(!Be()||!Me(t,r))return;const a=_e(s);Ie(a,t,r)}function qs(){const s={layers:[{...$,frequency:E($.frequency),gain:$.gain*.7},{...oe,frequency:E(oe.frequency),gain:oe.gain*.3}],masterGain:1};Ne(s,"click")}function Gs(){const s={layers:[{...$,frequency:E($.frequency),gain:$.gain*.7},{...oe,frequency:E(oe.frequency),gain:oe.gain*.3}],masterGain:1};Ne(s,"click")}function Os(){Ne({layers:[{frequency:800,waveform:"triangle",adsr:{attack:.005,decay:.02,sustain:0,release:.005},gain:.3,filter:{type:"lowpass",frequency:3e3,Q:.8}}],masterGain:.8},"click")}function Us(){Ne({layers:[{frequency:520,waveform:"triangle",adsr:{attack:.01,decay:.05,sustain:0,release:.01},gain:.5,filter:{type:"lowpass",frequency:2500,Q:1.2}}],masterGain:1},"click")}function Hs(){Ne({layers:[{frequency:740,waveform:"triangle",adsr:{attack:.015,decay:.105,sustain:0,release:.015},gain:.5,filter:{type:"lowpass",frequency:4e3,Q:1}}],masterGain:1},"click")}function Vs(){Ne({layers:[{frequency:800,waveform:"sine",adsr:{attack:.01,decay:.07,sustain:0,release:.01},gain:.4,filter:{type:"lowpass",frequency:3500,Q:1}}],masterGain:1},"click")}function he(s,t="success",r){if(!Be()||!Me(t,r))return;const a=_e(s);Ie(a,t,r)}function Ws(){const s={layers:[{...$,frequency:E($.frequency),gain:$.gain*.6},{...te,frequency:E(te.frequency),gain:te.gain*.4}],masterGain:1.26};he(s,"success")}function Ys(){const s={layers:[{...$,frequency:E($.frequency),gain:$.gain*.6},{...te,frequency:E(te.frequency),gain:te.gain*.2}],masterGain:1.58};he(s,"success")}function Js(){he({layers:[{frequency:220,waveform:"sine",adsr:{attack:.005,decay:.08,sustain:0,release:.01},gain:.6}],masterGain:.79},"error"),setTimeout(()=>{he({layers:[{frequency:180,waveform:"sine",adsr:{attack:.005,decay:.1,sustain:0,release:.01},gain:.6}],masterGain:.79},"error")},110)}function Ks(){const s={layers:[{...$,frequency:E($.frequency),gain:$.gain*1,adsr:{attack:.005,decay:.11,sustain:0,release:.015}}],masterGain:2.51};he(s,"success"),setTimeout(()=>{const t={layers:[{...te,frequency:1400,gain:te.gain*.8,adsr:{attack:.01,decay:.15,sustain:0,release:.03},filter:{type:"bandpass",frequency:1400,Q:1.5}}],masterGain:2.51};he(t,"success")},120),setTimeout(()=>{he({layers:[{frequency:600,waveform:"sine",adsr:{attack:.02,decay:.14,sustain:0,release:.02},gain:.35,filter:{type:"lowpass",frequency:800,Q:1.2}}],masterGain:2.51},"success")},220)}function Ee(s,t){if(!Be()||!Me("navigation",t))return;const r=_e(s);Ie(r,"navigation",t)}function Qs(){const s={layers:[{...$,frequency:E(660),gain:$.gain*.5}],masterGain:1};Ee(s)}function Zs(){const s={layers:[{...$,frequency:E(350),gain:$.gain*.4},{...oe,frequency:E(oe.frequency),gain:oe.gain*.2}],masterGain:1};Ee(s)}function Xs(){Ee({layers:[{frequency:880,waveform:"sine",adsr:{attack:.006,decay:.026,sustain:0,release:.006},gain:.4}],masterGain:1})}function et(){const s={layers:[{...$,frequency:E(400),gain:$.gain*.4},{...te,frequency:E(1200),gain:te.gain*.3}],masterGain:1};Ee(s)}function st(){const s={layers:[{...$,frequency:E(350),gain:$.gain*.3}],masterGain:.9};Ee(s)}const tt={light:{pattern:10,description:"Light tap"},medium:{pattern:20,description:"Medium tap"},heavy:{pattern:30,description:"Heavy tap"},success:{pattern:[10,50,10],description:"Success double tap"},warning:{pattern:[20,100,20,100,20],description:"Warning triple tap"},error:{pattern:[30,50,30],description:"Error alert pattern"},selection:{pattern:5,description:"Selection tick"}};function rt(){return"vibrate"in navigator}function at(){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||!rt())return!1;try{const s=localStorage.getItem("haptics-enabled");return s===null||s==="true"}catch{return!0}}function ge(s="light"){if(at())try{const t=tt[s];navigator.vibrate(t.pattern)||(y.debug("HAPTICS","Vibration pattern not supported, using fallback"),navigator.vibrate(10)),y.debug("HAPTICS","Triggered haptic feedback",{pattern:s,description:t.description})}catch(t){y.error("HAPTICS","Failed to trigger haptic feedback",t)}}const re={tap:()=>ge("light"),press:()=>ge("medium"),impact:()=>ge("heavy"),success:()=>ge("success"),warning:()=>ge("warning"),error:()=>ge("error"),selection:()=>ge("selection")};function qe(s,t=1){const r=[.025,.045,.07],a=[.15,.1,.06].map(i=>i*t),n=s.layers.flatMap(i=>[i,...r.map((o,l)=>({...i,gain:i.gain*a[l],adsr:{...i.adsr,attack:i.adsr.attack+o}}))]);return{...s,layers:n,masterGain:s.masterGain*.9}}let as=0;function nt(){const s=Date.now(),t=s-as;return as=s,t<200?.5:t<500?.7:t<1e3?1:1.3}function de(s,t="click",r){if(!Be()||!Me(t,r))return;const a=_e(s);Ie(a,t,r)}function fr(){const s={layers:[{frequency:E(280),waveform:"triangle",adsr:{attack:.01,decay:.15,sustain:.3,release:.25},gain:.35},{frequency:E(440),waveform:"sine",adsr:{attack:.02,decay:.2,sustain:.25,release:.3},gain:.25},{frequency:E(660),waveform:"sine",adsr:{attack:.03,decay:.25,sustain:.2,release:.35},gain:.15}],masterGain:1.2};de(s,"navigation","forge-strike"),re.press()}function vr(s){const t=Ge(s),r={layers:[{frequency:E(t),waveform:"triangle",adsr:{attack:.008,decay:.12,sustain:.25,release:.18},gain:.28},{frequency:E(t*1.5),waveform:"sine",adsr:{attack:.01,decay:.15,sustain:.2,release:.22},gain:.18}],masterGain:1};de(r,"click",`tile-${s}`),re.tap()}function yr(s){const t=Ge(s),r={layers:[{frequency:E(t*1.2),waveform:"sine",adsr:{attack:.005,decay:.08,sustain:.15,release:.12},gain:.22},{frequency:E(t*2),waveform:"sine",adsr:{attack:.008,decay:.1,sustain:.12,release:.15},gain:.12}],masterGain:1};de(r,"click",`pill-${s}`),re.selection()}function jr(){const s={layers:[{frequency:E(440),waveform:"sine",adsr:{attack:.01,decay:.12,sustain:.15,release:.2},gain:.18},{frequency:E(330),waveform:"sine",adsr:{attack:.02,decay:.15,sustain:.12,release:.25},gain:.15}],masterGain:.9};de(s,"navigation","panel-close"),re.tap()}function wr(){const s={layers:[{frequency:E(261.63),waveform:"sine",adsr:{attack:.008,decay:.15,sustain:.32,release:.28},gain:.35},{frequency:E(329.63),waveform:"sine",adsr:{attack:.012,decay:.18,sustain:.28,release:.32},gain:.28},{frequency:E(523.25),waveform:"sine",adsr:{attack:.015,decay:.2,sustain:.25,release:.35},gain:.22}],masterGain:1.15};de(s,"navigation","home-click"),re.press()}function Nr(s,t){const r=Ge(s),a=t?1.2:1,n={layers:[{frequency:E(r),waveform:"sine",adsr:{attack:.008,decay:.12,sustain:.2,release:.18},gain:.25*a},{frequency:E(r*1.5),waveform:"sine",adsr:{attack:.012,decay:.15,sustain:.18,release:.22},gain:.15*a}],masterGain:1};de(n,"navigation",`bottom-bar-${s}`),t?re.press():re.tap()}function Ge(s){return{"#10B981":349.23,"#3B82F6":392,"#F59E0B":440,"#A855F7":493.88,"#18E3FF":523.25,"#3D13B3":329.63,"#EC4899":466.16,"#8B5CF6":493.88,"#F7931E":329.63,"#EF4444":261.63}[s]||440}function it(s=1){const t=nt(),r={layers:[{frequency:E(180),waveform:"square",adsr:{attack:.001,decay:.04,sustain:0,release:.015},gain:.9*s},{...ye,frequency:E(ye.frequency),gain:ye.gain*s},{...Ae,frequency:E(2400),gain:Ae.gain*s*1.3}],masterGain:1.1},a=qe(r,t);de(a,"click","hammer-strike"),re.press()}function ot(){const s={layers:[{frequency:E(340),waveform:"triangle",adsr:{attack:.01,decay:.12,sustain:.15,release:.18},gain:.45},{frequency:E(680),waveform:"sawtooth",adsr:{attack:.02,decay:.1,sustain:.08,release:.15},gain:.25,filter:{type:"bandpass",frequency:650,Q:4}},{...Ae,frequency:E(1600),gain:Ae.gain*.6}],masterGain:.9},t=qe(s,.8);de(t,"click","hot-metal"),re.selection()}function lt(){const s={layers:[{frequency:E(220),waveform:"triangle",adsr:{attack:.005,decay:.2,sustain:.15,release:.35},gain:.5},{...ye,frequency:E(440),adsr:{...ye.adsr,decay:.3,release:.4},gain:ye.gain*1.2},{frequency:E(880),waveform:"sine",adsr:{attack:.015,decay:.25,sustain:.1,release:.3},gain:.18}],masterGain:1},t=qe(s,1.2);de(t,"click","anvil-ring"),re.impact()}function Q(){return v.useMemo(()=>({click:qs,glassClick:Gs,formInput:Os,toggle:Us,notif:Hs,timer:Vs,formSubmit:Ws,success:Ys,error:Js,successMajor:Ks,tabClick:Qs,sidebarClick:Zs,headerClick:Xs,navOpen:et,navClose:st,hammerStrike:it,hotMetalHiss:ot,anvilRing:lt,setAudioEnabled:s=>{ts({enabled:s})},setDiscreteMode:s=>{ts({discreteMode:s})},getAudioPreferences:$s}),[])}const ve=[{key:"sex",label:"Genre",description:"Nécessaire pour calculer les besoins nutritionnels",profileTab:"identity",priority:"high"},{key:"weight_kg",label:"Poids",description:"Essentiel pour les portions et calories",profileTab:"identity",priority:"high"},{key:"height_cm",label:"Taille",description:"Nécessaire pour les calculs métaboliques",profileTab:"identity",priority:"high"},{key:"allergies",label:"Allergies",description:"Important pour la sécurité alimentaire",profileTab:"nutrition",priority:"medium"},{key:"householdDetails.adults",label:"Nombre d'adultes",description:"Pour adapter les portions des recettes",profileTab:"nutrition",priority:"high"},{key:"diet",label:"Régime alimentaire",description:"Pour des recettes adaptées à votre style",profileTab:"nutrition",priority:"medium"},{key:"mealPrepPreferences.cookingSkill",label:"Niveau de cuisine",description:"Pour adapter la complexité des recettes",profileTab:"nutrition",priority:"medium"},{key:"kitchenEquipment",label:"Équipement de cuisine",description:"Pour des recettes réalisables chez vous",profileTab:"nutrition",priority:"medium"},{key:"objective",label:"Objectif fitness",description:"Pour des recettes alignées sur vos objectifs",profileTab:"identity",priority:"medium"},{key:"intolerances",label:"Intolérances",description:"Pour éviter les inconforts digestifs",profileTab:"nutrition",priority:"low"},{key:"foodPreferences.cuisines",label:"Cuisines préférées",description:"Pour des recettes qui vous plaisent",profileTab:"nutrition",priority:"low"},{key:"macroTargets.kcal",label:"Objectif calories",description:"Pour des recettes équilibrées",profileTab:"fasting",priority:"low"}];function ct(s,t){if(t==="allergies"){const n=s?.nutrition?.allergies&&Array.isArray(s.nutrition.allergies)&&s.nutrition.allergies.length>0,i=s?.nutrition?.noKnownAllergies===!0;return n||i}const r=t.split(".");let a=s;for(const n of r){if(!a||a[n]===void 0||a[n]===null)return!1;a=a[n]}return!(typeof a=="string"&&a.trim()===""||Array.isArray(a)&&a.length===0||typeof a=="object"&&Object.keys(a).length===0||typeof a=="number"&&a<=0)}function ze(s){if(!s)return{isSufficient:!1,completionPercentage:0,missingCriticalFields:ve,missingHighPriorityFields:ve.filter(h=>h.priority==="high"),suggestedMessage:"Créez votre profil pour des recettes personnalisées",nextAction:{label:"Créer mon profil",route:"/profile#identity"}};y.debug("PROFILE_COMPLETION_SERVICE","Calculating Recipe Workshop completion",{userId:s.userId,hasBasicInfo:!!(s.sex&&s.weight_kg&&s.height_cm),hasNutritionInfo:!!s.nutrition,hasHouseholdInfo:!!s.householdDetails,timestamp:new Date().toISOString()});const t=[],r=[];ve.forEach(h=>{ct(s,h.key)||(t.push(h),h.priority==="high"&&r.push(h))});const a=ve.length,n=a-t.length,i=Math.round(n/a*100);ve.filter(h=>h.priority==="high");const o=ve.filter(h=>h.priority==="medium"),l=t.filter(h=>h.priority==="medium"),x=r.length===0,d=l.length<=Math.floor(o.length*.5),p=x&&d;let g,u=null;if(r.length>0){const h=r[0];g=`Complétez votre ${h.label.toLowerCase()} pour des recettes personnalisées`,u={label:`Ajouter ${h.label}`,route:`/profile#${h.profileTab}`}}else if(t.length>0){const h=t[0];g=`Ajoutez votre ${h.label.toLowerCase()} pour une meilleure personnalisation`,u={label:`Compléter ${h.label}`,route:`/profile#${h.profileTab}`}}else g="Profil complet ! Recettes ultra-personnalisées disponibles",u=null;return y.debug("PROFILE_COMPLETION_SERVICE","Recipe Workshop completion calculated",{userId:s.userId,isSufficient:p,completionPercentage:i,missingHighPriorityCount:r.length,missingTotalCount:t.length,hasAllHighPriority:x,hasEnoughMediumPriority:d,timestamp:new Date().toISOString()}),{isSufficient:p,completionPercentage:i,missingCriticalFields:t,missingHighPriorityFields:r,suggestedMessage:g,nextAction:u}}function gs(s,t){const r=ze(s),n={recipes:["sex","weight_kg","allergies","householdDetails.adults"],shopping:["householdDetails.adults","allergies","shoppingPreferences.frequencyPerWeek"],planning:["householdDetails.adults","mealPrepPreferences.cookingSkill","macroTargets.kcal"]}[t]||[],i=r.missingCriticalFields.filter(x=>n.includes(x.key)),o=i.length===0||r.isSufficient;let l="";return!o&&i.length>0&&(l=`Ajoutez votre ${i.slice(0,2).map(d=>d.label.toLowerCase()).join(" et ")} pour une ${t==="recipes"?"génération":t==="shopping"?"liste":"planification"} optimale`),{canProceed:o,warningMessage:l,missingForFeature:i}}function dt(s){return s?!!(s.sex&&s.weight_kg&&s.height_cm):!1}const kr={checkCompleteness:ze,getFeatureGuidance:gs,hasMinimumData:dt},xt=()=>{const s=ce(),{click:t}=Q(),{isPerformanceMode:r}=q(),[a,n]=v.useState({scans:0,items:0,recipes:0}),i=r?"div":j.div;v.useEffect(()=>{(async()=>{try{const{data:{user:x}}=await H.auth.getUser();if(!x)return;const{data:d}=await H.from("recipe_sessions").select("inventory_final, selected_recipe_ids").eq("user_id",x.id).not("inventory_final","is",null);if(d&&d.length>0){const p=d.length,g=d.reduce((h,N)=>h+(Array.isArray(N.inventory_final)?N.inventory_final.length:0),0),u=d.reduce((h,N)=>h+(Array.isArray(N.selected_recipe_ids)?N.selected_recipe_ids.length:0),0);n({scans:p,items:g,recipes:u})}}catch(x){y.warn("FRIDGE_SCAN_MAIN_CTA","Failed to load stats",{error:x instanceof Error?x.message:"Unknown error"})}})()},[]);const o=()=>{t(),s("/fridge/scan")};return e.jsxs(I,{className:"relative overflow-hidden p-10 text-center",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 20%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #F472B6 18%, transparent) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, color-mix(in srgb, #DB2777 15%, transparent) 0%, transparent 70%),
          linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.10)),
          rgba(11, 14, 23, 0.85)
        `,borderColor:"color-mix(in srgb, #EC4899 45%, transparent)",boxShadow:`
          0 20px 60px rgba(0, 0, 0, 0.35),
          0 0 40px color-mix(in srgb, #EC4899 30%, transparent),
          0 0 80px color-mix(in srgb, #F472B6 25%, transparent),
          inset 0 2px 0 rgba(255, 255, 255, 0.2)
        `,backdropFilter:"blur(32px) saturate(170%)",WebkitBackdropFilter:"blur(32px) saturate(170%)"},children:[e.jsx("div",{className:"training-hero-corners","aria-hidden":"true",children:[0,1,2,3].map(l=>e.jsx(i,{className:"corner-particle",style:{position:"absolute",width:"12px",height:"12px",borderRadius:"2px",background:"linear-gradient(135deg, #EC4899, rgba(244, 114, 182, 0.8))",boxShadow:"0 0 20px #EC4899",top:l<2?"12px":"auto",bottom:l>=2?"12px":"auto",left:l%2===0?"12px":"auto",right:l%2===1?"12px":"auto",willChange:r?"auto":"transform, opacity"},...!r&&{initial:{rotate:l%2===0?45:-45},animate:{scale:[1,1.2,1],opacity:[.6,.9,.6],rotate:l%2===0?[45,55,45]:[-45,-55,-45]},transition:{duration:3.5,repeat:1/0,delay:l*.25,ease:[.45,.05,.55,.95]}}},l))}),e.jsxs("div",{className:"relative z-10 space-y-8",children:[e.jsx("div",{className:"relative inline-block",children:e.jsxs(i,{className:"w-28 h-28 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, transparent 60%),
                radial-gradient(circle at 70% 70%, color-mix(in srgb, #EC4899 35%, transparent) 0%, transparent 50%),
                linear-gradient(135deg, color-mix(in srgb, #EC4899 65%, transparent), color-mix(in srgb, #F472B6 55%, transparent))
              `,border:"4px solid color-mix(in srgb, #EC4899 75%, transparent)",boxShadow:`
                0 0 50px color-mix(in srgb, #EC4899 70%, transparent),
                0 0 100px color-mix(in srgb, #F472B6 50%, transparent),
                inset 0 4px 0 rgba(255,255,255,0.5)
              `,willChange:r?"auto":"transform"},...!r&&{animate:{scale:[1,1.06,1],boxShadow:["0 0 50px rgba(236, 72, 153, 0.7), 0 0 100px rgba(244, 114, 182, 0.5)","0 0 55px rgba(236, 72, 153, 0.75), 0 0 110px rgba(244, 114, 182, 0.55)","0 0 50px rgba(236, 72, 153, 0.7), 0 0 100px rgba(244, 114, 182, 0.5)"]},transition:{duration:3,repeat:1/0,ease:[.45,.05,.55,.95]}},children:[e.jsx(m,{Icon:c.Refrigerator,size:56,color:"rgba(255, 255, 255, 0.95)",variant:"pure"}),!r&&e.jsx(j.div,{className:"absolute inset-0 rounded-full border-3",style:{borderColor:"color-mix(in srgb, #EC4899 70%, transparent)",willChange:"transform, opacity"},animate:{scale:[1,1.5,1.5],opacity:[.7,0,0]},transition:{duration:2.5,repeat:1/0,ease:"easeOut"}}),!r&&[{size:16,distance:70,angle:45,delay:0},{size:20,distance:80,angle:135,delay:.4},{size:14,distance:75,angle:225,delay:.8},{size:18,distance:85,angle:315,delay:1.2}].map((l,x)=>e.jsx(j.div,{className:"absolute rounded-full pointer-events-none",style:{width:`${l.size}px`,height:`${l.size}px`,left:"50%",top:"50%",marginLeft:`-${l.size/2}px`,marginTop:`-${l.size/2}px`,background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6) 0%, transparent 70%),
                    linear-gradient(135deg,
                      color-mix(in srgb, #EC4899 70%, transparent),
                      color-mix(in srgb, #F472B6 50%, transparent)
                    )
                  `,border:"2px solid color-mix(in srgb, #EC4899 80%, transparent)",boxShadow:`
                    0 0 20px color-mix(in srgb, #EC4899 60%, transparent),
                    inset 0 2px 4px rgba(255,255,255,0.4)
                  `,willChange:"transform, opacity"},animate:{x:[0,Math.cos(l.angle*Math.PI/180)*l.distance],y:[0,Math.sin(l.angle*Math.PI/180)*l.distance],scale:[.6,1],opacity:[.9,0]},transition:{duration:2.5,repeat:1/0,ease:[.33,1,.68,1],delay:l.delay}},`bubble-${x}`))]})}),e.jsxs(i,{...!r&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2}},children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-4",style:{textShadow:"0 0 25px color-mix(in srgb, #EC4899 50%, transparent)"},children:"Scanner Votre Frigo"}),e.jsx("p",{className:"text-white/85 text-lg leading-relaxed max-w-2xl mx-auto",children:"Capturez l'intérieur de votre réfrigérateur pour une analyse instantanée. Générez des recettes personnalisées et des plans repas adaptés à vos ingrédients."})]}),e.jsx(i,{...!r&&{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.3}},children:e.jsxs("button",{onClick:o,className:"relative overflow-hidden px-12 py-5 text-xl font-bold rounded-2xl transition-all duration-300 group",style:{background:`
                linear-gradient(135deg,
                  color-mix(in srgb, #EC4899 90%, transparent),
                  color-mix(in srgb, #F472B6 75%, transparent),
                  color-mix(in srgb, #DB2777 65%, transparent)
                )
              `,border:"3px solid color-mix(in srgb, #EC4899 80%, transparent)",boxShadow:`
                0 20px 65px color-mix(in srgb, #EC4899 65%, transparent),
                0 0 110px color-mix(in srgb, #F472B6 55%, transparent),
                inset 0 5px 0 rgba(255,255,255,0.6)
              `,color:"white"},onMouseEnter:l=>{!r&&window.matchMedia("(hover: hover)").matches&&(l.currentTarget.style.transform="translateY(-4px) scale(1.04)",l.currentTarget.style.boxShadow=`
                  0 26px 85px color-mix(in srgb, #EC4899 80%, transparent),
                  0 0 140px color-mix(in srgb, #F472B6 70%, transparent),
                  inset 0 5px 0 rgba(255,255,255,0.7)
                `)},onMouseLeave:l=>{!r&&window.matchMedia("(hover: hover)").matches&&(l.currentTarget.style.transform="translateY(0) scale(1)",l.currentTarget.style.boxShadow=`
                  0 20px 65px color-mix(in srgb, #EC4899 65%, transparent),
                  0 0 110px color-mix(in srgb, #F472B6 55%, transparent),
                  inset 0 5px 0 rgba(255,255,255,0.6)
                `)},children:[!r&&e.jsx(j.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{background:"linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.5) 50%, transparent 100%)"},animate:{x:["-200%","200%"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"}}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx(m,{Icon:c.ScanLine,size:24,color:"white",variant:"pure"}),e.jsx("span",{children:"Lancer le Scan"})]})]})}),e.jsx(i,{...!r&&{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5}},className:"flex flex-wrap items-center justify-center gap-6 pt-4",children:[{icon:c.ScanLine,label:`${a.scans} Scan${a.scans>1?"s":""}`,color:"#EC4899"},{icon:c.Package,label:`${a.items} Item${a.items>1?"s":""}`,color:"#F472B6"},{icon:c.ChefHat,label:`${a.recipes} Recette${a.recipes>1?"s":""}`,color:"#DB2777"}].map((l,x)=>e.jsxs(i,{className:"flex items-center gap-2.5 px-5 py-2.5 rounded-full",style:{background:`color-mix(in srgb, ${l.color} 18%, transparent)`,border:`2px solid color-mix(in srgb, ${l.color} 35%, transparent)`,backdropFilter:"blur(18px) saturate(150%)"},...!r&&{whileHover:{scale:1.05},transition:{duration:.2}},children:[e.jsx(m,{Icon:l.icon,size:18,style:{color:l.color}}),e.jsx("span",{className:"text-white/90 text-sm font-semibold",children:l.label})]},x))})]})]})},mt=()=>{const s=ce(),{click:t}=Q(),[r,a]=v.useState([]);v.useEffect(()=>{(async()=>{try{const{data:{user:l}}=await H.auth.getUser();if(!l)return;const{data:x}=await H.from("recipe_sessions").select("id, created_at, inventory_final, status").eq("user_id",l.id).not("inventory_final","is",null).order("created_at",{ascending:!1}).limit(3);x&&a(x)}catch(l){y.warn("RECENT_SCANS_CARD","Failed to load recent sessions",{error:l instanceof Error?l.message:"Unknown error"})}})()},[]);const n=o=>{t(),s("/fridge#inventaire")},i=()=>{t(),s("/fridge#inventaire")};return e.jsxs(I,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 12%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #F472B6 10%, transparent) 0%, transparent 50%),
          linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08)),
          rgba(11, 14, 23, 0.80)
        `,borderColor:"color-mix(in srgb, #EC4899 35%, transparent)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px color-mix(in srgb, #EC4899 20%, transparent),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `,backdropFilter:"blur(24px) saturate(150%)",WebkitBackdropFilter:"blur(24px) saturate(150%)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j.div,{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #EC4899 45%, transparent), color-mix(in srgb, #F472B6 35%, transparent))
              `,border:"2px solid color-mix(in srgb, #EC4899 60%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EC4899 40%, transparent)"},animate:{scale:[1,1.05,1],boxShadow:["0 0 20px rgba(236, 72, 153, 0.4)","0 0 30px rgba(236, 72, 153, 0.55)","0 0 20px rgba(236, 72, 153, 0.4)"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},children:e.jsx(m,{Icon:c.History,size:20,className:"text-pink-300"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Scans Récents"}),e.jsx("p",{className:"text-sm text-white/70",children:"Vos derniers inventaires"})]})]}),e.jsx("button",{onClick:i,className:"px-4 py-2 rounded-xl text-sm font-semibold transition-all duration-300",style:{background:"color-mix(in srgb, #EC4899 15%, transparent)",border:"2px solid color-mix(in srgb, #EC4899 30%, transparent)",color:"#F472B6"},onMouseEnter:o=>{window.matchMedia("(hover: hover)").matches&&(o.currentTarget.style.background="color-mix(in srgb, #EC4899 25%, transparent)",o.currentTarget.style.borderColor="color-mix(in srgb, #EC4899 45%, transparent)")},onMouseLeave:o=>{window.matchMedia("(hover: hover)").matches&&(o.currentTarget.style.background="color-mix(in srgb, #EC4899 15%, transparent)",o.currentTarget.style.borderColor="color-mix(in srgb, #EC4899 30%, transparent)")},children:"Voir tout"})]}),e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #EC4899 15%, transparent)",border:"2px solid color-mix(in srgb, #EC4899 25%, transparent)"},children:e.jsx(m,{Icon:c.Package,size:32,className:"text-pink-300 opacity-50"})}),e.jsx("p",{className:"text-white/60 text-sm",children:"Aucun scan effectué pour le moment"}),e.jsx("p",{className:"text-white/50 text-xs mt-2",children:"Lancez votre premier scan pour commencer"})]}):r.map((o,l)=>e.jsx(j.button,{onClick:()=>n(o.id),className:"w-full text-left rounded-xl p-4 transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.03)",border:"2px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(12px)"},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:l*.1},whileHover:{scale:1.02,background:"rgba(236, 72, 153, 0.08)",borderColor:"rgba(236, 72, 153, 0.3)",boxShadow:"0 0 20px rgba(236, 72, 153, 0.2)"},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg flex items-center justify-center flex-shrink-0",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, color-mix(in srgb, #EC4899 35%, transparent), color-mix(in srgb, #F472B6 25%, transparent))
                    `,border:"2px solid color-mix(in srgb, #EC4899 40%, transparent)",boxShadow:"0 4px 12px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.2)"},children:e.jsx(m,{Icon:c.Refrigerator,size:32,className:"text-pink-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-white font-semibold text-base truncate",children:["Scan du ",Qe(new Date(o.created_at),"d MMM yyyy",{locale:Ze})]}),o.status==="completed"&&e.jsx("div",{className:"px-2 py-0.5 rounded-full text-xs font-medium",style:{background:"color-mix(in srgb, #10B981 20%, transparent)",color:"#10B981",border:"1px solid color-mix(in srgb, #10B981 30%, transparent)"},children:"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-white/70",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(m,{Icon:c.Package,size:14}),e.jsxs("span",{children:[Array.isArray(o.inventory_final)?o.inventory_final.length:0," items"]})]})}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:Qe(new Date(o.created_at),"HH:mm",{locale:Ze})})]}),e.jsx(m,{Icon:c.ChevronRight,size:20,className:"text-white/40 flex-shrink-0"})]})},o.id))})]})},pt=()=>{const[s,t]=v.useState({}),[r,a]=v.useState(0),[n,i]=v.useState(0),[o,l]=v.useState([]);v.useEffect(()=>{(async()=>{try{const{data:{user:g}}=await H.auth.getUser();if(!g)return;const{data:u}=await H.from("recipe_sessions").select("inventory_final").eq("user_id",g.id).not("inventory_final","is",null);if(u&&u.length>0){const h=u.length,N=u.reduce((C,R)=>C+(Array.isArray(R.inventory_final)?R.inventory_final.length:0),0),w={};u.forEach(C=>{Array.isArray(C.inventory_final)&&C.inventory_final.forEach(R=>{const _=R.category||"Autre";w[_]=(w[_]||0)+1})});const F=Object.entries(w).sort(([,C],[,R])=>R-C).slice(0,3).map(([C,R],_)=>({name:C,count:R,color:["#10B981","#F59E0B","#EC4899"][_]}));a(h),i(N),l(F)}}catch(g){y.warn("SCANNER_STATS_CARD","Failed to load stats",{error:g instanceof Error?g.message:"Unknown error"})}})()},[]);const x=n>0?85:0,d=[{label:"Scans Effectués",value:r,icon:"Scan",color:"#EC4899",unit:""},{label:"Items Détectés",value:n,icon:"Package",color:"#F472B6",unit:""},{label:"Taux de Fraîcheur",value:x,icon:"Sparkles",color:"#10B981",unit:"%"}];return v.useEffect(()=>{d.forEach(p=>{const g=p.label;let u=0;const h=p.value/30,N=setInterval(()=>{u+=h,u>=p.value&&(u=p.value,clearInterval(N)),t(w=>({...w,[g]:Math.floor(u)}))},30);return()=>clearInterval(N)})},[r,n]),e.jsxs(I,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #EC4899 12%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #F472B6 10%, transparent) 0%, transparent 50%),
          linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08)),
          rgba(11, 14, 23, 0.80)
        `,borderColor:"color-mix(in srgb, #EC4899 35%, transparent)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px color-mix(in srgb, #EC4899 20%, transparent),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `,backdropFilter:"blur(24px) saturate(150%)",WebkitBackdropFilter:"blur(24px) saturate(150%)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(j.div,{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #EC4899 45%, transparent), color-mix(in srgb, #F472B6 35%, transparent))
            `,border:"2px solid color-mix(in srgb, #EC4899 60%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EC4899 40%, transparent)"},animate:{scale:[1,1.05,1],boxShadow:["0 0 20px color-mix(in srgb, #EC4899 40%, transparent)","0 0 30px color-mix(in srgb, #EC4899 55%, transparent)","0 0 20px color-mix(in srgb, #EC4899 40%, transparent)"]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},children:e.jsx(m,{Icon:c.BarChart3,size:20,className:"text-pink-300"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Statistiques"}),e.jsx("p",{className:"text-sm text-white/70",children:"Vue d'ensemble de vos scans"})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:d.map((p,g)=>{const u=s[p.label]||0,h=p.unit==="%"?u:u/(p.value||1)*100;return e.jsxs(j.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:g*.1},className:"text-center",children:[e.jsxs("div",{className:"relative w-24 h-24 mx-auto mb-3",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"rgba(255, 255, 255, 0.1)",strokeWidth:"8"}),e.jsx(j.circle,{cx:"48",cy:"48",r:"40",fill:"none",stroke:p.color,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*40}`,initial:{strokeDashoffset:2*Math.PI*40},animate:{strokeDashoffset:2*Math.PI*40*(1-(p.unit==="%"?u/100:Math.min(h/100,1)))},transition:{duration:1,ease:"easeOut"},style:{filter:`drop-shadow(0 0 8px ${p.color}80)`}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(m,{Icon:c[p.icon],size:20,style:{color:p.color}}),e.jsxs("span",{className:"text-xl font-bold text-white mt-1",children:[u,p.unit]})]})]}),e.jsx("p",{className:"text-xs text-white/70 font-medium",children:p.label})]},p.label)})}),e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},className:"rounded-xl p-4 mb-4",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-semibold text-white",children:"Tendance des Scans"}),e.jsx("span",{className:"text-xs text-white/60",children:"7 derniers jours"})]}),e.jsx("div",{className:"flex items-end justify-between h-16 gap-1",children:[3,5,4,7,6,8,9].map((p,g)=>e.jsx(j.div,{className:"flex-1 rounded-t-lg",style:{background:`linear-gradient(180deg, ${c?"#EC4899":"#F472B6"}, ${c?"#F472B6":"#DB2777"})`,boxShadow:"0 0 10px color-mix(in srgb, #EC4899 40%, transparent)"},initial:{height:0},animate:{height:`${p/10*100}%`},transition:{duration:.5,delay:g*.05}},g))})]}),e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Top Catégories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((p,g)=>e.jsxs(j.div,{className:"px-4 py-2 rounded-full flex items-center gap-2",style:{background:`color-mix(in srgb, ${p.color} 15%, transparent)`,border:`2px solid color-mix(in srgb, ${p.color} 30%, transparent)`},initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.6+g*.1},whileHover:{scale:1.05},children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:p.color}}),e.jsx("span",{className:"text-sm font-medium text-white",children:p.name}),e.jsx("span",{className:"text-xs font-bold px-2 py-0.5 rounded-full",style:{background:`color-mix(in srgb, ${p.color} 25%, transparent)`,color:p.color},children:p.count})]},p.name))})]}),r>0&&e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.7},className:"mt-4 p-3 rounded-xl flex items-start gap-3",style:{background:"color-mix(in srgb, #10B981 10%, transparent)",border:"2px solid color-mix(in srgb, #10B981 25%, transparent)"},children:[e.jsx(m,{Icon:c.Lightbulb,size:18,className:"text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-300 mb-1",children:"Excellent Progrès!"}),e.jsxs("p",{className:"text-xs text-white/70",children:["Vous avez scanné ",r," frigo",r>1?"s":""," et détecté ",n," ingrédients. Continuez pour débloquer plus de recettes personnalisées."]})]})]})]})},Sr=()=>{const{profile:s}=je(),{loadRecentSessions:t}=we();return v.useEffect(()=>{t()},[t]),e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-6",children:[e.jsx(ws,{profile:s,forgeContext:"culinary"}),e.jsx(xt,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(mt,{}),e.jsx(pt,{})]})]})},gt=()=>{const s=ce(),{click:t}=Q(),{startScan:r}=we(),{isPerformanceMode:a}=q(),n=()=>{t(),r(),s("/fridge/scan")};return e.jsx(I,{className:"fridge-glass-inventory p-8 text-center relative overflow-hidden rounded-3xl transform-gpu preserve-3d will-transform transition-all duration-300",children:e.jsxs("div",{className:"flex flex-col items-center space-y-6",children:[e.jsx("div",{className:`fridge-icon-inventory ${a?"":"fridge-ai-focus"} w-20 h-20 mx-auto`,children:e.jsx(m,{Icon:c.Refrigerator,size:36,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white",children:"Mon Inventaire"}),e.jsx("p",{className:"text-white/80 text-base md:text-lg leading-relaxed",children:"Gérez vos ingrédients, générez des recettes et des plans alimentaires"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"fridge-icon-inventory w-12 h-12 mx-auto",children:e.jsx(m,{Icon:c.Camera,size:24,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Scan Rapide"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Photographiez votre frigo en quelques secondes pour un inventaire automatique"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"fridge-icon-inventory w-12 h-12 mx-auto",children:e.jsx(m,{Icon:c.Utensils,size:24,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Recettes Personnalisées"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Générez des recettes adaptées à vos ingrédients disponibles"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"fridge-icon-inventory w-12 h-12 mx-auto",children:e.jsx(m,{Icon:c.Calendar,size:24,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Plans de Repas"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Créez des plans alimentaires équilibrés pour toute la semaine"})]})]}),e.jsx("button",{onClick:n,className:"fridge-btn-inventory-primary px-6 md:px-8 py-3 md:py-4 text-lg md:text-xl font-bold relative overflow-hidden rounded-full transition-all duration-200 hover:scale-105 active:scale-95",children:e.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[e.jsx(m,{Icon:c.Camera,size:20,color:"white",variant:"pure"}),"Commencer - Scanner Mon Frigo"]})}),e.jsx("div",{className:"fridge-info-panel mt-8 p-4 w-full",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(m,{Icon:c.Lightbulb,size:20,color:"rgba(255, 255, 255, 0.95)",variant:"pure",style:{marginTop:"2px"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-sm font-semibold text-white/90 mb-1",children:"Astuce TwinForge"}),e.jsx("p",{className:"text-white/70 text-xs leading-relaxed",children:"Pour de meilleurs résultats, photographiez votre frigo avec un bon éclairage et organisez vos aliments de manière visible."})]})]})})]})})},ut=({session:s,onDeleteIndividualInventory:t})=>{const r=ce(),a=()=>{r("/fridge#recipes")},n=()=>{r("/fridge#plan")},i=()=>{t(s.id)};return e.jsxs("div",{className:"glass-card p-6 rounded-3xl",style:{background:`
          linear-gradient(135deg,
            color-mix(in srgb, var(--color-fridge-primary) 15%, transparent) 0%,
            color-mix(in srgb, var(--color-plasma-cyan) 12%, transparent) 50%,
            color-mix(in srgb, var(--color-fridge-primary) 8%, transparent) 100%
          )
        `,borderColor:"color-mix(in srgb, var(--color-fridge-primary) 40%, transparent)",borderRadius:"1.5rem",boxShadow:`
          0 12px 40px color-mix(in srgb, var(--color-fridge-primary) 25%, transparent),
          0 4px 16px rgba(0, 0, 0, 0.3),
          inset 0 2px 0 rgba(255, 255, 255, 0.15),
          inset 0 -2px 0 rgba(0, 0, 0, 0.1)
        `},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-xl",style:{background:`
              radial-gradient(circle at center, 
                color-mix(in srgb, var(--color-fridge-primary) 30%, transparent) 0%,
                color-mix(in srgb, var(--color-fridge-primary) 20%, transparent) 50%,
                color-mix(in srgb, var(--color-fridge-primary) 10%, transparent) 100%
              )
            `,border:"1px solid color-mix(in srgb, var(--color-fridge-primary) 50%, transparent)",boxShadow:`
              0 0 20px color-mix(in srgb, var(--color-fridge-primary) 40%, transparent),
              0 4px 12px rgba(0, 0, 0, 0.2),
              inset 0 1px 0 rgba(255, 255, 255, 0.2)
            `},children:e.jsx(m,{Icon:c.CheckCircle,size:20,className:"text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Inventaire Sélectionné"})]}),e.jsxs("div",{className:"mb-4 p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("p",{className:"text-gray-300 text-sm",children:["Inventaire du ",new Date(s.created_at).toLocaleDateString("fr-FR")]}),e.jsxs("p",{className:"text-white font-medium",children:[s.inventory_final?.length||0," articles détectés"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsx("button",{onClick:a,className:"btn-glass--primary px-4 py-3 text-sm font-medium rounded-2xl",style:{background:`
              linear-gradient(135deg,
                var(--color-fridge-primary) 0%,
                color-mix(in srgb, var(--color-fridge-primary) 80%, #ffffff) 100%
              )
            `,borderColor:"color-mix(in srgb, var(--color-fridge-primary) 70%, transparent)",borderRadius:"1rem",boxShadow:`
              0 8px 24px color-mix(in srgb, var(--color-fridge-primary) 35%, transparent),
              0 3px 12px rgba(0, 0, 0, 0.25),
              inset 0 2px 0 rgba(255, 255, 255, 0.2),
              inset 0 -2px 0 rgba(0, 0, 0, 0.1)
            `,color:"white",transform:"translateZ(0)",transition:"all 0.2s ease"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.ChefHat,size:16}),e.jsx("span",{children:"Générer Recettes"})]})}),e.jsx("button",{onClick:n,className:"btn-glass--primary px-4 py-3 text-sm font-medium rounded-2xl",style:{background:`
              linear-gradient(135deg,
                var(--color-plasma-cyan) 0%,
                color-mix(in srgb, var(--color-plasma-cyan) 80%, #ffffff) 100%
              )
            `,borderColor:"color-mix(in srgb, var(--color-plasma-cyan) 70%, transparent)",borderRadius:"1rem",boxShadow:`
              0 8px 24px color-mix(in srgb, var(--color-plasma-cyan) 35%, transparent),
              0 3px 12px rgba(0, 0, 0, 0.25),
              inset 0 2px 0 rgba(255, 255, 255, 0.2),
              inset 0 -2px 0 rgba(0, 0, 0, 0.1)
            `,color:"white",transform:"translateZ(0)",transition:"all 0.2s ease"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Calendar,size:16}),e.jsx("span",{children:"Plan de Repas"})]})}),e.jsx("button",{onClick:i,className:"btn-glass--danger px-4 py-3 text-sm font-medium rounded-2xl",style:{borderRadius:"1rem"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Trash2,size:16}),e.jsx("span",{children:"Supprimer cet inventaire"})]})})]})]})},bt=({onDeleteAllInventories:s})=>e.jsx("div",{className:"glass-card rounded-3xl",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent)",borderColor:"color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent)",borderRadius:"1.5rem",boxShadow:`
          0 8px 32px color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent),
          0 2px 8px rgba(0, 0, 0, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.1)
        `,overflow:"visible",isolation:"isolate",padding:0,paddingBottom:"1rem"},children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"flex-shrink-0",style:{width:"56px",height:"56px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.22) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent) 0%, transparent 60%),
                linear-gradient(135deg,
                  color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent),
                  color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent))
              `,border:"2px solid color-mix(in srgb, var(--color-plasma-cyan) 45%, transparent)",boxShadow:`
                0 8px 32px color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent),
                0 0 40px color-mix(in srgb, var(--color-plasma-cyan) 18%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.25)
              `,backdropFilter:"blur(16px) saturate(150%)",WebkitBackdropFilter:"blur(16px) saturate(150%)",transform:"translateZ(0)",overflow:"visible"},children:e.jsx(m,{Icon:c.Archive,size:28,style:{color:"#06B6D4",filter:"drop-shadow(0 0 8px rgba(6, 182, 212, 0.6))"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-white mb-1 tracking-tight",children:"Gestion des Inventaires"}),e.jsx("p",{className:"text-gray-400 text-sm md:text-base leading-relaxed",children:"Vos inventaires de frigo sauvegardés"})]})]})})}),ht=({sessions:s,selectedInventorySessionId:t,onInventorySelect:r,formatDate:a,getInventoryPreview:n})=>{const{isPerformanceMode:i}=q();return i||j.div,s.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/60",children:"Aucun inventaire disponible. Scannez votre frigo pour commencer !"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i?s.map(o=>e.jsx("div",{children:e.jsx(I,{className:`fridge-glass-inventory p-6 h-full cursor-pointer group relative overflow-hidden rounded-3xl transform-gpu preserve-3d will-transform transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] ${t===o.id?"fridge-glass-inventory--selected ring-2 ring-indigo-400/50":""}`,onClick:()=>r(o),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"fridge-icon-inventory w-10 h-10",children:e.jsx(m,{Icon:c.Package,size:18,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white text-sm",children:"Inventaire"}),e.jsx("p",{className:"text-white/60 text-xs",children:a(o.created_at)})]})]}),e.jsxs("div",{className:"fridge-badge-success flex items-center gap-1 px-2 py-1",children:[e.jsx(m,{Icon:c.Package,size:12,color:"rgba(16, 185, 129, 1)",variant:"pure"}),e.jsx("span",{className:"text-emerald-300 text-xs font-medium",children:o.inventory_final?.length||0})]})]}),e.jsx("div",{className:"flex-1 mb-4",children:e.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:n(o.inventory_final)})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:`px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 ${t===o.id?"fridge-badge-inventory-active text-cyan-300":"fridge-badge-inventory text-white/60"}`,children:t===o.id?"Sélectionné":"Cliquer pour sélectionner"})})]})})},o.id)):e.jsx(le,{children:s.map((o,l)=>e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:l*.1},children:e.jsx(I,{className:`fridge-glass-inventory p-6 h-full cursor-pointer group relative overflow-hidden rounded-3xl transform-gpu preserve-3d will-transform transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] ${t===o.id?"fridge-glass-inventory--selected ring-2 ring-indigo-400/50":""}`,onClick:()=>r(o),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"fridge-icon-inventory w-10 h-10",children:e.jsx(m,{Icon:c.Package,size:18,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white text-sm",children:"Inventaire"}),e.jsx("p",{className:"text-white/60 text-xs",children:a(o.created_at)})]})]}),e.jsxs("div",{className:"fridge-badge-success flex items-center gap-1 px-2 py-1",children:[e.jsx(m,{Icon:c.Package,size:12,color:"rgba(16, 185, 129, 1)",variant:"pure"}),e.jsx("span",{className:"text-emerald-300 text-xs font-medium",children:o.inventory_final?.length||0})]})]}),e.jsx("div",{className:"flex-1 mb-4",children:e.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:n(o.inventory_final)})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:`px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 ${t===o.id?"fridge-badge-inventory-active text-cyan-300":"fridge-badge-inventory text-white/60"}`,children:t===o.id?"Sélectionné":"Cliquer pour sélectionner"})})]})})},o.id))})})},ft=({loading:s,error:t})=>s?e.jsx(I,{className:"p-8 text-center relative overflow-hidden rounded-3xl transform-gpu preserve-3d will-transform transition-all duration-300",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 60%),
            rgba(255, 255, 255, 0.06)
          `,borderColor:"color-mix(in srgb, #06B6D4 25%, transparent)",backdropFilter:"blur(20px) saturate(160%)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #06B6D4 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center relative",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 20%, transparent) 0%, transparent 60%),
                rgba(255, 255, 255, 0.1)
              `,border:"2px solid color-mix(in srgb, #06B6D4 50%, transparent)",boxShadow:`
                0 8px 32px color-mix(in srgb, #06B6D4 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.2)
              `},children:e.jsx(m,{Icon:c.Loader2,size:24,className:"animate-spin",style:{color:"#06B6D4",filter:"drop-shadow(0 0 8px color-mix(in srgb, #06B6D4 40%, transparent))"},variant:"pure"})}),e.jsx("span",{className:"text-white text-lg font-medium",children:"Chargement de vos inventaires..."})]})}):t?e.jsx(I,{className:"p-6 relative overflow-hidden rounded-3xl transform-gpu preserve-3d will-transform transition-all duration-300",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #EF4444 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #F97316 8%, transparent) 0%, transparent 60%),
            rgba(255, 255, 255, 0.06)
          `,borderColor:"color-mix(in srgb, #EF4444 25%, transparent)",backdropFilter:"blur(20px) saturate(160%)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #EF4444 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center relative",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #EF4444 20%, transparent) 0%, transparent 60%),
                rgba(255, 255, 255, 0.1)
              `,border:"2px solid color-mix(in srgb, #EF4444 50%, transparent)",boxShadow:`
                0 8px 32px color-mix(in srgb, #EF4444 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.2)
              `},children:e.jsx(m,{Icon:c.AlertCircle,size:24,style:{color:"#EF4444",filter:"drop-shadow(0 0 8px color-mix(in srgb, #EF4444 40%, transparent))"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:"Erreur de Chargement"}),e.jsx("p",{className:"text-white/70",children:t})]})]})}):null,vt=({loading:s,sessions:t})=>s||t.length===0?null:e.jsx(I,{className:"p-4 relative overflow-hidden rounded-3xl transform-gpu preserve-3d will-transform transition-all duration-300",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 60%),
          rgba(255, 255, 255, 0.06)
        `,borderColor:"color-mix(in srgb, #06B6D4 20%, transparent)",backdropFilter:"blur(20px) saturate(160%)",boxShadow:`
          0 8px 32px rgba(0, 0, 0, 0.2),
          0 0 20px color-mix(in srgb, #06B6D4 10%, transparent),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{Icon:c.Info,size:16,style:{color:"#06B6D4",filter:"drop-shadow(0 0 6px color-mix(in srgb, #06B6D4 30%, transparent))"},variant:"pure"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-cyan-300 font-medium",children:"Inventaires disponibles : "}),e.jsxs("span",{className:"text-white/80",children:[t.length," inventaire",t.length>1?"s":""," sauvegardé",t.length>1?"s":""]})]})]})}),yt=s=>{const[t,r]=v.useState(!1),[a,n]=v.useState([]),[i,o]=v.useState(null);return v.useEffect(()=>{let l=!0;async function x(){if(!s){n([]);return}r(!0),o(null);try{y.info("FRIDGES_TAB","Loading fridge sessions",{userId:s,timestamp:new Date().toISOString()});const{data:d,error:p}=await H.from("recipe_sessions").select("id, created_at, inventory_final, status").eq("user_id",s).not("inventory_final","is",null).order("created_at",{ascending:!1});if(p)throw new Error(`Failed to fetch fridge sessions: ${p.message}`);if(!l)return;const g=(d||[]).filter(u=>u.inventory_final&&Array.isArray(u.inventory_final)&&u.inventory_final.length>0);n(g),y.info("FRIDGES_TAB","Loaded fridge sessions",{sessionsCount:g.length,timestamp:new Date().toISOString()})}catch(d){if(y.error("FRIDGES_TAB","Failed to load fridge sessions",{error:d instanceof Error?d.message:"Unknown error",userId:s,timestamp:new Date().toISOString()}),!l)return;o("Erreur lors du chargement des inventaires")}finally{l&&r(!1)}}return x(),()=>{l=!1}},[s]),{loading:t,sessions:a,error:i,setSessions:n,setLoading:r}},jt=(s,t,r,a,n)=>{const{showToast:i}=Te(),{showModal:o}=ys(),l=v.useCallback(()=>{!s||t.length===0||o({title:"Supprimer tous les inventaires",message:"Êtes-vous sûr de vouloir supprimer tous vos inventaires de frigo ? Cette action est irréversible.",confirmText:"Supprimer tout",cancelText:"Annuler",onConfirm:async()=>{a(!0);try{const d=t.map(p=>p.id);if(d.length>0){const{error:p}=await H.from("recipes").delete().in("session_id",d);if(p)throw console.error("Error deleting recipes:",p),p;const{error:g}=await H.from("recipe_sessions").delete().eq("user_id",s);if(g)throw console.error("Error deleting recipe sessions:",g),g}r([]),n(null),i("Tous les inventaires ont été supprimés avec succès","success")}catch(d){console.error("Error deleting all inventories:",d),i("Erreur lors de la suppression des inventaires","error")}finally{a(!1)}}})},[s,t,r,a,n,o,i]),x=v.useCallback(d=>{if(!s)return;const p=t.find(g=>g.id===d);p&&o({title:"Supprimer cet inventaire",message:`Êtes-vous sûr de vouloir supprimer l'inventaire du ${new Date(p.created_at).toLocaleDateString("fr-FR")} ? Cette action est irréversible.`,confirmText:"Supprimer",cancelText:"Annuler",onConfirm:async()=>{a(!0);try{const{error:g}=await H.from("recipes").delete().eq("session_id",d);if(g)throw console.error("Error deleting recipes:",g),g;const{error:u}=await H.from("recipe_sessions").delete().eq("id",d).eq("user_id",s);if(u)throw console.error("Error deleting recipe session:",u),u;const h=t.filter(N=>N.id!==d);r(h),n(null),i("Inventaire supprimé avec succès","success")}catch(g){console.error("Error deleting individual inventory:",g),i("Erreur lors de la suppression de l'inventaire","error")}finally{a(!1)}}})},[s,t,r,a,n,o,i]);return{handleDeleteAllInventories:l,handleDeleteIndividualInventory:x}},wt=()=>{const{click:s}=Q(),[t,r]=v.useState(null);return{selectedInventorySessionId:t,handleInventorySelect:n=>{s(),r(n.id),setTimeout(()=>{const i=document.getElementById("selected-inventory-actions");i&&i.scrollIntoView({behavior:"smooth",block:"center"})},100)},setSelectedInventorySessionId:r}},Nt=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),kt=s=>{if(!s||s.length===0)return"Inventaire vide";const t=s.slice(0,3).map(a=>a.name||a.item||"Article").join(", "),r=s.length-3;return r>0?`${t} et ${r} autre${r>1?"s":""}`:t},Cr=()=>{const s=ce(),{showToast:t}=Te(),{session:r}=je(),{startRecipeGenerationFromInventory:a}=we(),{generateMealPlan:n}=Ce(),i=r?.user?.id,{loading:o,sessions:l,error:x,setSessions:d,setLoading:p}=yt(i),{selectedInventorySessionId:g,handleInventorySelect:u,setSelectedInventorySessionId:h}=wt(),{handleDeleteAllInventories:N,handleDeleteIndividualInventory:w}=jt(i,l,d,p,h),F=l.find(C=>C.id===g);return e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-6",children:[!o&&l.length===0&&e.jsx(gt,{}),l.length>0&&e.jsx(bt,{onDeleteAllInventories:N}),e.jsx(ft,{loading:o,error:x}),!o&&!x&&e.jsx(ht,{sessions:l,selectedInventorySessionId:g,onInventorySelect:u,formatDate:Nt,getInventoryPreview:kt}),F&&e.jsx(ut,{session:F,onGenerateRecipes:a,onGenerateMealPlan:n,onDeleteIndividualInventory:w,navigate:s,showToast:t}),e.jsx(vt,{loading:o,sessions:l}),l.length>0&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{onClick:N,className:"btn-glass--danger px-8 py-3 text-base font-medium rounded-2xl",style:{borderRadius:"1rem"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{Icon:c.AlertTriangle,size:20}),e.jsx("span",{children:"Supprimer tous les inventaires"})]})})})]})},us=({recipe:s,isOpen:t,onClose:r})=>s?e.jsx(le,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100]",onClick:r}),e.jsx("div",{className:"fixed inset-0 z-[101] flex items-center justify-center p-4 pointer-events-none",children:e.jsx(j.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"w-full max-w-4xl max-h-[90vh] overflow-auto pointer-events-auto",children:e.jsxs(I,{className:"p-6 relative",children:[e.jsx("button",{onClick:r,className:"absolute top-4 right-4 p-2 rounded-xl bg-white/10 hover:bg-white/20 transition-colors","aria-label":"Fermer",children:e.jsx(hs,{size:20,className:"text-white"})}),s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-64 object-cover rounded-xl mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-white/70 mb-6",children:s.description}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"glass-card p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(m,{Icon:c.Clock,size:16,className:"text-cyan-400"}),e.jsx("span",{className:"text-xs text-white/60",children:"Préparation"})]}),e.jsxs("p",{className:"text-white font-semibold",children:[s.prepTimeMin," min"]})]}),e.jsxs("div",{className:"glass-card p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(m,{Icon:c.Flame,size:16,className:"text-orange-400"}),e.jsx("span",{className:"text-xs text-white/60",children:"Cuisson"})]}),e.jsxs("p",{className:"text-white font-semibold",children:[s.cookTimeMin," min"]})]}),e.jsxs("div",{className:"glass-card p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(m,{Icon:c.Users,size:16,className:"text-pink-400"}),e.jsx("span",{className:"text-xs text-white/60",children:"Portions"})]}),e.jsx("p",{className:"text-white font-semibold",children:s.servings})]})]}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Ingrédients"}),e.jsx("div",{className:"space-y-2",children:s.ingredients.map((a,n)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 mt-1",children:"•"}),e.jsxs("span",{className:"text-white/80",children:[a?.quantity," ",a?.unit&&a.unit," ",a?.name]})]},`ingredient-${s.id}-${n}-${a?.name||n}`))})]}),s.instructions&&s.instructions.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Instructions"}),e.jsx("div",{className:"space-y-4",children:s.instructions.map((a,n)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-cyan-400 font-semibold text-sm",children:a?.step||n+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white/80",children:a?.instruction}),a?.timeMin&&e.jsxs("p",{className:"text-white/50 text-sm mt-1",children:["⏱️ ",a.timeMin," min"]})]})]},a?.step||`step-${n}`))})]}),s.nutritionalInfo&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Informations nutritionnelles"}),e.jsxs("div",{className:"glass-card p-4 rounded-xl grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Calories"}),e.jsxs("p",{className:"text-white font-semibold",children:[s.nutritionalInfo.calories," kcal"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Protéines"}),e.jsxs("p",{className:"text-white font-semibold",children:[s.nutritionalInfo.protein,"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Glucides"}),e.jsxs("p",{className:"text-white font-semibold",children:[s.nutritionalInfo.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Lipides"}),e.jsxs("p",{className:"text-white font-semibold",children:[s.nutritionalInfo.fat,"g"]})]})]})]})]})})})]})}):null,St=({recipe:s,index:t,isSaved:r,isNewlyGenerated:a=!1,isLoading:n=!1,onToggleSaveStatus:i,onView:o})=>{const{click:l}=Q(),{isPerformanceMode:x}=q(),d=x?"div":j.div;if(n)return e.jsx(d,{...!x&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1}},className:"h-full",children:e.jsxs(I,{className:"p-6 h-full flex flex-col",children:[e.jsx("div",{className:"relative mb-4 h-48 rounded-lg overflow-hidden",children:e.jsx("div",{className:"w-full h-full skeleton-glass"})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("div",{className:"h-6 skeleton-glass rounded w-4/5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 skeleton-glass rounded w-full"}),e.jsx("div",{className:"h-4 skeleton-glass rounded w-3/4"}),e.jsx("div",{className:"h-4 skeleton-glass rounded w-1/2"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"h-4 w-12 skeleton-glass rounded"}),e.jsx("div",{className:"h-4 w-16 skeleton-glass rounded"}),e.jsx("div",{className:"h-4 w-8 skeleton-glass rounded"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("div",{className:"h-6 w-16 skeleton-glass rounded-full"}),e.jsx("div",{className:"h-6 w-20 skeleton-glass rounded-full"}),e.jsx("div",{className:"h-6 w-14 skeleton-glass rounded-full"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"h-3 w-32 skeleton-glass rounded"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-3 skeleton-glass rounded w-full"}),e.jsx("div",{className:"h-3 skeleton-glass rounded w-4/5"})]})]})]})});const p=u=>{u.stopPropagation(),l(),i()},g=()=>{o&&(l(),o(s))};return e.jsx(d,{...!x&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1}},className:"relative",children:e.jsxs(I,{className:`p-6 ${x?"":"transition-all duration-300"} cursor-pointer ${a?"ring-1 ring-yellow-400":r?"ring-1 ring-green-400/50":x?"":"hover:bg-white/5"}`,style:x?a?{background:"linear-gradient(145deg, color-mix(in srgb, #eab308 20%, #1e293b), color-mix(in srgb, #eab308 10%, #0f172a))"}:r?{background:"linear-gradient(145deg, color-mix(in srgb, #22c55e 15%, #1e293b), color-mix(in srgb, #22c55e 8%, #0f172a))"}:{background:"linear-gradient(145deg, #1e293b, #0f172a)"}:a?{background:"rgba(234, 179, 8, 0.1)"}:r?{background:"rgba(34, 197, 94, 0.05)"}:{},onClick:g,children:[a&&e.jsx(d,{...!x&&{initial:{scale:0},animate:{scale:1}},className:"absolute top-4 left-4 z-10",children:e.jsx("div",{className:"px-3 py-1 text-xs font-bold rounded-full border",style:x?{background:"color-mix(in srgb, #eab308 30%, #1e293b)",borderColor:"color-mix(in srgb, #eab308 60%, transparent)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",color:"#fbbf24"}:{background:"color-mix(in srgb, #eab308 20%, rgba(255,255,255,0.1))",borderColor:"color-mix(in srgb, #eab308 40%, transparent)",boxShadow:"0 4px 12px rgba(234, 179, 8, 0.3), inset 0 1px 0 rgba(255,255,255,0.2)",backdropFilter:"blur(12px)",color:"#fbbf24"},children:"NOUVEAU"})}),e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsx(d,{onClick:p,className:`w-14 h-14 rounded-full flex items-center justify-center cursor-pointer border ${x?"":"transition-all duration-300 hover:scale-110"}`,style:x?{background:r?"color-mix(in srgb, #ef4444 30%, #1e293b)":"color-mix(in srgb, #22c55e 30%, #1e293b)",borderColor:r?"color-mix(in srgb, #ef4444 60%, transparent)":"color-mix(in srgb, #22c55e 60%, transparent)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"}:{background:r?"color-mix(in srgb, #ef4444 20%, rgba(255,255,255,0.1))":"color-mix(in srgb, #22c55e 20%, rgba(255,255,255,0.1))",borderColor:r?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #22c55e 40%, transparent)",backdropFilter:"blur(12px)"},...!x&&{whileHover:{scale:1.1},whileTap:{scale:.95}},children:e.jsx(m,{Icon:r?c.Trash2:c.Plus,size:18,className:r?"text-red-300":"text-green-300"})})}),e.jsx("div",{className:"relative mb-4 h-48 rounded-lg overflow-hidden bg-gradient-to-br from-green-500/20 to-emerald-500/20",children:n||s.isGeneratingImage?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-white/5 to-white/10 backdrop-blur-sm border border-white/10 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"space-y-3 text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto bg-white/10 rounded-full animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-white/20 rounded animate-pulse"}),e.jsx("div",{className:"h-2 bg-white/15 rounded animate-pulse w-3/4 mx-auto"})]})]})}):s.imageGenerationError?e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-red-500/10 to-red-600/5 backdrop-blur-sm border border-red-400/20 rounded-lg flex flex-col items-center justify-center text-center p-4",children:[e.jsx(m,{Icon:c.Image,size:32,className:"text-red-400 mb-2"}),e.jsx("p",{className:"text-xs text-red-300",children:"Image indisponible"})]}):s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-full object-cover",loading:"lazy"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-white/5 to-white/10 backdrop-blur-sm border border-white/10 rounded-lg flex items-center justify-center",children:e.jsx(m,{Icon:c.ChefHat,size:48,className:"text-white/40"})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xl font-bold text-white line-clamp-2",children:s.title}),s.description&&e.jsx("p",{className:"text-white/80 text-sm line-clamp-3",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 flex-wrap",children:[s.prepTimeMin&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full backdrop-blur-md border text-xs",style:{background:"color-mix(in srgb, #3b82f6 15%, rgba(255,255,255,0.1))",borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",boxShadow:"0 2px 8px rgba(59, 130, 246, 0.2)"},children:[e.jsx(m,{Icon:c.Clock,size:12,className:"text-blue-300"}),e.jsxs("span",{className:"text-blue-200 font-medium",children:[s.prepTimeMin,"min"]})]}),s.cookTimeMin&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full backdrop-blur-md border text-xs",style:{background:"color-mix(in srgb, #f59e0b 15%, rgba(255,255,255,0.1))",borderColor:"color-mix(in srgb, #f59e0b 30%, transparent)",boxShadow:"0 2px 8px rgba(245, 158, 11, 0.2)"},children:[e.jsx(m,{Icon:c.Flame,size:12,className:"text-amber-300"}),e.jsxs("span",{className:"text-amber-200 font-medium",children:[s.cookTimeMin,"min"]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full backdrop-blur-md border text-xs",style:{background:"color-mix(in srgb, #8b5cf6 15%, rgba(255,255,255,0.1))",borderColor:"color-mix(in srgb, #8b5cf6 30%, transparent)",boxShadow:"0 2px 8px rgba(139, 92, 246, 0.2)"},children:[e.jsx(m,{Icon:c.Users,size:12,className:"text-violet-300"}),e.jsx("span",{className:"text-violet-200 font-medium",children:s.servings})]}),s.nutritionalInfo?.calories&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full backdrop-blur-md border text-xs",style:{background:"color-mix(in srgb, #ef4444 15%, rgba(255,255,255,0.1))",borderColor:"color-mix(in srgb, #ef4444 30%, transparent)",boxShadow:"0 2px 8px rgba(239, 68, 68, 0.2)"},children:[e.jsx(m,{Icon:c.Flame,size:12,className:"text-red-300"}),e.jsxs("span",{className:"text-red-200 font-medium",children:[s.nutritionalInfo.calories," kcal"]})]})]}),s.dietaryTags&&s.dietaryTags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[s.dietaryTags.slice(0,3).map((u,h)=>e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-white/10 text-white/80",children:u},h)),s.dietaryTags.length>3&&e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-white/10 text-white/60",children:["+",s.dietaryTags.length-3]})]}),s.reasons&&s.reasons.length>0&&e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsx("p",{className:"text-xs text-white/60 font-medium",children:"Pourquoi cette recette :"}),e.jsx("ul",{className:"text-xs text-white/70 space-y-1",children:s.reasons.slice(0,2).map((u,h)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-green-400 mt-0.5",children:"•"}),e.jsx("span",{children:u})]},h))})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:r?c.BookOpen:c.Book,size:14,className:r?"text-green-400":"text-white/50"}),e.jsx("span",{className:`text-xs ${r?"text-green-400":"text-white/50"}`,children:r?"Dans votre bibliothèque":"Non sauvegardée"})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r?"bg-green-500/20 text-green-400":"bg-white/10 text-white/60"}`,children:r?"Sauvegardée":"Temporaire"})]})]})})},Ct=fe.memo(St),Se=8,It=120,ie=40,ns=6,Re=({value:s,options:t,onChange:r,placeholder:a="Sélectionner...",className:n="","aria-label":i,buttonClassName:o=""})=>{const[l,x]=v.useState(!1),[d,p]=v.useState(!1),[g,u]=v.useState({top:0,left:0,width:0,maxHeight:240}),h=v.useRef(null),N=v.useRef(null),w=v.useRef(null),F=v.useMemo(()=>Math.max(0,t.findIndex(S=>S.value===s)),[t,s]),C=()=>{const S=N.current;if(!S)return;const M=S.getBoundingClientRect(),U=window.innerWidth,L=window.innerHeight,z=M.width,Z=Math.min(Math.max(M.left,Se),Math.max(Se,U-z-Se)),X=L-M.bottom-Se,ee=M.top-Se,ae=X<160&&ee>X;p(ae);const G=Math.max(It,Math.floor(ae?ee:X)),ke=ae?M.top-G:M.bottom;u({top:ke,left:Z,width:z,maxHeight:G})},R=()=>x(S=>!S);v.useEffect(()=>{const S=M=>{const U=M.target;!h.current?.contains(U)&&!w.current?.contains(U)&&x(!1)};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[]),v.useLayoutEffect(()=>{if(!l)return;C();const S=()=>C(),M=()=>C(),U=new ResizeObserver(()=>C());return N.current&&U.observe(N.current),window.addEventListener("scroll",S,!0),window.addEventListener("resize",M),requestAnimationFrame(()=>{if(!w.current)return;const L=g.maxHeight,z=Math.max(0,F*ie-Math.max(0,L/2-ie/2));w.current.scrollTop=z}),()=>{U.disconnect(),window.removeEventListener("scroll",S,!0),window.removeEventListener("resize",M)}},[l]);const[_,b]=v.useState(0);v.useEffect(()=>{if(!l)return;const S=w.current;if(!S)return;const M=()=>b(S.scrollTop);return S.addEventListener("scroll",M,{passive:!0}),()=>S.removeEventListener("scroll",M)},[l]);const k=t.length*ie,A=Math.ceil(g.maxHeight/ie)+ns*2,f=Math.max(0,Math.floor(_/ie)-ns),P=Math.min(t.length,f+A),V=f*ie,W=t.slice(f,P);v.useEffect(()=>{if(!l)return;let S=Math.max(0,F);const M=L=>{const z=w.current;if(!z)return;const Z=L*ie,X=Z+ie;Z<z.scrollTop?z.scrollTop=Z:X>z.scrollTop+z.clientHeight&&(z.scrollTop=X-z.clientHeight)},U=L=>{if(l){if(L.key==="Escape")L.preventDefault(),x(!1),N.current?.focus();else if(L.key==="ArrowDown")L.preventDefault(),S=Math.min(t.length-1,S+1),M(S),w.current?.querySelector(`[data-index='${S}']`)?.focus();else if(L.key==="ArrowUp")L.preventDefault(),S=Math.max(0,S-1),M(S),w.current?.querySelector(`[data-index='${S}']`)?.focus();else if(L.key==="Enter"){const z=document.activeElement;z?.dataset?.value&&(r(z.dataset.value),x(!1))}}};return document.addEventListener("keydown",U),()=>document.removeEventListener("keydown",U)},[l,r,t.length,F]);const K=S=>{r(S),x(!1),N.current?.focus()},T=t.find(S=>S.value===s),pe=e.jsx(le,{children:l&&e.jsx(j.div,{initial:{opacity:0,y:d?6:-6,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:d?6:-6,scale:.98},transition:{duration:.14,ease:"easeOut"},style:{position:"fixed",top:g.top,left:g.left,width:g.width,zIndex:1e5},children:e.jsx(I,{className:"py-1 px-1 overflow-y-auto rounded-2xl",style:{maxHeight:g.maxHeight,background:"linear-gradient(135deg, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0.12) 60%, rgba(255,255,255,0.08) 100%)",backdropFilter:"blur(16px) saturate(160%)",border:CSS.supports("color","color-mix(in srgb, white 28%, transparent)")?"1px solid color-mix(in srgb, white 28%, transparent)":"1px solid rgba(255,255,255,0.28)",boxShadow:"0 12px 32px rgba(0,0,0,0.45), 0 2px 8px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.2)"},ref:w,role:"listbox","aria-label":i,"aria-activedescendant":s||void 0,children:e.jsx("div",{style:{height:k,position:"relative"},children:e.jsx("div",{style:{position:"absolute",insetInlineStart:0,top:V,right:0,left:0},children:e.jsx("div",{className:"space-y-1",children:W.map((S,M)=>{const U=f+M,L=s===S.value;return e.jsx("button",{id:S.value,"data-index":U,"data-value":S.value,type:"button",role:"option","aria-selected":L,onClick:()=>K(S.value),className:`w-full h-10 px-3 text-left text-sm transition-colors outline-none rounded-xl
                                    focus:ring-2 focus:ring-white/30
                                    ${L?"bg-cyan-400/20 text-cyan-300":"text-white/85 hover:bg-white/10"}`,style:{lineHeight:`${ie}px`},children:S.label},S.value)})})})})})})});return e.jsxs("div",{ref:h,className:`relative ${n}`,children:[e.jsxs("button",{ref:N,type:"button",onClick:R,className:`btn-glass w-full justify-between text-left ${o}`,"aria-expanded":l,"aria-haspopup":"listbox","aria-label":i,children:[e.jsx("span",{className:"truncate",children:T?T.label:a}),e.jsx(m,{Icon:c.ChevronDown,size:16,className:`transition-transform duration-200 ${l?"rotate-180":""}`})]}),fs.createPortal(pe,document.body)]})},Et=({availableInventories:s,selectedInventoryId:t,onSelectInventory:r,onGenerateRecipes:a,isGenerating:n})=>{const{click:i}=Q(),{isPerformanceMode:o}=q(),l=o?"div":j.div,x=s.find(h=>h.id===t),d=x&&x.inventory_final.length>0,p=s.map(h=>({value:h.id,label:`Inventaire du ${new Date(h.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})} (${h.inventory_final.length} ingrédients)`,subtitle:new Date(h.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})})),g=()=>{i(),a()},u=h=>{i(),r(h)};return e.jsxs(l,{...!o&&{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5}},children:[e.jsxs(I,{className:"p-5",style:o?{background:"linear-gradient(145deg, color-mix(in srgb, #10B981 20%, #1e293b), color-mix(in srgb, #10B981 10%, #0f172a))",borderColor:"color-mix(in srgb, #10B981 40%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.4)"}:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%)",borderColor:"rgba(16, 185, 129, 0.2)",boxShadow:"0 8px 32px rgba(16, 185, 129, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[e.jsx("div",{className:"flex items-center gap-4 mb-5",children:e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center breathing-icon flex-shrink-0",style:o?{background:"linear-gradient(135deg, color-mix(in srgb, #10B981 35%, #1e293b), color-mix(in srgb, #10B981 25%, #0f172a))",border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.4)"}:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
                `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, #10B981 40%, transparent)"},children:e.jsx(m,{Icon:c.ChefHat,size:40,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:"Générateur de Recettes"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Créez des recettes personnalisées à partir de votre inventaire"})]})]})}),e.jsx("div",{className:"w-full mt-5",children:e.jsx(Re,{options:p,value:t||"",onChange:u,placeholder:"Sélectionner un inventaire",className:"w-full",disabled:n})}),s.length===0&&e.jsx(l,{...!o&&{initial:{opacity:0},animate:{opacity:1}},className:"pt-4 border-t border-white/10 mt-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-400",children:[e.jsx(m,{Icon:c.AlertTriangle,size:16}),e.jsx("span",{children:"Aucun inventaire disponible. Scannez votre frigo pour commencer !"})]})})]}),e.jsx(l,{className:"w-full mt-4",...!o&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1}},children:e.jsx("button",{onClick:g,disabled:!d||n,className:`btn-glass btn-glass--primary w-full px-8 py-4 text-lg font-bold transition-all duration-200 flex items-center justify-center gap-2 ${!d||n?"opacity-50 cursor-not-allowed":""}`,style:d&&!n?o?{background:"linear-gradient(145deg, color-mix(in srgb, #10B981 80%, #1e293b), color-mix(in srgb, #22C55E 70%, #0f172a))",border:"2.5px solid color-mix(in srgb, #10B981 60%, transparent)",boxShadow:"0 8px 32px rgba(16, 185, 129, 0.8), 0 4px 20px rgba(16, 185, 129, 0.6), 0 0 50px rgba(16, 185, 129, 0.4)",color:"white"}:{background:`
              linear-gradient(135deg,
                color-mix(in srgb, #10B981 80%, transparent),
                color-mix(in srgb, #22C55E 70%, transparent)
              )
            `,border:"2px solid color-mix(in srgb, #10B981 60%, transparent)",boxShadow:`
              0 12px 40px rgba(16, 185, 129, 0.5),
              0 8px 32px rgba(16, 185, 129, 0.4),
              0 0 60px rgba(16, 185, 129, 0.3),
              inset 0 2px 0 rgba(255, 255, 255, 0.4),
              inset 0 -2px 0 rgba(0, 0, 0, 0.2)
            `,backdropFilter:"blur(20px) saturate(160%)",WebkitBackdropFilter:"blur(20px) saturate(160%)",color:"white"}:void 0,children:n?e.jsxs(e.Fragment,{children:[e.jsx(m,{Icon:c.Loader2,size:16,className:"animate-spin",style:{color:"white"}}),"Génération..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{Icon:c.Sparkles,size:16,style:{color:"white"}}),"Générer les Recettes"]})})})]})},Ft=({searchFilter:s,setSearchFilter:t,selectedFilters:r,setSelectedFilters:a,recipesCount:n,totalRecipesCount:i,isGenerating:o,maxPrepTime:l,setMaxPrepTime:x,maxCookTime:d,setMaxCookTime:p,minServings:g,setMinServings:u})=>{const[h,N]=v.useState(!1),{isPerformanceMode:w}=q(),F=w?"div":j.div,C=w?"button":j.button,R=["végétarien","vegan","sans gluten","rapide","économique","protéiné","léger","réconfortant"],_=f=>{r.includes(f)?a(r.filter(P=>P!==f)):a([...r,f])},b=()=>{t(""),a([]),x?.(void 0),p?.(void 0),u?.(void 0)},k=s.length>0||r.length>0||l!==void 0||d!==void 0||g!==void 0,A=()=>{N(!h)};return e.jsxs(I,{className:"p-4 space-y-6",style:w?{background:"linear-gradient(145deg, color-mix(in srgb, #10B981 20%, #1e293b), color-mix(in srgb, #10B981 10%, #0f172a))",borderColor:"color-mix(in srgb, #10B981 40%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.4)"}:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #10B981 12%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #34D399 8%, transparent) 0%, transparent 50%),
          rgba(255, 255, 255, 0.05)
        `,borderColor:"color-mix(in srgb, #10B981 25%, transparent)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px color-mix(in srgb, #10B981 15%, transparent),
          0 0 60px color-mix(in srgb, #34D399 10%, transparent),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center breathing-icon",style:w?{background:"linear-gradient(135deg, color-mix(in srgb, #10B981 35%, #1e293b), color-mix(in srgb, #10B981 25%, #0f172a))",border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.4)"}:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, #10B981 40%, transparent)"},children:e.jsx(m,{Icon:c.Filter,size:20,style:{color:"#10B981"}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Filtrer les Recettes"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Affiner votre recherche"})]})]}),e.jsxs("button",{onClick:A,disabled:o,className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"color-mix(in srgb, #10B981 15%, transparent)",border:"1px solid color-mix(in srgb, #10B981 30%, transparent)",color:"color-mix(in srgb, #10B981 80%, white)"},children:[e.jsx(m,{Icon:c.Settings,size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Filtres avancés"}),e.jsx(m,{Icon:h?c.ChevronUp:c.ChevronDown,size:16})]})]}),e.jsx(le,{children:h&&e.jsxs(F,{...!w&&{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3}},className:"space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"search-filter",className:"block text-sm font-medium text-white/80 mb-2",children:"Recherche rapide"}),e.jsx("input",{id:"search-filter",type:"text",placeholder:"Rechercher une recette...",value:s,onChange:f=>t(f.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent",disabled:o})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Temps de préparation max (min)"}),e.jsx("input",{type:"number",placeholder:"Ex: 30",value:l||"",onChange:f=>x?.(f.target.value?parseInt(f.target.value):void 0),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent",disabled:o,min:"1",max:"180"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Temps de cuisson max (min)"}),e.jsx("input",{type:"number",placeholder:"Ex: 45",value:d||"",onChange:f=>p?.(f.target.value?parseInt(f.target.value):void 0),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent",disabled:o,min:"1",max:"300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Portions minimum"}),e.jsx("input",{type:"number",placeholder:"Ex: 2",value:g||"",onChange:f=>u?.(f.target.value?parseInt(f.target.value):void 0),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent",disabled:o,min:"1",max:"12"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-white/80",children:"Tags diététiques"}),k&&e.jsx("button",{onClick:b,className:"text-xs text-green-400 hover:text-green-300 transition-colors",disabled:o,children:"Effacer tout"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(f=>{const P=r.includes(f);return e.jsx(C,{onClick:()=>_(f),disabled:o,className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${P?"bg-green-500 text-white shadow-lg":"bg-white/10 text-white/70 hover:bg-white/20"} disabled:opacity-50 disabled:cursor-not-allowed`,...!w&&{whileHover:o?{}:{scale:1.05},whileTap:o?{}:{scale:.95}},children:f},f)})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-white/60 mt-6 pt-2 border-t border-white/10",children:[e.jsx("span",{children:o?"Génération en cours...":`${n} recette${n>1?"s":""} ${n!==i?`sur ${i}`:""}`}),k&&!o&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Filter,size:14,className:"text-green-400"}),e.jsx("span",{className:"text-green-400",children:"Filtres actifs"})]})]})]})},Dt=()=>{const{isPerformanceMode:s}=q(),t=s?"div":j.div;return e.jsx(t,{...!s&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5}},className:"mb-6",children:e.jsx(I,{className:"fridge-glass-recipes p-8 text-center",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:`fridge-icon-recipes ${s?"":"fridge-ai-focus"} w-20 h-20`,children:e.jsx(m,{Icon:c.Sparkles,size:40,color:"rgba(255, 255, 255, 0.95)",variant:"pure",...!s&&{motionAnimate:{rotate:360},motionTransition:{repeat:1/0,duration:2,ease:"linear"}}})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-2xl font-bold text-white fridge-text-glow-recipes",children:"Création de recettes en cours..."}),e.jsx("p",{className:"text-white/80 text-lg",children:"La Forge Spatiale travaille..."})]}),e.jsx("div",{className:"flex justify-center gap-2",children:[0,1,2].map(r=>e.jsx(t,{className:`w-3 h-3 bg-white/80 rounded-full ${s?"animate-pulse":""}`,...!s&&{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,delay:r*.2,ease:"easeInOut"}}},r))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-white/70",children:[e.jsx(m,{Icon:c.Clock,size:16,color:"var(--fridge-recipes-primary)",variant:"pure"}),e.jsx("span",{children:"Analyse des ingrédients et création des recettes..."})]}),e.jsx("div",{className:"fridge-progress-bar w-full max-w-xs mx-auto",children:e.jsx(t,{className:`fridge-progress-bar-fill ${s?"animate-pulse":""}`,...!s&&{animate:{x:["-100%","100%"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}},style:{width:"50%"}})})]})]})})})},At=({selectedInventoryId:s,availableInventories:t,hasSelectedInventory:r,onGenerateRecipes:a})=>{const n=ce(),{startScan:i}=we(),o=()=>{i(),n("/fridge/scan")},l=r?"Générer vos premières recettes":"Votre bibliothèque de recettes est vide",x=r?"Vous avez un inventaire sélectionné. Générez des recettes personnalisées basées sur vos ingrédients disponibles.":"Commencez par scanner votre frigo pour générer des recettes personnalisées",d=r?"Générer mes recettes":"Scanner mon frigo pour générer des recettes",p=r?a:o;return e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12 py-1",children:e.jsx(I,{className:"p-8",style:{background:`radial-gradient(ellipse at center, 
            rgba(236, 72, 153, 0.15) 0%, 
            rgba(244, 114, 182, 0.08) 50%, 
            rgba(0, 0, 0, 0.4) 100%)`,borderColor:"rgba(236, 72, 153, 0.3)",boxShadow:`
            0 0 30px rgba(236, 72, 153, 0.2),
            0 8px 32px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1)
          `,backdropFilter:"blur(20px) saturate(1.2)"},children:e.jsxs("div",{className:"space-y-6 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl flex items-center justify-center",style:{background:`radial-gradient(circle, 
                rgba(236, 72, 153, 0.3) 0%, 
                rgba(244, 114, 182, 0.15) 70%, 
                transparent 100%)`,border:"1px solid rgba(236, 72, 153, 0.4)",boxShadow:`
                0 0 25px rgba(236, 72, 153, 0.3),
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2)
              `},children:e.jsx(m,{Icon:r?c.Sparkles:c.ChefHat,size:48,className:"text-pink-400",style:{filter:`drop-shadow(0 0 12px rgba(236, 72, 153, 0.8)) 
                         drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3))`}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:l}),e.jsx("p",{className:"text-white/70 text-lg",children:x})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle, 
                    rgba(236, 72, 153, 0.3) 0%, 
                    rgba(244, 114, 182, 0.1) 70%, 
                    transparent 100%)`,border:"1px solid rgba(236, 72, 153, 0.4)",boxShadow:`
                    0 0 20px rgba(236, 72, 153, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(m,{Icon:r?c.Sparkles:c.Camera,size:24,className:"text-pink-400",style:{filter:`drop-shadow(0 0 8px rgba(236, 72, 153, 0.6)) 
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:r?"Génération par la Forge":"Scanner intelligent"}),e.jsx("p",{className:"text-white/60 text-sm",children:r?"Recettes créées par la Forge basées sur vos ingrédients":"Analysez automatiquement vos ingrédients disponibles"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle, 
                    rgba(236, 72, 153, 0.3) 0%, 
                    rgba(244, 114, 182, 0.1) 70%, 
                    transparent 100%)`,border:"1px solid rgba(236, 72, 153, 0.4)",boxShadow:`
                    0 0 20px rgba(236, 72, 153, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(m,{Icon:c.Sparkles,size:24,className:"text-pink-400",style:{filter:`drop-shadow(0 0 8px rgba(236, 72, 153, 0.6)) 
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Forge personnalisée"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Recettes adaptées à vos goûts et contraintes alimentaires"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle, 
                    rgba(236, 72, 153, 0.3) 0%, 
                    rgba(244, 114, 182, 0.1) 70%, 
                    transparent 100%)`,border:"1px solid rgba(236, 72, 153, 0.4)",boxShadow:`
                    0 0 20px rgba(236, 72, 153, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(m,{Icon:c.Clock,size:24,className:"text-pink-400",style:{filter:`drop-shadow(0 0 8px rgba(236, 72, 153, 0.6)) 
                             drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Zéro gaspillage"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Utilisez tous vos ingrédients avant qu'ils ne périment"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:p,className:"group relative px-8 py-4 text-white font-semibold rounded-2xl transform hover:scale-105 transition-all duration-300",style:{background:`linear-gradient(135deg, 
                  rgba(236, 72, 153, 0.8) 0%, 
                  rgba(244, 114, 182, 0.9) 100%)`,border:"2px solid rgba(236, 72, 153, 0.6)",boxShadow:`
                  0 0 30px rgba(236, 72, 153, 0.4),
                  0 8px 25px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2),
                  inset 0 -1px 0 rgba(0, 0, 0, 0.2)
                `,backdropFilter:"blur(10px) saturate(1.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{Icon:r?c.Sparkles:c.Camera,size:24,className:"group-hover:rotate-12 transition-transform duration-300",style:{color:"white",filter:`drop-shadow(0 0 10px rgba(236, 72, 153, 0.8)) 
                             drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3))`}}),e.jsx("span",{className:"text-lg",children:d})]}),e.jsx("div",{className:"absolute inset-0 rounded-2xl blur-xl opacity-50 group-hover:opacity-75 transition-opacity duration-300 -z-10",style:{background:`linear-gradient(135deg, 
                    rgba(236, 72, 153, 0.6) 0%, 
                    rgba(244, 114, 182, 0.6) 100%)`}})]})}),e.jsx("div",{className:"text-white/50 text-sm p-3 rounded-xl",style:{background:`radial-gradient(ellipse at center, 
                rgba(236, 72, 153, 0.1) 0%, 
                transparent 70%)`,border:"1px solid rgba(236, 72, 153, 0.2)",boxShadow:"0 0 15px rgba(236, 72, 153, 0.1)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(m,{Icon:c.Lightbulb,size:16,className:"text-pink-400",style:{filter:"drop-shadow(0 0 6px rgba(236, 72, 153, 0.6))"}}),e.jsx("span",{children:r?"Astuce : Vos recettes seront sauvegardées dans votre bibliothèque personnelle !":"Astuce : Plus votre frigo est rempli, plus vous aurez de recettes créatives !"})]})})]})})})},Rt=({newlyGeneratedRecipes:s,onSaveAllNewRecipes:t,onDiscardNewRecipes:r,isGenerating:a})=>{const[n,i]=v.useState(!1),{click:o}=Q(),{isPerformanceMode:l}=q(),x=l?"div":j.div,d=v.useMemo(()=>{if(s.length===0)return 0;const u=s.reduce((h,N)=>{const w=N.prepTimeMin||0,F=N.cookTimeMin||0;return h+w+F},0);return Math.round(u/s.length)},[s]),p=async()=>{i(!0),o();try{await t()}finally{i(!1)}},g=()=>{o(),r()};return a?e.jsx(x,{...!l&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0}},className:"mb-6",children:e.jsx(I,{className:"p-6 border-2 border-pink-400/30",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-lg animate-pulse"}),e.jsx("div",{className:"h-6 w-48 bg-white/20 rounded animate-pulse"})]}),e.jsx("div",{className:"w-16 h-6 bg-white/20 rounded animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:[1,2,3].map(u=>e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"h-8 w-12 bg-white/20 rounded mx-auto animate-pulse"}),e.jsx("div",{className:"h-4 w-16 bg-white/20 rounded mx-auto animate-pulse"})]},u))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 h-12 bg-white/20 rounded-xl animate-pulse"}),e.jsx("div",{className:"w-full sm:w-auto h-12 bg-white/20 rounded-xl animate-pulse"})]}),e.jsxs("div",{className:"bg-pink-500/10 rounded-lg p-4 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 bg-white/20 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-1/2 bg-white/20 rounded animate-pulse"})]})]})})}):s.length===0?null:e.jsx(x,{...!l&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0}},className:"mb-6",children:e.jsx(I,{className:"p-6 border-2 border-pink-400/30",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(m,{Icon:c.ChefHat,size:32,className:"text-pink-400"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-white",children:[s.length," Nouvelles Recettes Générées !"]}),e.jsx("p",{className:"text-sm text-white/70",children:"Vos recettes personnalisées sont prêtes"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm text-pink-400 font-medium",children:"Prêt !"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:s.length}),e.jsx("div",{className:"text-sm text-white/70",children:"Recettes"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:d}),e.jsx("div",{className:"text-sm text-white/70",children:"Min moy."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:Math.round(s.reduce((u,h)=>u+(h.servings||1),0)/s.length)}),e.jsx("div",{className:"text-sm text-white/70",children:"Portions"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:p,disabled:n,className:"flex-1 bg-gradient-to-r from-green-500/20 to-green-600/20 hover:from-green-500/30 hover:to-green-600/30 border-2 border-green-400/30 rounded-xl px-6 py-3 text-white font-semibold transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Sauvegarde..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{Icon:c.Save,size:20}),e.jsx("span",{children:"Sauvegarder Toutes"})]})}),e.jsxs("button",{onClick:g,disabled:n,className:"bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 rounded-xl px-4 py-3 text-white font-medium transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(m,{Icon:c.Trash2,size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Supprimer"})]})]}),e.jsx("div",{className:"bg-pink-500/10 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm text-white/80",children:[e.jsx("p",{className:"font-medium mb-1",children:"💡 Conseil :"}),e.jsx("p",{children:"Sauvegardez vos recettes préférées pour les retrouver facilement et créer vos listes de courses personnalisées."})]})})]})})})},Pt=({onExportAllRecipes:s,onDeleteAllRecipes:t,recipesCount:r})=>{const{click:a}=Q();return r===0?null:e.jsxs(j.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-center justify-end gap-3 mb-6",children:[e.jsxs(j.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{a(),s()},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium transition-all duration-200",style:{background:"linear-gradient(135deg, color-mix(in srgb, #10B981 20%, transparent), color-mix(in srgb, #10B981 10%, transparent))",border:"1px solid color-mix(in srgb, #10B981 30%, transparent)",boxShadow:`
            0 4px 16px color-mix(in srgb, #10B981 15%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.15)
          `,backdropFilter:"blur(20px) saturate(180%)",color:"#10B981"},title:"Exporter toutes les recettes",children:[e.jsx(m,{Icon:c.Download,size:18,className:"text-green-400"}),e.jsx("span",{className:"text-sm",children:"Exporter"}),e.jsxs("span",{className:"text-xs opacity-70",children:["(",r,")"]})]}),e.jsxs(j.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{a(),t()},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium transition-all duration-200",style:{background:"linear-gradient(135deg, color-mix(in srgb, #EF4444 20%, transparent), color-mix(in srgb, #EF4444 10%, transparent))",border:"1px solid color-mix(in srgb, #EF4444 30%, transparent)",boxShadow:`
            0 4px 16px color-mix(in srgb, #EF4444 15%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.15)
          `,backdropFilter:"blur(20px) saturate(180%)",color:"#EF4444"},title:"Supprimer toutes les recettes",children:[e.jsx(m,{Icon:c.Trash2,size:18,className:"text-red-400"}),e.jsx("span",{className:"text-sm",children:"Supprimer"}),e.jsxs("span",{className:"text-xs opacity-70",children:["(",r,")"]})]})]})},Tt=({userId:s,profile:t,userEditedInventory:r,recipeCandidates:a,clearRecipeCandidates:n,showToast:i,click:o,success:l})=>{const[x,d]=v.useState([]),[p,g]=v.useState(!0),u=v.useMemo(()=>a.filter(b=>!x.some(k=>k.id===b.id)),[a,x]),h=v.useMemo(()=>{const b=new Set(x.map(A=>A.id));return[...a.filter(A=>!b.has(A.id)),...x]},[x,a]),N=async()=>{if(s)try{g(!0),y.info("GENERATED_RECIPES_TAB","Fetching persisted recipes from database",{userId:s,timestamp:new Date().toISOString()});const{data:b,error:k}=await H.from("recipes").select(`
          id,
          session_id,
          title,
          description,
          ingredients,
          instructions,
          prep_time_min,
          cook_time_min,
          servings,
          dietary_tags,
          nutritional_info,
          image_url,
          image_signature,
          reasons,
          created_at,
          updated_at,
          recipe_sessions!inner(user_id)
        `).eq("recipe_sessions.user_id",s).order("created_at",{ascending:!1});if(k)throw new Error(`Failed to fetch recipes: ${k.message}`);const A=(b||[]).map(f=>({id:f.id,sessionId:f.session_id,title:f.title,description:f.description,ingredients:f.ingredients||[],instructions:f.instructions||[],prepTimeMin:f.prep_time_min||0,cookTimeMin:f.cook_time_min||0,servings:f.servings||2,dietaryTags:f.dietary_tags||[],nutritionalInfo:f.nutritional_info||{},imageUrl:f.image_url,imageSignature:f.image_signature,reasons:f.reasons||[],createdAt:f.created_at,updatedAt:f.updated_at,status:"ready"}));d(A),y.info("GENERATED_RECIPES_TAB","Successfully fetched persisted recipes",{userId:s,recipesCount:A.length,timestamp:new Date().toISOString()})}catch(b){y.error("GENERATED_RECIPES_TAB","Failed to fetch persisted recipes",{userId:s,error:b instanceof Error?b.message:"Unknown error",timestamp:new Date().toISOString()}),i({type:"error",title:"Erreur de chargement",message:"Impossible de charger vos recettes sauvegardées.",duration:4e3})}finally{g(!1)}},w=async b=>{if(!s){i({type:"error",title:"Erreur d'authentification",message:"Vous devez être connecté pour sauvegarder des recettes.",duration:4e3});return}try{y.info("GENERATED_RECIPES_TAB","Saving recipe to database",{userId:s,recipeId:b.id,recipeTitle:b.title,timestamp:new Date().toISOString()});let k=b.sessionId;k||(k=crypto.randomUUID());const A={nutrition:t?.nutrition||{},householdDetails:t?.householdDetails||{},mealPrepPreferences:t?.mealPrepPreferences||{},kitchenEquipment:t?.kitchenEquipment||{},foodPreferences:t?.foodPreferences||{},sensoryPreferences:t?.sensoryPreferences||{},macroTargets:t?.macroTargets||{},shoppingPreferences:t?.shoppingPreferences||{}},{error:f}=await H.from("recipe_sessions").upsert({id:k,user_id:s,inventory_final:r||[],selected_recipe_ids:[b.id],preferences_snapshot:A,filters_snapshot:{},status:"completed",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(f)throw new Error(`Failed to create session: ${f.message}`);const{error:P}=await H.from("recipes").upsert({id:b.id,session_id:k,title:b.title,description:b.description,ingredients:b.ingredients,instructions:b.instructions,prep_time_min:b.prepTimeMin,cook_time_min:b.cookTimeMin,servings:b.servings,dietary_tags:b.dietaryTags,nutritional_info:b.nutritionalInfo,...b.imageUrl&&{image_url:b.imageUrl},image_signature:b.imageSignature,reasons:b.reasons,created_at:b.createdAt||new Date().toISOString(),updated_at:new Date().toISOString()});if(P)throw new Error(`Failed to save recipe: ${P.message}`);const V={...b,sessionId:k};d(W=>W.find(T=>T.id===b.id)?W.map(T=>T.id===b.id?V:T):[V,...W]),i({type:"success",title:"Recette sauvegardée",message:`"${b.title}" a été ajoutée à votre bibliothèque.`,duration:3e3}),y.info("GENERATED_RECIPES_TAB","Recipe saved successfully",{userId:s,recipeId:b.id,sessionId:k,timestamp:new Date().toISOString()})}catch(k){y.error("GENERATED_RECIPES_TAB","Failed to save recipe",{userId:s,recipeId:b.id,error:k instanceof Error?k.message:"Unknown error",timestamp:new Date().toISOString()}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder la recette. Veuillez réessayer.",duration:4e3})}},F=async b=>{if(s)try{y.info("GENERATED_RECIPES_TAB","Deleting recipe from database",{userId:s,recipeId:b,timestamp:new Date().toISOString()});const{error:k}=await H.from("recipes").delete().eq("id",b);if(k)throw new Error(`Failed to delete recipe: ${k.message}`);d(f=>f.filter(P=>P.id!==b));const A=x.find(f=>f.id===b);i({type:"success",title:"Recette supprimée",message:`"${A?.title||"La recette"}" a été supprimée de votre bibliothèque.`,duration:3e3}),y.info("GENERATED_RECIPES_TAB","Recipe deleted successfully",{userId:s,recipeId:b,timestamp:new Date().toISOString()})}catch(k){y.error("GENERATED_RECIPES_TAB","Failed to delete recipe",{userId:s,recipeId:b,error:k instanceof Error?k.message:"Unknown error",timestamp:new Date().toISOString()}),i({type:"error",title:"Erreur de suppression",message:"Impossible de supprimer la recette. Veuillez réessayer.",duration:4e3})}},C=async b=>{o(),x.some(A=>A.id===b.id)?(await F(b.id),y.debug("GENERATED_RECIPES_TAB","Recipe removed from library",{recipeId:b.id,recipeTitle:b.title,timestamp:new Date().toISOString()})):(await w(b),y.debug("GENERATED_RECIPES_TAB","Recipe added to library",{recipeId:b.id,recipeTitle:b.title,timestamp:new Date().toISOString()}))},R=async()=>{try{for(const b of u)await w(b);l(),i({type:"success",title:"Recettes sauvegardées !",message:`${u.length} recettes ont été ajoutées à votre collection`,duration:4e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder toutes les recettes",duration:4e3})}},_=()=>{n(),i({type:"info",title:"Recettes supprimées",message:`${u.length} nouvelles recettes ont été supprimées`,duration:3e3})};return v.useEffect(()=>{s&&N()},[s]),{persistedRecipes:x,loadingPersistedRecipes:p,newlyGeneratedRecipes:u,allRecipes:h,fetchPersistedRecipes:N,saveRecipeToDb:w,deleteRecipeFromDb:F,handleToggleSaveStatus:C,handleSaveAllNewRecipes:R,handleDiscardNewRecipes:_}},Bt=({allRecipes:s})=>{const[t,r]=v.useState(""),[a,n]=v.useState([]),[i,o]=v.useState(void 0),[l,x]=v.useState(void 0),[d,p]=v.useState(void 0),[g,u]=v.useState(8),[h,N]=v.useState(8);v.useEffect(()=>{const b=()=>{const A=window.innerWidth<=768?8:9;N(A),u(A)};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]);const w=v.useMemo(()=>s.filter(b=>{const k=b.title.toLowerCase().includes(t.toLowerCase())||b.description?.toLowerCase().includes(t.toLowerCase()),A=a.length===0||a.some(W=>b.dietaryTags?.includes(W)||b.reasons?.includes(W)),f=i===void 0||b.prepTimeMin&&b.prepTimeMin<=i,P=l===void 0||b.cookTimeMin&&b.cookTimeMin<=l,V=d===void 0||b.servings&&b.servings>=d;return k&&A&&f&&P&&V}),[s,t,a,i,l,d]),F=v.useMemo(()=>w.slice(0,g),[w,g]),C=w.length>g;return{searchFilter:t,setSearchFilter:r,selectedFilters:a,setSelectedFilters:n,maxPrepTime:i,setMaxPrepTime:o,maxCookTime:l,setMaxCookTime:x,minServings:d,setMinServings:p,itemsPerPage:g,initialItemsPerPage:h,filteredRecipes:w,displayedRecipes:F,hasMoreRecipes:C,handleLoadMore:()=>{u(b=>b+h)},clearAllFilters:()=>{r(""),n([]),o(void 0),x(void 0),p(void 0),u(h)}}},_t=({allRecipes:s,userId:t,showToast:r,click:a})=>{const n=o=>{let l=`# ${o.title}

`;return o.description&&(l+=`${o.description}

`),l+=`**Temps de préparation:** ${o.prepTimeMin||0} min
`,l+=`**Temps de cuisson:** ${o.cookTimeMin||0} min
`,l+=`**Portions:** ${o.servings||2}

`,o.ingredients&&o.ingredients.length>0&&(l+=`## Ingrédients
`,o.ingredients.forEach(x=>{l+=`- ${x}
`}),l+=`
`),o.instructions&&o.instructions.length>0&&(l+=`## Instructions
`,o.instructions.forEach((x,d)=>{l+=`${d+1}. ${x}
`}),l+=`
`),o.dietaryTags&&o.dietaryTags.length>0&&(l+=`**Tags:** ${o.dietaryTags.join(", ")}

`),l+=`---

`,l};return{handleExportAllRecipes:async()=>{try{if(a(),s.length===0){r({type:"warning",title:"Aucune recette à exporter",message:"Générez d'abord des recettes pour pouvoir les exporter.",duration:3e3});return}y.info("GENERATED_RECIPES_TAB","Exporting all recipes",{userId:t,recipesCount:s.length,timestamp:new Date().toISOString()});let o=`# Mes Recettes Générées

`;o+=`Exporté le ${new Date().toLocaleDateString("fr-FR")} à ${new Date().toLocaleTimeString("fr-FR")}

`,o+=`Total: ${s.length} recette${s.length>1?"s":""}

`,o+="=".repeat(50)+`

`,s.forEach((l,x)=>{o+=n(l)}),await navigator.clipboard.writeText(o),r({type:"success",title:"Recettes exportées !",message:`${s.length} recette${s.length>1?"s ont été copiées":" a été copiée"} dans le presse-papiers.`,duration:4e3}),y.info("GENERATED_RECIPES_TAB","Recipes exported successfully",{userId:t,recipesCount:s.length,timestamp:new Date().toISOString()})}catch(o){y.error("GENERATED_RECIPES_TAB","Failed to export recipes",{userId:t,error:o instanceof Error?o.message:"Unknown error",timestamp:new Date().toISOString()}),r({type:"error",title:"Erreur d'exportation",message:"Impossible d'exporter les recettes. Veuillez réessayer.",duration:4e3})}},formatRecipeForExport:n}},Mt=({allRecipes:s,persistedRecipes:t,newlyGeneratedRecipes:r,userId:a,showToast:n,click:i,clearRecipeCandidates:o,deleteRecipeFromDb:l})=>({handleDeleteAllRecipes:async()=>{try{if(i(),s.length===0){n({type:"warning",title:"Aucune recette à supprimer",message:"Il n'y a aucune recette à supprimer.",duration:3e3});return}y.info("GENERATED_RECIPES_TAB","Deleting all recipes",{userId:a,totalRecipes:s.length,persistedRecipes:t.length,newRecipes:r.length,timestamp:new Date().toISOString()}),o();const d=t.map(p=>l(p.id));await Promise.all(d),n({type:"success",title:"Recettes supprimées !",message:`${s.length} recette${s.length>1?"s ont été supprimées":" a été supprimée"} de votre collection.`,duration:4e3}),y.info("GENERATED_RECIPES_TAB","All recipes deleted successfully",{userId:a,deletedCount:s.length,timestamp:new Date().toISOString()})}catch(d){y.error("GENERATED_RECIPES_TAB","Failed to delete all recipes",{userId:a,error:d instanceof Error?d.message:"Unknown error",timestamp:new Date().toISOString()}),n({type:"error",title:"Erreur de suppression",message:"Impossible de supprimer toutes les recettes. Veuillez réessayer.",duration:4e3})}}}),Ir=()=>{ce();const[s,t]=v.useState(!1),[r,a]=v.useState(null),{click:n,success:i}=Q(),{showToast:o}=Te(),{recipeCandidates:l,loadingState:x,userEditedInventory:d,generateRecipes:p,clearRecipeCandidates:g,startScan:u}=we(),{session:h,profile:N}=je(),w=h?.user?.id,{availableInventories:F,selectedInventoryId:C,selectInventory:R,loadAvailableInventories:_}=Ce(),{persistedRecipes:b,loadingPersistedRecipes:k,newlyGeneratedRecipes:A,allRecipes:f,handleToggleSaveStatus:P,handleSaveAllNewRecipes:V,handleDiscardNewRecipes:W,deleteRecipeFromDb:K}=Tt({userId:w,profile:N,userEditedInventory:d,recipeCandidates:l,clearRecipeCandidates:g,showToast:o,click:n,success:i}),{searchFilter:T,setSearchFilter:pe,selectedFilters:S,setSelectedFilters:M,maxPrepTime:U,setMaxPrepTime:L,maxCookTime:z,setMaxCookTime:Z,minServings:X,setMinServings:ee,filteredRecipes:ae,displayedRecipes:G,hasMoreRecipes:ke,handleLoadMore:Oe}=Bt({allRecipes:f}),{handleExportAllRecipes:Ue}=_t({allRecipes:f,userId:w,showToast:o,click:n}),{handleDeleteAllRecipes:He}=Mt({allRecipes:f,persistedRecipes:b,newlyGeneratedRecipes:A,userId:w,showToast:o,click:n,clearRecipeCandidates:g,deleteRecipeFromDb:K});fe.useEffect(()=>{w&&_()},[w,_]);const Ve=fe.useMemo(()=>{if(!C)return!1;const B=F.find(O=>O.id===C);return B&&B.inventory_final&&B.inventory_final.length>0},[C,F]),We=B=>{if(!B){o({type:"error",title:"Erreur",message:"Les données de la recette sont manquantes",duration:3e3});return}if(!B.title&&!B.ingredients&&!B.instructions){o({type:"error",title:"Recette incomplète",message:"Cette recette ne contient pas assez d'informations pour être affichée",duration:3e3});return}a(B),t(!0)},Ye=()=>{t(!1),a(null)},D=x==="generating"||x==="streaming",ne=f.length>0,Y=k||D;return e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-6",children:[ne&&!Y&&e.jsx(Et,{availableInventories:F,selectedInventoryId:C,onSelectInventory:R,onGenerateRecipes:()=>{const B=F.find(O=>O.id===C);B&&B.inventory_final.length>0?p():o({type:"warning",title:"Aucun inventaire sélectionné",message:"Veuillez sélectionner un inventaire avec des ingrédients pour générer des recettes.",duration:3e3})},isGenerating:D}),D&&!k&&e.jsx(Dt,{}),A.length>0&&e.jsx(Rt,{newlyGeneratedRecipes:A,onSaveAllNewRecipes:V,onDiscardNewRecipes:W,isGenerating:D}),!D&&ne&&!Y&&e.jsxs(e.Fragment,{children:[e.jsx(Ft,{searchFilter:T,setSearchFilter:pe,selectedFilters:S,setSelectedFilters:M,recipesCount:ae.length,totalRecipesCount:f.length,isGenerating:D,maxPrepTime:U,setMaxPrepTime:L,maxCookTime:z,setMaxCookTime:Z,minServings:X,setMinServings:ee}),e.jsx(Pt,{onExportAllRecipes:Ue,onDeleteAllRecipes:He,recipesCount:f.length})]}),!ne&&!Y?e.jsx(At,{selectedInventoryId:C,availableInventories:F,hasSelectedInventory:Ve,onGenerateRecipes:()=>{const B=F.find(O=>O.id===C);B&&B.inventory_final.length>0?p():o({type:"warning",title:"Aucun inventaire sélectionné",message:"Veuillez sélectionner un inventaire avec des ingrédients pour générer des recettes.",duration:3e3})}}):e.jsxs("div",{className:"space-y-4",children:[k&&e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-8",children:e.jsx(I,{className:"p-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto",children:e.jsx(m,{Icon:c.Loader2,size:64,className:"animate-spin text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Chargement de votre bibliothèque..."}),e.jsx("p",{className:"text-white/70",children:"Récupération de vos recettes sauvegardées"})]})]})})}),!k&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(le,{children:G.map((B,O)=>{const Je=b.some($e=>$e.id===B.id),bs=l.some($e=>$e.id===B.id)&&!Je;return e.jsx(Ct,{recipe:B,index:O,isSaved:Je,isNewlyGenerated:bs,isLoading:B.status==="loading"||B.isGeneratingImage,onToggleSaveStatus:()=>P(B),onView:We},B.id)})})}),ke&&e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsxs("button",{onClick:Oe,className:"px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-xl text-white font-medium transition-all duration-200 hover:scale-105",children:["Charger plus de recettes (",ae.length-G.length," restantes)"]})})]}),ne&&ae.length===0&&!Y&&e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8",children:e.jsx(I,{className:"p-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(m,{Icon:c.Search,size:48,className:"mx-auto text-white/50"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Aucune recette trouvée"}),e.jsx("p",{className:"text-white/70",children:"Essayez de modifier vos filtres ou votre recherche"})]})]})})})]}),r&&e.jsx(us,{isOpen:s,onClose:Ye,recipe:r})]})},Fe=(s,t)=>{if(!s)return null;const r=s.mealName||s.title||"Recette non trouvée";let a=`  ${t}: ${r}`;if(s.detailedRecipe){if(s.detailedRecipe.ingredients&&s.detailedRecipe.ingredients.length>0&&(a+=`
    Ingrédients:`,s.detailedRecipe.ingredients.forEach(n=>{const i=typeof n=="string"?n:`${n.quantity||""} ${n.unit||""} ${n.name||n.ingredient||""}`.trim();a+=`
      • ${i}`})),s.detailedRecipe.instructions&&s.detailedRecipe.instructions.length>0&&(a+=`
    Instructions:`,s.detailedRecipe.instructions.forEach((n,i)=>{const o=typeof n=="string"?n:n.step||n.instruction||"";a+=`
      ${i+1}. ${o}`})),s.detailedRecipe.nutritional_info){const n=s.detailedRecipe.nutritional_info;a+=`
    Informations nutritionnelles:`,n.calories&&(a+=`
      • Calories: ${n.calories}`),n.protein&&(a+=`
      • Protéines: ${n.protein}g`),n.carbs&&(a+=`
      • Glucides: ${n.carbs}g`),n.fat&&(a+=`
      • Lipides: ${n.fat}g`)}}else a+=`
    (Détails de la recette non disponibles - générez d'abord la recette détaillée)`;return a},zt=()=>{const{session:s,profile:t}=je(),{currentPlan:r,currentWeek:a,availableInventories:n,selectedInventoryId:i,isGenerating:o,generationProgress:l,loadingMessage:x,currentLoadingTitle:d,currentLoadingSubtitle:p,recipes:g,availableWeeks:u,maxAvailableWeek:h,isWeekAvailable:N,isCurrentWeekActive:w,canGenerateNextWeek:F,getWeekDateRange:C,loadAvailableInventories:R,selectInventory:_,generateMealPlan:b,regenerateWeek:k,generateNextWeek:A,generateSpecificWeek:f,clearPlan:P,setCurrentWeek:V}=Ce(),{click:W,success:K}=Q(),{showToast:T}=Te(),pe=ze(t),S=gs(t,"planning"),[M,U]=v.useState(!1),[L,z]=v.useState(!1),[Z,X]=v.useState(null),ee=s?.user?.id,ae=i&&n.length>0,G=n.find(D=>D.id===i),ke=v.useMemo(()=>{const D=C(a);return{formatted:D.formatted,startDate:D.startDate,endDate:D.endDate}},[a,C]);return v.useEffect(()=>{ee&&R()},[ee,R]),{currentPlan:r,currentWeek:a,availableInventories:n,selectedInventoryId:i,isGenerating:o,generationProgress:l,loadingMessage:x,currentLoadingTitle:d,currentLoadingSubtitle:p,recipes:g,availableWeeks:u,maxAvailableWeek:h,canGenerateNextWeek:F,profileCompletion:pe,featureGuidance:S,nudgeDismissed:M,showRecipeDetailModal:L,selectedRecipeForDetail:Z,userId:ee,hasInventory:ae,selectedInventory:G,weekDateRange:ke,getWeekDateRange:C,loadAvailableInventories:R,selectInventory:_,generateMealPlan:b,regenerateWeek:k,generateNextWeek:A,generateSpecificWeek:f,clearPlan:P,setCurrentWeek:V,setNudgeDismissed:U,setShowRecipeDetailModal:z,setSelectedRecipeForDetail:X,isWeekAvailable:D=>u.includes(D),handleGenerateMealPlan:async()=>{if(!i||!G){T({type:"warning",title:"Inventaire requis",message:"Sélectionnez un inventaire pour générer un plan de repas",duration:3e3});return}if(!t){T({type:"warning",title:"Profil incomplet",message:"Complétez votre profil nutritionnel pour un plan optimal",duration:3e3});return}try{y.info("PLAN_TAB","Starting meal plan generation",{userId:ee,selectedInventoryId:i,inventoryItemsCount:G.inventory_final?.length||0,currentWeek:a,timestamp:new Date().toISOString()}),await b(a,G.inventory_final),K(),T({type:"success",title:"Plan généré !",message:`Plan de repas créé pour la semaine ${a}`,duration:4e3})}catch(D){y.error("PLAN_TAB","Meal plan generation failed",{error:D instanceof Error?D.message:"Unknown error",userId:ee,selectedInventoryId:i,currentWeek:a,timestamp:new Date().toISOString()}),T({type:"error",title:"Erreur de génération",message:"Impossible de générer le plan de repas",duration:4e3})}},handleRegenerateWeek:async()=>{if(console.log("handleRegenerateWeek called",{selectedInventoryId:i,selectedInventory:!!G,currentWeek:a,isGenerating:o,userId:ee}),!(!i||!G)){if(o){console.warn("Cannot regenerate: generation already in progress"),T({type:"warning",title:"Génération en cours",message:"Attendez la fin de la génération actuelle",duration:3e3});return}if(!G.inventory_final||G.inventory_final.length===0){console.warn("Cannot regenerate: no inventory items",{inventoryFinal:G.inventory_final}),T({type:"warning",title:"Inventaire vide",message:"L'inventaire sélectionné ne contient aucun ingrédient",duration:3e3});return}try{console.log("Starting week regeneration",{currentWeek:a,inventoryItemsCount:G.inventory_final.length}),await k(G.inventory_final,a),console.log("Week regeneration successful"),K(),T({type:"success",title:"Semaine régénérée !",message:`Nouveau plan créé pour la semaine ${a}`,duration:3e3})}catch(D){console.error("Week regeneration failed",{error:D instanceof Error?D.message:"Unknown error",currentWeek:a,selectedInventoryId:i}),T({type:"error",title:"Erreur de régénération",message:"Impossible de régénérer la semaine",duration:4e3})}}},handleGenerateNextWeek:async()=>{if(!(!i||!G))try{await A(G.inventory_final),K(),T({type:"success",title:"Semaine suivante générée !",message:`Plan créé pour la semaine ${a+1}`,duration:3e3})}catch{T({type:"error",title:"Erreur de génération",message:"Impossible de générer la semaine suivante",duration:4e3})}},handleExportPlan:async()=>{if(r)try{W();const D=r.days.map(Y=>{const B=[];if(Y.meals.breakfast){const O=Fe(Y.meals.breakfast,"Petit-déjeuner");O&&B.push(O)}if(Y.meals.lunch){const O=Fe(Y.meals.lunch,"Déjeuner");O&&B.push(O)}if(Y.meals.dinner){const O=Fe(Y.meals.dinner,"Dîner");O&&B.push(O)}if(Y.meals.snack){const O=Fe(Y.meals.snack,"Collation");O&&B.push(O)}return`${Y.dayName}
${B.join(`
`)}`}).join(`

`),ne=`Plan de Repas TwinForge - Semaine ${a}

${D}`;await navigator.clipboard.writeText(ne),K(),T({type:"success",title:"Plan exporté !",message:"Le plan de repas a été copié dans le presse-papiers",duration:3e3})}catch{T({type:"error",title:"Erreur d'export",message:"Impossible de copier le plan dans le presse-papiers",duration:3e3})}},handleViewRecipe:D=>{if(!D){T({type:"error",title:"Erreur",message:"Les données de la recette sont manquantes",duration:3e3});return}if(!D.title&&!D.ingredients&&!D.instructions){T({type:"error",title:"Recette incomplète",message:"Cette recette ne contient pas assez d'informations pour être affichée",duration:3e3});return}X(D),z(!0)},handleGenerateAllRecipes:async()=>{if(r)try{for(let D=0;D<r.days.length;D++){const ne=r.days[D];ne&&ne.date&&await Ke(D)}K(),T({type:"success",title:"Toutes les recettes générées !",message:"Les recettes détaillées sont maintenant disponibles",duration:4e3})}catch{T({type:"error",title:"Erreur de génération",message:"Impossible de générer toutes les recettes",duration:4e3})}},generateDetailedRecipeForMeal:js,generateAllDetailedRecipesForDay:Ke}},$t=({nutritionalSummary:s,estimatedWeeklyCost:t})=>{const{isPerformanceMode:r}=q();return s?e.jsxs(I,{className:"p-6",style:r?{background:"linear-gradient(145deg, #1e3a2f, #0f1f1a)",borderColor:"color-mix(in srgb, #10B981 40%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.4)"}:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #10B981 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, #10B981 20%, transparent)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:r?{background:"color-mix(in srgb, #10B981 25%, #1e293b)",border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"}:{background:"color-mix(in srgb, #10B981 15%, transparent)",border:"2px solid color-mix(in srgb, #10B981 25%, transparent)"},children:e.jsx(m,{Icon:c.BarChart3,size:16,style:{color:"#10B981"}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-green-300 font-semibold text-lg",children:"Résumé Nutritionnel"}),e.jsx("p",{className:"text-green-200 text-sm",children:"Moyennes quotidiennes calculées"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-xl border",style:r?{background:"color-mix(in srgb, #f97316 20%, #1e293b)",borderColor:"color-mix(in srgb, #f97316 40%, transparent)"}:{background:"rgba(249, 115, 22, 0.1)",borderColor:"rgba(251, 146, 60, 0.2)"},children:[e.jsx("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:s.avgCaloriesPerDay}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"kcal/jour"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl border",style:r?{background:"color-mix(in srgb, #ef4444 20%, #1e293b)",borderColor:"color-mix(in srgb, #ef4444 40%, transparent)"}:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(248, 113, 113, 0.2)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-red-400 mb-1",children:[s.avgProteinPerDay,"g"]}),e.jsx("div",{className:"text-red-300 text-sm font-medium",children:"Protéines"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl border",style:r?{background:"color-mix(in srgb, #3b82f6 20%, #1e293b)",borderColor:"color-mix(in srgb, #3b82f6 40%, transparent)"}:{background:"rgba(59, 130, 246, 0.1)",borderColor:"rgba(96, 165, 250, 0.2)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:[s.avgCarbsPerDay,"g"]}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Glucides"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl border",style:r?{background:"color-mix(in srgb, #a855f7 20%, #1e293b)",borderColor:"color-mix(in srgb, #a855f7 40%, transparent)"}:{background:"rgba(168, 85, 247, 0.1)",borderColor:"rgba(192, 132, 252, 0.2)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:[s.avgFatPerDay,"g"]}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Lipides"})]})]}),t&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl border text-center",style:r?{background:"color-mix(in srgb, #10B981 20%, #1e293b)",borderColor:"color-mix(in srgb, #10B981 40%, transparent)"}:{background:"rgba(16, 185, 129, 0.1)",borderColor:"rgba(52, 211, 153, 0.2)"},children:[e.jsxs("div",{className:"text-xl font-bold text-green-400 mb-1",children:[t.toFixed(2),"€"]}),e.jsx("div",{className:"text-green-300 text-sm",children:"Coût estimé par semaine"})]})]}):null},Lt=({currentPlan:s,selectedInventoryId:t,availableInventories:r,selectInventory:a,isGenerating:n,currentWeek:i,availableWeeks:o,maxAvailableWeek:l,canGenerateNextWeek:x,setCurrentWeek:d,getWeekDateRange:p,handleGenerateMealPlan:g,isWeekAvailable:u,weekDateRange:h})=>{const{click:N}=Q(),{isPerformanceMode:w}=q(),F=i>1,C=i<l||x,R=o.map(b=>({value:b.toString(),label:`Semaine ${b} - ${p(b).formatted}`})),_=s&&s.weekNumber===i;return e.jsxs(e.Fragment,{children:[s?.nutritionalSummary&&e.jsx($t,{nutritionalSummary:s.nutritionalSummary,estimatedWeeklyCost:s.estimatedWeeklyCost}),e.jsxs(I,{className:"fridge-glass-plans p-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:`fridge-icon-plans ${w?"":"fridge-ai-focus"} w-16 h-16`,children:e.jsx(m,{Icon:c.Calendar,size:32,color:"rgba(255, 255, 255, 0.95)",variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-white",children:"Générateur de Plan Repas"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Organisez vos repas de la semaine avec votre inventaire"})]})]})}),e.jsx(Re,{value:t||"",options:r.map(b=>({value:b.id,label:`Inventaire du ${new Date(b.created_at).toLocaleDateString("fr-FR")} (${b.inventory_final?.length||0} ingrédients)`})),onChange:a,placeholder:"Sélectionner un inventaire...",className:"w-full","aria-label":"Sélectionner l'inventaire pour le plan de repas",disabled:n}),R.length>0&&e.jsx("div",{className:"space-y-4 mt-4 pt-4 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>{N(),d(i-1)},disabled:!F||n,className:"fridge-btn-plans-subtle w-8 h-8 rounded-full flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",title:F?"Semaine précédente":"Aucune semaine précédente disponible",children:e.jsx(m,{Icon:c.ChevronLeft,size:14,color:"var(--fridge-plans-light)",variant:"pure"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(Re,{options:R,value:i.toString(),onChange:b=>{N(),d(parseInt(b))},placeholder:"Sélectionner une semaine",disabled:n,className:"w-full"})}),e.jsx("button",{onClick:()=>{N(),d(i+1)},disabled:!C||n,className:"fridge-btn-plans-subtle w-8 h-8 rounded-full flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",title:C?"Semaine suivante":"Semaine suivante non disponible",children:e.jsx(m,{Icon:c.ChevronRight,size:14,color:"var(--fridge-plans-light)",variant:"pure"})})]})}),s?.nutritionalSummary&&e.jsxs("div",{className:"flex items-center gap-4 mt-4 pt-4 border-t border-white/10 text-sm",children:[e.jsxs("span",{className:"text-purple-300 font-medium",children:["~",Math.round(s.nutritionalSummary.avgCaloriesPerDay)," kcal/jour"]}),e.jsxs("span",{className:"text-cyan-300 font-medium",children:[Math.round(s.nutritionalSummary.avgProteinPerDay),"g protéines/jour"]})]})]}),s&&e.jsx("div",{className:"mt-4",children:!_&&t&&u(i)&&e.jsx(le,{children:e.jsx(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},children:e.jsx("button",{onClick:()=>{N(),g()},disabled:n,className:"fridge-btn-plans-primary w-full px-6 py-3 font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[n?e.jsx(m,{Icon:c.Loader2,size:20,className:"animate-spin",color:"white",variant:"pure"}):e.jsx(m,{Icon:c.Calendar,size:20,color:"white",variant:"pure"}),e.jsx("span",{children:n?"Génération...":`Générer Semaine ${i}`})]})})})})})]})},qt=({progress:s,loadingMessage:t,currentLoadingTitle:r,currentLoadingSubtitle:a})=>{const{isPerformanceMode:n}=q(),i=n?"div":j.div;return e.jsx(i,{...!n&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5}},children:e.jsx(I,{className:"p-8 text-center",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #A855F7 12%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #8B5CF6 30%, transparent)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #8B5CF6 20%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{className:`w-20 h-20 mx-auto rounded-full flex items-center justify-center ${n?"animate-pulse":""}`,style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #8B5CF6 35%, transparent), color-mix(in srgb, #8B5CF6 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #8B5CF6 50%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, #8B5CF6 40%, transparent)"},...!n&&{animate:{scale:[1,1.05,1],opacity:[.8,1,.8]},transition:{duration:2,repeat:1/0}},children:e.jsx(m,{Icon:c.Calendar,size:40,style:{color:"#8B5CF6"}})}),e.jsxs("div",{children:[e.jsx(i,{className:"text-3xl font-bold text-white mb-3",...!n&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4}},style:{textShadow:"0 0 20px color-mix(in srgb, #8B5CF6 60%, transparent)"},children:r||"Génération du Plan Nutritionnel"},r),e.jsx(i,{className:"text-white/90 text-xl mb-2",...!n&&{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1}},children:a||"Préparation de votre plan personnalisé"},a),t&&e.jsx(i,{className:"text-white/70 text-sm",...!n&&{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2}},children:t},t)]}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm text-white/70",children:[e.jsx("span",{children:"Progression"}),e.jsxs("span",{children:[Math.round(s),"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(i,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg,
                    #8B5CF6,
                    #A855F7,
                    #C084FC
                  )`,boxShadow:`
                    0 0 16px color-mix(in srgb, #8B5CF6 70%, transparent),
                    inset 0 1px 0 rgba(255,255,255,0.4)
                  `,width:`${s}%`},...!n&&{initial:{width:0},animate:{width:`${s}%`},transition:{duration:.3,ease:"easeOut"}},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg,
                      transparent 0%,
                      rgba(255,255,255,0.6) 50%,
                      transparent 100%
                    )`,animation:"progressShimmer 2s ease-in-out infinite"}})})})]}),e.jsx("div",{className:"text-sm text-white/60",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(m,{Icon:c.Zap,size:14,style:{color:"#8B5CF6"}}),e.jsx("span",{children:"Analyse de la Forge • Optimisation nutritionnelle • Planification de la Forge"})]})})]})})})},Gt=({currentPlan:s,onGenerateAllRecipes:t,onRegenerateWeek:r,onExportPlan:a,clearPlan:n,isGenerating:i})=>{const[o,l]=v.useState(!1),[x,d]=v.useState(!1),{click:p}=Q(),{isPerformanceMode:g}=q(),u=g?"div":j.div,h=v.useMemo(()=>{if(!s?.days)return{totalMeals:0,generatedRecipes:0,totalUniqueIngredients:0,totalUniqueRecipes:0};let R=0,_=0;const b=new Set,k=new Set;return s.days.forEach(A=>{A.meals&&Object.values(A.meals).forEach(f=>{f&&typeof f=="object"&&(R++,f.detailedRecipe?.id?(k.add(f.detailedRecipe.id),_++):f.recipeId&&k.add(f.recipeId),f.detailedRecipe?.ingredients?f.detailedRecipe.ingredients.forEach(P=>{P.name&&b.add(P.name.toLowerCase())}):f.mainIngredients&&f.mainIngredients.forEach(P=>{b.add(P.toLowerCase())}))})}),{totalMeals:R,generatedRecipes:_,totalUniqueIngredients:b.size,totalUniqueRecipes:k.size}},[s]),N=async()=>{l(!0),p();try{await t()}finally{l(!1)}},w=async()=>{d(!0),p();try{await r()}finally{d(!1)}},F=()=>{p(),a()},C=()=>{p(),n()};return i?null:e.jsx(u,{...!g&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0}},className:"mb-6",children:e.jsx(I,{className:"p-6 border-2 border-purple-400/30",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx(m,{Icon:c.CheckCircle,size:20,className:"text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Plan de repas généré avec succès !"})]}),e.jsxs("div",{className:"text-sm text-purple-300 font-medium",children:["Semaine ",s?.weekNumber||1]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-white/70",children:"Progression des recettes"}),e.jsxs("span",{className:"text-white font-medium",children:[h.generatedRecipes,"/",h.totalMeals]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-400 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:h.totalMeals>0?`${h.generatedRecipes/h.totalMeals*100}%`:"0%"}})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:s?.days?.length||0}),e.jsx("div",{className:"text-sm text-white/70",children:"Jours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:h.totalUniqueRecipes}),e.jsx("div",{className:"text-sm text-white/70",children:"Recettes uniques"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:h.totalUniqueIngredients}),e.jsx("div",{className:"text-sm text-white/70",children:"Ingrédients uniques"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:s?.batchCookingDays?.length>0?s.batchCookingDays.length:h.totalMeals}),e.jsx("div",{className:"text-sm text-white/70",children:s?.batchCookingDays?.length>0?"Jours de batch cooking":"Repas planifiés"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full",children:e.jsx("button",{onClick:N,disabled:o,className:"w-full text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",style:o?void 0:g?{background:"linear-gradient(145deg, color-mix(in srgb, #A855F7 90%, #1e293b), color-mix(in srgb, #9333EA 85%, #0f172a))",border:"2px solid color-mix(in srgb, #A855F7 60%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.5)"}:{background:"linear-gradient(135deg, rgba(168, 85, 247, 0.9) 0%, rgba(147, 51, 234, 0.85) 100%)",backdropFilter:"blur(20px) saturate(160%)",border:"2px solid color-mix(in srgb, #A855F7 60%, transparent)",boxShadow:`
                    0 12px 40px color-mix(in srgb, #A855F7 40%, transparent),
                    0 0 60px color-mix(in srgb, #A855F7 30%, transparent),
                    inset 0 3px 0 rgba(255, 255, 255, 0.4),
                    inset 0 -3px 0 rgba(0, 0, 0, 0.2),
                    inset 2px 0 0 rgba(255, 255, 255, 0.1),
                    inset -2px 0 0 rgba(0, 0, 0, 0.1)
                  `,transform:"translateZ(0)",WebkitBackdropFilter:"blur(20px) saturate(160%)"},children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Génération en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{Icon:c.Zap,size:20}),e.jsx("span",{children:"Valider & Générer toutes les recettes"})]})})}),e.jsxs("div",{className:"w-full flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:F,disabled:o||i,className:"sm:w-auto sm:flex-1 h-10 px-4 flex items-center justify-center bg-white/10 hover:bg-white/20 text-white font-medium rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",title:"Exporter le plan",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Download,size:16}),e.jsx("span",{children:"Exporter"})]})}),e.jsx("button",{onClick:C,disabled:o||i,className:"sm:w-auto sm:flex-1 h-10 px-4 flex items-center justify-center bg-white/10 hover:bg-white/20 text-white font-medium rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",title:"Supprimer le plan",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Trash2,size:16}),e.jsx("span",{children:"Supprimer"})]})}),e.jsx("button",{onClick:w,disabled:x||i,className:"sm:w-auto sm:flex-1 h-10 px-4 flex items-center justify-center bg-white/10 hover:bg-white/20 text-white font-medium rounded-xl transition-all duration-200",title:"Régénérer la semaine",children:x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Régénérer"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.RotateCcw,size:16}),e.jsx("span",{children:"Régénérer"})]})})]})]}),e.jsx("div",{className:"bg-purple-500/10 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm text-white/80",children:[e.jsx("p",{className:"font-medium mb-1",children:"💡 Conseil :"}),e.jsx("p",{children:"Générez toutes les recettes pour obtenir des instructions détaillées et une liste de courses complète."})]})})]})})})},Ot=({dayName:s,date:t,index:r})=>{const{isPerformanceMode:a}=q(),n=a?"div":j.div;return e.jsx(n,{...!a&&{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,delay:r*.05}},children:e.jsxs(I,{className:"p-5",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #6B7280 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, #6B7280 20%, transparent)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #6B7280 15%, transparent)",border:"2px solid color-mix(in srgb, #6B7280 25%, transparent)"},children:e.jsx(m,{Icon:c.CalendarDays,size:16,style:{color:"#6B7280"}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:s}),e.jsx("div",{className:"text-white/60 text-xs",children:new Date(t).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Loader2,size:16,className:"animate-spin text-gray-400"}),e.jsx("span",{className:"text-gray-400 text-xs",children:"Génération..."})]})]}),e.jsx("div",{className:"space-y-3",children:["Petit-déjeuner","Déjeuner","Dîner"].map((i,o)=>e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-4 h-4 bg-white/20 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-white/20 rounded w-24 animate-pulse"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-white/15 rounded w-full animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/15 rounded w-2/3 animate-pulse"})]})]},o))})]})})},Ut=()=>e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-white/5 rounded w-full"}),e.jsx("div",{className:"h-3 bg-white/5 rounded w-5/6"}),e.jsx("div",{className:"h-3 bg-white/5 rounded w-4/5"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-3 bg-white/5 rounded w-16"}),e.jsx("div",{className:"h-3 bg-white/5 rounded w-12"})]})]}),De=({mealType:s,meal:t,onViewRecipe:r,dayIndex:a,onGenerateDetailedRecipe:n})=>{const i=p=>p==="snack"?"snacks":p,o=p=>({breakfast:"#F59E0B",lunch:"#10B981",dinner:"#8B5CF6",snacks:"#EC4899"})[i(p)]||"#6B7280",l=p=>({breakfast:"Coffee",lunch:"Utensils",dinner:"Utensils",snacks:"Coffee"})[i(p)]||"Utensils",x=p=>({breakfast:"Petit-déjeuner",lunch:"Déjeuner",dinner:"Dîner",snacks:"Collations"})[i(p)]||p,d=o(s);return t?.status==="loading"?e.jsx(Ut,{}):e.jsxs("div",{className:"p-4 rounded-xl border transition-all duration-200",style:{background:t?`color-mix(in srgb, ${d} 8%, transparent)`:"rgba(255, 255, 255, 0.05)",borderColor:t?`color-mix(in srgb, ${d} 25%, transparent)`:"rgba(255, 255, 255, 0.15)"},children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c[l(s)],size:16,style:{color:d}}),e.jsx("span",{className:"text-white/80 text-sm font-medium",children:x(s)})]})}),t?e.jsxs("div",{className:"space-y-3",children:[t.imageUrl?e.jsxs("div",{className:"mb-3 relative h-32 overflow-hidden rounded-lg",children:[e.jsx("img",{src:t.imageUrl,alt:t.mealName||t.title,className:"w-full h-full object-cover",onError:p=>{p.currentTarget.style.display="none"}}),e.jsx("div",{className:"absolute top-2 right-2 z-10",children:t.status==="loading"?e.jsxs("button",{disabled:!0,className:"btn-glass px-2 py-1 text-xs rounded-full flex items-center gap-1 cursor-not-allowed",style:{background:"color-mix(in srgb, #6B7280 15%, transparent)",border:"1px solid color-mix(in srgb, #6B7280 25%, transparent)",color:"#9CA3AF"},children:[e.jsx(m,{Icon:c.Loader2,size:12,className:"animate-spin"}),"Génération..."]}):t.isDetailedRecipeGenerated?e.jsxs("button",{onClick:()=>r&&r(t),className:`btn-glass px-2 py-1 text-xs rounded-full flex items-center gap-1 
                             hover:scale-105 transition-all duration-200`,style:{background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,color:d},children:[e.jsx(m,{Icon:c.Eye,size:12}),"Voir"]}):e.jsxs("button",{onClick:()=>{console.log("🍽️ INDIVIDUAL MEAL BUTTON CLICKED: Générer la recette",{dayIndex:a,mealType:s,mealTitle:t.mealName||t.title,hasFunction:!!n}),n(a,s)},className:`btn-glass px-2 py-1 text-xs rounded-full flex items-center gap-1 
                             hover:scale-105 transition-all duration-200`,style:{background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,color:d},children:[e.jsx(m,{Icon:c.Sparkles,size:12}),"Générer"]})})]}):t.isDetailedRecipeGenerated&&!t.imageGenerationError?e.jsxs("div",{className:"mb-3 relative h-32 bg-gradient-to-br from-blue-900/20 to-purple-900/20 rounded-lg flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-blue-400/30 border-t-blue-400 rounded-full"}),e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs("button",{onClick:()=>r&&r(t),className:`btn-glass px-2 py-1 text-xs rounded-full flex items-center gap-1 
                           hover:scale-105 transition-all duration-200`,style:{background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,color:d},children:[e.jsx(m,{Icon:c.Eye,size:12}),"Voir"]})})]}):null,t.imageGenerationError&&e.jsxs("div",{className:"mb-3 relative h-32 bg-gradient-to-br from-gray-800 to-gray-900 rounded-lg flex items-center justify-center",children:[e.jsx(m,{Icon:c.AlertTriangle,size:24,className:"text-orange-400"}),e.jsx("div",{className:"absolute top-2 right-2 z-10",children:t.isDetailedRecipeGenerated?e.jsxs("button",{onClick:()=>r&&r(t),className:`btn-glass px-2 py-1 text-xs rounded-full flex items-center gap-1 
                             hover:scale-105 transition-all duration-200`,style:{background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,color:d},children:[e.jsx(m,{Icon:c.Eye,size:12}),"Voir"]}):e.jsxs("button",{onClick:()=>{console.log("🍽️ INDIVIDUAL MEAL BUTTON CLICKED: Générer la recette",{dayIndex:a,mealType:s,mealTitle:t.mealName||t.title,hasFunction:!!n}),n(a,s)},className:`btn-glass px-2 py-1 text-xs rounded-full flex items-center gap-1 
                             hover:scale-105 transition-all duration-200`,style:{background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,color:d},children:[e.jsx(m,{Icon:c.Sparkles,size:12}),"Générer"]})})]}),e.jsx("h5",{className:"text-white font-semibold text-sm mb-2 leading-tight",children:t.mealName||t.title}),(t.descriptionSummary||t.description)&&e.jsx("p",{className:"text-white/60 text-xs mb-2 line-clamp-2",children:t.descriptionSummary||t.description}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 text-xs text-white/70",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"⏱️"}),e.jsxs("span",{children:[t.estimatedPrepTime||t.prep_time_min||0,"min (prép)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"/"}),e.jsxs("span",{children:[t.estimatedCookTime||t.cook_time_min||0,"min (cuis)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"🔥"}),e.jsxs("span",{children:[t.estimatedCalories||t.calories_est||0," kcal"]})]})]}),t.mealComponents&&t.mealComponents.length>0&&e.jsx("div",{className:"space-y-1 mb-2",children:t.mealComponents.slice(0,2).map((p,g)=>e.jsxs("div",{className:"text-xs text-white/70 flex items-center gap-1",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-white/40"}),e.jsx("span",{children:p})]},g))}),t.dietaryTags&&t.dietaryTags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:t.dietaryTags.slice(0,2).map(p=>e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs",style:{background:`color-mix(in srgb, ${d} 15%, transparent)`,color:d},children:p},p))})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(m,{Icon:c.Plus,size:20,className:"text-white/40 mx-auto mb-2"}),e.jsx("span",{className:"text-white/50 text-sm",children:"Aucun repas planifié"})]})]})},Ht=({day:s,index:t,isEditable:r=!1,onViewRecipe:a,onGenerateDetailedRecipe:n,onGenerateAllDetailedRecipesForDay:i})=>{const{isPerformanceMode:o}=q(),l=o?"div":j.div;if(s.status==="loading")return e.jsx(Ot,{dayName:s.dayName,date:s.date,index:t});const x=s.date===new Date().toISOString().split("T")[0],d=s.isBatchCookingDay,p=()=>{console.log("🔥 BUTTON CLICKED: Générer les Recettes du Jour",{dayIndex:t,dayName:s.dayName,date:s.date,hasFunction:!!i}),i?(console.log("🚀 CALLING onGenerateAllDetailedRecipesForDay with dayIndex:",t),i(t)):console.error("❌ onGenerateAllDetailedRecipesForDay function is not available")};return e.jsx(l,{...!o&&{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,delay:t*.05}},className:"relative group",children:e.jsxs(I,{className:"p-5",style:{background:x?`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #22C55E 12%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #10B981 8%, transparent) 0%, transparent 50%),
              var(--glass-opacity)
            `:d?`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:x?"color-mix(in srgb, #22C55E 30%, transparent)":d?"color-mix(in srgb, #8B5CF6 25%, transparent)":"color-mix(in srgb, #06B6D4 20%, transparent)",boxShadow:x?`
              0 12px 40px rgba(0, 0, 0, 0.25),
              0 0 30px color-mix(in srgb, #22C55E 20%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.15)
            `:`
              0 8px 32px rgba(0, 0, 0, 0.2),
              0 0 20px color-mix(in srgb, #06B6D4 12%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.12)
            `},children:[e.jsxs("div",{className:"absolute top-4 right-4 flex flex-col gap-2 z-10",children:[x&&e.jsx("div",{className:`px-2 py-1 bg-gradient-to-r from-orange-500/80 to-red-500/80 
                          border border-orange-400/60 rounded-lg text-white text-xs font-medium
                          shadow-lg backdrop-blur-sm`,children:"Aujourd'hui"}),d&&e.jsx("div",{className:`px-2 py-1 bg-gradient-to-r from-green-500/80 to-emerald-500/80 
                          border border-green-400/60 rounded-lg text-white text-xs font-medium
                          shadow-lg backdrop-blur-sm`,children:"Planifié"})]}),e.jsx("div",{className:"relative flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:x?"color-mix(in srgb, #22C55E 20%, transparent)":d?"color-mix(in srgb, #8B5CF6 15%, transparent)":"color-mix(in srgb, #06B6D4 15%, transparent)",border:x?"2px solid color-mix(in srgb, #22C55E 40%, transparent)":d?"2px solid color-mix(in srgb, #8B5CF6 30%, transparent)":"2px solid color-mix(in srgb, #06B6D4 25%, transparent)"},children:e.jsx(m,{Icon:x?c.Calendar:d?c.Clock:c.CalendarDays,size:16,style:{color:x?"#22C55E":d?"#8B5CF6":"#06B6D4"}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:s.dayName}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-white/60",children:[e.jsx("span",{children:new Date(s.date).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}),d&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{className:"text-purple-300 font-medium",children:"Batch Cooking"})]})]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"p-4 rounded-xl border",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${x?"#22C55E":d?"#8B5CF6":"#06B6D4"} 12%, transparent) 0%, transparent 60%),
                rgba(255, 255, 255, 0.08)
              `,borderColor:`color-mix(in srgb, ${x?"#22C55E":d?"#8B5CF6":"#06B6D4"} 30%, transparent)`,backdropFilter:"blur(12px) saturate(140%)"},children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(m,{Icon:c.Clock,size:18,style:{color:x?"#22C55E":d?"#8B5CF6":"#06B6D4"}}),e.jsx("span",{className:"text-white font-bold text-xl",children:s.prepTime+s.cookTime}),e.jsx("span",{className:"text-white/70 text-sm font-medium",children:"min"})]}),e.jsx("div",{className:"text-white/60 text-xs",children:"Temps total"})]}),e.jsx("div",{className:"w-px h-8 bg-white/20"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(m,{Icon:c.Flame,size:18,style:{color:"#F59E0B"}}),e.jsx("span",{className:"text-white font-bold text-xl",children:s.totalCalories}),e.jsx("span",{className:"text-white/70 text-sm font-medium",children:"kcal"})]}),e.jsx("div",{className:"text-white/60 text-xs",children:"Calories totales"})]})]})})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(De,{mealType:"breakfast",meal:s.meals?.breakfast,onViewRecipe:a,dayIndex:t,onGenerateDetailedRecipe:n}),e.jsx(De,{mealType:"lunch",meal:s.meals?.lunch,onViewRecipe:a,dayIndex:t,onGenerateDetailedRecipe:n}),e.jsx(De,{mealType:"dinner",meal:s.meals?.dinner,onViewRecipe:a,dayIndex:t,onGenerateDetailedRecipe:n}),s.meals?.snack&&e.jsx(De,{mealType:"snack",meal:s.meals.snack,onViewRecipe:a,dayIndex:t,onGenerateDetailedRecipe:n})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-white/10",children:e.jsx("button",{onClick:p,className:"w-full btn-glass--primary py-3 px-4 text-sm font-semibold",style:{background:`
                linear-gradient(135deg, 
                  color-mix(in srgb, ${x?"#22C55E":d?"#8B5CF6":"#06B6D4"} 80%, transparent), 
                  color-mix(in srgb, ${x?"#10B981":d?"#A855F7":"#0891B2"} 60%, transparent)
                )
              `,border:`2px solid color-mix(in srgb, ${x?"#22C55E":d?"#8B5CF6":"#06B6D4"} 60%, transparent)`,boxShadow:`
                0 8px 32px color-mix(in srgb, ${x?"#22C55E":d?"#8B5CF6":"#06B6D4"} 40%, transparent),
                0 0 40px color-mix(in srgb, ${x?"#22C55E":d?"#8B5CF6":"#06B6D4"} 30%, transparent),
                inset 0 2px 0 rgba(255,255,255,0.4)
              `,backdropFilter:"blur(16px) saturate(150%)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(m,{Icon:c.Sparkles,size:18,className:"text-white",variant:"pure"}),e.jsx("span",{className:"text-white",children:"Générer les Recettes du Jour"}),e.jsx(m,{Icon:c.ArrowRight,size:16,className:"text-white/80",variant:"pure"})]})})})]})})},Vt=({weekNumber:s})=>e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsxs(I,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #10B981 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #22C55E 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #10B981 30%, transparent)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #10B981 20%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center breathing-icon animate-pulse",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 40%, transparent), color-mix(in srgb, #22C55E 30%, transparent))
              `,border:"3px solid color-mix(in srgb, #10B981 60%, transparent)",boxShadow:`
                0 0 40px color-mix(in srgb, #10B981 50%, transparent),
                0 0 80px color-mix(in srgb, #22C55E 30%, transparent),
                inset 0 3px 0 rgba(255,255,255,0.4)
              `},children:e.jsx(m,{Icon:c.Lightbulb,size:32,style:{color:"#10B981",filter:`
                  drop-shadow(0 0 16px color-mix(in srgb, #10B981 90%, transparent))
                  drop-shadow(0 0 32px color-mix(in srgb, #10B981 70%, transparent))
                `},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Votre Guide Nutritionnel de la Forge"}),e.jsxs("p",{className:"text-green-200 text-lg",children:["Analyse personnalisée de votre plan - Semaine ",s]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-green-300/20 rounded-xl w-3/4"}),e.jsx("div",{className:"h-16 bg-white/5 rounded-xl border border-green-400/20 p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-green-200/30 rounded w-full"}),e.jsx("div",{className:"h-3 bg-green-200/30 rounded w-5/6"}),e.jsx("div",{className:"h-3 bg-green-200/30 rounded w-4/5"})]})})]}),e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-green-300/20 rounded-xl w-2/3"}),e.jsx("div",{className:"h-16 bg-white/5 rounded-xl border border-green-400/20 p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-green-200/30 rounded w-full"}),e.jsx("div",{className:"h-3 bg-green-200/30 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-green-200/30 rounded w-5/6"})]})})]}),e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-green-300/20 rounded-xl w-1/2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("div",{className:"h-12 bg-white/5 rounded-xl border border-green-400/20"}),e.jsx("div",{className:"h-12 bg-white/5 rounded-xl border border-green-400/20"})]})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-green-400/20",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Sparkles,size:12}),e.jsx("span",{children:"Génération en cours..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Clock,size:12}),e.jsx("span",{className:"animate-pulse",children:"Analyse en temps réel"})]})]})})]})}),Wt=({aiExplanation:s,weekNumber:t,isLoading:r=!1})=>r||!s?e.jsx(Vt,{weekNumber:t}):e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsxs(I,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #10B981 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #22C55E 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #10B981 30%, transparent)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #10B981 20%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center breathing-icon",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 40%, transparent), color-mix(in srgb, #22C55E 30%, transparent))
              `,border:"3px solid color-mix(in srgb, #10B981 60%, transparent)",boxShadow:`
                0 0 40px color-mix(in srgb, #10B981 50%, transparent),
                0 0 80px color-mix(in srgb, #22C55E 30%, transparent),
                inset 0 3px 0 rgba(255,255,255,0.4)
              `},children:e.jsx(m,{Icon:c.Lightbulb,size:32,style:{color:"#10B981",filter:`
                  drop-shadow(0 0 16px color-mix(in srgb, #10B981 90%, transparent))
                  drop-shadow(0 0 32px color-mix(in srgb, #10B981 70%, transparent))
                `},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Votre Guide Nutritionnel de la Forge"}),e.jsxs("p",{className:"text-green-200 text-lg",children:["Analyse personnalisée de votre plan - Semaine ",t]})]})]}),e.jsxs("div",{className:"space-y-6",children:[s.personalizedReasoning&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-green-300 font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(m,{Icon:c.User,size:18}),"Pourquoi ce plan vous convient"]}),e.jsx("p",{className:"text-green-100 text-sm leading-relaxed bg-white/5 p-4 rounded-xl border border-green-400/20",children:s.personalizedReasoning})]}),s.nutritionalStrategy&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-green-300 font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(m,{Icon:c.Target,size:18}),"Stratégie nutritionnelle"]}),e.jsx("p",{className:"text-green-100 text-sm leading-relaxed bg-white/5 p-4 rounded-xl border border-green-400/20",children:s.nutritionalStrategy})]}),s.adaptationHighlights&&s.adaptationHighlights.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-green-300 font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(m,{Icon:c.Check,size:18}),"Adaptations spécifiques"]}),e.jsx("div",{className:"space-y-2",children:s.adaptationHighlights.map((a,n)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-white/5 border border-green-400/20",children:[e.jsx(m,{Icon:c.ArrowRight,size:14,className:"text-green-400 mt-0.5"}),e.jsx("span",{className:"text-green-100 text-sm leading-relaxed",children:a})]},n))})]}),s.weeklyGoals&&s.weeklyGoals.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-green-300 font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(m,{Icon:c.Flag,size:18}),"Objectifs de la semaine"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.weeklyGoals.map((a,n)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-green-400/20",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-100 text-sm",children:a})]},n))})]}),s.complianceNotes&&s.complianceNotes.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-green-300 font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(m,{Icon:c.Shield,size:18}),"Respect de vos contraintes"]}),e.jsx("div",{className:"space-y-2",children:s.complianceNotes.map((a,n)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-white/5 border border-green-400/20",children:[e.jsx(m,{Icon:c.CheckCircle,size:14,className:"text-green-400 mt-0.5"}),e.jsx("span",{className:"text-green-100 text-sm leading-relaxed",children:a})]},n))})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-green-400/20",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Sparkles,size:12}),e.jsx("span",{children:"Généré par votre Forge Nutritionnelle"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{Icon:c.Clock,size:12}),e.jsx("span",{children:"Mis à jour en temps réel"})]})]})})]})}),Yt=({hasContext:s,onGenerate:t,isGenerating:r,profileCompletion:a,featureGuidance:n,onDismissNudge:i,nudgeDismissed:o,currentWeek:l,isWeekAvailable:x,weekDateRange:d,setCurrentWeek:p})=>{const g=()=>x?s?`Générer Semaine ${l}`:"Scannez votre frigo pour commencer":`Semaine ${l} Non Disponible`,u=()=>x?s?"Votre plan de repas sera généré automatiquement en organisant vos recettes sur 7 jours avec optimisation nutritionnelle.":"Commencez par scanner votre frigo ou sélectionner un inventaire existant pour générer votre plan de repas personnalisé.":"Cette semaine ne peut pas encore être générée. Attendez que la semaine précédente soit terminée pour débloquer la planification.";return e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{className:"p-8 text-center",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #8B5CF6 20%, transparent)"},children:e.jsxs("div",{className:"space-y-6 w-full text-center",children:[e.jsx("div",{className:"flex justify-center items-center w-full",children:e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center breathing-icon",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #8B5CF6 35%, transparent), color-mix(in srgb, #A855F7 25%, transparent))
                `,border:"2px solid color-mix(in srgb, #8B5CF6 50%, transparent)",boxShadow:`
                  0 0 30px color-mix(in srgb, #8B5CF6 40%, transparent),
                  0 0 60px color-mix(in srgb, #8B5CF6 30%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.2)
                `,backdropFilter:"blur(16px) saturate(150%)"},children:e.jsx(m,{Icon:s?c.Calendar:c.Scan,size:40,style:{color:"#8B5CF6",filter:`
                    drop-shadow(0 0 12px color-mix(in srgb, #8B5CF6 80%, transparent))
                    drop-shadow(0 0 24px color-mix(in srgb, #8B5CF6 60%, transparent))
                  `},variant:"pure"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:g()}),e.jsx("div",{className:"text-purple-300 text-sm font-medium mb-3",children:d.formatted}),e.jsx("p",{className:"text-white/70 text-lg leading-relaxed",children:u()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mx-auto",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #8B5CF6 25%, transparent), color-mix(in srgb, #A855F7 15%, transparent))
                  `,border:"1px solid color-mix(in srgb, #8B5CF6 40%, transparent)",boxShadow:`
                    0 0 20px color-mix(in srgb, #8B5CF6 30%, transparent),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15)
                  `,backdropFilter:"blur(12px) saturate(140%)"},children:e.jsx(m,{Icon:c.Sparkles,size:24,style:{color:"#8B5CF6",filter:"drop-shadow(0 0 8px #8B5CF6)"}})}),e.jsx("h4",{className:"text-white font-semibold",children:"Génération par la Forge"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Créez des plans uniques basés sur votre inventaire"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mx-auto",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #8B5CF6 25%, transparent), color-mix(in srgb, #A855F7 15%, transparent))
                  `,border:"1px solid color-mix(in srgb, #8B5CF6 40%, transparent)",boxShadow:`
                    0 0 20px color-mix(in srgb, #8B5CF6 30%, transparent),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15)
                  `,backdropFilter:"blur(12px) saturate(140%)"},children:e.jsx(m,{Icon:c.Save,size:24,style:{color:"#8B5CF6",filter:"drop-shadow(0 0 8px #8B5CF6)"}})}),e.jsx("h4",{className:"text-white font-semibold",children:"Sauvegarde"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Gardez vos plans favoris dans votre bibliothèque"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mx-auto",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #8B5CF6 25%, transparent), color-mix(in srgb, #A855F7 15%, transparent))
                  `,border:"1px solid color-mix(in srgb, #8B5CF6 40%, transparent)",boxShadow:`
                    0 0 20px color-mix(in srgb, #8B5CF6 30%, transparent),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15)
                  `,backdropFilter:"blur(12px) saturate(140%)"},children:e.jsx(m,{Icon:c.Search,size:24,style:{color:"#8B5CF6",filter:"drop-shadow(0 0 8px #8B5CF6)"}})}),e.jsx("h4",{className:"text-white font-semibold",children:"Organisation"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Filtrez et recherchez facilement dans vos plans"})]})]}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("button",{onClick:t,disabled:r||!s||!x,className:"group relative overflow-hidden px-8 py-4 text-lg font-bold transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",style:{background:`
                  linear-gradient(135deg, 
                    color-mix(in srgb, #8B5CF6 90%, transparent) 0%,
                    color-mix(in srgb, #A855F7 80%, transparent) 50%,
                    color-mix(in srgb, #7C3AED 85%, transparent) 100%
                  )
                `,border:"2px solid color-mix(in srgb, #8B5CF6 70%, transparent)",borderRadius:"16px",boxShadow:`
                  0 8px 32px color-mix(in srgb, #8B5CF6 50%, transparent),
                  0 0 40px color-mix(in srgb, #8B5CF6 40%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.4),
                  inset 0 -2px 0 rgba(0, 0, 0, 0.3),
                  inset 2px 0 0 rgba(255, 255, 255, 0.2),
                  inset -2px 0 0 rgba(0, 0, 0, 0.2)
                `,backdropFilter:"blur(20px) saturate(160%)",WebkitBackdropFilter:"blur(20px) saturate(160%)",color:"white",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",transform:"translateZ(0)",willChange:"transform, box-shadow"},children:[e.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300",style:{background:`
                    linear-gradient(135deg, 
                      color-mix(in srgb, #8B5CF6 95%, transparent) 0%,
                      color-mix(in srgb, #A855F7 90%, transparent) 50%,
                      color-mix(in srgb, #7C3AED 95%, transparent) 100%
                    )
                  `,borderRadius:"14px"}}),e.jsxs("div",{className:"relative flex items-center gap-3 z-10",children:[r?e.jsx(m,{Icon:c.Loader2,size:24,className:"animate-spin",style:{color:"white",filter:"drop-shadow(0 0 8px rgba(255, 255, 255, 0.5))"}}):e.jsx(m,{Icon:s?c.Calendar:c.Scan,size:24,style:{color:"white",filter:"drop-shadow(0 0 8px rgba(255, 255, 255, 0.5))"}}),e.jsx("span",{className:"relative",children:r?"Génération en cours...":s?"Générer mon plan de repas":"Scanner mon frigo"})]}),e.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:"linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%)",transform:"translateX(-100%)",animation:"shine 2s infinite",borderRadius:"14px"}})]})}),l>1&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:()=>p(l-1),className:"group relative overflow-hidden px-6 py-3 text-base font-semibold transition-all duration-300 hover:scale-105",style:{background:`
                    linear-gradient(135deg, 
                      color-mix(in srgb, #6B7280 60%, transparent) 0%,
                      color-mix(in srgb, #9CA3AF 50%, transparent) 50%,
                      color-mix(in srgb, #6B7280 55%, transparent) 100%
                    )
                  `,border:"2px solid color-mix(in srgb, #6B7280 50%, transparent)",borderRadius:"12px",boxShadow:`
                    0 4px 16px color-mix(in srgb, #6B7280 30%, transparent),
                    0 0 20px color-mix(in srgb, #6B7280 20%, transparent),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.2)
                  `,backdropFilter:"blur(16px) saturate(140%)",WebkitBackdropFilter:"blur(16px) saturate(140%)",color:"white",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"},children:[e.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300",style:{background:`
                      linear-gradient(135deg, 
                        color-mix(in srgb, #6B7280 70%, transparent) 0%,
                        color-mix(in srgb, #9CA3AF 60%, transparent) 50%,
                        color-mix(in srgb, #6B7280 65%, transparent) 100%
                      )
                    `,borderRadius:"10px"}}),e.jsxs("div",{className:"relative flex items-center gap-2 z-10",children:[e.jsx(m,{Icon:c.ArrowLeft,size:20,style:{color:"white",filter:"drop-shadow(0 0 6px rgba(255, 255, 255, 0.3))"}}),e.jsx("span",{className:"relative",children:"Retour à la semaine précédente"})]})]})}),e.jsx("div",{className:"mt-8 p-4 rounded-lg",style:{background:"color-mix(in srgb, #8B5CF6 8%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 20%, transparent)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(m,{Icon:c.Lightbulb,size:20,className:"text-purple-400 mt-0.5",style:{filter:"drop-shadow(0 0 6px #8B5CF6)"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-purple-300 font-semibold text-sm mb-1",children:"Astuce"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Les plans générés sont dynamiques. Vous pouvez les modifier et les sauvegarder pour les retrouver plus tard."})]})]})})]})}),e.jsx("style",{children:`
        @keyframes shine {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }

        .breathing-icon {
          animation: breathe 3s ease-in-out infinite;
        }

        @keyframes breathe {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.05); }
        }
      `})]})},Jt=({hasInventory:s,isGenerating:t,generationProgress:r,loadingMessage:a,currentLoadingTitle:n,currentLoadingSubtitle:i,currentPlan:o,selectedInventory:l,handleGenerateAllRecipes:x,handleRegenerateWeek:d,handleExportPlan:p,clearPlan:g,handleViewRecipe:u,generateDetailedRecipeForMeal:h,generateAllDetailedRecipesForDay:N,profileCompletion:w,featureGuidance:F,nudgeDismissed:C,setNudgeDismissed:R,currentWeek:_,weekDateRange:b,handleGenerateMealPlan:k,isWeekAvailable:A,setCurrentWeek:f})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(qt,{progress:r,loadingMessage:a,currentLoadingTitle:n,currentLoadingSubtitle:i}),!t&&o&&e.jsxs(e.Fragment,{children:[e.jsx(Gt,{currentPlan:o,onRegenerateWeek:d,onGenerateAllRecipes:x,onExportPlan:p,clearPlan:g,isGenerating:t}),e.jsx(j.div,{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:o.days.filter(P=>P&&P.date).map((P,V)=>e.jsx(Ht,{day:P,index:V,isEditable:!1,onViewRecipe:u,onGenerateDetailedRecipe:h,onGenerateAllDetailedRecipesForDay:N},P.date))})]}),(t||o?.aiExplanation)&&e.jsx(Wt,{aiExplanation:o?.aiExplanation,weekNumber:_,isLoading:t}),!t&&!o&&e.jsx(Yt,{hasContext:s,onGenerate:k,isGenerating:t,profileCompletion:w,featureGuidance:F,onDismissNudge:()=>R(!0),nudgeDismissed:C,currentWeek:_,isWeekAvailable:A(_),weekDateRange:b,setCurrentWeek:f})]}),Kt=({isGenerating:s,currentPlan:t,selectedInventory:r,currentWeek:a})=>e.jsxs(e.Fragment,{children:[!s&&t&&r&&e.jsx(I,{className:"p-4",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #06B6D4 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{Icon:c.Info,size:16,className:"text-cyan-400"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-cyan-300 font-medium",children:"Plan basé sur : "}),e.jsxs("span",{className:"text-white/80",children:["Inventaire du ",new Date(r.created_at).toLocaleDateString(),"(",r.inventory_final?.length||0," ingrédients) + Profil nutritionnel"]}),e.jsxs("span",{className:"text-white/60 ml-2",children:["• Semaine ",a]})]})]})}),!s&&t&&e.jsxs(I,{className:"p-6",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #10B981 8%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #10B981 20%, transparent)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #10B981 15%, transparent)",border:"2px solid color-mix(in srgb, #10B981 25%, transparent)"},children:e.jsx(m,{Icon:c.Lightbulb,size:14,style:{color:"#10B981"}})}),e.jsx("h4",{className:"text-green-300 font-semibold",children:"Conseils de votre Nutritionniste IA"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-green-200",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Personnalisation :"})," Ce plan est adapté à vos objectifs fitness et préférences alimentaires"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Optimisation :"})," Utilise au maximum les ingrédients de votre inventaire sélectionné"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Évolution :"})," Générez une nouvelle semaine pour une progression continue"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Flexibilité :"})," Cliquez sur une recette pour voir les détails complets et instructions"]})]})]})]}),Er=()=>{const{currentPlan:s,currentWeek:t,availableInventories:r,selectedInventoryId:a,isGenerating:n,generationProgress:i,loadingMessage:o,currentLoadingTitle:l,currentLoadingSubtitle:x,availableWeeks:d,maxAvailableWeek:p,isWeekAvailable:g,profileCompletion:u,featureGuidance:h,nudgeDismissed:N,showRecipeDetailModal:w,selectedRecipeForDetail:F,hasInventory:C,selectedInventory:R,weekDateRange:_,canGenerateNextWeek:b,getWeekDateRange:k,selectInventory:A,clearPlan:f,setCurrentWeek:P,setNudgeDismissed:V,setShowRecipeDetailModal:W,setSelectedRecipeForDetail:K,handleGenerateMealPlan:T,handleRegenerateWeek:pe,handleExportPlan:S,handleViewRecipe:M,handleGenerateAllRecipes:U,handleSavePlanAsIs:L,generateDetailedRecipeForMeal:z,generateAllDetailedRecipesForDay:Z}=zt();return e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-6",children:[(s||n)&&e.jsx(Lt,{currentPlan:s,handleExportPlan:S,clearPlan:f,selectedInventoryId:a,availableInventories:r,selectInventory:A,isGenerating:n,currentWeek:t,availableWeeks:d,maxAvailableWeek:p,canGenerateNextWeek:b,setCurrentWeek:P,getWeekDateRange:k,handleGenerateMealPlan:T,isWeekAvailable:g,weekDateRange:_}),e.jsx(Jt,{hasInventory:C,isGenerating:n,generationProgress:i,loadingMessage:o,currentLoadingTitle:l,currentLoadingSubtitle:x,currentPlan:s,selectedInventory:R,handleGenerateAllRecipes:U,handleRegenerateWeek:pe,handleViewRecipe:M,generateDetailedRecipeForMeal:z,setCurrentWeek:P,generateAllDetailedRecipesForDay:Z,profileCompletion:u,featureGuidance:h,nudgeDismissed:N,setNudgeDismissed:V,currentWeek:t,weekDateRange:_,handleGenerateMealPlan:T,isWeekAvailable:g,handleSavePlanAsIs:L}),e.jsx(Kt,{isGenerating:n,currentPlan:s,selectedInventory:R,currentWeek:t}),e.jsx(us,{isOpen:w,onClose:()=>{W(!1),K(null)},recipe:F})]})},Qt=({onGenerate:s,hasAvailableMealPlans:t,onGenerateFromPlan:r,onScanFridge:a})=>{ce();const[n,i]=v.useState(!1),{profile:o}=je(),l=ze(o),x=t?{text:"Générer une liste depuis un plan de repas",icon:c.ShoppingCart,action:r?()=>{y.info("User initiated shopping list generation from meal plan"),r()}:()=>{}}:{text:"Scanner mon frigo pour générer une liste",icon:c.Scan,action:a?()=>{y.info("User initiated fridge scan for shopping list"),a()}:()=>{}},d=t?{title:"Générez votre Liste de Courses",description:"Créez une liste de courses optimisée à partir de vos plans de repas existants ou scannez votre frigo pour une approche personnalisée."}:{title:"Votre Atelier de Courses",description:"Commencez par scanner votre frigo pour générer des listes de courses intelligentes basées sur vos ingrédients actuels."};return e.jsx(I,{className:"w-full",style:{background:"radial-gradient(circle at 20% 50%, rgba(251, 146, 60, 0.15) 0%, rgba(249, 115, 22, 0.1) 50%, rgba(234, 88, 12, 0.05) 100%)",borderColor:"rgba(251, 146, 60, 0.2)",boxShadow:"0 8px 32px rgba(251, 146, 60, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center",style:{background:"radial-gradient(circle, rgba(251, 146, 60, 0.2) 0%, rgba(249, 115, 22, 0.15) 100%)",border:"2px solid rgba(251, 146, 60, 0.3)",boxShadow:"0 8px 24px rgba(251, 146, 60, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:e.jsx(m,{Icon:c.ShoppingCart,size:32,style:{color:"var(--color-plasma-orange)",filter:"drop-shadow(0 2px 4px rgba(251, 146, 60, 0.3))"}})})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:d.title}),e.jsx("p",{className:"text-white/80 text-lg mb-8 max-w-2xl mx-auto",children:d.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:"radial-gradient(circle, rgba(251, 146, 60, 0.15) 0%, rgba(249, 115, 22, 0.1) 100%)",border:"1px solid rgba(251, 146, 60, 0.2)",boxShadow:"0 4px 16px rgba(251, 146, 60, 0.15)"},children:e.jsx(m,{Icon:c.Zap,size:24,style:{color:"var(--color-plasma-orange)",filter:"drop-shadow(0 2px 4px rgba(251, 146, 60, 0.3))"}})}),e.jsx("h4",{className:"text-white font-semibold mb-2",children:"Génération Intelligente"}),e.jsx("h4",{className:"text-white font-semibold mb-2",children:"Génération par la Forge"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Mécanismes de la Forge pour des listes optimisées selon vos besoins nutritionnels."})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:"radial-gradient(circle, rgba(251, 146, 60, 0.15) 0%, rgba(249, 115, 22, 0.1) 100%)",border:"1px solid rgba(251, 146, 60, 0.2)",boxShadow:"0 4px 16px rgba(251, 146, 60, 0.15)"},children:e.jsx(m,{Icon:c.Package,size:24,style:{color:"var(--color-plasma-orange)",filter:"drop-shadow(0 2px 4px rgba(251, 146, 60, 0.3))"}})}),e.jsx("h4",{className:"text-white font-semibold mb-2",children:"Optimisation Budget"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Suggestions d'alternatives économiques sans compromettre la qualité nutritionnelle."})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:"radial-gradient(circle, rgba(251, 146, 60, 0.15) 0%, rgba(249, 115, 22, 0.1) 100%)",border:"1px solid rgba(251, 146, 60, 0.2)",boxShadow:"0 4px 16px rgba(251, 146, 60, 0.15)"},children:e.jsx(m,{Icon:c.Lightbulb,size:24,style:{color:"var(--color-plasma-orange)",filter:"drop-shadow(0 2px 4px rgba(251, 146, 60, 0.3))"}})}),e.jsx("h4",{className:"text-white font-semibold mb-2",children:"Conseils Personnalisés"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Recommandations adaptées à vos préférences alimentaires et contraintes."})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("button",{onClick:x.action,className:"group relative px-8 py-4 rounded-2xl font-semibold text-lg transition-all duration-300 hover:scale-105",style:{background:"linear-gradient(135deg, rgba(251, 146, 60, 0.4) 0%, rgba(249, 115, 22, 0.35) 50%, rgba(234, 88, 12, 0.3) 100%)",border:"2px solid rgba(251, 146, 60, 0.4)",boxShadow:"0 12px 40px rgba(251, 146, 60, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.1)",color:"#FFFFFF",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},children:[e.jsx("div",{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300",style:{background:"linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%)",animation:"shine 2s infinite"}}),e.jsxs("div",{className:"relative flex items-center justify-center gap-3",children:[e.jsx(m,{Icon:x.icon,size:24,style:{color:"#FFFFFF",filter:"drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))"}}),e.jsx("span",{children:x.text})]})]})}),l&&!l.isSufficient&&!n&&e.jsx("div",{className:"mb-8",children:e.jsx(Ns,{completion:l,variant:"banner",onDismiss:()=>i(!0),showDismiss:!0})}),e.jsx("div",{className:"mt-8 p-4 rounded-lg",style:{background:"rgba(251, 146, 60, 0.08)",border:"1px solid rgba(251, 146, 60, 0.15)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(m,{Icon:c.Lightbulb,size:20,style:{color:"var(--color-plasma-orange)",filter:"drop-shadow(0 2px 4px rgba(251, 146, 60, 0.3))"},className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"text-white font-medium mb-1",children:"Astuce TwinForge"}),e.jsx("p",{className:"text-white/70 text-sm",children:t?"Utilisez vos plans de repas existants pour générer des listes de courses optimisées, ou scannez votre frigo pour une approche basée sur vos ingrédients actuels.":"Commencez par scanner votre frigo pour identifier vos ingrédients disponibles et générer des listes de courses personnalisées."})]})]})})]})})},J=(s,t,r)=>CSS.supports(s,t)?t:r,Zt=({currentLoadingTitle:s,currentLoadingSubtitle:t,simulatedProgressPercentage:r})=>{const{isPerformanceMode:a}=q(),n=a?"div":j.div;return e.jsx(I,{className:"border-orange-500/30",style:{background:`
          linear-gradient(135deg, rgba(251, 146, 60, 0.20) 0%, rgba(249, 115, 22, 0.12) 50%, rgba(234, 88, 12, 0.08) 100%)
        `,backdropFilter:"blur(20px) saturate(180%)",border:`1px solid ${J("color","color-mix(in srgb, #fb923c 40%, transparent)","rgba(251, 146, 60, 0.4)")}`,boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.5),
          0 6px 20px rgba(251, 146, 60, 0.3),
          0 2px 8px rgba(251, 146, 60, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1),
          inset 0 -1px 0 rgba(0, 0, 0, 0.3)
        `},children:e.jsxs("div",{className:"p-2 text-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-orange-400/50 to-orange-600/30 blur-xl"}),e.jsxs(n,{...!a&&{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"}},className:`relative w-16 h-16 mx-auto rounded-full flex items-center justify-center shadow-2xl ${a?"animate-spin":""}`,style:{background:`
                radial-gradient(circle at 30% 30%, rgba(251, 146, 60, 0.6) 0%, rgba(249, 115, 22, 0.4) 40%, rgba(234, 88, 12, 0.2) 100%)
              `,border:`1px solid ${J("color","color-mix(in srgb, #fb923c 60%, transparent)","rgba(251, 146, 60, 0.6)")}`,boxShadow:`
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 4px 16px rgba(251, 146, 60, 0.4),
                0 2px 8px rgba(251, 146, 60, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2)
              `},children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-orange-300/30 to-transparent blur-sm"}),e.jsx(m,{Icon:c.ShoppingCart,size:32,className:"relative text-orange-100 drop-shadow-2xl"})]}),!a&&e.jsx(n,{animate:{scale:[1,1.2,1],opacity:[.5,0,.5]},transition:{duration:2,repeat:1/0},className:"absolute inset-0 w-20 h-20 mx-auto rounded-full border-2 border-orange-500/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-2xl font-bold bg-gradient-to-r from-orange-200 to-orange-100 bg-clip-text text-transparent drop-shadow-sm",children:s||"TwinForge génère votre liste..."}),e.jsx("p",{className:"text-white/70 text-sm",children:t||"Intelligence artificielle en action pour vos courses parfaites"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 overflow-hidden",children:e.jsx(n,{className:"h-full bg-gradient-to-r from-orange-400 to-orange-500 rounded-full shadow-lg",...!a&&{initial:{width:0},animate:{width:`${r}%`},transition:{duration:.5,ease:"easeOut"}},style:a?{width:`${r}%`}:void 0})}),e.jsxs("span",{className:"text-orange-200 text-sm font-semibold",children:[Math.round(r),"%"]})]})]})})},Le=[{step:1,title:"Analyse nutritionnelle",progress:15,icon:"User"},{step:2,title:"Vérification inventaire",progress:30,icon:"Package"},{step:3,title:"Extraction des recettes",progress:45,icon:"Utensils"},{step:4,title:"Génération intelligente",progress:70,icon:"ShoppingCart"},{step:5,title:"Optimisation IA",progress:85,icon:"Zap"},{step:6,title:"Finalisation",progress:100,icon:"Check"}],Xt=({simulatedProgressPercentage:s})=>e.jsx(I,{className:"border-white/20",style:{background:`
          linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 50%, rgba(255, 255, 255, 0.03) 100%)
        `,backdropFilter:"blur(20px) saturate(180%)",border:`1px solid ${J("color","color-mix(in srgb, white 25%, transparent)","rgba(255, 255, 255, 0.25)")}`,boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.5),
          0 6px 20px rgba(255, 255, 255, 0.15),
          0 2px 8px rgba(255, 255, 255, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.1),
          inset 0 -1px 0 rgba(0, 0, 0, 0.3)
        `},children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-white/20 to-white/10 blur-sm"}),e.jsxs("div",{className:"relative p-2 rounded-full",style:{background:"rgba(255, 255, 255, 0.15)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:`
                  0 2px 8px rgba(0, 0, 0, 0.2),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2)
                `},children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-white/20 to-transparent blur-sm"}),e.jsx(m,{Icon:c.Clock,className:"relative w-5 h-5 text-white/70 drop-shadow-lg"})]})]}),e.jsx("span",{className:"text-white/80 text-sm font-medium",children:"Étapes de génération TwinForge"})]}),e.jsx("div",{className:"space-y-3",children:Le.map((t,r)=>{t.step/Le.length*100;const a=Math.floor(s/100*Le.length),n=r===a,i=r<a;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[n&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-orange-400/40 to-orange-600/20 blur-md"}),e.jsxs("div",{className:"relative w-10 h-10 rounded-full flex items-center justify-center text-xs font-medium transition-all duration-500",style:i?{background:`
                              radial-gradient(circle at 30% 30%, rgba(251, 146, 60, 0.5) 0%, rgba(249, 115, 22, 0.3) 40%, rgba(234, 88, 12, 0.15) 100%)
                            `,border:`1px solid ${J("color","color-mix(in srgb, #fb923c 60%, transparent)","rgba(251, 146, 60, 0.6)")}`,color:"rgba(251, 146, 60, 0.9)",boxShadow:`
                              0 2px 8px rgba(0, 0, 0, 0.3),
                              0 1px 4px rgba(251, 146, 60, 0.4),
                              inset 0 1px 0 rgba(255, 255, 255, 0.15)
                            `}:n?{background:`
                              radial-gradient(circle at 30% 30%, rgba(251, 146, 60, 0.3) 0%, rgba(249, 115, 22, 0.2) 40%, rgba(234, 88, 12, 0.1) 100%)
                            `,border:`1px solid ${J("color","color-mix(in srgb, #fb923c 40%, transparent)","rgba(251, 146, 60, 0.4)")}`,color:"rgba(251, 146, 60, 0.8)",boxShadow:`
                              0 2px 8px rgba(0, 0, 0, 0.2),
                              inset 0 1px 0 rgba(255, 255, 255, 0.1)
                            `}:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.5)"},children:[n&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-orange-300/20 to-transparent blur-sm"}),i?e.jsx(m,{Icon:c.Check,size:20,className:"relative drop-shadow-lg"}):e.jsx(m,{Icon:c[t.icon],size:20,className:"relative drop-shadow-lg"})]})]}),e.jsx("span",{className:`text-base ${n?"text-white font-medium":"text-white/50"}`,children:t.title})]},t.step)})})]})}),er=()=>{const{isGenerating:s,simulatedProgressPercentage:t,currentLoadingTitle:r,currentLoadingSubtitle:a,startSimulatedProgress:n,stopSimulatedProgress:i}=Pe();return fe.useEffect(()=>(s&&n(),()=>{s||i()}),[s,n,i]),v.useEffect(()=>(n(),()=>{i()}),[n,i]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Zt,{currentLoadingTitle:r,currentLoadingSubtitle:a,simulatedProgressPercentage:t}),e.jsx(Xt,{simulatedProgressPercentage:t})]})},sr=({shoppingList:s,completedCount:t,totalCount:r,progressPercentage:a,onReset:n})=>{const{isPerformanceMode:i}=q(),o=i?"div":j.div;return e.jsx(I,{className:"border-cyan-500/30 p-1",style:i?{background:"linear-gradient(145deg, color-mix(in srgb, #06b6d4 20%, #1e293b), color-mix(in srgb, #06b6d4 10%, #0f172a))",border:"1px solid color-mix(in srgb, #06b6d4 40%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.4)"}:{background:`
          radial-gradient(circle at 30% 20%, rgba(6, 182, 212, 0.15) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, rgba(8, 145, 178, 0.10) 0%, transparent 50%),
          linear-gradient(135deg, rgba(6, 182, 212, 0.12) 0%, rgba(8, 145, 178, 0.08) 50%, rgba(14, 116, 144, 0.06) 100%)
        `,backdropFilter:"blur(24px) saturate(180%)",border:`1px solid ${J("color","color-mix(in srgb, #06b6d4 35%, transparent)","rgba(6, 182, 212, 0.35)")}`,boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.4),
          0 6px 20px rgba(6, 182, 212, 0.20),
          0 2px 8px rgba(6, 182, 212, 0.25),
          inset 0 2px 0 rgba(255, 255, 255, 0.15),
          inset 0 -1px 0 rgba(0, 0, 0, 0.2)
        `},children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-cyan-400/40 to-cyan-600/25 blur-2xl"}),e.jsxs("div",{className:"relative w-16 h-16 rounded-full flex items-center justify-center shadow-2xl breathing-icon",style:i?{background:"linear-gradient(135deg, color-mix(in srgb, #06b6d4 35%, #1e293b), color-mix(in srgb, #06b6d4 25%, #0f172a))",border:"2px solid color-mix(in srgb, #06b6d4 50%, transparent)",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.4)"}:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    radial-gradient(circle at 70% 70%, rgba(6, 182, 212, 0.4) 0%, rgba(8, 145, 178, 0.3) 50%, rgba(14, 116, 144, 0.2) 100%)
                  `,border:`2px solid ${J("color","color-mix(in srgb, #06b6d4 50%, transparent)","rgba(6, 182, 212, 0.5)")}`,boxShadow:`
                    0 8px 32px rgba(0, 0, 0, 0.3),
                    0 4px 16px rgba(6, 182, 212, 0.3),
                    0 2px 8px rgba(6, 182, 212, 0.4),
                    0 0 40px rgba(6, 182, 212, 0.25),
                    inset 0 2px 0 rgba(255, 255, 255, 0.25),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.15)
                  `},children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-cyan-300/20 to-transparent blur-sm"}),e.jsx(m,{Icon:c.ShoppingCart,size:32,className:"relative text-cyan-100 drop-shadow-2xl"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold bg-gradient-to-r from-cyan-200 to-cyan-100 bg-clip-text text-transparent drop-shadow-sm",children:s.name}),e.jsx("p",{className:"text-white/70 text-sm",children:s.generationMode==="user_and_family"?"Liste familiale":"Liste personnelle"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-cyan-200/70 font-medium",children:"Progression des courses"}),e.jsxs("span",{className:"text-cyan-200 font-semibold",children:[t,"/",r," articles"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 overflow-hidden",children:e.jsx(o,{className:"h-full rounded-full shadow-lg",style:{background:"linear-gradient(90deg, rgba(16, 185, 129, 0.9) 0%, rgba(5, 150, 105, 0.95) 100%)",width:i?`${a}%`:void 0},...!i&&{initial:{width:0},animate:{width:`${a}%`},transition:{duration:.5}}})})]}),e.jsx("button",{onClick:n,className:"w-full mt-4 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 btn-glass",style:i?{background:"linear-gradient(145deg, color-mix(in srgb, #06b6d4 80%, #1e293b), color-mix(in srgb, #0891b2 75%, #0f172a))",border:"2px solid color-mix(in srgb, #06b6d4 60%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.5)",color:"white"}:{background:`
              linear-gradient(135deg,
                color-mix(in srgb, #06b6d4 80%, transparent),
                color-mix(in srgb, #0891b2 75%, transparent)
              )
            `,border:`2px solid ${J("color","color-mix(in srgb, #06b6d4 60%, transparent)","rgba(6, 182, 212, 0.6)")}`,boxShadow:`
              0 8px 32px color-mix(in srgb, #06b6d4 35%, transparent),
              0 0 40px color-mix(in srgb, #06b6d4 25%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.3),
              inset 0 -2px 0 rgba(0, 0, 0, 0.2)
            `,backdropFilter:"blur(20px) saturate(160%)",color:"white"},children:"Nouvelle liste"})]})})},tr=({budgetEstimation:s})=>!s||!s.estimated_cost||s.estimated_cost==="Non estimé"?null:e.jsx(I,{className:"border-slate-400/30 p-1 mb-4",style:{background:`
          linear-gradient(135deg, 
            rgba(148, 163, 184, 0.15) 0%, 
            rgba(100, 116, 139, 0.12) 25%,
            rgba(71, 85, 105, 0.08) 50%,
            rgba(51, 65, 85, 0.06) 75%,
            rgba(30, 41, 59, 0.04) 100%
          )
        `,backdropFilter:"blur(24px) saturate(200%)",border:`1px solid ${J("color","color-mix(in srgb, #94a3b8 30%, transparent)","rgba(148, 163, 184, 0.3)")}`,boxShadow:`
          0 16px 48px rgba(0, 0, 0, 0.4),
          0 8px 24px rgba(148, 163, 184, 0.15),
          0 4px 12px rgba(148, 163, 184, 0.2),
          0 2px 6px rgba(148, 163, 184, 0.25),
          inset 0 1px 0 rgba(255, 255, 255, 0.15),
          inset 0 -1px 0 rgba(0, 0, 0, 0.2),
          inset 1px 0 0 rgba(255, 255, 255, 0.08),
          inset -1px 0 0 rgba(0, 0, 0, 0.08)
        `},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-slate-300/40 to-slate-500/20 blur-xl"}),e.jsxs("div",{className:"relative w-12 h-12 rounded-full flex items-center justify-center shadow-2xl",style:{background:`
                  radial-gradient(circle at 30% 30%, 
                    rgba(148, 163, 184, 0.4) 0%, 
                    rgba(100, 116, 139, 0.3) 40%, 
                    rgba(71, 85, 105, 0.2) 70%,
                    rgba(51, 65, 85, 0.1) 100%
                  )
                `,border:`1px solid ${J("color","color-mix(in srgb, #94a3b8 50%, transparent)","rgba(148, 163, 184, 0.5)")}`,boxShadow:`
                  0 8px 32px rgba(0, 0, 0, 0.3),
                  0 4px 16px rgba(148, 163, 184, 0.2),
                  0 2px 8px rgba(148, 163, 184, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.25),
                  inset 0 -1px 0 rgba(0, 0, 0, 0.15)
                `},children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-slate-200/20 to-transparent blur-sm"}),e.jsx(m,{Icon:c.DollarSign,size:24,className:"relative text-slate-200 drop-shadow-lg"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold bg-gradient-to-r from-slate-200 to-slate-300 bg-clip-text text-transparent drop-shadow-sm",children:"Budget estimé"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-100 drop-shadow-lg",children:s.estimated_cost}),s.confidence_level&&e.jsx("span",{className:"text-xs text-slate-300/80 font-medium",children:s.confidence_level})]})]})]}),s.notes&&s.notes.length>0&&e.jsx("div",{className:"mt-3 p-3 rounded-lg",style:{background:`
                linear-gradient(135deg, 
                  rgba(148, 163, 184, 0.08) 0%, 
                  rgba(100, 116, 139, 0.06) 50%,
                  rgba(71, 85, 105, 0.04) 100%
                )
              `,border:`1px solid ${J("color","color-mix(in srgb, #94a3b8 20%, transparent)","rgba(148, 163, 184, 0.2)")}`,boxShadow:`
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1)
              `},children:e.jsx("div",{className:"space-y-1",children:s.notes.map((t,r)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-slate-300/90",children:[e.jsx("div",{className:"w-1 h-1 rounded-full mt-1.5 flex-shrink-0",style:{background:"linear-gradient(45deg, rgba(148, 163, 184, 0.6), rgba(100, 116, 139, 0.4))",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.2)"}}),e.jsx("span",{children:t})]},r))})})]})}),rr=({suggestions:s})=>!s||s.length===0?null:e.jsxs(I,{className:"border-blue-500/30 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center",children:e.jsx(m,{Icon:c.Lightbulb,size:20,className:"text-blue-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Suggestions Complémentaires"})]}),e.jsx("div",{className:"space-y-2",children:s.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-white/5",children:[e.jsx(m,{Icon:c.Plus,size:16,className:"text-blue-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:t.name}),t.reason&&e.jsx("p",{className:"text-white/70 text-sm",children:t.reason})]}),t.estimatedPrice&&e.jsxs("span",{className:"text-blue-400 font-medium",children:[t.estimatedPrice,"€"]})]},r))})]}),ar=({advice:s})=>!s||s.length===0?null:e.jsxs(I,{className:"border-green-500/30 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(m,{Icon:c.CheckCircle,size:20,className:"text-green-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Conseils Personnalisés"})]}),e.jsx("div",{className:"space-y-3",children:s.map((t,r)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 flex-shrink-0 mt-2"}),e.jsx("p",{className:"text-white/90 text-sm leading-relaxed",children:t})]},r))})]}),nr=({item:s,itemKey:t,isChecked:r,onToggle:a,index:n})=>{const{isPerformanceMode:i}=q(),o=i?"div":j.div;return y.debug("ShoppingListItem rendering",{itemName:s.name,itemKey:t,isChecked:r,quantity:s.quantity}),e.jsxs(o,{...!i&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:n*.05},whileHover:{scale:1.01},whileTap:{scale:.99}},className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all duration-300 ${r?"bg-green-500/20 border border-green-500/40 shadow-lg":"bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20"}`,onClick:()=>a(t),children:[e.jsxs("div",{className:"relative",children:[r&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-green-400/40 to-green-600/20 blur-md"}),e.jsx("div",{className:"relative w-6 h-6 rounded border-2 flex items-center justify-center transition-all duration-300",style:r?{background:`
              linear-gradient(135deg, rgba(34, 197, 94, 0.8) 0%, rgba(22, 163, 74, 0.6) 50%, rgba(21, 128, 61, 0.4) 100%)
            `,border:`2px solid ${J("color","color-mix(in srgb, #22c55e 80%, transparent)","rgba(34, 197, 94, 0.8)")}`,boxShadow:`
              0 4px 12px rgba(0, 0, 0, 0.3),
              0 2px 6px rgba(34, 197, 94, 0.5),
              inset 0 1px 0 rgba(255, 255, 255, 0.2),
              inset 0 -1px 0 rgba(0, 0, 0, 0.1)
            `}:{border:"2px solid rgba(255, 255, 255, 0.4)",background:"rgba(255, 255, 255, 0.08)",boxShadow:`
              0 2px 4px rgba(0, 0, 0, 0.2),
              inset 0 1px 0 rgba(255, 255, 255, 0.1)
            `},children:e.jsx(le,{children:r&&e.jsxs(j.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},transition:{duration:.2},children:[e.jsx("div",{className:"absolute inset-0 rounded bg-gradient-to-br from-green-300/20 to-transparent blur-sm"}),e.jsx(m,{Icon:c.Check,className:"relative w-4 h-4 text-white drop-shadow-lg"})]})})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{className:`font-medium text-base transition-all duration-300 ${r?"text-white/60 line-through":"text-white"}`,children:s.name})}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-white/70 text-sm font-medium",children:s.quantity}),s.notes&&e.jsxs("span",{className:"text-white/50 text-xs",children:["• ",s.notes]})]})]})]})},ir=({category:s,checkedItems:t,onToggleItem:r,index:a})=>{const{isPerformanceMode:n}=q(),i=n?"div":j.div;return y.debug("ShoppingListCategory rendering",{categoryName:s.category,itemsCount:s.items?.length||0,checkedItemsCount:t.size}),!s.items||s.items.length===0?(y.warn("ShoppingListCategory received empty items array",{category:s.category}),null):e.jsxs(i,{...!n&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1}},className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center drop-shadow-lg mb-3",children:[e.jsx("span",{className:"w-2 h-2 bg-orange-400 rounded-full mr-3"}),s.category]}),e.jsxs("span",{className:"text-sm text-white/70 font-medium",children:[s.items.length," article",s.items.length>1?"s":""]})]}),e.jsx("div",{className:"space-y-2",children:s.items.map((o,l)=>{const x=`${s.category}-${o.name}`;return e.jsx(nr,{item:o,itemKey:x,isChecked:t.has(x),onToggle:r,index:l},x)})})]})},or=({shoppingList:s})=>{const{isPerformanceMode:t}=q(),r=t?"button":j.button,a=()=>{y.info("PDF export requested",{shoppingListId:s.id});const i={name:s.name,totalItems:s.totalItems,categories:s.categories?.map(o=>({name:o.name,items:o.items.map(l=>`${l.name} - ${l.quantity}`)}))};y.debug("Formatted shopping list for PDF export",i),typeof window<"u"&&window.alert&&window.alert("Génération PDF en cours de développement. Cette fonctionnalité sera bientôt disponible !")},n=async()=>{y.info("Text export requested",{shoppingListId:s.id});let i=`${s.name}
`;i+=`${"=".repeat(s.name.length)}

`,s.categories?.forEach(o=>{i+=`${o.name}:
`,o.items.forEach(l=>{i+=`  • ${l.name} - ${l.quantity}`,l.notes&&(i+=` (${l.notes})`),i+=`
`}),i+=`
`}),i+=`Total: ${s.totalItems} articles
`;try{typeof navigator<"u"&&navigator.clipboard?(await navigator.clipboard.writeText(i),y.info("Shopping list copied to clipboard successfully"),typeof window<"u"&&window.alert&&window.alert("Liste de courses copiée dans le presse-papiers !")):(y.warn("Clipboard API not available, using fallback"),typeof window<"u"&&window.alert&&window.alert(`Votre navigateur ne supporte pas la copie automatique. Voici votre liste:

`+i))}catch(o){y.error("Failed to copy to clipboard",o),typeof window<"u"&&window.alert&&window.alert(`Erreur lors de la copie. Voici votre liste:

`+i)}};return e.jsx(I,{className:"border-white/20 p-1",style:{background:`
          linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 50%, rgba(255, 255, 255, 0.03) 100%)
        `,backdropFilter:"blur(20px) saturate(180%)",border:`1px solid ${J("color","color-mix(in srgb, white 25%, transparent)","rgba(255, 255, 255, 0.25)")}`,boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.5),
          0 6px 20px rgba(255, 255, 255, 0.15),
          0 2px 8px rgba(255, 255, 255, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.1),
          inset 0 -1px 0 rgba(0, 0, 0, 0.3)
        `},children:e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-white/20 to-white/10 blur-sm"}),e.jsx("div",{className:"relative w-10 h-10 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.15)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:`
                    0 2px 8px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(m,{Icon:c.Download,size:20,className:"relative text-white/70 drop-shadow-lg"})})]}),e.jsx("span",{className:"text-white/80 text-base font-medium",children:"Exporter votre liste"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{...!t&&{whileHover:{scale:1.05},whileTap:{scale:.95}},onClick:a,className:`px-2 py-1 bg-white/10 hover:bg-orange-500/20 rounded-lg text-white/70 hover:text-orange-200 ${t?"":"transition-all duration-300"} text-xs border border-white/20 hover:border-orange-400/30`,children:"PDF"}),e.jsx(r,{...!t&&{whileHover:{scale:1.05},whileTap:{scale:.95}},onClick:n,className:`px-2 py-1 bg-white/10 hover:bg-orange-500/20 rounded-lg text-white/70 hover:text-orange-200 ${t?"":"transition-all duration-300"} text-xs border border-white/20 hover:border-orange-400/30`,children:"Texte"})]})]})})})},lr=()=>{const{shoppingList:s,suggestions:t,advice:r,budgetEstimation:a,reset:n}=Pe(),[i,o]=v.useState(new Set);if(fe.useEffect(()=>{y.debug("SHOPPING_LIST_DISPLAY","Current state",{shoppingListCount:s?.categories?.length||0,suggestionsCount:t.length,adviceCount:r.length,hasBudget:!!a}),s&&(y.debug("SHOPPING_LIST_DISPLAY","Shopping list details",{id:s.id,name:s.name,totalItems:s.totalItems,categoriesCount:s.categories?.length||0,categories:s.categories?.map(g=>({id:g.id,name:g.name,itemsCount:g.items?.length||0,items:g.items?.map(u=>({id:u.id,name:u.name,quantity:u.quantity}))||[]}))||[]}),s.categories?.forEach((g,u)=>{y.debug("SHOPPING_LIST_DISPLAY",`Category ${u+1}: ${g.name}`,{categoryId:g.id,itemsCount:g.items?.length||0,items:g.items?.map(h=>`${h.name} (${h.quantity})`)||[]})}))},[s,t,r,a]),!s)return y.debug("SHOPPING_LIST_DISPLAY","No shopping list available"),null;const l=g=>{const u=new Set(i);u.has(g)?u.delete(g):u.add(g),o(u),new Set(i).size,y.debug("SHOPPING_LIST_DISPLAY","Item toggled",{itemId:g,isChecked:u.has(g),totalChecked:u.size})},x=s.totalItems||0,d=i.size,p=x>0?d/x*100:0;return y.debug("SHOPPING_LIST_DISPLAY","Rendering shopping list",{totalCount:x,completedCount:d,progressPercentage:p,categoriesCount:s.categories?.length||0}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(sr,{shoppingList:s,totalCount:x,completedCount:d,progressPercentage:p,onReset:n}),e.jsx(tr,{budgetEstimation:a}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.categories?.map((g,u)=>(y.debug("SHOPPING_LIST_DISPLAY",`Rendering category ${u+1}`,{categoryId:g.id,categoryName:g.name,itemsCount:g.items?.length||0}),e.jsx(ir,{category:g,checkedItems:i,onToggleItem:l,index:u},g.id)))}),e.jsx(rr,{suggestions:t}),e.jsx(ar,{advice:r}),e.jsx(or,{shoppingList:s})]})},is=()=>{const{generationMode:s,selectedMealPlanId:t,setGenerationMode:r,setSelectedMealPlanId:a,generateShoppingList:n}=Pe(),{allMealPlans:i,loadAllMealPlans:o}=Ce(),[l,x]=v.useState(!1),{isPerformanceMode:d}=q();v.useEffect(()=>{o()},[o]);const p=(i||[]).map(u=>({value:u.id,label:`Plan du ${new Date(u.createdAt).toLocaleDateString()}`})),g=async()=>{if(!l){y.debug("SHOPPING_LIST_GENERATOR","Starting generation",{generationMode:s,selectedMealPlanId:t}),x(!0);try{await n({generationMode:s,selectedMealPlanId:t})}catch(u){y.error("SHOPPING_LIST_GENERATOR","Generation failed",{error:u})}finally{x(!1)}y.info("User initiated shopping list generation",{selectedMealPlanId:t,generationMode:s})}};return e.jsx(I,{className:"p-6",style:d?{background:"linear-gradient(145deg, color-mix(in srgb, #fb923c 20%, #1e293b), color-mix(in srgb, #fb923c 10%, #0f172a))",border:"1px solid color-mix(in srgb, #fb923c 40%, transparent)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.4)"}:{background:`
          radial-gradient(circle at 30% 20%, rgba(251, 146, 60, 0.25) 0%, transparent 50%),
          linear-gradient(135deg, rgba(251, 146, 60, 0.20) 0%, rgba(249, 115, 22, 0.12) 50%, rgba(234, 88, 12, 0.08) 100%)
        `,backdropFilter:"blur(20px) saturate(180%)",border:`1px solid ${CSS.supports("color","color-mix(in srgb, #fb923c 40%, transparent)")?"color-mix(in srgb, #fb923c 40%, transparent)":"rgba(251, 146, 60, 0.4)"}`,boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.5),
          0 6px 20px rgba(251, 146, 60, 0.3),
          0 2px 8px rgba(251, 146, 60, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1),
          inset 0 -1px 0 rgba(0, 0, 0, 0.3)
        `},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-orange-400/50 to-orange-600/30 blur-xl"}),e.jsxs("div",{className:"relative w-16 h-16 rounded-full flex items-center justify-center shadow-2xl",style:d?{background:"linear-gradient(135deg, color-mix(in srgb, #fb923c 60%, #1e293b), color-mix(in srgb, #fb923c 40%, #0f172a))",border:"1px solid color-mix(in srgb, #fb923c 60%, transparent)",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.4)"}:{background:`
                  radial-gradient(circle at 30% 30%, rgba(251, 146, 60, 0.6) 0%, rgba(249, 115, 22, 0.4) 40%, rgba(234, 88, 12, 0.2) 100%)
                `,border:`1px solid ${CSS.supports("color","color-mix(in srgb, #fb923c 60%, transparent)")?"color-mix(in srgb, #fb923c 60%, transparent)":"rgba(251, 146, 60, 0.6)"}`,boxShadow:`
                  0 8px 32px rgba(0, 0, 0, 0.4),
                  0 4px 16px rgba(251, 146, 60, 0.4),
                  0 2px 8px rgba(251, 146, 60, 0.6),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2),
                  inset 0 -1px 0 rgba(0, 0, 0, 0.2)
                `},children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-orange-300/30 to-transparent blur-sm"}),e.jsx(c.ShoppingCart,{size:32,className:"relative text-orange-100 drop-shadow-lg"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Générateur de Liste de Courses"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Créez des listes de courses optimisées pour vos repas"})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsx(Re,{options:p,value:t||"",onChange:u=>a(u),placeholder:"Choisir un plan de repas",className:"w-full",disabled:l})}),e.jsx("div",{className:"border-t border-white/10 mt-4 pt-4"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>r("user_only"),className:`flex-1 p-4 rounded-xl border transition-all duration-500 ${s==="user_only"?"border-orange-400/50 bg-gradient-to-br from-orange-500/25 to-orange-600/15 text-orange-300 shadow-2xl":"border-white/20 bg-white/5 text-white/60 hover:border-orange-400/30 hover:bg-orange-500/10"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[s==="user_only"&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-orange-400/40 to-orange-600/20 blur-md"}),e.jsxs("div",{className:"relative w-10 h-10 rounded-full flex items-center justify-center",style:s==="user_only"?d?{background:"linear-gradient(135deg, color-mix(in srgb, #fb923c 50%, #1e293b), color-mix(in srgb, #fb923c 30%, #0f172a))",border:"1px solid color-mix(in srgb, #fb923c 50%, transparent)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"}:{background:`
                      radial-gradient(circle at 30% 30%, rgba(251, 146, 60, 0.5) 0%, rgba(249, 115, 22, 0.3) 40%, rgba(234, 88, 12, 0.15) 100%)
                    `,border:`1px solid ${CSS.supports("color","color-mix(in srgb, #fb923c 50%, transparent)")?"color-mix(in srgb, #fb923c 50%, transparent)":"rgba(251, 146, 60, 0.5)"}`,boxShadow:`
                      0 4px 16px rgba(0, 0, 0, 0.3),
                      0 2px 8px rgba(251, 146, 60, 0.3),
                      inset 0 1px 0 rgba(255, 255, 255, 0.15),
                      inset 0 -1px 0 rgba(0, 0, 0, 0.15)
                    `}:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[s==="user_only"&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-orange-300/20 to-transparent blur-sm"}),e.jsx(c.User,{size:20,className:"relative drop-shadow-lg"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-base",children:"Courses Personnelles"}),e.jsx("div",{className:"text-sm opacity-75",children:"Liste personnelle"})]})]})}),e.jsx("button",{onClick:()=>r("user_and_family"),className:`flex-1 p-4 rounded-xl border transition-all duration-500 ${s==="user_and_family"?"border-orange-400/50 bg-gradient-to-br from-orange-500/25 to-orange-600/15 text-orange-300 shadow-2xl":"border-white/20 bg-white/5 text-white/60 hover:border-orange-400/30 hover:bg-orange-500/10"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[s==="user_and_family"&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-orange-400/40 to-orange-600/20 blur-md"}),e.jsxs("div",{className:"relative w-10 h-10 rounded-full flex items-center justify-center",style:s==="user_and_family"?d?{background:"linear-gradient(135deg, color-mix(in srgb, #fb923c 50%, #1e293b), color-mix(in srgb, #fb923c 30%, #0f172a))",border:"1px solid color-mix(in srgb, #fb923c 50%, transparent)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"}:{background:`
                      radial-gradient(circle at 30% 30%, rgba(251, 146, 60, 0.5) 0%, rgba(249, 115, 22, 0.3) 40%, rgba(234, 88, 12, 0.15) 100%)
                    `,border:`1px solid ${CSS.supports("color","color-mix(in srgb, #fb923c 50%, transparent)")?"color-mix(in srgb, #fb923c 50%, transparent)":"rgba(251, 146, 60, 0.5)"}`,boxShadow:`
                      0 4px 16px rgba(0, 0, 0, 0.3),
                      0 2px 8px rgba(251, 146, 60, 0.3),
                      inset 0 1px 0 rgba(255, 255, 255, 0.15),
                      inset 0 -1px 0 rgba(0, 0, 0, 0.15)
                    `}:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[s==="user_and_family"&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-orange-300/20 to-transparent blur-sm"}),e.jsx(c.Users,{size:20,className:"relative drop-shadow-lg"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-base",children:"Courses Familiales"}),e.jsx("div",{className:"text-sm opacity-75",children:"Liste pour tous"})]})]})})]}),e.jsxs("button",{onClick:g,disabled:!t||l,className:"w-full px-8 py-4 text-lg font-bold text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-500 flex items-center justify-center gap-3 transform hover:scale-[1.02] active:scale-[0.98]",style:{background:`
              linear-gradient(135deg, rgba(251, 146, 60, 0.9) 0%, rgba(249, 115, 22, 0.95) 50%, rgba(234, 88, 12, 1) 100%)
            `,border:`1px solid ${CSS.supports("color","color-mix(in srgb, #fb923c 70%, transparent)")?"color-mix(in srgb, #fb923c 70%, transparent)":"rgba(251, 146, 60, 0.7)"}`,boxShadow:`
              0 12px 40px rgba(0, 0, 0, 0.4),
              0 6px 20px rgba(251, 146, 60, 0.4),
              0 3px 10px rgba(251, 146, 60, 0.6),
              inset 0 1px 0 rgba(255, 255, 255, 0.2),
              inset 0 -2px 0 rgba(0, 0, 0, 0.2)
            `},children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-white/40 to-white/20 blur-sm"}),e.jsxs("div",{className:"relative p-1 rounded-full",style:{background:"rgba(255, 255, 255, 0.25)",border:"1px solid rgba(255, 255, 255, 0.4)",boxShadow:`
                  0 2px 8px rgba(0, 0, 0, 0.2),
                  inset 0 1px 0 rgba(255, 255, 255, 0.3)
                `},children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-white/20 to-transparent blur-sm"}),e.jsx(c.Sparkles,{className:"relative w-4 h-4 text-white drop-shadow-lg"})]})]}),e.jsx("span",{className:"drop-shadow-sm",children:"Générer ma liste de courses"})]})]})})},Fr=()=>{ce();const{isGenerating:s,shoppingList:t,error:r,reset:a,generateShoppingList:n}=Pe(),{allMealPlans:i,loadAllMealPlans:o}=Ce(),{startScan:l}=we();fe.useEffect(()=>{o()},[o]),fe.useEffect(()=>(y.debug("SHOPPING_LIST_TAB","Component mounted",{isGenerating:s,hasShoppingList:!!t,hasError:!!r,allMealPlansCount:i.length}),()=>{y.debug("SHOPPING_LIST_TAB","Component unmounting")}),[s,t,r,i.length]);const x=i.length>0,d=t&&t.totalItems>0,p=()=>{y.info("SHOPPING_LIST_TAB","User initiated generation from meal plan")},g=()=>s?e.jsx(er,{}):d?e.jsxs("div",{className:"space-y-6",children:[e.jsx(lr,{}),e.jsx(is,{})]}):x?e.jsx(is,{}):e.jsx(Qt,{hasAvailableMealPlans:x,onGenerateFromPlan:p});return e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"space-y-6 w-full",children:[e.jsx(le,{children:r&&e.jsx(j.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"w-full",children:e.jsx(I,{className:"border-red-500/20 bg-red-500/5",children:e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx(m,{name:"AlertTriangle",size:20,className:"text-red-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-400 font-medium",children:"Erreur de génération"}),e.jsx("p",{className:"text-red-300/80 text-sm mt-1",children:r})]}),e.jsx("button",{onClick:a,className:"text-red-400 hover:text-red-300 transition-colors",children:e.jsx(m,{name:"X",size:16})})]})})})}),e.jsx(le,{mode:"wait",children:e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"w-full",children:g()},s?"generating":t?"display":"generator")})]})};export{Cr as F,re as H,br as P,Ir as R,Sr as S,q as a,jr as b,ze as c,yr as d,Nr as e,fr as f,Er as g,wr as h,Fr as i,kr as j,ur as k,y as l,hr as p,H as s,vr as t,Q as u};
