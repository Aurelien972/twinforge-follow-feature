const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ScanExitConfirmationModal-Fo-0NH5U.js","assets/page-fridge-Cp-W9isk.js","assets/vendor-BefW7Bxj.js","assets/utils-CUtLAp28.js","assets/supabase-pyFrrmXL.js","assets/page-fridge-scan-C62RDC3k.js","assets/stores-Dp3vmZ5-.js","assets/ui-components-lrK_WhZu.js","assets/motion-BQvLDPOm.js","assets/ui-components-DyoLTZgZ.css","assets/page-fridge-scan-DAz6gEg3.css","assets/date-utils-BlBdbPk_.js","assets/signedUrlService-DUv0zqbl.js"])))=>i.map(i=>d[i]);
import{R as E,j as e,r as S,c$ as ge,u as xe,e as pe,cX as me}from"./vendor-BefW7Bxj.js";import{u as J,a as ee,l as u}from"./page-fridge-Cp-W9isk.js";import{n as de}from"./utils-CUtLAp28.js";import{a as re}from"./stores-Dp3vmZ5-.js";import{G as O,S as g,I as c,s as ue,u as be,m as ce,r as he}from"./ui-components-lrK_WhZu.js";import{_ as fe}from"./page-fridge-scan-C62RDC3k.js";import{S as ye,u as je,m as ve}from"./ScanExitConfirmationModal-Fo-0NH5U.js";import{m as f,u as X,A as oe}from"./motion-BQvLDPOm.js";import"./supabase-pyFrrmXL.js";import"./date-utils-BlBdbPk_.js";import"./signedUrlService-DUv0zqbl.js";const Ne=({isValidating:a,onCameraClick:t,onGalleryClick:s,onBarcodeClick:i,onBarcodeImageUpload:r})=>{const[o,l]=E.useState(!1);return E.useEffect(()=>{console.log("CaptureGuide mounted, isValidating:",a),console.log("CaptureGuide handlers:",{onCameraClick:t,onGalleryClick:s,onBarcodeClick:i});const p=m=>{console.log("üñ±Ô∏è GLOBAL CLICK DETECTED:",{target:m.target,currentTarget:m.currentTarget,clientX:m.clientX,clientY:m.clientY,tagName:m.target?.tagName,className:m.target?.className})};return document.addEventListener("click",p,!0),()=>{document.removeEventListener("click",p,!0)}},[]),E.useEffect(()=>{console.log("isValidating changed:",a)},[a]),console.log("üé® CaptureGuide RENDER",{isValidating:a}),e.jsxs(O,{interactive:!1,className:"p-6 relative glass-card--capture meal-capture-enter",style:{position:"relative",zIndex:10,background:`
          radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, rgba(34, 197, 94, 0.06) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"rgba(16, 185, 129, 0.25)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px rgba(16, 185, 129, 0.12),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                linear-gradient(135deg, rgba(16, 185, 129, 0.45), rgba(5, 150, 105, 0.35))
              `,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                0 0 20px rgba(16, 185, 129, 0.6),
                0 0 40px rgba(16, 185, 129, 0.3),
                inset 0 2px 0 rgba(255,255,255,0.35),
                inset 0 -2px 0 rgba(0,0,0,0.2)
              `},children:e.jsx(g,{Icon:c.Camera,size:18,style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(16, 185, 129, 0.9)) drop-shadow(0 0 4px rgba(255,255,255,0.5))"}})}),e.jsx("h4",{className:"text-white font-bold text-base",style:{textShadow:"0 2px 8px rgba(16, 185, 129, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:"Photo de votre repas"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",style:{background:`
              linear-gradient(135deg,
                rgba(59, 130, 246, 0.2),
                rgba(37, 99, 235, 0.15)
              )
            `,border:"2px solid rgba(59, 130, 246, 0.4)",borderRadius:"16px",backdropFilter:"blur(12px) saturate(130%)",boxShadow:`
              0 4px 16px rgba(59, 130, 246, 0.25),
              0 0 24px rgba(59, 130, 246, 0.15),
              inset 0 1px 0 rgba(255,255,255,0.2)
            `},children:[e.jsx(f.div,{className:"w-2 h-2 rounded-full",style:{backgroundColor:"#3B82F6",boxShadow:"0 0 10px #3B82F6"},animate:{scale:[1,1.3,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:"En attente"})]})]}),e.jsxs("div",{className:"space-y-6",style:{position:"relative",zIndex:1},children:[e.jsx("div",{className:"relative aspect-[4/3] rounded-xl overflow-visible meal-capture-guide",style:{background:`
              radial-gradient(circle at 40% 30%, rgba(16, 185, 129, 0.12) 0%, transparent 60%),
              radial-gradient(circle at 60% 70%, rgba(34, 197, 94, 0.08) 0%, transparent 50%),
              linear-gradient(135deg, rgba(16, 185, 129, 0.06), rgba(34, 197, 94, 0.04))
            `,border:"2px dashed rgba(16, 185, 129, 0.3)",backdropFilter:"blur(8px) saturate(120%)"},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{pointerEvents:"none !important"},children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"w-24 h-24 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 197, 94, 0.3))
                  `,border:"2px solid rgba(16, 185, 129, 0.4)",boxShadow:"0 0 30px rgba(16, 185, 129, 0.3)"},children:[e.jsx(g,{Icon:c.Camera,size:48,className:"text-green-400 icon-pulse-css",style:{filter:"drop-shadow(0 2px 8px rgba(16, 185, 129, 0.4))"}}),[...Array(3)].map((p,m)=>e.jsx("div",{className:`absolute w-2 h-2 rounded-full bg-green-400 particle-css particle-css--${m+1}`,style:{left:`${20+m*20}%`,top:`${20+m%2*60}%`,boxShadow:"0 0 8px rgba(16, 185, 129, 0.6)","--particle-color":"#10B981"}},m))]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-white font-semibold mb-2 text-base md:text-lg",children:"Forgez Votre Nutrition"}),e.jsx("p",{className:"text-green-200 text-xs md:text-sm leading-relaxed max-w-full sm:max-w-xs mx-auto px-2 sm:px-0",children:"Capturez votre repas pour une analyse compl√®te des nutriments et calories"})]})]})})}),e.jsx("button",{onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("CaptureGuide: Camera button onClick fired",p),console.log("isValidating:",a),console.log("Calling onCameraClick..."),t()},onMouseDown:p=>{console.log("Camera button mouseDown")},onTouchStart:p=>{console.log("Camera button touchStart")},className:"w-full btn-glass--primary touch-feedback-css",disabled:a,type:"button",style:{"--scan-primary":"#10B981",background:`
              linear-gradient(135deg, 
                rgba(16, 185, 129, 0.8), 
                rgba(34, 197, 94, 0.6)
              )
            `,backdropFilter:"blur(20px) saturate(160%)",boxShadow:`
              0 12px 40px rgba(16, 185, 129, 0.4),
              0 0 60px rgba(16, 185, 129, 0.3),
              inset 0 3px 0 rgba(255,255,255,0.3),
              inset 0 -3px 0 rgba(0,0,0,0.2)
            `,border:"2px solid rgba(16, 185, 129, 0.6)"},children:e.jsxs("div",{className:"relative flex items-center justify-center gap-3",children:[e.jsx("div",{className:a?"icon-spin-css":"",children:e.jsx(g,{Icon:a?c.Loader2:c.Camera,size:24,className:"text-white",style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.3))"}})}),e.jsx("span",{className:"font-bold text-lg",children:a?"Validation...":"Appareil photo"})]})}),e.jsx("button",{onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("CaptureGuide: Gallery button onClick fired",p),console.log("isValidating:",a),console.log("Calling onGalleryClick..."),s()},onMouseDown:p=>{console.log("Gallery button mouseDown")},onTouchStart:p=>{console.log("Gallery button touchStart")},className:"w-full btn-glass btn-glass--secondary-nav touch-feedback-css",disabled:a,type:"button",style:{background:"rgba(16, 185, 129, 0.08)",borderColor:"rgba(16, 185, 129, 0.25)",backdropFilter:"blur(12px) saturate(130%)",boxShadow:`
              0 4px 16px rgba(0, 0, 0, 0.15),
              0 0 20px rgba(16, 185, 129, 0.1),
              inset 0 1px 0 rgba(255, 255, 255, 0.15)
            `},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.Image,size:18}),e.jsx("span",{className:"font-medium",children:"Galerie"})]})})]})]})},we=({capturedPhoto:a,showSuccessAnimation:t,onRetake:s})=>{const i=X(),{glassClick:r}=J();return e.jsxs(O,{className:"p-6 relative overflow-visible glass-card--capture",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, rgba(34, 197, 94, 0.06) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"rgba(16, 185, 129, 0.25)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px rgba(16, 185, 129, 0.12),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                linear-gradient(135deg, rgba(16, 185, 129, 0.45), rgba(5, 150, 105, 0.35))
              `,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                0 0 20px rgba(16, 185, 129, 0.6),
                0 0 40px rgba(16, 185, 129, 0.3),
                inset 0 2px 0 rgba(255,255,255,0.35),
                inset 0 -2px 0 rgba(0,0,0,0.2)
              `},children:e.jsx(g,{Icon:c.Camera,size:18,style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(16, 185, 129, 0.9)) drop-shadow(0 0 4px rgba(255,255,255,0.5))"}})}),e.jsx("h4",{className:"text-white font-bold text-base",style:{textShadow:"0 2px 8px rgba(16, 185, 129, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:"Photo de votre repas"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",style:{background:`
              linear-gradient(135deg,
                rgba(16, 185, 129, 0.25),
                rgba(5, 150, 105, 0.2)
              )
            `,border:"2px solid rgba(16, 185, 129, 0.5)",borderRadius:"16px",backdropFilter:"blur(12px) saturate(130%)",boxShadow:`
              0 4px 16px rgba(16, 185, 129, 0.3),
              0 0 24px rgba(16, 185, 129, 0.2),
              inset 0 1px 0 rgba(255,255,255,0.25)
            `},children:[e.jsx(f.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:i?"tween":"spring",stiffness:260,damping:20,duration:i?.1:void 0},style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(g,{Icon:c.Check,size:14,style:{color:"#fff",filter:"drop-shadow(0 0 6px rgba(16, 185, 129, 0.8))"}})}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:"Captur√©e"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative aspect-[4/3] rounded-xl overflow-hidden glass-card--capture-preview",children:[e.jsx(f.img,{src:a.url,alt:"Photo du repas",className:"w-full h-full object-cover bg-black/20 border border-green-400/20",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:i?.1:.6,ease:"easeOut"}}),e.jsx(oe,{children:t&&e.jsx(f.div,{className:"absolute inset-0 flex items-center justify-center backdrop-blur-md rounded-xl success-overlay",style:{background:`
                    radial-gradient(circle at center, rgba(16, 185, 129, 0.3) 0%, rgba(16, 185, 129, 0.1) 70%),
                    linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 197, 94, 0.3))
                  `,border:"2px solid rgba(16, 185, 129, 0.6)",backdropFilter:"blur(16px) saturate(140%)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.1},transition:{duration:i?.1:.6,ease:"easeOut"},children:e.jsx(f.div,{className:"w-24 h-24 rounded-full flex items-center justify-center backdrop-blur-sm success-icon-container",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(34, 197, 94, 0.6))
                    `,border:"3px solid rgba(16, 185, 129, 0.8)",boxShadow:`
                      0 0 60px rgba(16, 185, 129, 0.8),
                      0 0 120px rgba(16, 185, 129, 0.4),
                      inset 0 3px 0 rgba(255,255,255,0.4),
                      inset 0 -3px 0 rgba(0,0,0,0.2)
                    `},initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:i?"tween":"spring",stiffness:300,damping:20,delay:i?0:.2,duration:i?.1:void 0},children:e.jsx(g,{Icon:c.Check,size:36,className:"text-white success-icon-glow",style:{filter:"drop-shadow(0 0 8px rgba(255,255,255,0.8))"}})})})})]}),e.jsx(f.button,{onClick:()=>{r(),s()},className:"w-full btn-glass btn-glass--secondary-nav",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.RotateCcw,size:14}),e.jsx("span",{children:"Reprendre"})]})})]})]})},_e=({onProceedToProcessing:a,isProcessingInProgress:t,hasPhoto:s,hasScannedBarcodes:i,hasScannedProducts:r,scannedBarcodesCount:o,scannedProductsCount:l})=>{const{success:p}=J(),y=(()=>{const w=o+l;return s&&(i||r)?{title:"Photo et codes-barres d√©tect√©s !",subtitle:`Votre photo${i?` et ${o} code${o>1?"s-barres":"-barre"}`:""}${r?` et ${l} produit${l>1?"s":""}`:""} sont pr√™ts pour l'analyse compl√®te.`}:i&&r?{title:`${w} √©l√©ment${w>1?"s":""} d√©tect√©${w>1?"s":""} !`,subtitle:`${o} code${o>1?"s-barres":"-barre"} et ${l} produit${l>1?"s":""} pr√™ts pour l'analyse.`}:i?{title:`${o} code${o>1?"s-barres":"-barre"} d√©tect√©${o>1?"s":""} !`,subtitle:"Vos codes-barres sont pr√™ts pour l'analyse nutritionnelle avanc√©e."}:r?{title:`${l} produit${l>1?"s":""} scann√©${l>1?"s":""} !`,subtitle:"Vos produits sont pr√™ts pour l'analyse nutritionnelle."}:{title:"Photo captur√©e avec succ√®s !",subtitle:"Votre carburant nutritionnel est pr√™t pour l'analyse TwinForge."}})();return e.jsx("div",{className:"meal-ready-processing meal-capture-enter",children:e.jsxs(O,{className:"p-6 text-center relative glass-card--ready-processing perf-critical",style:{background:`
            radial-gradient(circle at 25% 25%, rgba(16, 185, 129, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 75% 75%, rgba(34, 197, 94, 0.12) 0%, transparent 60%),
            radial-gradient(circle at 50% 50%, rgba(52, 211, 153, 0.08) 0%, transparent 70%),
            var(--glass-opacity)
          `,borderColor:"rgba(16, 185, 129, 0.4)",boxShadow:`
            0 16px 48px rgba(0, 0, 0, 0.3),
            0 0 40px rgba(16, 185, 129, 0.25),
            0 0 80px rgba(34, 197, 94, 0.15),
            inset 0 2px 0 rgba(255, 255, 255, 0.2)
          `},children:[e.jsx("div",{className:"absolute inset-0 rounded-inherit pointer-events-none",style:{background:"radial-gradient(circle at center, rgba(16, 185, 129, 0.08) 0%, transparent 70%)",filter:"blur(20px)",transform:"scale(1.2)",zIndex:-1,animation:"forge-nutritional-glow 3s ease-in-out infinite"}}),e.jsxs("div",{className:"relative z-10 space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mb-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(34, 197, 94, 0.4))
                `,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                  0 0 40px rgba(16, 185, 129, 0.5),
                  inset 0 2px 0 rgba(255, 255, 255, 0.3)
                `},children:e.jsx(g,{Icon:c.Check,size:28,className:"text-white",style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.3))"}})}),e.jsx("h3",{className:"text-white text-xl font-bold text-center",children:y.title}),e.jsx("p",{className:"text-green-100 text-base leading-relaxed max-w-md mx-auto text-center",children:y.subtitle})]})}),e.jsx("button",{onClick:()=>{p(),a()},className:"w-full max-w-md mx-auto py-3 btn-breathing-css btn-touch-feedback touch-feedback-css",disabled:t,style:{"--scan-primary":"#10B981",position:"relative",overflow:"hidden",background:`
                linear-gradient(135deg, 
                  rgba(16, 185, 129, 0.9), 
                  rgba(34, 197, 94, 0.7),
                  rgba(52, 211, 153, 0.8)
                )
              `,backdropFilter:"blur(20px) saturate(160%)",boxShadow:`
                0 16px 48px rgba(16, 185, 129, 0.5),
                0 0 80px rgba(16, 185, 129, 0.4),
                0 0 120px rgba(34, 197, 94, 0.3),
                inset 0 3px 0 rgba(255,255,255,0.4),
                inset 0 -3px 0 rgba(0,0,0,0.2)
              `,borderRadius:"999px",border:"2px solid rgba(16, 185, 129, 0.8)"},children:e.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-3",children:[e.jsx("div",{className:t?"icon-spin-css":"",children:e.jsx(g,{Icon:t?c.Loader2:c.Zap,size:20,className:"text-white",style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.4))"}})}),e.jsx("span",{className:"text-lg font-bold text-white",children:t?"Analyse en cours...":"Lancer l'analyse avanc√©e"})]})})]})]})})},ke=({capturedPhoto:a,onBack:t})=>{const{click:s}=J();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f.button,{onClick:()=>{s(),t()},className:"btn-glass--secondary-nav touch-target",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.ArrowLeft,size:16}),e.jsx("span",{children:"Retour"})]})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-white/60 text-sm",children:a?"‚úì Photo captur√©e":"√âtape 1 sur 3"})})]})},Ce="_wrap_1ie0e_12",Se="_card_1ie0e_19",Ie="_grid_1ie0e_33",Ee="_icon_1ie0e_43",Me="_iconHalo_1ie0e_62",Ae="_iconGlyph_1ie0e_68",Pe="_center_1ie0e_74",Be="_title_1ie0e_80",De="_subtitle_1ie0e_91",Fe="_rail_1ie0e_101",Re="_seg_1ie0e_106",Oe="_segGreen_1ie0e_110",Le="_segCyan_1ie0e_111",ze="_isCurrent_1ie0e_113",$e="_isComplete_1ie0e_114",Te="_fill_1ie0e_116",Ue="_fillGreen_1ie0e_120",We="_fillCyan_1ie0e_125",Ve="_step_1ie0e_132",Ge="_percent_1ie0e_139",B={wrap:Ce,card:Se,grid:Ie,icon:Ee,iconHalo:Me,iconGlyph:Ae,center:Pe,title:Be,subtitle:De,rail:Fe,seg:Re,segGreen:Oe,segCyan:Le,isCurrent:ze,isComplete:$e,fill:Te,fillGreen:Ue,fillCyan:We,step:Ve,percent:Ge},ne=[{id:"capture",title:"Capture"},{id:"processing",title:"Analyse"},{id:"results",title:"R√©sultats"}],qe={capture:"Camera",processing:"Scan",results:"Check"};function ae({currentStep:a,progress:t,message:s,subMessage:i}){const{isPerformanceMode:r}=ee(),o=r?"span":f.span,l=Number.isFinite(t)?Math.min(100,Math.max(0,t)):0,p=100/ne.length,m=Math.max(0,ne.findIndex(_=>_.id===a)),y=m*p,w=Math.max(0,Math.min(1,(l-y)/p)),n=qe[a]??"Camera";return e.jsx("div",{className:B.wrap,children:e.jsx(O,{className:B.card,children:e.jsxs("div",{className:B.grid,"data-dph":!0,children:[e.jsxs("div",{className:B.icon,children:[e.jsx("div",{className:B.iconHalo}),e.jsx(g,{Icon:c[n],size:26,className:B.iconGlyph})]}),e.jsxs("div",{className:B.center,children:[e.jsx("h2",{className:B.title,children:s||"Capture Nutritionnelle"}),i&&e.jsx("p",{className:B.subtitle,children:i}),e.jsx("div",{className:B.rail,role:"progressbar","aria-valuenow":Math.round(l),"aria-valuemin":0,"aria-valuemax":100,children:ne.map((_,M)=>{const v=M<m,D=M===m,U=v?"100%":D?`${w*100}%`:"0%",z=M===0?B.segGreen:B.segCyan,W=M===0?B.fillGreen:B.fillCyan;return e.jsx("div",{className:`${B.seg} ${z} ${v?B.isComplete:""} ${D?B.isCurrent:""}`,children:(v||D)&&e.jsx(o,{className:`${B.fill} ${W}`,...!r&&{initial:{width:0},animate:{width:U},transition:{duration:.45,ease:"easeOut"}},style:r?{width:U}:void 0})},_.id)})}),e.jsxs("div",{className:B.step,children:["√âtape ",m+1," sur ",ne.length]})]}),e.jsxs("div",{className:B.percent,"aria-hidden":"true",children:[Math.round(l),"%"]})]})})})}const He=async a=>{try{const t=new Image,s=URL.createObjectURL(a);await new Promise((o,l)=>{t.onload=()=>o(),t.onerror=()=>l(new Error("Failed to load image")),t.src=s});const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");if(!r)return URL.revokeObjectURL(s),{success:!1,error:"Failed to get canvas context"};if(r.drawImage(t,0,0),URL.revokeObjectURL(s),"BarcodeDetector"in window)try{const l=await new window.BarcodeDetector({formats:["ean_13","ean_8","upc_a","upc_e","code_128","code_39"]}).detect(i);if(l.length>0)return{success:!0,barcode:l[0].rawValue,format:l[0].format}}catch(o){console.warn("BarcodeDetector failed, falling back to error:",o)}return{success:!1,error:"Aucun code-barre d√©tect√© dans l'image. La d√©tection de code-barres sur image n'est pas support√©e par votre navigateur."}}catch(t){return console.error("Error scanning barcode from image:",t),{success:!1,error:t instanceof Error?t.message:"Erreur lors du scan de l'image"}}},Xe=({onBarcodeDetected:a,onClose:t,mode:s,uploadedImage:i})=>{const[r,o]=S.useState(s==="camera"),[l,p]=S.useState(!1),[m,y]=S.useState(null),[w,n]=S.useState(null),[_,M]=S.useState(null),[v,D]=S.useState(null),[U,z]=S.useState(null),[W,L]=S.useState("loading");S.useEffect(()=>{s==="upload"&&i&&C(i)},[s,i]),S.useEffect(()=>()=>{v&&URL.revokeObjectURL(v)},[v]);const C=j=>{n(null),L("loading");const d=URL.createObjectURL(j);D(d),z(j),u.info("BARCODE_SCANNER","Image loaded for preview, starting auto-detection",{fileName:j.name,fileSize:j.size,timestamp:new Date().toISOString()}),L("ready"),H(j)},H=async j=>{p(!0),n(null),L("detecting"),u.info("BARCODE_SCANNER","Starting barcode detection",{fileName:j.name,timestamp:new Date().toISOString()});try{const d=await He(j);if(!d.success||!d.barcode){u.warn("BARCODE_SCANNER","No barcode found in image",{error:d.error,timestamp:new Date().toISOString()}),n(d.error||"Aucun code-barre d√©tect√©"),L("ready"),p(!1);return}V(d.barcode)}catch(d){u.error("BARCODE_SCANNER","Error detecting barcode",{error:d instanceof Error?d.message:String(d),timestamp:new Date().toISOString()}),n("Erreur lors de la d√©tection du code-barre"),L("ready")}finally{p(!1)}},V=j=>{u.info("BARCODE_SCANNER","Barcode detected successfully",{barcode:j,timestamp:new Date().toISOString()});const d={barcode:j,image_url:v||void 0,scannedAt:new Date().toISOString(),portionMultiplier:1};a(d),M(`Code-barre ${j} d√©tect√© !`),L("complete"),setTimeout(()=>{M(null),o(!0),y(null),L("loading")},1500)},x=async j=>{if(!r||l||j.length===0)return;const d=j[0]?.rawValue;!d||d===m||(y(d),o(!1),V(d))},b=j=>{u.error("BARCODE_SCANNER","Camera error",{error:j?.message||String(j),timestamp:new Date().toISOString()}),n("Erreur d'acc√®s √† la cam√©ra")};return e.jsx(f.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"relative z-40 mt-4",children:e.jsx("div",{className:"w-full",children:e.jsxs(O,{className:"p-6 relative overflow-hidden",style:{background:`
              radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.12) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, rgba(79, 70, 229, 0.08) 0%, transparent 50%),
              rgba(17, 24, 39, 0.95)
            `,borderColor:"rgba(99, 102, 241, 0.3)",boxShadow:`
              0 20px 60px rgba(0, 0, 0, 0.5),
              0 0 40px rgba(99, 102, 241, 0.2),
              inset 0 2px 0 rgba(255, 255, 255, 0.15)
            `},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                    linear-gradient(135deg, rgba(99, 102, 241, 0.45), rgba(79, 70, 229, 0.35))
                  `,border:"2px solid rgba(99, 102, 241, 0.6)",boxShadow:`
                    0 0 20px rgba(99, 102, 241, 0.6),
                    0 0 40px rgba(99, 102, 241, 0.3)
                  `},children:e.jsx(g,{Icon:c.Scan,size:18,style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(99, 102, 241, 0.9))"}})}),e.jsx("h4",{className:"text-white font-bold text-base",children:"Scanner Code-Barre"})]}),e.jsx("button",{onClick:t,className:"w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-gray-700/50",style:{border:"1px solid rgba(156, 163, 175, 0.3)"},"aria-label":"Fermer",children:e.jsx(g,{Icon:c.X,size:16,className:"text-gray-400"})})]}),e.jsxs("div",{className:"relative aspect-square rounded-xl overflow-hidden mb-4",children:[s==="upload"&&v?e.jsx("img",{src:v,alt:"Uploaded barcode",className:"w-full h-full object-cover"}):r&&e.jsx(ge,{onScan:x,onError:b,formats:["ean_13","ean_8","upc_a","upc_e","code_128","code_39"],components:{audio:!1,finder:!0},styles:{container:{width:"100%",height:"100%"},video:{width:"100%",height:"100%",objectFit:"cover"}}}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"w-64 h-48 relative",style:{border:"3px solid rgba(99, 102, 241, 0.6)",borderRadius:"12px",boxShadow:"0 0 30px rgba(99, 102, 241, 0.4)"},children:[e.jsx("div",{className:"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-indigo-400 rounded-tl-lg"}),e.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-indigo-400 rounded-tr-lg"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-indigo-400 rounded-bl-lg"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-indigo-400 rounded-br-lg"}),r&&e.jsx(f.div,{className:"absolute inset-x-0 h-1 bg-gradient-to-r from-transparent via-indigo-400 to-transparent",style:{filter:"drop-shadow(0 0 8px rgba(99, 102, 241, 0.8))"},animate:{top:["10%","90%","10%"]},transition:{duration:2,repeat:1/0,ease:"linear"}})]})}),e.jsxs(oe,{children:[l&&e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-indigo-400 border-t-transparent rounded-full mx-auto mb-3"}),e.jsx("p",{className:"text-white font-medium",children:"D√©tection du code-barre..."})]})}),_&&e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-green-500/20 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-500/30 flex items-center justify-center mx-auto mb-3",children:e.jsx(g,{Icon:c.Check,size:32,className:"text-green-400"})}),e.jsx("p",{className:"text-white font-bold text-lg",children:_}),e.jsx("p",{className:"text-green-200 text-sm mt-2",children:`Cliquez sur "Lancer l'analyse" pour continuer`})]})}),w&&e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-red-500/20 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-500/30 flex items-center justify-center mx-auto mb-3",children:e.jsx(g,{Icon:c.AlertCircle,size:32,className:"text-red-400"})}),e.jsx("p",{className:"text-white font-bold text-lg mb-2",children:"Erreur"}),e.jsx("p",{className:"text-red-200 text-sm",children:w})]})})]})]})]}),e.jsx("div",{className:"text-center",children:s==="camera"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Positionnez le code-barre dans le cadre"}),e.jsx("p",{className:"text-gray-500 text-xs",children:"Formats support√©s : EAN-13, EAN-8, UPC-A, UPC-E, Code 128, Code 39"})]})})]})})})},Ke="https://world.openfoodfacts.org/api/v2",Qe="TwinForge/1.0 (Nutrition Tracking App; contact@twinforge.app)";async function Ze(a,t={},s=8e3){const i=new AbortController,r=setTimeout(()=>i.abort(),s);try{const o=await fetch(a,{...t,signal:i.signal,headers:{"User-Agent":Qe,...t.headers}});return clearTimeout(r),o}catch(o){throw clearTimeout(r),o}}const Y={async getProductByBarcode(a){u.info("OFF_SERVICE","Fetching product from OpenFoodFacts",{barcode:a,timestamp:new Date().toISOString()});try{const t=`${Ke}/product/${a}?fields=code,product_name,brands,quantity,image_url,image_small_url,nutriments,serving_size,nutrition_grades,nutriscore_grade,nova_group,categories,allergens,ingredients_text`,s=await Ze(t,{},8e3);if(!s.ok)return u.warn("OFF_SERVICE","OpenFoodFacts API returned non-OK status",{barcode:a,status:s.status,statusText:s.statusText,timestamp:new Date().toISOString()}),{success:!1,error:`Produit non trouv√© (HTTP ${s.status})`};const i=await s.json();if(i.status!==1||!i.product)return u.info("OFF_SERVICE","Product not found in OpenFoodFacts database",{barcode:a,status:i.status,status_verbose:i.status_verbose,timestamp:new Date().toISOString()}),{success:!1,error:"Produit non trouv√© dans la base de donn√©es OpenFoodFacts"};const r=i.product;if(!r.product_name||!r.nutriments)return u.warn("OFF_SERVICE","Product found but missing essential data",{barcode:a,hasName:!!r.product_name,hasNutriments:!!r.nutriments,timestamp:new Date().toISOString()}),{success:!1,error:"Donn√©es nutritionnelles incompl√®tes"};const o=r.nutriments,l={success:!0,product:{barcode:r.code,name:r.product_name,brand:r.brands,image_url:r.image_url||r.image_small_url,portion_size:r.serving_size||r.quantity,nutrition_per_100g:{calories:o["energy-kcal_100g"]||0,proteins:o.proteins_100g||0,carbs:o.carbohydrates_100g||0,fats:o.fat_100g||0,fiber:o.fiber_100g,sugar:o.sugars_100g,sodium:o.sodium_100g},nutriscore:r.nutriscore_grade||r.nutrition_grades,nova_group:r.nova_group,categories:r.categories,allergens:r.allergens}};return(o["energy-kcal_serving"]||o.proteins_serving||o.carbohydrates_serving||o.fat_serving)&&(l.product.nutrition_per_serving={calories:o["energy-kcal_serving"]||0,proteins:o.proteins_serving||0,carbs:o.carbohydrates_serving||0,fats:o.fat_serving||0}),u.info("OFF_SERVICE","Product fetched successfully",{barcode:a,productName:r.product_name,brand:r.brands,hasNutritionPerServing:!!l.product?.nutrition_per_serving,nutriscore:l.product?.nutriscore,timestamp:new Date().toISOString()}),l}catch(t){return t instanceof Error&&t.name==="AbortError"?(u.error("OFF_SERVICE","Request timeout",{barcode:a,error:"Request timed out after 8 seconds",timestamp:new Date().toISOString()}),{success:!1,error:"D√©lai d'attente d√©pass√©. Veuillez r√©essayer."}):(u.error("OFF_SERVICE","Error fetching product",{barcode:a,error:t instanceof Error?t.message:String(t),errorStack:t instanceof Error?t.stack:void 0,timestamp:new Date().toISOString()}),{success:!1,error:"Erreur de connexion √† OpenFoodFacts"})}},convertToMealItem(a,t=1){if(!a)return null;const s=a.nutrition_per_serving&&t===1,i=s?a.nutrition_per_serving:a.nutrition_per_100g,r=i.calories*t,o=i.proteins*t,l=i.carbs*t,p=i.fats*t,m=s?a.portion_size||"1 portion":t===1?"100g":`${t*100}g`,y={name:a.brand?`${a.brand} ${a.name}`:a.name,confidence:1,calories:Math.round(r),proteins:Math.round(o*10)/10,carbs:Math.round(l*10)/10,fats:Math.round(p*10)/10,fiber:a.nutrition_per_100g.fiber?Math.round(a.nutrition_per_100g.fiber*t*10)/10:void 0,sugar:a.nutrition_per_100g.sugar?Math.round(a.nutrition_per_100g.sugar*t*10)/10:void 0,sodium:a.nutrition_per_100g.sodium?Math.round(a.nutrition_per_100g.sodium*t*1e3)/1e3:void 0,portion_size:m,category:"packaged_product"};return u.debug("OFF_SERVICE","Converted product to MealItem",{productName:a.name,portionMultiplier:t,useServing:s,mealItem:{name:y.name,calories:y.calories,portion_size:y.portion_size},timestamp:new Date().toISOString()}),y},getCommonPortionMultipliers(){return[{label:"¬º portion",value:.25},{label:"¬Ω portion",value:.5},{label:"1 portion",value:1},{label:"1.5 portions",value:1.5},{label:"2 portions",value:2},{label:"3 portions",value:3}]}},Ye=({product:a,onPortionChange:t,onRemove:s})=>{const i=Y.getCommonPortionMultipliers();return e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{duration:.3},children:e.jsx(O,{className:"p-4 relative",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.08) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, rgba(79, 70, 229, 0.06) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"rgba(99, 102, 241, 0.25)",boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.2),
            0 0 20px rgba(99, 102, 241, 0.1),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"flex gap-4",children:[a.image_url&&e.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden flex-shrink-0",style:{border:"2px solid rgba(99, 102, 241, 0.3)",background:"rgba(255, 255, 255, 0.05)"},children:e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("div",{className:"px-2 py-0.5 rounded-md flex items-center gap-1",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(79, 70, 229, 0.15))",border:"1px solid rgba(99, 102, 241, 0.3)"},children:[e.jsx(g,{Icon:c.Scan,size:12,className:"text-indigo-300"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-200",children:"Code-barre"})]})}),e.jsx("h4",{className:"text-white font-semibold text-sm mb-0.5 truncate",children:a.name}),a.brand&&e.jsx("p",{className:"text-gray-400 text-xs truncate",children:a.brand})]}),e.jsx("button",{onClick:()=>s(a.barcode),className:"flex-shrink-0 w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-red-500/20",style:{border:"1px solid rgba(239, 68, 68, 0.3)"},"aria-label":"Retirer le produit",children:e.jsx(g,{Icon:c.X,size:16,className:"text-red-400"})})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-0.5",children:"Calories"}),e.jsxs("p",{className:"text-white font-bold text-lg",children:[a.mealItem.calories,e.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"kcal"})]})]}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 mb-0.5",children:"P"}),e.jsxs("p",{className:"text-green-400 font-semibold",children:[a.mealItem.proteins,"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 mb-0.5",children:"G"}),e.jsxs("p",{className:"text-yellow-400 font-semibold",children:[a.mealItem.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 mb-0.5",children:"L"}),e.jsxs("p",{className:"text-orange-400 font-semibold",children:[a.mealItem.fats,"g"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Portion"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:i.map(r=>e.jsx("button",{onClick:()=>t(a.barcode,r.value),className:`
                      px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                      ${a.portionMultiplier===r.value?"bg-indigo-500/30 text-indigo-200 border-indigo-400":"bg-gray-800/50 text-gray-400 border-gray-700 hover:bg-gray-700/50"}
                    `,style:{border:"1px solid"},children:r.label},r.value))})]})]})]})})})},Je=({scanType:a,onSelectScanType:t,capturedPhoto:s,scannedBarcodes:i,scannedProducts:r,onPhotoCapture:o,onBarcodeDetected:l,onProductScanned:p,onProductPortionChange:m,onProductRemove:y,onBarcodePortionChange:w,onBarcodeRemove:n,onRetake:_,onBack:M,onProceedToProcessing:v,isProcessingInProgress:D,readyForProcessingRef:U,progress:z,progressMessage:W,progressSubMessage:L})=>{const[C,H]=S.useState(!1),[V,x]=S.useState(!1),[b,j]=S.useState(!1),[d,A]=S.useState(null);E.useEffect(()=>{console.log("üîç BARCODE_SCANNER_STATE:",{showBarcodeScanner:b,barcodeScanMode:d})},[b,d]);const T=S.useRef(null),N=S.useRef(null),$=S.useRef(null),I=[{id:"nutrition-tracking",icon:"TrendingUp",color:"#22C55E",title:"Suivi Nutritionnel",description:"Analysez vos apports en macronutriments et calories"},{id:"ai-detection",icon:"Zap",color:"#10B981",title:"D√©tection IA",description:"Identification automatique des aliments et portions"},{id:"personalized-insights",icon:"Target",color:"#059669",title:"Conseils Personnalis√©s",description:"Recommandations adapt√©es √† vos objectifs"}],F=[{id:"instant-analysis",icon:"Zap",color:"#6366F1",title:"Analyse Instantan√©e",description:"R√©cup√©ration imm√©diate des donn√©es nutritionnelles"},{id:"accurate-data",icon:"Database",color:"#818CF8",title:"Donn√©es Pr√©cises",description:"Informations officielles des fabricants via OpenFoodFacts"},{id:"easy-tracking",icon:"Package",color:"#4F46E5",title:"Suivi Simplifi√©",description:"Id√©al pour les produits emball√©s et transform√©s"}],h=()=>{if(console.log("Camera button clicked"),console.log("fileInputRef.current:",T.current),!T.current){console.error("fileInputRef.current is null or undefined");return}try{console.log("Attempting to trigger file input click"),T.current.click(),console.log("File input click triggered successfully")}catch(k){console.error("Error clicking file input:",k)}},P=()=>{if(console.log("Gallery button clicked"),console.log("galleryInputRef.current:",N.current),!N.current){console.error("galleryInputRef.current is null or undefined");return}try{console.log("Attempting to reset and trigger gallery input"),N.current.value="",N.current.click(),console.log("Gallery input click triggered successfully")}catch(k){console.error("Error clicking gallery input:",k)}},R=()=>{j(!0),A("camera")},Z=()=>{$.current?.click()},G=()=>{j(!1)},te=k=>{l(k),j(!1)},se=async k=>{const q=k.target.files?.[0];if(console.log("File selected:",q?.name,"from:",k.target===T.current?"camera":"gallery"),!!q){H(!0);try{await new Promise(le=>setTimeout(le,1e3));const K={validation:{isValid:!0,issues:[],confidence:.9},metadata:{fileSize:q.size,dimensions:{width:1920,height:1080},timestamp:new Date().toISOString()}};o(q,K),x(!0),setTimeout(()=>x(!1),2e3)}catch(K){console.error("Photo validation failed:",K)}finally{H(!1),T.current&&(T.current.value=""),N.current&&(N.current.value="")}}};return e.jsxs("div",{className:"space-y-6 pb-32",style:{minHeight:"100vh"},children:[e.jsx(ae,{currentStep:"capture",progress:z,message:W,subMessage:L}),e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs(f.button,{onClick:()=>t("photo-analysis"),className:"flex-1 p-4 rounded-xl transition-all touch-feedback-css relative overflow-hidden",style:{background:a==="photo-analysis"?`
                  radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.3) 0%, transparent 60%),
                  radial-gradient(circle at 70% 80%, rgba(5, 150, 105, 0.2) 0%, transparent 50%),
                  linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(5, 150, 105, 0.15))
                `:`
                  linear-gradient(135deg, rgba(107, 114, 128, 0.08), rgba(75, 85, 99, 0.06))
                `,borderWidth:"2px",borderStyle:"solid",borderColor:a==="photo-analysis"?"rgba(16, 185, 129, 0.6)":"rgba(107, 114, 128, 0.25)",boxShadow:a==="photo-analysis"?`
                  0 8px 32px rgba(16, 185, 129, 0.25),
                  0 0 40px rgba(16, 185, 129, 0.15),
                  inset 0 2px 0 rgba(255, 255, 255, 0.15)
                `:"none"},whileTap:{scale:.97},children:[e.jsxs("div",{className:"flex flex-col items-center gap-2.5",children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:a==="photo-analysis"?`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(5, 150, 105, 0.3))
                    `:"rgba(107, 114, 128, 0.15)",border:a==="photo-analysis"?"2px solid rgba(16, 185, 129, 0.5)":"1px solid rgba(107, 114, 128, 0.3)",boxShadow:a==="photo-analysis"?"0 0 20px rgba(16, 185, 129, 0.4)":"none"},children:e.jsx(g,{Icon:c.Camera,size:24,className:a==="photo-analysis"?"text-white":"text-gray-400",style:{filter:a==="photo-analysis"?"drop-shadow(0 2px 4px rgba(0,0,0,0.3))":"none"}})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:`font-bold text-sm block ${a==="photo-analysis"?"text-white":"text-gray-400"}`,style:{textShadow:a==="photo-analysis"?"0 1px 4px rgba(0,0,0,0.3)":"none"},children:"Scan Repas IA"}),a==="photo-analysis"&&e.jsx(f.span,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"text-emerald-200 text-xs font-medium block",children:"Recommand√©"})]})]}),a==="photo-analysis"&&e.jsx(f.div,{layoutId:"activeIndicator",className:"absolute inset-0 rounded-xl",style:{background:"rgba(16, 185, 129, 0.05)",pointerEvents:"none"},transition:{type:"spring",bounce:.2,duration:.6}})]}),e.jsxs(f.button,{onClick:()=>t("barcode-scan"),className:"flex-1 p-4 rounded-xl transition-all touch-feedback-css relative overflow-hidden",style:{background:a==="barcode-scan"?`
                  radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.3) 0%, transparent 60%),
                  radial-gradient(circle at 70% 80%, rgba(79, 70, 229, 0.2) 0%, transparent 50%),
                  linear-gradient(135deg, rgba(99, 102, 241, 0.25), rgba(79, 70, 229, 0.15))
                `:`
                  linear-gradient(135deg, rgba(107, 114, 128, 0.08), rgba(75, 85, 99, 0.06))
                `,borderWidth:"2px",borderStyle:"solid",borderColor:a==="barcode-scan"?"rgba(99, 102, 241, 0.6)":"rgba(107, 114, 128, 0.25)",boxShadow:a==="barcode-scan"?`
                  0 8px 32px rgba(99, 102, 241, 0.25),
                  0 0 40px rgba(99, 102, 241, 0.15),
                  inset 0 2px 0 rgba(255, 255, 255, 0.15)
                `:"none"},whileTap:{scale:.97},children:[e.jsxs("div",{className:"flex flex-col items-center gap-2.5",children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:a==="barcode-scan"?`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, rgba(99, 102, 241, 0.4), rgba(79, 70, 229, 0.3))
                    `:"rgba(107, 114, 128, 0.15)",border:a==="barcode-scan"?"2px solid rgba(99, 102, 241, 0.5)":"1px solid rgba(107, 114, 128, 0.3)",boxShadow:a==="barcode-scan"?"0 0 20px rgba(99, 102, 241, 0.4)":"none"},children:e.jsx(g,{Icon:c.ScanBarcode,size:24,className:a==="barcode-scan"?"text-white":"text-gray-400",style:{filter:a==="barcode-scan"?"drop-shadow(0 2px 4px rgba(0,0,0,0.3))":"none"}})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("span",{className:`font-bold text-sm block ${a==="barcode-scan"?"text-white":"text-gray-400"}`,style:{textShadow:a==="barcode-scan"?"0 1px 4px rgba(0,0,0,0.3)":"none"},children:"Code-Barre"}),a==="barcode-scan"&&e.jsx(f.span,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"text-indigo-200 text-xs font-medium block",children:"Rapide"})]})]}),a==="barcode-scan"&&e.jsx(f.div,{layoutId:"activeIndicator",className:"absolute inset-0 rounded-xl",style:{background:"rgba(99, 102, 241, 0.05)",pointerEvents:"none"},transition:{type:"spring",bounce:.2,duration:.6}})]})]}),e.jsxs("div",{className:"space-y-6",children:[a==="photo-analysis"&&!s&&e.jsx("div",{className:"mt-6",children:e.jsx(Ne,{isValidating:C,onCameraClick:h,onGalleryClick:P,onBarcodeClick:R,onBarcodeImageUpload:Z})}),a==="photo-analysis"&&s&&e.jsx(oe,{mode:"wait",children:e.jsx(f.div,{className:"mt-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsx(we,{capturedPhoto:s,showSuccessAnimation:V,onRetake:_})},"captured")}),a==="barcode-scan"&&i.length===0&&r.length===0&&e.jsx("div",{className:"mt-6",children:e.jsxs(O,{className:"p-6 rounded-3xl",style:{background:`
                    radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 60%),
                    radial-gradient(circle at 70% 80%, rgba(79, 70, 229, 0.1) 0%, transparent 50%),
                    rgba(17, 24, 39, 0.95)
                  `,borderColor:"rgba(99, 102, 241, 0.4)",borderWidth:"2px",backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)",boxShadow:`
                    0 20px 60px rgba(0, 0, 0, 0.3),
                    0 0 40px rgba(99, 102, 241, 0.2),
                    inset 0 2px 0 rgba(255, 255, 255, 0.15),
                    inset 0 -2px 0 rgba(0, 0, 0, 0.1)
                  `},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:`
                          radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                          linear-gradient(135deg, rgba(99, 102, 241, 0.45), rgba(79, 70, 229, 0.35))
                        `,border:"2px solid rgba(99, 102, 241, 0.6)",boxShadow:`
                          0 0 20px rgba(99, 102, 241, 0.6),
                          0 0 40px rgba(99, 102, 241, 0.3),
                          inset 0 2px 0 rgba(255,255,255,0.35),
                          inset 0 -2px 0 rgba(0,0,0,0.2)
                        `},children:e.jsx(g,{Icon:c.ScanBarcode,size:18,style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(99, 102, 241, 0.9)) drop-shadow(0 0 4px rgba(255,255,255,0.5))"}})}),e.jsx("h4",{className:"text-white font-bold text-base",style:{textShadow:"0 2px 8px rgba(99, 102, 241, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:"Scan Code-Barre"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",style:{background:`
                        linear-gradient(135deg,
                          rgba(59, 130, 246, 0.2),
                          rgba(37, 99, 235, 0.15)
                        )
                      `,border:"2px solid rgba(59, 130, 246, 0.4)",borderRadius:"16px",backdropFilter:"blur(12px) saturate(130%)",boxShadow:`
                        0 4px 16px rgba(59, 130, 246, 0.25),
                        0 0 24px rgba(59, 130, 246, 0.15),
                        inset 0 1px 0 rgba(255,255,255,0.2)
                      `},children:[e.jsx(f.div,{className:"w-2 h-2 rounded-full",style:{backgroundColor:"#3B82F6",boxShadow:"0 0 10px #3B82F6"},animate:{scale:[1,1.3,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:"En attente"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative aspect-[4/3] rounded-2xl overflow-visible",style:{background:`
                        radial-gradient(circle at 40% 30%, rgba(99, 102, 241, 0.15) 0%, transparent 60%),
                        radial-gradient(circle at 60% 70%, rgba(79, 70, 229, 0.1) 0%, transparent 50%),
                        linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(79, 70, 229, 0.08))
                      `,border:"2px dashed rgba(99, 102, 241, 0.4)",backdropFilter:"blur(12px) saturate(130%)",WebkitBackdropFilter:"blur(12px) saturate(130%)"},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                              linear-gradient(135deg, rgba(99, 102, 241, 0.25), rgba(79, 70, 229, 0.35))
                            `,border:"2px solid rgba(99, 102, 241, 0.5)",boxShadow:"0 0 30px rgba(99, 102, 241, 0.4)"},children:e.jsx(g,{Icon:c.ScanBarcode,size:48,className:"text-indigo-400",style:{filter:"drop-shadow(0 2px 8px rgba(99, 102, 241, 0.5))"}})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-white font-semibold mb-2 text-base md:text-lg",children:"Scan Rapide"}),e.jsx("p",{className:"text-indigo-200 text-xs md:text-sm leading-relaxed max-w-full sm:max-w-xs mx-auto px-2 sm:px-0",children:"Scannez le code-barre pour une analyse instantan√©e du produit"})]})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:R,className:"w-full btn-glass--primary touch-feedback-css",style:{background:`
                          linear-gradient(135deg,
                            rgba(99, 102, 241, 0.8),
                            rgba(79, 70, 229, 0.6)
                          )
                        `,backdropFilter:"blur(20px) saturate(160%)",boxShadow:`
                          0 12px 40px rgba(99, 102, 241, 0.4),
                          0 0 60px rgba(99, 102, 241, 0.3),
                          inset 0 3px 0 rgba(255,255,255,0.3),
                          inset 0 -3px 0 rgba(0,0,0,0.2)
                        `,border:"2px solid rgba(99, 102, 241, 0.6)",padding:"1rem"},children:e.jsxs("div",{className:"relative flex flex-col items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.Camera,size:28,className:"text-white",style:{filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.3))"}}),e.jsx("span",{className:"font-bold text-base",children:"Scanner avec Cam√©ra"})]})}),e.jsx("button",{onClick:Z,className:"w-full btn-glass touch-feedback-css",style:{background:`
                          linear-gradient(135deg,
                            rgba(99, 102, 241, 0.2),
                            rgba(79, 70, 229, 0.12)
                          )
                        `,backdropFilter:"blur(20px) saturate(140%)",boxShadow:`
                          0 8px 32px rgba(99, 102, 241, 0.2),
                          0 0 40px rgba(99, 102, 241, 0.12),
                          inset 0 2px 0 rgba(255,255,255,0.12)
                        `,border:"2px solid rgba(99, 102, 241, 0.35)",padding:"1rem"},children:e.jsxs("div",{className:"relative flex flex-col items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.Image,size:24,className:"text-indigo-300",style:{filter:"drop-shadow(0 2px 8px rgba(99, 102, 241, 0.5))"}}),e.jsx("span",{className:"font-bold text-sm text-indigo-200",children:"Choisir depuis Galerie"})]})})]})]})]})}),i.length>0&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-white font-semibold text-base flex items-center gap-2",children:[e.jsx(g,{Icon:c.ScanBarcode,size:20,className:"text-indigo-400"}),e.jsx("span",{children:"Codes-barres d√©tect√©s"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-300 text-xs font-bold",children:i.length})]})}),e.jsx("div",{className:"space-y-3",children:i.map((k,q)=>e.jsx(O,{className:"p-4",style:{background:"rgba(99, 102, 241, 0.08)",borderColor:"rgba(99, 102, 241, 0.3)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(79, 70, 229, 0.2))",border:"1px solid rgba(99, 102, 241, 0.4)"},children:e.jsx(g,{Icon:c.ScanBarcode,size:24,className:"text-indigo-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-semibold text-sm mb-1",children:k.barcode}),e.jsx("p",{className:"text-indigo-300 text-xs",children:"En attente d'analyse"})]})]}),e.jsx("button",{onClick:()=>n(k.barcode),className:"w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-red-500/20",style:{border:"1px solid rgba(239, 68, 68, 0.3)"},children:e.jsx(g,{Icon:c.X,size:16,className:"text-red-400"})})]})},`barcode-${k.barcode}-${q}-${k.scannedAt}`))}),!s&&i.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(O,{className:"p-4 text-center",style:{background:"rgba(99, 102, 241, 0.05)",borderColor:"rgba(99, 102, 241, 0.2)"},children:[e.jsx("p",{className:"text-gray-300 text-sm mb-3",children:"Ajouter une photo pour enrichir votre analyse nutritionnelle"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"flex-1 btn-glass touch-feedback-css",style:{background:"rgba(16, 185, 129, 0.08)",borderColor:"rgba(16, 185, 129, 0.25)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.Camera,size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Appareil photo"})]})}),e.jsx("button",{onClick:P,className:"flex-1 btn-glass touch-feedback-css",style:{background:"rgba(16, 185, 129, 0.08)",borderColor:"rgba(16, 185, 129, 0.25)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.Image,size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Galerie"})]})})]})]})})]}),r.length>0&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-white font-semibold text-base flex items-center gap-2",children:[e.jsx(g,{Icon:c.Check,size:20,className:"text-green-400"}),e.jsx("span",{children:"Produits analys√©s"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-green-500/20 text-green-300 text-xs font-bold",children:r.length})]})}),e.jsx("div",{className:"space-y-3",children:r.map(k=>e.jsx(Ye,{product:k,onPortionChange:m,onRemove:y},k.barcode))})]}),(s||i.length>0||r.length>0)&&e.jsx("div",{ref:U,className:"mt-8",children:e.jsx(_e,{onProceedToProcessing:v,isProcessingInProgress:D,hasPhoto:!!s,hasScannedBarcodes:i.length>0,hasScannedProducts:r.length>0,scannedBarcodesCount:i.length,scannedProductsCount:r.length})}),a==="photo-analysis"&&!s&&i.length===0&&r.length===0&&e.jsx(ue,{benefits:I,themeColor:"#10B981",title:"Pourquoi scanner mes repas ?"}),a==="barcode-scan"&&i.length===0&&r.length===0&&e.jsx(ue,{benefits:F,themeColor:"#6366F1",title:"Pourquoi scanner un code-barre ?"})]}),e.jsx("input",{ref:T,type:"file",accept:"image/*",onChange:se,style:{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0",opacity:0,pointerEvents:"none"},capture:"environment","data-testid":"camera-file-input"}),e.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:se,style:{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0",opacity:0,pointerEvents:"none"},"data-testid":"gallery-file-input"}),e.jsx("input",{ref:$,type:"file",accept:"image/*",onChange:k=>{k.target.files?.[0]&&(j(!0),A("upload"))},className:"hidden"}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 z-50",style:{pointerEvents:"none"},children:e.jsx("div",{style:{pointerEvents:"auto"},children:e.jsx(ke,{capturedPhoto:s,onBack:M})})}),b&&e.jsx(Xe,{onBarcodeDetected:te,onClose:G,mode:d,uploadedImage:d==="upload"?$.current?.files?.[0]:void 0})]})},ea=({analysisZones:a,currentPhase:t,analysisColor:s})=>e.jsxs("div",{className:"absolute inset-0 analysis-overlays perf-heavy",children:[e.jsx("div",{className:"absolute top-0 w-1 h-full opacity-70 scan-line-vertical",style:{background:`linear-gradient(180deg, 
            transparent 0%, 
            ${s}CC 30%, 
            ${s}FF 50%, 
            ${s}CC 70%, 
            transparent 100%
          )`,left:"50%",transform:"translateX(-50%)",boxShadow:`0 0 8px ${s}80`}}),e.jsx("div",{className:"absolute left-0 w-full h-1 opacity-60 scan-line-horizontal",style:{background:`linear-gradient(90deg, 
            transparent 0%, 
            ${s}80 30%, 
            ${s}CC 50%, 
            ${s}80 70%, 
            transparent 100%
          )`,top:"50%",transform:"translateY(-50%)",boxShadow:`0 0 6px ${s}60`}}),e.jsx("div",{className:"absolute inset-0 opacity-25 analysis-grid",children:e.jsx("div",{className:"w-full h-full",style:{backgroundImage:`
              linear-gradient(${s}30 1px, transparent 1px),
              linear-gradient(90deg, ${s}30 1px, transparent 1px)
            `,backgroundSize:"32px 32px"}})}),e.jsx("div",{className:"absolute inset-0 nutrition-keypoints",children:[{x:25,y:30,label:"Prot√©ines",color:"#EF4444"},{x:75,y:25,label:"Lipides",color:"#8B5CF6"}].map((i,r)=>e.jsx("div",{className:`absolute w-4 h-4 rounded-full nutrition-keypoint particle-css particle-css--${r+1}`,style:{left:`${i.x}%`,top:`${i.y}%`,background:i.color,boxShadow:`
                0 0 16px ${i.color}80,
                0 0 32px ${i.color}40
              `,border:`1px solid ${i.color}CC`,"--particle-color":i.color},children:e.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 px-2 py-1 rounded text-xs font-medium whitespace-nowrap pointer-events-none",style:{background:`${i.color}20`,border:`1px solid ${i.color}40`,color:i.color,backdropFilter:"blur(8px)",opacity:t==="detection"?1:.3},children:i.label})},i.label))}),a.slice(0,3).map(i=>e.jsx("div",{className:"absolute w-16 h-16 rounded-full pointer-events-none",style:{left:`${i.x}%`,top:`${i.y}%`,background:`radial-gradient(circle, 
              ${s}${Math.round(i.intensity*80)} 0%, 
              ${s}${Math.round(i.intensity*40)} 50%, 
              transparent 70%
            )`,border:`1px solid ${s}40`,backdropFilter:"blur(4px)"}},i.id)),e.jsx("div",{className:"absolute inset-0 rounded-xl pointer-events-none ai-focus-overlay",style:{background:`
            radial-gradient(circle at center, 
              transparent 20%, 
              ${s}10 40%, 
              ${s}20 60%, 
              ${s}15 80%, 
              transparent 100%
            )
          `,mixBlendMode:"overlay"}})]}),aa=({capturedPhoto:a,analysisZones:t,currentPhase:s,analysisColor:i})=>{const r=X(),{isPerformanceMode:o}=ee(),l=o?"div":f.div;return e.jsxs(O,{className:"p-6 relative overflow-visible glass-card--analysis",style:{background:o?"linear-gradient(145deg, color-mix(in srgb, #10B981 10%, #1e293b), color-mix(in srgb, #10B981 5%, #0f172a))":"radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.12) 0%, transparent 60%), radial-gradient(circle at 70% 80%, rgba(6, 182, 212, 0.08) 0%, transparent 50%), var(--glass-opacity)",borderColor:"rgba(16, 185, 129, 0.3)",boxShadow:o?"0 8px 32px rgba(0, 0, 0, 0.5)":"0 12px 40px rgba(0, 0, 0, 0.25), 0 0 30px rgba(16, 185, 129, 0.15), inset 0 2px 0 rgba(255, 255, 255, 0.15)",...o?{}:{backdropFilter:"blur(20px) saturate(150%)"}},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:o?"linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(5, 150, 105, 0.3))":"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%), linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(5, 150, 105, 0.3))",border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:o?"0 4px 16px rgba(0, 0, 0, 0.5)":"0 0 24px rgba(16, 185, 129, 0.5), inset 0 2px 0 rgba(255,255,255,0.3), inset 0 -2px 0 rgba(0,0,0,0.2)"},children:e.jsx(g,{Icon:c.Scan,size:20,style:{color:"#fff",filter:"drop-shadow(0 2px 6px rgba(16, 185, 129, 0.8))"}})}),e.jsx("h4",{className:"text-white font-bold text-lg",style:{textShadow:"0 2px 8px rgba(16, 185, 129, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:"Forge Nutritionnelle"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2",style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(34, 197, 94, 0.2))",border:"2px solid rgba(16, 185, 129, 0.5)",borderRadius:"20px",...o?{}:{backdropFilter:"blur(16px) saturate(140%)"},boxShadow:o?"0 4px 16px rgba(0, 0, 0, 0.5)":"0 4px 20px rgba(16, 185, 129, 0.3), 0 0 30px rgba(16, 185, 129, 0.2), inset 0 1px 0 rgba(255,255,255,0.25)"},children:[e.jsx(l,{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:i,boxShadow:`0 0 12px ${i}`},...!o&&!r&&{animate:{scale:[1,1.4,1],opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}}),e.jsx("span",{className:"font-bold text-sm",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:s==="detection"?"D√©tection":s==="analysis"?"Analyse":"Calcul"})]})]}),e.jsxs("div",{className:"relative aspect-[4/3] rounded-xl overflow-hidden bg-black/20 analysis-viewport",children:[e.jsx("img",{src:a.url,alt:"Repas en cours d'analyse",className:"w-full h-full object-cover border border-green-400/20"}),!o&&!r&&e.jsx(ea,{analysisZones:t,currentPhase:s,analysisColor:i})]})]})},ta=({currentProgress:a,currentMessage:t,currentSubMessage:s,currentPhase:i,analysisColor:r})=>{const o=X(),{isPerformanceMode:l}=ee(),p=l?"div":f.div;return e.jsx(O,{className:"p-6 text-center glass-card--progress",style:{background:l?"linear-gradient(145deg, color-mix(in srgb, #10B981 10%, #1e293b), color-mix(in srgb, #22C55E 6%, #0f172a))":`
            radial-gradient(circle at 50% 30%, rgba(16, 185, 129, 0.12) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, rgba(34, 197, 94, 0.08) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"rgba(16, 185, 129, 0.3)",borderRadius:"24px",...l?{}:{backdropFilter:"blur(20px) saturate(150%)"},boxShadow:l?"0 12px 40px rgba(0, 0, 0, 0.25)":`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px rgba(16, 185, 129, 0.15),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center relative",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, rgba(16, 185, 129, 0.35), rgba(34, 197, 94, 0.25))
              `,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                0 0 40px rgba(16, 185, 129, 0.5),
                inset 0 2px 0 rgba(255,255,255,0.3),
                inset 0 -2px 0 rgba(0,0,0,0.2)
              `},children:e.jsxs(f.div,{className:"relative",animate:o?{}:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:[e.jsx(g,{Icon:c.Loader2,size:28,className:"loader-essential",style:{color:"#fff",filter:"drop-shadow(0 2px 8px rgba(16, 185, 129, 0.8))"}}),!o&&!l&&e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`conic-gradient(from 0deg,
                      transparent 0%,
                      ${r}40 25%,
                      transparent 50%,
                      ${r}60 75%,
                      transparent 100%
                    )`,animation:"spinHalo 3s linear infinite reverse"}})]})}),e.jsx("h3",{className:"text-2xl font-bold text-white",style:{textShadow:"0 2px 12px rgba(16, 185, 129, 0.4), 0 0 4px rgba(0,0,0,0.3)"},children:t})]}),e.jsx("p",{className:"text-green-100 text-sm mb-4 leading-relaxed max-w-sm mx-auto",children:s}),e.jsxs(p,{className:"inline-flex items-center justify-center gap-2 px-4 py-2 mx-auto",style:{background:`
              linear-gradient(135deg,
                rgba(16, 185, 129, 0.2),
                rgba(34, 197, 94, 0.15)
              )
            `,border:"2px solid rgba(16, 185, 129, 0.4)",borderRadius:"999px",boxShadow:l?"none":`
                0 0 20px rgba(16, 185, 129, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.2)
              `,...l?{}:{backdropFilter:"blur(12px)"}},...!l&&{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.4}},children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:r,boxShadow:`0 0 8px ${r}`,animation:"pulse 1.5s ease-in-out infinite"}}),e.jsx("span",{className:"text-sm font-bold",style:{color:"#fff",textShadow:"0 1px 4px rgba(0,0,0,0.3)"},children:i==="detection"?"D√©tection":i==="analysis"?"Analyse":"Calcul"})]},i),e.jsx("div",{className:"flex items-center justify-center gap-1 mt-3",children:["detection","analysis","calculation"].map((m,y)=>e.jsx(p,{className:"w-2 h-2 rounded-full",style:{background:m===i?r:"rgba(255, 255, 255, 0.3)",boxShadow:m===i?`0 0 8px ${r}60`:"none"},...!l&&{animate:m===i?{scale:[1,1.2,1],opacity:[.8,1,.8]}:{},transition:{duration:1.5,repeat:m===i?1/0:0,ease:"easeInOut"}}},m))}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-2 mt-4 overflow-hidden backdrop-blur-sm",children:e.jsx(f.div,{className:"h-full rounded-full relative",style:{background:`
                linear-gradient(90deg, 
                  ${r}, 
                  rgba(34, 197, 94, 0.9),
                  rgba(52, 211, 153, 0.8)
                )
              `,boxShadow:`
                0 0 16px ${r}80,
                inset 0 1px 0 rgba(255,255,255,0.3)
              `},initial:{width:0},animate:{width:`${a}%`},transition:{duration:.8,ease:"easeOut"},children:!o&&!l&&e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg,
                    transparent 0%,
                    rgba(255,255,255,0.4) 50%,
                    transparent 100%
                  )`,animation:"progressShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-green-300 font-medium",children:[Math.round(a),"% termin√©"]}),e.jsxs("span",{className:"text-white/60",children:["Phase: ",i==="detection"?"D√©tection":i==="analysis"?"Analyse":"Calcul"]})]})]})})},sa=({analysisColor:a})=>e.jsxs("div",{className:"relative overflow-hidden data-flow-container h-16 perf-heavy",children:[Array.from({length:4}).map((t,s)=>e.jsx("div",{className:`absolute w-3 h-3 rounded-full particle-css particle-css--${s+1}`,style:{background:`linear-gradient(135deg, ${a}, rgba(34, 197, 94, 0.8))`,left:`${10+s*10}%`,top:`${40+s%3*20}%`,boxShadow:`
              0 0 12px ${a}80,
              0 0 24px ${a}40
            `,border:`1px solid ${a}CC`,"--particle-color":a}},s)),e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{opacity:.3},children:Array.from({length:2}).map((t,s)=>e.jsx("path",{d:`M ${20+s*30} 50 Q ${40+s*30} 20 ${60+s*30} 50`,stroke:a,strokeWidth:"2",fill:"none",strokeDasharray:"4 4",style:{animation:`data-flow-path 3s ease-in-out infinite ${s*.5}s`}},s))})]}),ra=`
@keyframes data-flow-path {
  0% { stroke-dashoffset: 20; }
  100% { stroke-dashoffset: -20; }
}
`;if(typeof document<"u"){const a=document.createElement("style");a.textContent=ra,document.head.appendChild(a)}const na=({capturedPhoto:a,progress:t,progressMessage:s,progressSubMessage:i})=>{const[r,o]=S.useState([]),[l,p]=S.useState("detection"),m="#10B981";return S.useEffect(()=>{const y=()=>{const n=Array.from({length:6},(_,M)=>({x:Math.random()*80+10,y:Math.random()*80+10,intensity:Math.random()*.6+.4,id:`zone-${Date.now()}-${M}`}));o(n)};y();const w=setInterval(y,2e3);return()=>clearInterval(w)},[]),S.useEffect(()=>{const y=["detection","analysis","calculation"];let w=0;const n=setInterval(()=>{w=(w+1)%y.length,p(y[w]),u.debug("MEAL_ANALYSIS","Analysis phase changed",{phase:y[w],timestamp:new Date().toISOString()})},3e3);return()=>clearInterval(n)},[]),a?e.jsxs("div",{className:"space-y-6 w-full meal-processing-enter",children:[e.jsx(ae,{currentStep:"processing",progress:t,message:s,subMessage:i}),e.jsx("div",{children:e.jsx(aa,{capturedPhoto:a,analysisZones:r,currentPhase:l,analysisColor:m})}),e.jsx("div",{children:e.jsx(ta,{currentProgress:t,currentMessage:s,currentSubMessage:i,currentPhase:l,analysisColor:m})}),e.jsx(sa,{analysisColor:m})]}):null},ia=({mealName:a,totalCalories:t,confidence:s,analysisModel:i,celebrationActive:r,analysisMetadata:o})=>{const l=X(),[p,m]=S.useState(0);return S.useEffect(()=>{if(t===0)return;const y=800,w=30,n=t/w,_=y/w;let M=0;const v=setInterval(()=>{M++;const D=Math.min(t,Math.round(n*M));m(D),(M>=w||D>=t)&&(m(t),clearInterval(v))},_);return()=>clearInterval(v)},[t]),e.jsx("div",{className:"meal-results-enter",children:e.jsx(f.div,{animate:r?{boxShadow:["0 12px 40px rgba(0, 0, 0, 0.25), 0 0 40px color-mix(in srgb, #FF4500 20%, transparent)","0 12px 40px rgba(0, 0, 0, 0.25), 0 0 60px color-mix(in srgb, #FF4500 35%, transparent)","0 12px 40px rgba(0, 0, 0, 0.25), 0 0 40px color-mix(in srgb, #FF4500 20%, transparent)"]}:l?{}:{boxShadow:["0 12px 40px rgba(0, 0, 0, 0.25), 0 0 30px color-mix(in srgb, #FF4500 15%, transparent)","0 12px 40px rgba(0, 0, 0, 0.25), 0 0 45px color-mix(in srgb, #FF4500 25%, transparent)","0 12px 40px rgba(0, 0, 0, 0.25), 0 0 30px color-mix(in srgb, #FF4500 15%, transparent)"]},transition:{duration:r?1.5:3,repeat:1/0,ease:"easeInOut"},children:e.jsxs(O,{className:"p-6 md:p-8 text-center relative w-full perf-critical",style:{background:`
              radial-gradient(circle at 50% 50%, color-mix(in srgb, #FF4500 6%, transparent) 0%, transparent 70%),
              radial-gradient(circle at 80% 20%, color-mix(in srgb, #FF8C00 4%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #FF4500 30%, transparent)",boxShadow:`
              0 12px 40px rgba(0, 0, 0, 0.25),
              0 0 30px color-mix(in srgb, #FF4500 15%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.15)
            `,backdropFilter:"blur(20px) saturate(150%)",borderRadius:"24px",border:"2px solid color-mix(in srgb, #FF4500 40%, transparent)"},children:[e.jsx("div",{className:"absolute inset-0 rounded-inherit pointer-events-none",style:{background:"radial-gradient(circle at center, color-mix(in srgb, #FF4500 2%, transparent) 0%, transparent 70%)",filter:"blur(16px)",transform:"scale(1.1)",zIndex:-1,animation:r&&!l?"calorie-forge-glow 3s ease-in-out infinite":l?"none":"calorie-forge-glow-idle 4s ease-in-out infinite"}}),e.jsxs("div",{className:"relative z-10 space-y-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(f.div,{className:"w-24 h-24 rounded-full flex items-center justify-center relative",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #FF4500 50%, transparent), color-mix(in srgb, #FF8C00 40%, transparent))
                `,border:"2px solid color-mix(in srgb, #FF4500 70%, transparent)",boxShadow:`
                  0 0 50px color-mix(in srgb, #FF4500 60%, transparent),
                  0 0 80px color-mix(in srgb, #FF4500 40%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.35)
                `},animate:r?{scale:[1,1.12,1],boxShadow:["0 0 50px color-mix(in srgb, #FF4500 60%, transparent), 0 0 80px color-mix(in srgb, #FF4500 40%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.35)","0 0 70px color-mix(in srgb, #FF4500 80%, transparent), 0 0 120px color-mix(in srgb, #FF4500 60%, transparent), inset 0 3px 0 rgba(255, 255, 255, 0.45)","0 0 50px color-mix(in srgb, #FF4500 60%, transparent), 0 0 80px color-mix(in srgb, #FF4500 40%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.35)"]}:l?{}:{scale:[1,1.03,1],rotate:[0,2,-2,0]},transition:{duration:r?1.5:2.5,repeat:1/0,ease:"easeInOut"},children:e.jsx(f.div,{animate:l?{}:{scale:[1,1.1,.95,1],opacity:[1,.9,1,1]},transition:{duration:1.8,repeat:1/0,ease:"easeInOut",times:[0,.3,.6,1]},children:e.jsx(g,{Icon:c.Flame,size:48,className:"text-white",variant:"pure","aria-hidden":"true"})})})}),e.jsxs("div",{className:"text-center space-y-5",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white leading-normal",children:a}),e.jsx("p",{className:"text-white/70 text-base",children:"Repas analys√© par TwinForge"})]}),e.jsx("div",{className:"text-5xl md:text-6xl font-black leading-none",style:{background:`
                  linear-gradient(135deg, 
                    #FF4500, 
                    #FF8C00,
                    #FFD700
                  )
                `,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",textShadow:r?"0 0 40px color-mix(in srgb, #FF4500 60%, transparent)":"0 0 20px color-mix(in srgb, #FF4500 40%, transparent)",filter:"drop-shadow(0 2px 8px rgba(0,0,0,0.3))"},children:p}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold text-white",children:"√ânergie Totale"}),e.jsx("p",{className:"text-white/80 text-base md:text-lg",children:"Kilocalories analys√©es"})]})]})]})]})})})},oa=({analysisResults:a,celebrationActive:t})=>{const s=X();return e.jsxs("div",{className:"macronutrients-card-container",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(f.div,{className:"macronutrients-header-icon",whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:20},children:e.jsx(g,{Icon:c.BarChart3,size:20,style:{color:"var(--nutrition-secondary)"}})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Macronutriments Forg√©s"})]}),e.jsxs("div",{className:"nutrition-stats-grid",children:[e.jsxs(f.div,{className:"nutrition-stat-card proteins",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:s?.1:.5,delay:s?0:.1},children:[e.jsx("div",{className:`nutrition-stat-icon ${t?"celebrating":""}`,children:e.jsx(g,{Icon:c.Activity,size:20,style:{color:"var(--nutrition-proteins)"}})}),e.jsxs(f.div,{className:"nutrition-stat-value",style:{color:"var(--nutrition-proteins)"},initial:{scale:0},animate:{scale:1},transition:{type:s?"tween":"spring",stiffness:300,delay:s?0:.3},children:[Math.round(a.macronutrients.proteins),"g"]}),e.jsx("div",{className:"text-white font-medium text-sm",children:"Prot√©ines"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"R√©cup√©ration"})]}),e.jsxs(f.div,{className:"nutrition-stat-card carbs",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:s?.1:.5,delay:s?0:.2},children:[e.jsx("div",{className:`nutrition-stat-icon ${t?"celebrating":""}`,children:e.jsx(g,{Icon:c.Zap,size:20,style:{color:"var(--nutrition-carbs)"}})}),e.jsxs(f.div,{className:"nutrition-stat-value",style:{color:"var(--nutrition-carbs)"},initial:{scale:0},animate:{scale:1},transition:{type:s?"tween":"spring",stiffness:300,delay:s?0:.4},children:[Math.round(a.macronutrients.carbs),"g"]}),e.jsx("div",{className:"text-white font-medium text-sm",children:"Glucides"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"√ânergie rapide"})]}),e.jsxs(f.div,{className:"nutrition-stat-card fats",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:s?.1:.5,delay:s?0:.3},children:[e.jsx("div",{className:`nutrition-stat-icon ${t?"celebrating":""}`,children:e.jsx(g,{Icon:c.Heart,size:20,style:{color:"var(--nutrition-fats)"}})}),e.jsxs(f.div,{className:"nutrition-stat-value",style:{color:"var(--nutrition-fats)"},initial:{scale:0},animate:{scale:1},transition:{type:s?"tween":"spring",stiffness:300,delay:s?0:.5},children:[Math.round(a.macronutrients.fats),"g"]}),e.jsx("div",{className:"text-white font-medium text-sm",children:"Lipides"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Graisses saines"})]})]}),e.jsxs(f.div,{className:"nutrition-confidence-indicator",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:s?.1:.6,delay:s?0:.6},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{Icon:c.BarChart3,size:16,style:{color:"var(--nutrition-secondary)",filter:"drop-shadow(0 0 8px color-mix(in srgb, var(--nutrition-secondary) 60%, transparent))"}}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"R√©partition Macronutritionnelle"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-lg",style:{color:"var(--nutrition-secondary)"},children:[Math.round((a.macronutrients.proteins+a.macronutrients.carbs+a.macronutrients.fats)/3),"g"]}),e.jsx("div",{className:"text-white/60 text-xs",children:"Moyenne"})]})]})]})};function ie(a){const t={protein:"#EF4444",carbs:"#F59E0B",vegetables:"#22C55E",healthy_fats:"#8B5CF6",dairy:"#06B6D4",fruits:"#EC4899",grains:"#D97706",default:"#10B981"};return t[a]||t.default}const la=({analysisResults:a})=>{const t=X();return e.jsxs("div",{className:"detected-foods-card-container",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(f.div,{className:"detected-foods-header-icon",whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:20},children:e.jsx(g,{Icon:c.Eye,size:20,style:{color:"var(--nutrition-accent)"}})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Aliments D√©tect√©s"})]}),e.jsx("div",{className:"space-y-3",children:a.detected_foods.map((s,i)=>e.jsx(f.div,{className:"food-item-card",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:t?.1:.4,delay:t?0:.3+i*.1},style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${ie(s.category)} 8%, transparent) 0%, transparent 60%),
                rgba(255, 255, 255, 0.08)
              `,border:`2px solid color-mix(in srgb, ${ie(s.category)} 25%, transparent)`,boxShadow:`
                0 4px 16px rgba(0, 0, 0, 0.15),
                0 0 12px color-mix(in srgb, ${ie(s.category)} 15%, transparent),
                inset 0 1px 0 rgba(255, 255, 255, 0.12)
              `},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"food-category-indicator",style:{color:ie(s.category)}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold text-lg",children:s.name}),s.portion_size&&e.jsx("div",{className:"text-white/60 text-sm mb-1",children:s.portion_size}),e.jsxs("div",{className:"text-white/70 text-sm",children:["P: ",Math.round(s.proteins),"g ‚Ä¢ G: ",Math.round(s.carbs),"g ‚Ä¢ L: ",Math.round(s.fats),"g"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-white font-bold text-xl",children:s.calories}),e.jsx("div",{className:"text-white/70 text-sm",children:"kcal"})]})]})},i))})]})},ca=({capturedPhoto:a})=>(X(),e.jsxs(O,{className:"p-6 glass-card--photo-analyzed",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-primary) 12%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, var(--brand-primary) 35%, transparent)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px color-mix(in srgb, var(--brand-primary) 15%, transparent),
          0 0 60px color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent),
          inset 0 1px 0 rgba(255, 255, 255, 0.15)
        `,backdropFilter:"blur(20px) saturate(150%)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(f.div,{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, var(--brand-primary) 40%, transparent), color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent))
            `,border:"2px solid color-mix(in srgb, var(--brand-primary) 60%, transparent)",boxShadow:"0 0 25px color-mix(in srgb, var(--brand-primary) 40%, transparent)"},whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:20},children:e.jsx(g,{Icon:c.Camera,size:18,style:{color:"var(--color-plasma-cyan)"}})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Capture Nutritionnelle"})]}),e.jsxs("div",{className:"aspect-[4/3] rounded-2xl overflow-hidden relative",children:[e.jsx("img",{src:a.url,alt:"Repas analys√©",className:"w-full h-full object-cover",style:{border:"2px solid color-mix(in srgb, var(--brand-primary) 30%, transparent)"}}),e.jsx("div",{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{background:`
              radial-gradient(circle at center, color-mix(in srgb, var(--nutrition-primary) 8%, transparent) 0%, transparent 70%),
              radial-gradient(circle at 30% 30%, color-mix(in srgb, var(--color-plasma-cyan) 6%, transparent) 0%, transparent 50%)
            `,border:"1px solid color-mix(in srgb, var(--nutrition-primary) 20%, transparent)",backdropFilter:"blur(4px) saturate(120%)"}}),e.jsx("div",{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{background:`
              linear-gradient(135deg, 
                color-mix(in srgb, var(--color-plasma-cyan) 4%, transparent) 0%, 
                transparent 30%, 
                color-mix(in srgb, var(--nutrition-primary) 3%, transparent) 70%, 
                transparent 100%
              )
            `,mixBlendMode:"overlay"}})]})]})),da=({isSaving:a,onSaveMeal:t,onRetake:s,onNewScan:i,analysisResults:r})=>{const o=X(),{click:l,formSubmit:p}=J(),m=async()=>{p();try{await t()}catch(y){console.error("ActionButtons: Save meal failed:",y)}};return e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:o?.1:.6,delay:o?0:.4},className:"space-y-4",children:[e.jsx("button",{onClick:m,disabled:a,className:"btn-save-meal-cta touch-feedback-css",children:e.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-3",children:[e.jsx("div",{className:a?"icon-spin-css":"",children:e.jsx(g,{Icon:a?c.Loader2:c.Check,size:24})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:a?"Sauvegarde...":"Sauvegarder le Repas"})]})}),e.jsxs("div",{className:"meal-secondary-actions-grid",children:[e.jsx("button",{onClick:()=>{l(),s()},className:"btn-meal-secondary retake touch-target touch-feedback-css",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(g,{Icon:c.RotateCcw,size:18}),e.jsx("span",{className:"font-medium",children:"Reprendre"})]})}),e.jsx("button",{onClick:()=>{l(),i()},className:"btn-meal-secondary new-scan touch-target touch-feedback-css",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(g,{Icon:c.Plus,size:18}),e.jsx("span",{className:"font-medium",children:"Nouveau Scan"})]})})]})]})},ua=({analysisResults:a,capturedPhoto:t,onSaveMeal:s,isSaving:i,onRetake:r,onNewScan:o,progress:l,progressMessage:p,progressSubMessage:m})=>{const{isPerformanceMode:y}=ee(),[w,n]=E.useState(!1);return!a||!t?null:(E.useEffect(()=>{if(i)n(!0);else{const _=setTimeout(()=>n(!1),1e3);return()=>clearTimeout(_)}},[i]),e.jsxs("div",{className:`space-y-6 w-full meal-results-enter pb-6 ${w?"celebration-active celebration-glow-css":""}`,children:[e.jsx(ae,{currentStep:"results",progress:l,message:p,subMessage:m,celebrationActive:w}),e.jsx("div",{children:e.jsx(ia,{totalCalories:a.total_calories,mealName:a.meal_name,confidence:a.confidence,analysisModel:a.analysis_metadata?.analysis_model_used||"advanced",celebrationActive:w,analysisMetadata:a.analysis_metadata})}),e.jsx("div",{children:e.jsx(oa,{analysisResults:a,celebrationActive:w})}),e.jsx("div",{children:e.jsx(la,{analysisResults:a})}),e.jsx("div",{children:e.jsx(ca,{capturedPhoto:t})}),e.jsx("div",{children:e.jsx(da,{isSaving:i,onSaveMeal:s,onRetake:r,onNewScan:o,analysisResults:a})})]}))},Q={scanType:"photo-analysis",currentStep:"capture",captureMode:"photo",capturedPhoto:null,scannedBarcodes:[],scannedProducts:[],analysisResults:null,barcodeAnalysisResults:null,isProcessing:!1,progress:0,progressMessage:"Pr√™t √† scanner votre repas",progressSubMessage:"Prenez une photo ou s√©lectionnez depuis la galerie",analysisError:null,analysisMetadata:null,isScanningBarcode:!1};async function ga(a){return new Promise((t,s)=>{const i=new FileReader;i.onload=()=>{const o=i.result.split(",")[1];t(o)},i.onerror=s,i.readAsDataURL(a)})}function xa(a){return{sex:a?.sex,height_cm:a?.height_cm,weight_kg:a?.weight_kg,target_weight_kg:a?.target_weight_kg,activity_level:a?.activity_level,objective:a?.objective,birthdate:a?.birthdate,job_category:a?.job_category,nutrition:{diet:a?.nutrition?.diet,allergies:a?.nutrition?.allergies||[],intolerances:a?.nutrition?.intolerances||[],disliked:a?.nutrition?.disliked||[],budgetLevel:a?.nutrition?.budgetLevel,proteinTarget_g:a?.nutrition?.proteinTarget_g,fastingWindow:a?.nutrition?.fastingWindow},health:{bloodType:a?.health?.bloodType,conditions:a?.health?.conditions||[],medications:a?.health?.medications||[]},emotions:{chronotype:a?.emotions?.chronotype,stress:a?.emotions?.stress,sleepHours:a?.emotions?.sleepHours,moodBaseline:a?.emotionBaseline?.moodBaseline,sensitivities:a?.emotions?.sensitivities||[]},workout:{type:a?.preferences?.workout?.type,sessionsPerWeek:a?.preferences?.workout?.sessionsPerWeek,preferredDuration:a?.preferences?.workout?.preferredDuration,equipment:a?.preferences?.workout?.equipment||[],morningWorkouts:a?.preferences?.workout?.morningWorkouts,highIntensity:a?.preferences?.workout?.highIntensity,groupWorkouts:a?.preferences?.workout?.groupWorkouts,outdoorActivities:a?.preferences?.workout?.outdoorActivities},constraints:a?.constraints||{},calculated_metrics:(()=>{const t=a?.birthdate?new Date().getFullYear()-new Date(a.birthdate).getFullYear():void 0,s=a?.height_cm&&a?.weight_kg?a.weight_kg/Math.pow(a.height_cm/100,2):void 0,i=a?.height_cm&&a?.weight_kg&&t?a.sex==="male"?88.362+13.397*a.weight_kg+4.799*a.height_cm-5.677*t:447.593+9.247*a.weight_kg+3.098*a.height_cm-4.33*t:void 0,r=a?.activity_level==="sedentary"?1.2:a?.activity_level==="light"?1.375:a?.activity_level==="moderate"?1.55:a?.activity_level==="active"?1.725:a?.activity_level==="athlete"?1.9:1.55,o=i?i*r:void 0,l=a?.objective==="muscle_gain"?2.2:a?.objective==="fat_loss"?2:1.6,p=a?.weight_kg?a.weight_kg*l:void 0;return{age:t,bmi:s?Math.round(s*10)/10:void 0,bmr:i?Math.round(i):void 0,tdee:o?Math.round(o):void 0,protein_target_calculated:p?Math.round(p):void 0,daily_calorie_target:o?Math.round(o):void 0}})()}}function pa({scanFlowState:a,setScanFlowState:t,profile:s,userId:i,clientScanIdRef:r,processingGuardRef:o,readyForProcessingRef:l,showToast:p,success:m,errorSound:y,queryClient:w,onAnalysisError:n,onSuccess:_}){const M=E.useCallback(async(x,b)=>{const j={file:x,url:URL.createObjectURL(x),validationResult:{isValid:b.validation?.isValid??!0,issues:b.validation?.issues??[],confidence:b.validation?.confidence??.8},captureReport:b};t(d=>({...d,capturedPhoto:j,analysisError:null,progress:33,progressMessage:"Forge du Repas",progressSubMessage:"Photo captur√©e avec succ√®s"})),u.info("MEAL_SCAN_FLOW","Photo captured",{clientScanId:r.current,isValid:j.validationResult.isValid}),setTimeout(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth",block:"center"})},300)},[t,r,l]),v=E.useCallback(()=>{t(x=>({...x,capturedPhoto:null,analysisError:null,analysisMetadata:null,currentStep:"capture",progress:0,progressMessage:"Forge du Repas",progressSubMessage:"Pr√™t pour une nouvelle capture"})),u.info("MEAL_SCAN_FLOW","Photo retake requested",{clientScanId:r.current})},[t,r]),D=E.useCallback(async()=>{if(o.current||!a.capturedPhoto&&a.scannedBarcodes.length===0&&a.scannedProducts.length===0||!i)return;o.current=!0,t(b=>({...b,isProcessing:!0,currentStep:"processing",analysisError:null,progress:20,progressMessage:"Analyse du Carburant",progressSubMessage:"D√©marrage de l'analyse..."}));const x=r.current;try{if(a.scannedBarcodes.length>0){u.info("MEAL_SCAN_FLOW","Starting barcode analysis",{clientScanId:x,barcodesCount:a.scannedBarcodes.length,barcodes:a.scannedBarcodes.map(I=>I.barcode)}),t(I=>({...I,progress:30,progressSubMessage:`Analyse de ${a.scannedBarcodes.length} code${a.scannedBarcodes.length>1?"s-barres":"-barre"}...`}));const N=[],$=[];for(let I=0;I<a.scannedBarcodes.length;I++){const F=a.scannedBarcodes[I];u.info("MEAL_SCAN_FLOW",`Analyzing barcode ${I+1}/${a.scannedBarcodes.length}`,{clientScanId:x,barcode:F.barcode,portionMultiplier:F.portionMultiplier});try{const h=await Y.getProductByBarcode(F.barcode);if(h.success&&h.product){const P=Y.convertToMealItem(h.product,F.portionMultiplier);P?(N.push({barcode:h.product.barcode,name:h.product.name,brand:h.product.brand,image_url:h.product.image_url,mealItem:P,portionMultiplier:F.portionMultiplier,scannedAt:F.scannedAt}),u.info("MEAL_SCAN_FLOW","Barcode analyzed successfully",{clientScanId:x,barcode:F.barcode,productName:h.product.name,calories:P.calories})):($.push({barcode:F.barcode,reason:"Failed to convert to meal item"}),u.warn("MEAL_SCAN_FLOW","Failed to convert product to meal item",{clientScanId:x,barcode:F.barcode}))}else $.push({barcode:F.barcode,reason:h.error||"Product not found"}),u.warn("MEAL_SCAN_FLOW","Product not found for barcode",{clientScanId:x,barcode:F.barcode,error:h.error})}catch(h){$.push({barcode:F.barcode,reason:h instanceof Error?h.message:"Unknown error"}),u.error("MEAL_SCAN_FLOW","Exception during barcode analysis",{clientScanId:x,barcode:F.barcode,error:h instanceof Error?h.message:String(h),stack:h instanceof Error?h.stack:void 0})}t(h=>({...h,progress:30+15*(I+1)/a.scannedBarcodes.length,progressSubMessage:`Analyse ${I+1}/${a.scannedBarcodes.length} codes-barres...`}))}if(t(I=>({...I,scannedProducts:[...I.scannedProducts,...N],scannedBarcodes:[]})),u.info("MEAL_SCAN_FLOW","Barcodes analysis completed",{clientScanId:x,totalBarcodes:a.scannedBarcodes.length,analyzedCount:N.length,failedCount:$.length,failedDetails:$,analyzedProducts:N.map(I=>({barcode:I.barcode,name:I.name,calories:I.mealItem.calories}))}),N.length===0&&$.length>0){const I=`Impossible d'analyser les codes-barres: ${$.map(F=>F.reason).join(", ")}`;u.error("MEAL_SCAN_FLOW","All barcodes failed to analyze",{clientScanId:x,failedBarcodes:$}),n(I);return}}t(N=>({...N,progress:50,progressSubMessage:"Identification des aliments..."}));const b=xa(s),j={user_id:i,meal_type:"dinner",timestamp:new Date().toISOString(),user_profile_context:b};a.capturedPhoto&&(j.image_data=await ga(a.capturedPhoto.file)),a.scannedProducts.length>0&&(j.scanned_products=a.scannedProducts.map(N=>({barcode:N.barcode,name:N.name,brand:N.brand,mealItem:N.mealItem,portionMultiplier:N.portionMultiplier})),console.log("üîµ DEBUG - scannedProducts being sent:",{count:a.scannedProducts.length,products:j.scanned_products,analysisRequestKeys:Object.keys(j),hasScannedProducts:!!j.scanned_products})),u.info("MEAL_SCAN_FLOW","Transmitting complete user context to analysis",{clientScanId:x,contextKeys:Object.keys(b),philosophy:"complete_user_context_transmission_to_analysis"}),await new Promise(N=>setTimeout(N,1500)),t(N=>({...N,progress:60,progressSubMessage:"Analyse des nutriments..."}));const{mealsRepo:d}=await fe(async()=>{const{mealsRepo:N}=await import("./ScanExitConfirmationModal-Fo-0NH5U.js").then($=>$.a);return{mealsRepo:N}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])),A=await d.analyzeMeal(j),T={model:A.analysis_metadata.ai_model_used,tokensUsed:A.analysis_metadata.tokens_used?.total||0,costUSD:A.analysis_metadata.tokens_used?.cost_estimate_usd||0,fallbackUsed:A.analysis_metadata.fallback_used||!1,photo_url:a.capturedPhoto?.url};t(N=>({...N,progress:70,progressSubMessage:"Calcul des macronutriments...",analysisMetadata:T})),await new Promise(N=>setTimeout(N,500)),t(N=>({...N,progress:85,progressSubMessage:"Optimisation pour vos objectifs..."})),await new Promise(N=>setTimeout(N,500)),t(N=>({...N,analysisResults:A,progress:95,progressMessage:"√ânergie Raffin√©e",progressSubMessage:"Finalisation des donn√©es..."})),await new Promise(N=>setTimeout(N,500)),t(N=>({...N,progress:100,currentStep:"results"})),_(),u.info("MEAL_SCAN_FLOW","Analysis completed",{clientScanId:x,totalCalories:A.total_calories,confidence:A.confidence,insightsCount:A.personalized_insights?.length||0,aiModelUsed:A.analysis_metadata?.ai_model_used,tokensUsed:A.analysis_metadata?.tokens_used,analysisId:A.analysis_id,hasPhoto:!!a.capturedPhoto,scannedProductsCount:a.scannedProducts.length,philosophy:"analysis_with_complete_user_context_and_hybrid_input"})}catch(b){u.error("MEAL_SCAN_FLOW","Analysis failed",{clientScanId:x,error:b instanceof Error?b.message:"Unknown error"}),n(b instanceof Error?b.message:"Unknown error occurred")}finally{t(b=>({...b,isProcessing:!1})),o.current=!1}},[a.capturedPhoto,a.scannedBarcodes,a.scannedProducts,i,s,t,r,o,n,_]),U=E.useCallback(x=>{t(b=>({...b,scannedProducts:[...b.scannedProducts,x],analysisError:null})),u.info("MEAL_SCAN_FLOW","Product scanned and added",{clientScanId:r.current,barcode:x.barcode,productName:x.name,totalScannedProducts:a.scannedProducts.length+1})},[t,r,a.scannedProducts.length]),z=E.useCallback((x,b)=>{t(j=>({...j,scannedProducts:j.scannedProducts.map(d=>{if(d.barcode===x){const A=Y.convertToMealItem({barcode:d.barcode,name:d.name,brand:d.brand,image_url:d.image_url,portion_size:d.mealItem.portion_size,nutrition_per_100g:{calories:d.mealItem.calories/d.portionMultiplier,proteins:d.mealItem.proteins/d.portionMultiplier,carbs:d.mealItem.carbs/d.portionMultiplier,fats:d.mealItem.fats/d.portionMultiplier,fiber:d.mealItem.fiber?d.mealItem.fiber/d.portionMultiplier:void 0,sugar:d.mealItem.sugar?d.mealItem.sugar/d.portionMultiplier:void 0,sodium:d.mealItem.sodium?d.mealItem.sodium/d.portionMultiplier:void 0}},b);return{...d,portionMultiplier:b,mealItem:A}}return d})})),u.info("MEAL_SCAN_FLOW","Product portion changed",{clientScanId:r.current,barcode:x,newMultiplier:b})},[t,r]),W=E.useCallback(x=>{t(b=>({...b,scannedProducts:b.scannedProducts.filter(j=>j.barcode!==x)})),u.info("MEAL_SCAN_FLOW","Product removed",{clientScanId:r.current,barcode:x,remainingProducts:a.scannedProducts.length-1})},[t,r,a.scannedProducts.length]),L=E.useRef(null),C=E.useCallback(x=>{t(b=>{const j=Date.now(),d=2e3;return L.current&&L.current.barcode===x.barcode&&j-L.current.timestamp<d?(u.warn("MEAL_SCAN_FLOW","Rapid duplicate barcode detected, applying cooldown",{clientScanId:r.current,barcode:x.barcode,timeSinceLastScan:j-L.current.timestamp,cooldownMs:d}),b):b.scannedBarcodes.some(T=>T.barcode===x.barcode)?(u.warn("MEAL_SCAN_FLOW","Barcode already in session, skipping",{clientScanId:r.current,barcode:x.barcode,existingCount:b.scannedBarcodes.length}),b):(L.current={barcode:x.barcode,timestamp:j},u.info("MEAL_SCAN_FLOW","Barcode detected and added",{clientScanId:r.current,barcode:x.barcode,totalScannedBarcodes:b.scannedBarcodes.length+1,timestamp:x.scannedAt}),{...b,scannedBarcodes:[...b.scannedBarcodes,x],analysisError:null})})},[t,r]),H=E.useCallback((x,b)=>{t(j=>({...j,scannedBarcodes:j.scannedBarcodes.map(d=>d.barcode===x?{...d,portionMultiplier:b}:d)})),u.info("MEAL_SCAN_FLOW","Barcode portion changed",{clientScanId:r.current,barcode:x,newMultiplier:b})},[t,r]),V=E.useCallback(x=>{t(b=>({...b,scannedBarcodes:b.scannedBarcodes.filter(j=>j.barcode!==x)})),u.info("MEAL_SCAN_FLOW","Barcode removed",{clientScanId:r.current,barcode:x,remainingBarcodes:a.scannedBarcodes.length-1})},[t,r,a.scannedBarcodes.length]);return{handlePhotoCapture:M,handleRetake:v,handleProceedToProcessing:D,handleProductScanned:U,handleProductPortionChange:z,handleProductRemove:W,handleBarcodeDetected:C,handleBarcodePortionChange:H,handleBarcodeRemove:V}}function ma({scanFlowState:a,setScanFlowState:t,clientScanIdRef:s,processingGuardRef:i,onAnalysisError:r,onSuccess:o}){const l=E.useCallback(y=>{u.info("BARCODE_PIPELINE","Barcode detected",{clientScanId:s.current,barcode:y.barcode}),t(w=>({...w,scannedBarcodes:[y],analysisError:null,progress:33,progressMessage:"Code-Barre D√©tect√©",progressSubMessage:"Pr√™t pour l'analyse"}))},[t,s]),p=E.useCallback(async()=>{if(i.current||a.scannedBarcodes.length===0)return;i.current=!0;const y=a.scannedBarcodes[0],w=s.current;try{t(v=>({...v,isProcessing:!0,currentStep:"processing",analysisError:null,progress:20,progressMessage:"Analyse du Code-Barre",progressSubMessage:"Connexion √† OpenFoodFacts..."})),u.info("BARCODE_PIPELINE","Starting barcode analysis",{clientScanId:w,barcode:y.barcode}),await new Promise(v=>setTimeout(v,500)),t(v=>({...v,progress:40,progressSubMessage:"R√©cup√©ration du produit..."}));const n=await Y.getProductByBarcode(y.barcode);if(!n.success||!n.product)throw new Error(n.error||"Produit non trouv√© dans la base OpenFoodFacts");u.info("BARCODE_PIPELINE","Product found",{clientScanId:w,barcode:y.barcode,productName:n.product.name}),t(v=>({...v,progress:60,progressSubMessage:"Analyse des donn√©es nutritionnelles..."})),await new Promise(v=>setTimeout(v,500));const _=Y.convertToMealItem(n.product,y.portionMultiplier);if(!_)throw new Error("Impossible de convertir les donn√©es nutritionnelles");t(v=>({...v,progress:80,progressSubMessage:"Finalisation des donn√©es..."})),await new Promise(v=>setTimeout(v,500));const M={scannedProduct:{barcode:n.product.barcode,name:n.product.name,brand:n.product.brand,image_url:n.product.image_url,mealItem:_,portionMultiplier:y.portionMultiplier,scannedAt:y.scannedAt},totalCalories:_.calories,totalProteins:_.proteins,totalCarbs:_.carbs,totalFats:_.fats,productDetails:{name:n.product.name,brand:n.product.brand,image_url:n.product.image_url,barcode:n.product.barcode,portionSize:n.product.portion_size||"100g"}};t(v=>({...v,barcodeAnalysisResults:M,progress:100,progressMessage:"Analyse Termin√©e",progressSubMessage:"Produit identifi√© avec succ√®s"})),await new Promise(v=>setTimeout(v,500)),t(v=>({...v,currentStep:"results"})),o(),u.info("BARCODE_PIPELINE","Analysis completed",{clientScanId:w,barcode:y.barcode,productName:n.product.name,calories:_.calories})}catch(n){u.error("BARCODE_PIPELINE","Analysis failed",{clientScanId:w,barcode:y.barcode,error:n instanceof Error?n.message:"Unknown error"}),r(n instanceof Error?n.message:"Erreur lors de l'analyse du code-barre")}finally{t(n=>({...n,isProcessing:!1})),i.current=!1}},[a.scannedBarcodes,t,s,i,r,o]),m=E.useCallback(()=>{t(y=>({...y,scannedBarcodes:[],barcodeAnalysisResults:null,analysisError:null,currentStep:"capture",progress:0,progressMessage:"Scanner un Code-Barre",progressSubMessage:"Pr√™t pour un nouveau scan"})),u.info("BARCODE_PIPELINE","Barcode retake requested",{clientScanId:s.current})},[t,s]);return{handleBarcodeDetected:l,handleBarcodeScan:p,handleBarcodeRetake:m}}const ba=({barcode:a,productImage:t,progress:s,progressMessage:i,progressSubMessage:r})=>e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(ae,{currentStep:"processing",progress:s,message:i,subMessage:r}),e.jsx(f.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4},children:e.jsx(O,{className:"p-6",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(79, 70, 229, 0.05))",borderColor:"rgba(99, 102, 241, 0.3)"},children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-6",children:[e.jsxs("div",{className:"w-32 h-32 rounded-3xl flex items-center justify-center relative overflow-hidden",style:{background:t?"rgba(99, 102, 241, 0.1)":"linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(79, 70, 229, 0.15))",border:"2px solid rgba(99, 102, 241, 0.4)"},children:[t?e.jsx(f.img,{src:t,alt:"Product",className:"w-full h-full object-contain p-2",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5}}):e.jsx(f.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(g,{Icon:c.ScanBarcode,size:64,className:"text-indigo-300"})}),e.jsx(f.div,{className:"absolute inset-0 rounded-3xl",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.2), transparent)"},animate:{opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-white font-bold text-xl",children:"Analyse du Code-Barre"}),e.jsx("p",{className:"text-indigo-300 text-sm font-mono",children:a}),e.jsx("p",{className:"text-gray-300 text-sm max-w-md",children:"R√©cup√©ration des donn√©es nutritionnelles depuis OpenFoodFacts..."})]}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"h-2 rounded-full overflow-hidden",style:{background:"rgba(99, 102, 241, 0.15)"},children:e.jsx(f.div,{className:"h-full rounded-full",style:{background:"linear-gradient(90deg, #6366F1, #818CF8)"},initial:{width:"0%"},animate:{width:`${s}%`},transition:{duration:.3}})}),e.jsxs("p",{className:"text-indigo-300 text-xs mt-2 text-center",children:[Math.round(s),"% compl√©t√©"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4 w-full max-w-md",children:[{icon:c.Database,label:"OpenFoodFacts"},{icon:c.Package,label:"Produit"},{icon:c.TrendingUp,label:"Nutrition"}].map((o,l)=>e.jsxs(f.div,{className:"flex flex-col items-center gap-2 p-3 rounded-xl",style:{background:"rgba(99, 102, 241, 0.08)",border:"1px solid rgba(99, 102, 241, 0.2)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:l*.1},children:[e.jsx(f.div,{animate:{scale:s>(l+1)*30?[1,1.2,1]:1},transition:{duration:.3},children:e.jsx(g,{Icon:o.icon,size:20,className:s>(l+1)*30?"text-indigo-300":"text-gray-500"})}),e.jsx("span",{className:`text-xs font-medium ${s>(l+1)*30?"text-indigo-300":"text-gray-500"}`,children:o.label})]},o.label))})]})})})]}),ha=({barcodeResults:a,onSaveMeal:t,isSaving:s,onRetake:i,onNewScan:r})=>{const[o,l]=S.useState(a.scannedProduct.portionMultiplier),p=_=>{l(_)},m=Math.round(a.totalCalories*o),y=Math.round(a.totalProteins*o),w=Math.round(a.totalCarbs*o),n=Math.round(a.totalFats*o);return e.jsxs("div",{className:"space-y-6 w-full pb-32",children:[e.jsx(ae,{currentStep:"results",progress:100,message:"Analyse Termin√©e",subMessage:"Produit identifi√© avec succ√®s"}),e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsxs(O,{className:"p-6",style:{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(79, 70, 229, 0.05))",borderColor:"rgba(99, 102, 241, 0.35)"},children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[a.productDetails.image_url&&e.jsx("div",{className:"w-24 h-24 rounded-2xl overflow-hidden flex-shrink-0",style:{background:"rgba(99, 102, 241, 0.1)",border:"2px solid rgba(99, 102, 241, 0.3)"},children:e.jsx("img",{src:a.productDetails.image_url,alt:a.productDetails.name,className:"w-full h-full object-contain p-2"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-white font-bold text-xl mb-1",children:a.productDetails.name}),a.productDetails.brand&&e.jsx("p",{className:"text-indigo-300 text-sm mb-2",children:a.productDetails.brand}),e.jsx("p",{className:"text-gray-400 text-xs font-mono",children:a.productDetails.barcode})]})]}),e.jsxs("div",{className:"p-4 rounded-xl mb-4",style:{background:"rgba(99, 102, 241, 0.08)",border:"1px solid rgba(99, 102, 241, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-gray-300 text-sm",children:"Portion"}),e.jsx("span",{className:"text-indigo-300 text-sm font-semibold",children:a.productDetails.portionSize})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>p(Math.max(.25,o-.25)),className:"w-10 h-10 rounded-lg flex items-center justify-center touch-feedback-css",style:{background:"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)"},children:e.jsx(g,{Icon:c.Minus,size:18,className:"text-indigo-300"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsxs("p",{className:"text-white font-bold text-2xl",children:[o,"x"]}),e.jsx("p",{className:"text-gray-400 text-xs",children:"Multiplicateur de portion"})]}),e.jsx("button",{onClick:()=>p(o+.25),className:"w-10 h-10 rounded-lg flex items-center justify-center touch-feedback-css",style:{background:"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)"},children:e.jsx(g,{Icon:c.Plus,size:18,className:"text-indigo-300"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"linear-gradient(135deg, rgba(251, 146, 60, 0.15), rgba(249, 115, 22, 0.08))",border:"1px solid rgba(251, 146, 60, 0.3)"},children:[e.jsx(g,{Icon:c.Flame,size:24,className:"text-orange-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-bold text-2xl mb-1",children:m}),e.jsx("p",{className:"text-orange-300 text-xs font-semibold",children:"Calories"})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.08))",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[e.jsx(g,{Icon:c.Drumstick,size:24,className:"text-red-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-white font-bold text-2xl mb-1",children:[y,"g"]}),e.jsx("p",{className:"text-red-300 text-xs font-semibold",children:"Prot√©ines"})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.08))",border:"1px solid rgba(59, 130, 246, 0.3)"},children:[e.jsx(g,{Icon:c.Wheat,size:24,className:"text-blue-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-white font-bold text-2xl mb-1",children:[w,"g"]}),e.jsx("p",{className:"text-blue-300 text-xs font-semibold",children:"Glucides"})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"linear-gradient(135deg, rgba(234, 179, 8, 0.15), rgba(202, 138, 4, 0.08))",border:"1px solid rgba(234, 179, 8, 0.3)"},children:[e.jsx(g,{Icon:c.Droplet,size:24,className:"text-yellow-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-white font-bold text-2xl mb-1",children:[n,"g"]}),e.jsx("p",{className:"text-yellow-300 text-xs font-semibold",children:"Lipides"})]})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 z-50",style:{background:"linear-gradient(to top, rgba(17, 24, 39, 0.98), rgba(17, 24, 39, 0.95), transparent)",pointerEvents:"none"},children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-3",style:{pointerEvents:"auto"},children:[e.jsx("button",{onClick:t,disabled:s,className:"w-full btn-glass touch-feedback-css disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(5, 150, 105, 0.15))",borderColor:"rgba(16, 185, 129, 0.4)"},children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-white font-semibold",children:"Sauvegarde en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{Icon:c.Check,size:20,className:"text-emerald-400"}),e.jsx("span",{className:"text-white font-semibold",children:"Sauvegarder dans mon historique"})]})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,disabled:s,className:"flex-1 btn-glass touch-feedback-css disabled:opacity-50",style:{background:"rgba(107, 114, 128, 0.1)",borderColor:"rgba(107, 114, 128, 0.3)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.RotateCcw,size:18,className:"text-gray-400"}),e.jsx("span",{className:"text-gray-300 font-medium text-sm",children:"Rescanner"})]})}),e.jsx("button",{onClick:r,disabled:s,className:"flex-1 btn-glass touch-feedback-css disabled:opacity-50",style:{background:"rgba(99, 102, 241, 0.1)",borderColor:"rgba(99, 102, 241, 0.3)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.Plus,size:18,className:"text-indigo-400"}),e.jsx("span",{className:"text-indigo-300 font-medium text-sm",children:"Nouveau scan"})]})})]})]})})]})},Ea=()=>{const a=xe(),t=pe(),{isPerformanceMode:s}=ee(),i=s?"div":f.div,{profile:r,authReady:o,session:l,user:p}=re(),{showToast:m}=be(),{success:y,error:w}=J(),[n,_]=S.useState(Q),[M,v]=S.useState(!1),[D,U]=S.useState(null),z=S.useRef(null),W=S.useRef(!1),L=S.useRef(null),C=l?.user?.id||p?.id||r?.userId,H=!!(n.capturedPhoto||n.isProcessing||n.analysisResults),V=me(({currentLocation:h,nextLocation:P})=>h.pathname===P.pathname?!1:H);E.useEffect(()=>{V.state==="blocked"&&(u.info("MEAL_SCAN_EXIT","Navigation blocked - showing confirmation",{currentStep:n.currentStep,hasCapturedPhoto:!!n.capturedPhoto,isProcessing:n.isProcessing,hasResults:!!n.analysisResults,timestamp:new Date().toISOString()}),U(()=>()=>{V.proceed()}),v(!0))},[V.state,n]),E.useEffect(()=>{const P=setTimeout(()=>{const R=document.getElementById("main-content");R&&R.scrollTo({top:0,behavior:"smooth"}),window.scrollTo({top:0,behavior:"smooth"})},100);return u.debug("MEAL_SCAN_SCROLL","Auto scroll triggered on step change",{currentStep:n.currentStep,progress:n.progress,timestamp:new Date().toISOString()}),()=>clearTimeout(P)},[n.currentStep]),E.useEffect(()=>{u.info("MEAL_SCAN_FLOW_AUTH_DEBUG","Complete auth state in MealScanFlowPage",{hasSession:!!l,sessionUserId:l?.user?.id,sessionUserEmail:l?.user?.email,sessionAccessToken:l?.access_token?"present":"missing",sessionExpiresAt:l?.expires_at,hasUser:!!p,userIdDirect:p?.id,userEmail:p?.email,hasProfile:!!r,profileUserId:r?.userId,profileDisplayName:r?.displayName,profileKeys:r?Object.keys(r):[],authReady:o,userId:C})},[l,p,r,o,C]);const x=pa({scanFlowState:n,setScanFlowState:_,profile:r,userId:C,clientScanIdRef:z,processingGuardRef:W,readyForProcessingRef:L,showToast:m,success:y,errorSound:w,queryClient:t,onAnalysisError:h=>{_(P=>({...P,analysisError:h})),m(`Erreur d'analyse: ${h}`,"error"),w()},onSuccess:()=>{y()}}),b=ma({scanFlowState:n,setScanFlowState:_,clientScanIdRef:z,processingGuardRef:W,onAnalysisError:h=>{_(P=>({...P,analysisError:h})),m(`Erreur d'analyse: ${h}`,"error"),w()},onSuccess:()=>{y()}}),j=E.useCallback(h=>{_(P=>({...P,scanType:h,progressMessage:h==="photo-analysis"?"Forge du Repas":"Scanner un Code-Barre",progressSubMessage:h==="photo-analysis"?"Capturez votre carburant nutritionnel":"Scannez le code-barre d'un produit"})),u.info("MEAL_SCAN_FLOW","Scan type selected",{scanType:h,timestamp:new Date().toISOString()})},[_]),[d,A]=S.useState(!1),T=async()=>{if(!C||d)return;const h=!!n.analysisResults,P=!!n.barcodeAnalysisResults;if(!(!h&&!P)){A(!0);try{u.info("MEAL_SCAN_SAVE","Starting meal save and reset process",{userId:C,scanType:n.scanType,hasAnalysisResults:h,hasBarcodeResults:P,totalCalories:h?n.analysisResults.total_calories:n.barcodeAnalysisResults?.totalCalories,hasCapturedPhoto:!!n.capturedPhoto,timestamp:new Date().toISOString()});let R;if(n.capturedPhoto?.file){u.info("MEAL_SCAN_SAVE","Uploading meal photo to storage",{userId:C,fileSize:n.capturedPhoto.file.size,fileType:n.capturedPhoto.file.type,timestamp:new Date().toISOString()});try{const k=await je(n.capturedPhoto.file,C);k.success&&k.signedUrl?(R=k.signedUrl,u.info("MEAL_SCAN_SAVE","Photo uploaded successfully with signed URL",{hasSignedUrl:!0,uploadPath:k.uploadPath,userId:C,timestamp:new Date().toISOString()})):(u.warn("MEAL_SCAN_SAVE","Photo upload failed, continuing without photo",{error:k.error,userId:C,timestamp:new Date().toISOString()}),m({type:"warning",title:"Photo non sauvegard√©e",message:k.error||"La photo n'a pas pu √™tre sauvegard√©e, mais votre repas sera enregistr√©.",duration:4e3}))}catch(k){u.error("MEAL_SCAN_SAVE","Photo upload exception",{error:k instanceof Error?k.message:String(k),userId:C,timestamp:new Date().toISOString()})}}let Z;if(n.scanType==="barcode-scan"&&P){const k=n.barcodeAnalysisResults.scannedProduct;Z={user_id:C,timestamp:new Date().toISOString(),items:[k.mealItem],total_kcal:n.barcodeAnalysisResults.totalCalories,meal_type:"snack",meal_name:k.name,photo_url:R}}else if(h){const k=[...n.analysisResults.detected_foods||[],...n.scannedProducts.map(K=>K.mealItem)||[]],q=k.reduce((K,le)=>K+le.calories,0);Z={user_id:C,timestamp:new Date().toISOString(),items:k,total_kcal:q||n.analysisResults.total_calories||0,meal_type:n.analysisResults.meal_type||"dinner",meal_name:n.analysisResults.meal_name,photo_url:R}}else throw new Error("Aucune donn√©e de repas √† sauvegarder");const G=await ve.saveMeal(Z);u.info("MEAL_SCAN_SAVE","Meal saved to database, starting cache update",{mealId:G.id,userId:C,timestamp:new Date().toISOString()});const te=t.getQueryData(["meals-today",C])||[];t.setQueryData(["meals-today",C],[G,...te]),u.info("MEAL_SCAN_SAVE","Optimistic cache update applied",{mealId:G.id,newMealsCount:te.length+1,timestamp:new Date().toISOString()}),await Promise.all([t.refetchQueries({queryKey:["meals-today",C],type:"active"}),t.refetchQueries({queryKey:["meals-week",C],type:"active"}),t.refetchQueries({queryKey:["meals-recent",C],type:"active"}),t.refetchQueries({queryKey:["meals-history",C],type:"active"}),t.invalidateQueries({queryKey:["meals-month",C]}),t.invalidateQueries({queryKey:["daily-ai-summary",C]})]),u.info("MEAL_SCAN_SAVE","All meal queries refetched",{mealId:G.id,queries:["meals-today","meals-week","meals-recent","meals-history","meals-month","daily-ai-summary"],timestamp:new Date().toISOString()}),y();const se=h?n.analysisResults.total_calories:n.barcodeAnalysisResults.totalCalories;m({type:"success",title:"Repas sauvegard√© !",message:`${se} kcal ajout√©es √† votre forge nutritionnelle${R?" avec photo":""}`,duration:3e3}),u.info("MEAL_SCAN_SAVE","Meal saved successfully, resetting scan state",{mealId:G.id,userId:C,photoSaved:!!R,timestamp:new Date().toISOString()}),M||(_(Q),z.current=null,W.current=!1,await new Promise(k=>setTimeout(k,150)),u.info("MEAL_SCAN_SAVE","Navigating to meals page with fresh cache",{mealId:G.id,timestamp:new Date().toISOString()}),a("/meals",{state:{freshMealSaved:!0,mealId:G.id}}))}catch(R){w(),u.error("MEAL_SCAN_SAVE","Failed to save meal",{error:R instanceof Error?R.message:String(R),errorStack:R instanceof Error?R.stack:void 0,userId:C,mealData:{totalCalories:n.analysisResults?.total_calories,itemsCount:n.analysisResults?.detected_foods?.length,mealType:n.analysisResults?.meal_type,hasPhoto:!!photoUrl},timestamp:new Date().toISOString()}),m({type:"error",title:"Erreur de sauvegarde",message:`Impossible de sauvegarder le repas: ${R instanceof Error?R.message:"Erreur inconnue"}. Veuillez r√©essayer.`,duration:4e3})}finally{A(!1)}}},N=async()=>{try{n.analysisResults?(u.info("MEAL_SCAN_EXIT","Saving meal before exit",{hasResults:!!n.analysisResults,timestamp:new Date().toISOString()}),v(!1),_(Q),z.current=null,W.current=!1,D&&(D(),U(null)),T().catch(h=>{u.error("MEAL_SCAN_EXIT","Background save failed",{error:h instanceof Error?h.message:String(h),timestamp:new Date().toISOString()})}),u.info("MEAL_SCAN_EXIT","Navigation allowed, saving in background",{timestamp:new Date().toISOString()})):(v(!1),_(Q),z.current=null,D&&(D(),U(null)))}catch(h){u.error("MEAL_SCAN_EXIT","Failed to exit",{error:h instanceof Error?h.message:String(h),timestamp:new Date().toISOString()}),m("Erreur lors de la sortie","error"),v(!1)}},$=()=>{u.info("MEAL_SCAN_EXIT","User chose to discard scan and exit",{currentStep:n.currentStep,hasCapturedPhoto:!!n.capturedPhoto,hasResults:!!n.analysisResults,timestamp:new Date().toISOString()}),_(Q),z.current=null,W.current=!1,v(!1),D&&(D(),U(null))},I=()=>{u.info("MEAL_SCAN_EXIT","User cancelled exit, continuing scan",{currentStep:n.currentStep,timestamp:new Date().toISOString()}),v(!1),U(null),V.state==="blocked"&&V.reset()};if(!o)return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(ce,{icon:"Loader",title:"Chargement...",subtitle:"Initialisation de votre session",circuit:"meal-scan"}),e.jsxs(O,{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-blue-400 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-300",children:"Chargement de votre session..."})]})]});if(!C)return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(ce,{icon:"LogIn",title:"Connexion Requise",subtitle:"Connectez-vous pour analyser vos repas",circuit:"meal-scan"}),e.jsxs(O,{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Connexion Requise"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Vous devez √™tre connect√© pour utiliser l'analyse de repas."}),e.jsx("button",{onClick:()=>a("/auth/login"),className:"btn-glass--primary w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.LogIn,size:16}),e.jsx("span",{children:"Se Connecter"})]})})]})]});if(!r)return u.warn("MEAL_SCAN_FLOW_NO_PROFILE","CRITICAL: No profile detected, showing incomplete profile",{hasProfile:!!r,hasSessionInfo:!!sessionInfo,authReady:o,userId:C,profileType:typeof r,profileStringified:r?JSON.stringify(r,null,2).substring(0,500)+"...":"null",userStoreProfileState:{profile:!!re.getState().profile,profileUserId:re.getState().profile?.userId,profileDisplayName:re.getState().profile?.displayName},timestamp:new Date().toISOString()}),e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(ce,{icon:"User",title:"Profil Incomplet",subtitle:"Compl√©tez votre profil pour des analyses nutritionnelles personnalis√©es",circuit:"meal-scan"}),e.jsxs(O,{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Profil Incomplet"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Compl√©tez votre profil pour b√©n√©ficier d'analyses nutritionnelles personnalis√©es."}),e.jsx("button",{onClick:()=>a("/profile"),className:"btn-glass--primary w-full mb-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.User,size:16}),e.jsx("span",{children:"Compl√©ter le Profil"})]})}),e.jsx("button",{onClick:()=>a("/"),className:"btn-glass--secondary-nav w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.Home,size:16}),e.jsx("span",{children:"Retour √† l'accueil"})]})})]})]});const F=()=>{if(n.analysisError&&n.currentStep==="processing")return e.jsxs(O,{className:"p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(g,{Icon:c.AlertCircle,size:48,className:"text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Erreur d'analyse"}),e.jsx("p",{className:"text-gray-300",children:n.analysisError})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>a("/meals"),className:"flex-1 btn-glass--secondary-nav",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.ArrowLeft,size:16}),e.jsx("span",{children:"Retour"})]})}),e.jsx("button",{onClick:x.handleRetake,className:"flex-1 btn-glass--primary",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{Icon:c.RotateCcw,size:16}),e.jsx("span",{children:"R√©essayer"})]})})]})]});switch(n.currentStep){case"capture":return e.jsx(Je,{scanType:n.scanType,onSelectScanType:j,capturedPhoto:n.capturedPhoto,scannedBarcodes:n.scannedBarcodes,scannedProducts:n.scannedProducts,onPhotoCapture:x.handlePhotoCapture,onBarcodeDetected:n.scanType==="barcode-scan"?b.handleBarcodeDetected:x.handleBarcodeDetected,onProductScanned:x.handleProductScanned,onProductPortionChange:x.handleProductPortionChange,onProductRemove:x.handleProductRemove,onBarcodePortionChange:x.handleBarcodePortionChange,onBarcodeRemove:x.handleBarcodeRemove,onRetake:n.scanType==="barcode-scan"?b.handleBarcodeRetake:x.handleRetake,onBack:()=>a("/meals"),onProceedToProcessing:n.scanType==="barcode-scan"?b.handleBarcodeScan:x.handleProceedToProcessing,isProcessingInProgress:n.isProcessing,readyForProcessingRef:L,progress:n.progress,progressMessage:n.progressMessage,progressSubMessage:n.progressSubMessage});case"processing":return n.scanType==="barcode-scan"?e.jsx(ba,{barcode:n.scannedBarcodes[0]?.barcode||"",productImage:n.scannedBarcodes[0]?.image_url,progress:n.progress,progressMessage:n.progressMessage,progressSubMessage:n.progressSubMessage}):e.jsx(na,{capturedPhoto:n.capturedPhoto,progress:n.progress,progressMessage:n.progressMessage,progressSubMessage:n.progressSubMessage});case"results":return n.scanType==="barcode-scan"&&n.barcodeAnalysisResults?e.jsx(ha,{barcodeResults:n.barcodeAnalysisResults,onSaveMeal:T,isSaving:d,onRetake:b.handleBarcodeRetake,onNewScan:()=>{_(Q),z.current=de()}}):e.jsx(ua,{analysisResults:n.analysisResults,capturedPhoto:n.capturedPhoto,progress:n.progress,progressMessage:n.progressMessage,progressSubMessage:n.progressSubMessage,onSaveMeal:T,isSaving:d,onRetake:x.handleRetake,onNewScan:()=>{_(Q),z.current=de()}});default:return null}};return e.jsxs("div",{className:"w-full min-w-0 pb-8",style:{overflow:"visible !important"},children:[e.jsx(oe,{mode:"wait",children:e.jsx(i,{className:"meal-scan-step pb-6","data-step":n.currentStep,...!s&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3}},style:{minHeight:"auto",overflow:"visible"},children:F()},n.currentStep)}),e.jsx(he,{children:e.jsx(ye,{isOpen:M,onSaveAndExit:N,onDiscardAndExit:$,onCancel:I,hasResults:!!n.analysisResults,isProcessing:n.isProcessing,capturedPhoto:n.capturedPhoto})})]})};export{Ea as default};
