const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-BvehWoy3.js","assets/vendor-BefW7Bxj.js","assets/utils-CUtLAp28.js","assets/supabase-pyFrrmXL.js","assets/page-fridge-scan-C62RDC3k.js","assets/stores-Dp3vmZ5-.js","assets/page-fridge-Cp-W9isk.js","assets/ui-components-lrK_WhZu.js","assets/motion-BQvLDPOm.js","assets/ui-components-DyoLTZgZ.css","assets/date-utils-BlBdbPk_.js","assets/page-fridge-scan-DAz6gEg3.css","assets/Profile-bO3qoX3E.js","assets/useScrollMemory-DhxRhvvf.js","assets/page-profile-CZR_5_Mb.js","assets/forms-BkbsF97i.js","assets/ActivityPage-DC5KF59f.js","assets/ActivityUtils-BQw4lb66.js","assets/ActivityUtils-BeOZYLth.css","assets/FastingPage--qs9B3r7.js","assets/FastingTipsCard-Ma7Pp04F.js","assets/MealsPage-qvcVe9FA.js","assets/ScanExitConfirmationModal-Fo-0NH5U.js","assets/signedUrlService-DUv0zqbl.js","assets/MealScanFlowPage-BfecSTyS.js","assets/MealScanFlowPage-D1lXSlqb.css","assets/FridgePage-D_AZSPmi.js","assets/TrainingPage-grakMon4.js","assets/UnderConstructionCard-DKwpKbnZ.js","assets/SettingsPage-Dqe6oRsk.js","assets/SettingsPage--eX8c2e1.css","assets/NotificationsPage-BbbjfsAl.js","assets/BodyScanPage-BdidJ1mK.js","assets/AvatarPage-C7ZEc3RK.js","assets/Avatar3DViewer-CWA1lRRG.js","assets/normalizeSkinTone-BhVF89EQ.js","assets/BodyScan-DwlG9ziW.js","assets/BodyScanProgressHeader-Cl4niUVu.js","assets/BodyScanProgressHeader-CArGgCyz.css","assets/BodyScanCelebrationWithHeader-D9m2wtM8.js","assets/BodyScanReviewWithHeader-CYYnyCuS.js","assets/ActivityInputPage-CzwlaJis.js","assets/ActivityInputPage-BrlLrD1Y.css","assets/FastingInputPage-CoaoBC8a.js","assets/FridgeScanPage-BoMqOv4M.js","assets/VitalPage-BVlktQbt.js","assets/DevCachePage-C8Y_F_o4.js","assets/LogoGalleryPage-DnX5Vldy.js"])))=>i.map(i=>d[i]);
var xe=Object.defineProperty;var fe=(a,t,n)=>t in a?xe(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n;var Q=(a,t,n)=>fe(a,typeof t!="symbol"?t+"":t,n);import{w as X,_ as C}from"./page-fridge-scan-C62RDC3k.js";import{R as _,r as l,j as e,u as Y,cN as J,cO as be,cP as ve,cQ as ye,cR as we,cS as Se,cT as je,cU as Ee,cV as Ae}from"./vendor-BefW7Bxj.js";import{L as _e,T as re,S as D,I,B as Ce,M as Ne,g as ke,b as Z,n as Ie,c as Te,v as ee,d as Oe,u as ce,e as Pe,U as De,f as ze,F as Re,h as Le,D as Fe,i as Ue,j as Be,k as We,l as Me,G as se}from"./ui-components-lrK_WhZu.js";import{i as G,j as $e,Z as He,a as V,d as Ve,c as Ye,l as oe}from"./stores-Dp3vmZ5-.js";import{l as o,u as q,f as Ge,b as qe,h as Ke,t as Qe,d as Ze,a as ne,s as F,e as Je,P as Xe}from"./page-fridge-Cp-W9isk.js";import{a as et}from"./utils-CUtLAp28.js";import{m as P,u as tt,A as ie}from"./motion-BQvLDPOm.js";import{d as M}from"./page-profile-CZR_5_Mb.js";import"./supabase-pyFrrmXL.js";import"./date-utils-BlBdbPk_.js";import"./forms-BkbsF97i.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function at(){const[a,t]=_.useState(!1),[n,i]=_.useState(!1),[s,r]=_.useState(null),[u,b]=_.useState(null);return l.useEffect(()=>{if(!("serviceWorker"in navigator)){o.info("PWA_UPDATE","Service Worker not supported",{userAgent:navigator.userAgent.substring(0,100),timestamp:new Date().toISOString()});return}const g=d=>{const f=d.waiting;f&&(b(f),t(!0),r({version:"Nouvelle version",features:["Améliorations de performance","Nouvelles fonctionnalités","Corrections de bugs"],isRequired:!1}),o.info("PWA_UPDATE","Service Worker update detected",{swState:f.state,timestamp:new Date().toISOString()}))},p=()=>{o.info("PWA_UPDATE","Service Worker controller changed",{timestamp:new Date().toISOString()}),window.location.reload()};return navigator.serviceWorker.getRegistration().then(d=>{d&&(d.addEventListener("updatefound",()=>{const f=d.installing;f&&f.addEventListener("statechange",()=>{f.state==="installed"&&navigator.serviceWorker.controller&&g(d)})}),d.waiting&&g(d))}),navigator.serviceWorker.addEventListener("controllerchange",p),navigator.serviceWorker.addEventListener("message",d=>{try{const f=typeof d.data=="string"?JSON.parse(d.data):d.data;f&&f.type==="UPDATE_AVAILABLE"&&(t(!0),r(f.updateInfo||null),o.info("PWA_UPDATE","Update message received from Service Worker",{updateInfo:f.updateInfo,timestamp:new Date().toISOString()}))}catch(f){o.warn("PWA_UPDATE","Failed to parse service worker message",{error:f instanceof Error?f.message:"Unknown error",timestamp:new Date().toISOString()})}}),()=>{navigator.serviceWorker.removeEventListener("controllerchange",p)}},[]),{isUpdateAvailable:a,isUpdating:n,updateInfo:s,applyUpdate:async()=>{if(!u){o.warn("PWA_UPDATE","No waiting Service Worker available for update",{timestamp:new Date().toISOString()});return}i(!0);try{o.info("PWA_UPDATE","Applying Service Worker update",{swState:u.state,timestamp:new Date().toISOString()}),u.postMessage({type:"SKIP_WAITING"})}catch(g){o.error("PWA_UPDATE","Failed to apply update",{error:g instanceof Error?g.message:"Unknown error",timestamp:new Date().toISOString()}),i(!1)}},dismissUpdate:()=>{t(!1),r(null),b(null),o.info("PWA_UPDATE","Update notification dismissed",{timestamp:new Date().toISOString()})},checkForUpdates:()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(g=>{g&&(o.info("PWA_UPDATE","Manually checking for updates",{timestamp:new Date().toISOString()}),g.update())})}}}const rt=()=>{const{activeOverlayId:a,close:t}=G(),{isOpen:n,close:i}=$e();l.useEffect(()=>{const s=r=>{if(r.key==="Escape"){if(a==="chatDrawer"&&n){o.debug("ESCAPE_KEY","Closing chat drawer via overlay system"),i(),r.preventDefault(),r.stopPropagation();return}if(a!=="none"){o.debug("ESCAPE_KEY","Closing overlay",{overlayId:a}),t(),r.preventDefault(),r.stopPropagation();return}if(n){o.warn("ESCAPE_KEY","Chat open but not tracked by overlay - closing directly"),i(),r.preventDefault(),r.stopPropagation();return}}};return document.addEventListener("keydown",s,{capture:!0}),()=>{document.removeEventListener("keydown",s,{capture:!0})}},[a,n,t,i])},E=({title:a="Initialisation de TwinForge",subtitle:t="Préparation de votre espace de forge..."})=>e.jsx("div",{className:"flex items-center justify-center min-h-[400px] bg-transparent",children:e.jsx(_e,{variant:"default",title:a,subtitle:t,showProgressBar:!1})}),it=()=>{const a=Y(),{click:t,headerClick:n}=q(),[i,s]=_.useState(!1),r=x=>{x.preventDefault(),o.trace("HEADER","Logo click triggered"),a("/",{replace:!0})},u=()=>{o.trace("HEADER","Logo pointer down"),n()},b=()=>{s(!0)},h=()=>{s(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx("button",{onClick:r,onPointerDown:u,onMouseEnter:b,onMouseLeave:h,className:"focus-ring rounded-lg transition-colors cursor-pointer flex items-center justify-center h-full","aria-label":"Retour au tableau de bord",onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),r(x))},children:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(P.div,{className:"relative transition-all duration-300 ease-out",animate:i?{scale:1.05}:{scale:1},transition:{duration:.2,ease:[.25,.1,.25,1]},children:e.jsx(re,{variant:"desktop",isHovered:i})})})})}),e.jsx("div",{className:"lg:hidden",children:e.jsx("button",{onClick:r,onPointerDown:u,onMouseEnter:b,onMouseLeave:h,className:"focus-ring rounded-lg transition-colors cursor-pointer flex items-center justify-center","aria-label":"Retour au tableau de bord",onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),r(x))},children:e.jsx(P.div,{className:"relative",animate:i?{scale:1.05}:{scale:1},transition:{duration:.2,ease:[.25,.1,.25,1]},children:e.jsx(re,{variant:"mobile",isHovered:i})})})})]})},$=[{key:"navigation",title:"Navigation Principale",actions:[{id:"home",label:"Tableau de Bord",subtitle:"Vue d'ensemble TwinForge",icon:"Home",route:"/",color:"#F7931E",available:!0,description:"Retourner au tableau de bord principal"}]},{key:"alimentation",title:"Alimentation",actions:[{id:"scan-meal",label:"Scanner de Repas",subtitle:"Analysez vos repas",icon:"Camera",route:"/meals/scan",color:"#10B981",available:!0,description:"Analyser un repas avec précision"},{id:"generate-recipe",label:"Générateur de Recettes",subtitle:"Recettes personnalisées",icon:"ChefHat",route:"/fridge#recipes",color:"#EC4899",available:!0,description:"Générer des recettes personnalisées"},{id:"generate-meal-plan",label:"Générateur de Plans",subtitle:"Plan alimentaire hebdo",icon:"Calendar",route:"/fridge#plan",color:"#8B5CF6",available:!0,description:"Générer un plan de repas personnalisé"},{id:"generate-shopping-list",label:"Générateur de Courses",subtitle:"Liste optimisée",icon:"ShoppingCart",route:"/fridge#courses",color:"#F59E0B",available:!0,description:"Créer une liste de courses optimisée"},{id:"scan-fridge",label:"Scanner de Frigo",subtitle:"Inventaire intelligent",icon:"Scan",route:"/fridge/scan",color:"#06B6D4",available:!0,description:"Scanner votre frigo pour créer un inventaire"}]},{key:"activite",title:"Activité",actions:[{id:"coach-training",label:"Coach Training",subtitle:"Live Training",icon:"Dumbbell",route:"/training",color:"#18E3FF",available:!0,description:"Accéder à la pipeline de training avec coaching en direct"},{id:"track-activity",label:"Tracker d'Activité",subtitle:"Enregistrez vos séances",icon:"Activity",route:"/activity/input",color:"#3B82F6",available:!0,description:"Enregistrer une nouvelle séance d'activité"}]},{key:"sante",title:"Santé",actions:[{id:"start-fasting",label:"Tracker de Jeûne",subtitle:"Gérez vos sessions",icon:"Timer",route:"/fasting/input",color:"#F59E0B",available:!0,description:"Commencer une période de jeûne"},{id:"forge-vitale",label:"Forge Vitale",subtitle:"Bientôt disponible",icon:"HeartPulse",color:"#EF4444",available:!1,comingSoon:!0,description:"Suivi de santé complet (bientôt disponible)"}]},{key:"avatar-twin",title:"TwinForge Avatar",actions:[{id:"avatar-scan",label:"Mon Avatar en 3D",subtitle:"Créez votre jumeau numérique",icon:"Scan",route:"/body-scan",color:"#A855F7",available:!0,description:"Scanner et créer votre avatar 3D personnalisé"}]}];function nt(a){const t=a.replace("#",""),n=parseInt(t.length===3?t.split("").map(u=>u+u).join(""):t,16),i=n>>16&255,s=n>>8&255,r=n&255;return[i,s,r]}function H(a,t){return a.find(n=>n.key===t)||{title:"",actions:[]}}const de=({isOpen:a})=>{const t=Y(),n=tt(),{click:i,success:s}=q(),{close:r}=G(),u=H($,"alimentation"),b=H($,"activite"),h=H($,"sante"),x=H($,"navigation"),w=H($,"avatar-twin"),g=x.actions.find(c=>["home","dashboard","root"].includes(c.id)||/accueil|home|cœur|coeur|coeur de la forge|forge/i.test(c.label))||null,p=(c,N=!1,y)=>{if(!c?.available||c?.comingSoon){o.warn("CENTRAL_ACTIONS","Action not available",{actionId:c?.id,comingSoon:c?.comingSoon});return}o.info("CENTRAL_ACTIONS","Action clicked",{actionId:c.id,actionLabel:c.label,route:c.route,hasEvent:!!y}),c.id==="home"?Ke():N?Qe(c.color):Ze(c.color),r(),c.route?(o.info("CENTRAL_ACTIONS","Navigating to route",{actionId:c.id,actionLabel:c.label,route:c.route,timestamp:new Date().toISOString()}),setTimeout(()=>{o.info("CENTRAL_ACTIONS","Executing navigation",{route:c.route}),t(c.route)},100)):typeof c.onClick=="function"&&c.onClick()};_.useEffect(()=>{a?Ge():qe()},[a]),_.useEffect(()=>{if(!a)return;const c=v=>{if(v.target.closest('button[role="menuitem"]'))return;const k=document.querySelectorAll(".central-action-button, .user-panel-toggle"),z=document.querySelector(".central-actions-menu");let U=!1;k.forEach(R=>{R.contains(v.target)&&(U=!0)}),!U&&z&&!z.contains(v.target)&&r()},N=v=>{v.key==="Escape"&&r()},y=setTimeout(()=>{document.addEventListener("mousedown",c),document.addEventListener("keydown",N)},150);return()=>{clearTimeout(y),document.removeEventListener("mousedown",c),document.removeEventListener("keydown",N)}},[a,r]);const d=n?{duration:.2,ease:[.25,.1,.25,1]}:{type:"spring",stiffness:280,damping:22,mass:.9},f=({action:c,index:N})=>{const y=c.comingSoon||!c.available;return e.jsxs(P.button,{onClick:v=>p(c,!1,v),disabled:y,className:"glass-card rounded-xl px-2 py-1.5 flex items-center gap-1.5 w-full",style:{"--pill-circuit-color":c.color||"#18E3FF",opacity:y?.5:1,cursor:y?"not-allowed":"pointer",position:"relative",isolation:"isolate"},initial:{opacity:0,y:10},animate:{opacity:y?.5:1,y:0},transition:{...d,delay:n?0:N*.05},whileHover:n||y?{}:{},whileTap:n||y?{}:{},role:"menuitem","aria-label":c.description||c.label,"aria-disabled":y,children:[e.jsxs("div",{className:"w-6 h-6 rounded-lg flex items-center justify-center flex-shrink-0",style:{position:"relative"},children:[e.jsx(D,{Icon:I[c.icon],size:13}),y&&e.jsx("div",{style:{position:"absolute",top:"-6px",right:"-6px",width:"16px",height:"16px",borderRadius:"50%",background:"linear-gradient(135deg, rgba(251, 146, 60, 0.95), rgba(251, 113, 133, 0.95))",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"7px",fontWeight:"bold",color:"white",boxShadow:"0 2px 8px rgba(251, 146, 60, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3)",zIndex:20,pointerEvents:"none",border:"1.5px solid rgba(255, 255, 255, 0.4)"},children:"S"})]}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-[11px] font-semibold text-white leading-tight break-words",children:c.label}),c.subtitle&&e.jsx("div",{className:"text-[9px] text-white/65 leading-tight mt-0.5 break-words",children:c.subtitle})]})]},c.id)},S=window.innerWidth<768,T=window.innerWidth>=768&&window.innerWidth<1024,A={initial:{opacity:0,scale:.92,y:-20},animate:{opacity:1,scale:1,y:0,transition:{duration:.25,ease:[.25,.1,.25,1],opacity:{duration:.25},scale:{duration:.25},y:{duration:.25}}},exit:{opacity:0,scale:.94,y:-16,transition:{duration:.2,ease:[.25,.1,.25,1]}}};return e.jsx(ie,{children:a&&e.jsx(P.div,{className:"central-actions-menu fixed",style:{zIndex:He.CENTRAL_MENU,transformOrigin:"top center",overflow:"visible",...S?{top:"80px",left:"8px",right:"8px",width:"auto",maxHeight:"calc(100vh - 96px - var(--new-bottom-bar-height) - var(--new-bottom-bar-bottom-offset))"}:T?{top:"80px",left:"16px",right:"16px",width:"auto",maxWidth:"calc(100vw - 32px)",maxHeight:"calc(100vh - 120px - var(--new-bottom-bar-height) - var(--new-bottom-bar-bottom-offset))"}:{top:"80px",right:"24px",left:"auto",width:"400px",maxHeight:"calc(100vh - 120px)"}},initial:A.initial,animate:A.animate,exit:A.exit,role:"dialog","aria-label":"Actions rapides","aria-modal":"true",children:e.jsx("div",{className:"rounded-3xl overflow-hidden relative central-actions-panel liquid-glass-premium max-h-[inherit]",style:{padding:12,isolation:"isolate",opacity:1,willChange:"transform, opacity"},children:e.jsxs("div",{className:"central-actions-scroll-container",style:{maxHeight:"inherit",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-[3px] w-1 rounded-full",style:{background:"linear-gradient(180deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%)",boxShadow:"0 0 8px rgba(255, 255, 255, 0.5)"},"aria-hidden":!0}),e.jsx("span",{className:"text-white text-sm font-bold tracking-wider uppercase",children:"Outils du Forgeron"})]}),g&&e.jsxs("button",{onClick:c=>p(g,!1,c),className:"glass-card rounded-full px-2.5 py-1 flex items-center gap-1.5",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18) 0%, transparent 60%),
                      radial-gradient(circle at 70% 70%, rgba(247, 147, 30, 0.15) 0%, transparent 65%),
                      var(--liquid-pill-bg)
                    `,border:"1px solid rgba(247, 147, 30, 0.35)",boxShadow:`
                      0 2px 8px rgba(247, 147, 30, 0.15),
                      0 0 16px rgba(247, 147, 30, 0.08),
                      inset 0 1px 0 rgba(255, 255, 255, 0.15)
                    `},children:[e.jsx(D,{Icon:I.Home,size:13,style:{color:"#FDC830",filter:"drop-shadow(0 0 4px rgba(253, 200, 48, 0.5))"}}),e.jsx("span",{className:"text-[10px] font-semibold",style:{color:"rgba(255, 255, 255, 0.95)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.2)"},children:"Dashboard"})]})]}),u.actions.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-1.5 mb-1.5",children:e.jsx("h3",{className:"text-white/70 text-[11px] uppercase tracking-wider font-bold",children:"Alimentation"})}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:u.actions.map((c,N)=>e.jsx(f,{action:c,index:N},c.id))})]}),b.actions.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-1.5 mb-1.5",children:e.jsx("h3",{className:"text-white/70 text-[11px] uppercase tracking-wider font-bold",children:"Activité"})}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:b.actions.map((c,N)=>e.jsx(f,{action:c,index:N},c.id))})]}),h.actions.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-1.5 mb-1.5",children:e.jsx("h3",{className:"text-white/70 text-[11px] uppercase tracking-wider font-bold",children:"Santé"})}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:h.actions.map((c,N)=>e.jsx(f,{action:c,index:N},c.id))})]}),w.actions.length>0&&e.jsx("div",{className:"mt-4 pt-3 border-t border-white/10",children:w.actions.map((c,N)=>{const[y,v,m]=nt(c.color||"#D946EF");return e.jsxs(P.button,{onClick:k=>p(c,!0,k),className:"rounded-2xl px-4 py-3 flex items-center gap-3 w-full relative avatar-twin-button",style:{background:`
                          radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.12) 0%, transparent 60%),
                          radial-gradient(circle at 70% 70%, rgba(${y}, ${v}, ${m}, 0.15) 0%, transparent 65%),
                          rgba(255, 255, 255, 0.03)
                        `,backdropFilter:"blur(20px) saturate(150%)",WebkitBackdropFilter:"blur(20px) saturate(150%)",border:`1px solid rgba(${y}, ${v}, ${m}, 0.4)`,boxShadow:`
                          0 4px 16px rgba(${y}, ${v}, ${m}, 0.25),
                          0 0 24px rgba(${y}, ${v}, ${m}, 0.15),
                          inset 0 1px 0 rgba(255, 255, 255, 0.2)
                        `},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{...d,delay:n?0:.3},whileHover:n?{}:{y:-2,scale:1.02},whileTap:n?{}:{scale:.98},role:"menuitem","aria-label":c.description||c.label,children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:`linear-gradient(135deg, rgba(${y}, ${v}, ${m}, 0.4), rgba(${y}, ${v}, ${m}, 0.25))`,border:`1px solid rgba(${y}, ${v}, ${m}, 0.5)`,boxShadow:`0 0 12px rgba(${y}, ${v}, ${m}, 0.3)`},children:e.jsx(D,{Icon:I[c.icon],size:20,style:{color:c.color,filter:`drop-shadow(0 0 6px rgba(${y}, ${v}, ${m}, 0.6))`}})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-[13px] font-bold text-white leading-tight",children:c.label}),e.jsx("div",{className:"text-[10px] text-white/75 leading-tight mt-0.5",children:c.subtitle})]}),e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`rgba(${y}, ${v}, ${m}, 0.2)`,border:`1px solid rgba(${y}, ${v}, ${m}, 0.4)`},children:e.jsx(D,{Icon:I.ChevronRight,size:12,style:{color:c.color}})})]},c.id)})})]})})})})},ue=_.memo(()=>{const{click:a}=q(),{isOpen:t,toggle:n}=G(),i=t("centralMenu"),{isPerformanceMode:s}=ne();return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:`
          header-liquid-glass h-[64px] z-9997-important will-change-transform-important position-fixed-important transform-gpu-important isolation-isolate-important contain-layout-style-paint-important
          fixed top-2 left-4 right-4 z-[9999]
          rounded-glass-lg
          ${s?"":"backdrop-blur-xl"}
          transition-all duration-300
        `,style:{left:"24px",right:"24px",top:"8px",borderRadius:"20px",overflow:"hidden",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",WebkitTransformStyle:"preserve-3d",transformStyle:"preserve-3d",WebkitPerspective:"1000px",perspective:"1000px",background:s?"rgb(11, 14, 23)":void 0,backgroundColor:s?"rgb(11, 14, 23)":void 0,backgroundImage:s?"none":void 0,backdropFilter:s?"none":void 0,WebkitBackdropFilter:s?"none":void 0,border:s?"1px solid rgba(255, 255, 255, 0.15)":void 0},role:"banner","aria-label":"TwinForge Pont de Commandement",children:e.jsxs("div",{className:"w-full h-full flex items-center justify-between gap-2 px-4 md:px-6",children:[e.jsxs("div",{className:"flex items-center gap-1 md:gap-3",children:[e.jsx(Ce,{}),e.jsx(it,{})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsxs(P.button,{type:"button",className:"user-panel-toggle relative central-action-button",style:{width:"48px",height:"48px",borderRadius:"50%",position:"relative",overflow:"visible",padding:0,alignItems:"center",justifyContent:"center",display:"flex",background:i?"radial-gradient(circle at 30% 30%, rgba(247, 147, 30, 0.45) 0%, transparent 60%), linear-gradient(135deg, rgba(247, 147, 30, 0.35), rgba(255, 107, 53, 0.3))":"radial-gradient(circle at 30% 30%, rgba(247, 147, 30, 0.25) 0%, transparent 60%), linear-gradient(135deg, rgba(247, 147, 30, 0.2), rgba(255, 107, 53, 0.15))",border:i?"2px solid rgba(247, 147, 30, 0.6)":"2px solid rgba(247, 147, 30, 0.35)",backdropFilter:"blur(16px) saturate(150%)",WebkitBackdropFilter:"blur(16px) saturate(150%)",boxShadow:i?"0 0 0 1px rgba(255, 255, 255, 0.15) inset, 0 4px 32px rgba(247, 147, 30, 0.5), 0 2px 16px rgba(0, 0, 0, 0.25)":"0 0 0 1px rgba(255, 255, 255, 0.08) inset, 0 4px 24px rgba(247, 147, 30, 0.25), 0 2px 12px rgba(0, 0, 0, 0.2)",transition:"transform 280ms cubic-bezier(0.25, 0.1, 0.25, 1), background 180ms cubic-bezier(0.16, 1, 0.3, 1), box-shadow 180ms cubic-bezier(0.16, 1, 0.3, 1), border-color 180ms cubic-bezier(0.16, 1, 0.3, 1)",transform:"translateZ(0)",willChange:"transform, filter",cursor:"pointer"},"aria-label":"Ouvrir les outils du forgeron","aria-expanded":i,"aria-haspopup":"menu",onPointerDown:()=>a(),onClick:()=>n("centralMenu"),onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),a(),n("centralMenu"))},whileHover:{scale:1.08},whileTap:{scale:.95},children:[[0,1,2,3].map(r=>e.jsx(P.div,{style:{position:"absolute",width:"6px",height:"6px",borderRadius:"1.5px",background:"linear-gradient(135deg, #F7931E, rgba(255, 255, 255, 0.9))",boxShadow:"0 0 16px #F7931E",top:r<2?"2px":"auto",bottom:r>=2?"2px":"auto",left:r%2===0?"2px":"auto",right:r%2===1?"2px":"auto",zIndex:2},initial:{rotate:r%2===0?45:-45},animate:{scale:i?[1,1.4,1]:[1,1.2,1],opacity:i?[.7,1,.7]:[.5,.8,.5],rotate:r%2===0?[45,60,45]:[-45,-60,-45]},transition:{duration:3,repeat:1/0,delay:r*.2,ease:[.4,0,.2,1]}},r)),e.jsx(D,{Icon:I.Zap,size:22,style:{color:i?"#F7931E":"#FF9F40",filter:i?"drop-shadow(0 0 14px rgba(247, 147, 30, 0.9))":"drop-shadow(0 0 10px rgba(255, 159, 64, 0.6))"},"aria-hidden":"true"}),e.jsx(P.div,{className:"absolute inset-0 rounded-full",style:{background:"radial-gradient(circle at center, rgba(247, 147, 30, 0.25) 0%, transparent 70%)",filter:"blur(10px)",zIndex:-1,pointerEvents:"none"},animate:i?{scale:[1,1.4,1.3],opacity:[.7,1,.8]}:{scale:[1,1.15,1],opacity:[.4,.6,.4]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},"aria-hidden":"true"})]}),e.jsx(P.button,{type:"button",className:"user-panel-toggle relative lg:hidden",style:{width:"48px",height:"48px",borderRadius:"50%",position:"relative",overflow:"visible",padding:0,display:"flex",alignItems:"center",justifyContent:"center",background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18) 0%, transparent 50%),
                  rgba(255, 255, 255, 0.10)
                `,border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(16px) saturate(140%)",WebkitBackdropFilter:"blur(16px) saturate(140%)",boxShadow:`
                  0 8px 24px rgba(0, 0, 0, 0.25),
                  0 2px 12px rgba(0, 0, 0, 0.18),
                  inset 0 1px 0 rgba(255, 255, 255, 0.12)
                `,transition:"transform 280ms cubic-bezier(0.25, 0.1, 0.25, 1), background 180ms cubic-bezier(0.16, 1, 0.3, 1), box-shadow 180ms cubic-bezier(0.16, 1, 0.3, 1), border-color 180ms cubic-bezier(0.16, 1, 0.3, 1)",transform:"translateZ(0)",willChange:"transform, filter",cursor:"pointer"},onMouseEnter:r=>{window.matchMedia("(hover: hover)").matches&&(r.currentTarget.style.background=`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                    rgba(255, 255, 255, 0.10)
                  `,r.currentTarget.style.borderColor="rgba(255,255,255,0.3)",r.currentTarget.style.boxShadow=`
                    0 8px 24px rgba(0, 0, 0, 0.25),
                    0 2px 12px rgba(0, 0, 0, 0.18),
                    inset 0 1px 0 rgba(255, 255, 255, 0.12),
                    0 0 20px rgba(255,255,255,0.15),
                    0 4px 16px rgba(0,0,0,0.2)
                  `)},onMouseLeave:r=>{window.matchMedia("(hover: hover)").matches&&(r.currentTarget.style.background=`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18) 0%, transparent 50%),
                    rgba(255, 255, 255, 0.10)
                  `,r.currentTarget.style.borderColor="rgba(255,255,255,0.2)",r.currentTarget.style.boxShadow=`
                    0 8px 24px rgba(0, 0, 0, 0.25),
                    0 2px 12px rgba(0, 0, 0, 0.18),
                    inset 0 1px 0 rgba(255, 255, 255, 0.12)
                  `)},"aria-label":"Ouvrir le menu de navigation principal","aria-expanded":t("mobileDrawer"),"aria-haspopup":"menu",onPointerDown:()=>a(),onClick:()=>{o.debug("HEADER","Mobile drawer toggle clicked"),n("mobileDrawer")},onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),a(),o.debug("HEADER","Mobile drawer toggle via keyboard"),n("mobileDrawer"))},whileHover:{scale:1.08},whileTap:{scale:.95},children:e.jsx(D,{Icon:I.Menu,size:20,style:{color:"rgba(255,255,255,0.9)",filter:"drop-shadow(0 0 8px rgba(247, 147, 30, 0.3))"},"aria-hidden":"true"})})]})]})}),e.jsx(Ne,{}),e.jsx(de,{isOpen:i,onClose:()=>{}})]})});ue.displayName="Header";const pe=_.memo(({to:a,icon:t,label:n,subtitle:i,actionLabel:s,isPrimary:r=!1,isTwin:u=!1,isForge:b=!1,isActive:h,circuitColor:x,tabs:w,subItems:g,isExpanded:p,onToggleExpand:d})=>{const f=J(),S=I[t],T=x||ke(a),{sidebarClick:A}=q(),c=g&&g.length>0,N=m=>{o.trace("SIDEBAR","NavItem click captured",{to:a,label:n,isActive:h}),o.trace("SIDEBAR","NavItem click triggered",{to:a,label:n,currentPath:window.location.pathname}),c&&(m.preventDefault(),d&&(d(),A()))},y=c&&g.some(m=>{const k=m.to.split("#")[0],z=m.to.split("#")[1],U=f.pathname,R=f.hash.replace("#","")||"daily";return U===k&&(!z||R===z)});f.pathname;let v="sidebar-item";return r?v="sidebar-item sidebar-item--primary":u?v="sidebar-item sidebar-item--twin":b&&(v="sidebar-item sidebar-item--forge"),e.jsxs("div",{className:"relative sidebar-nav-item-container",children:[e.jsxs(Z,{to:a,className:`
          ${v}
          ${c?"sidebar-item--with-submenu":""}
          group focus-ring
          ${h||y?"text-white shadow-sm":"text-white/70 hover:text-white"}
        `,onClick:N,onPointerDown:m=>{o.trace("SIDEBAR","NavItem pointer down",{to:a,label:n})},onMouseDown:m=>{o.trace("SIDEBAR","NavItem mouse down",{to:a,label:n})},"aria-current":h?"page":void 0,"aria-expanded":c?p:void 0,"aria-label":`${n} - ${i}`,role:r?"link":"menuitem",style:{"--item-circuit-color":T},children:[e.jsx("div",{className:`sidebar-item-icon-container ${h?"sidebar-item-icon-container--active":""}`,children:e.jsx(D,{Icon:S,size:r?22:u?20:18,className:`sidebar-item-icon ${h||y?"":"opacity-80 group-hover:opacity-100"}`,color:h||y?T:void 0,style:h||y?{color:T,filter:`drop-shadow(0 0 8px ${T}60)`}:void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`sidebar-item-label font-medium ${r?"text-base":u?"text-sm":"text-xs"} truncate ${h||y?"text-white":"text-white/82"}`,children:n}),e.jsx("div",{className:`sidebar-item-subtitle text-xxs truncate ${r?"mt-0.5":"mt-0"} ${h||y?"text-white/70":"text-white/50"}`,children:i})]}),b&&s&&!c&&e.jsx("div",{className:`sidebar-item-action-badge ${h?"sidebar-item-action-badge--active":""}`,children:s})]}),c&&e.jsx("div",{className:`sidebar-submenu ${p?"sidebar-submenu--expanded":""}`,role:"group","aria-label":`Sous-menu ${n}`,children:e.jsx("div",{className:"sidebar-submenu-inner",children:g.map(m=>{const k=I[m.icon],z=m.to.split("#")[0],U=m.to.split("#")[1],R=f.pathname,L=f.hash.replace("#","")||"daily",B=R===z&&(!U||L===U),K=m.isPrimarySubMenu&&R===z;return e.jsxs(Z,{to:m.to,className:`
                    sidebar-submenu-item
                    ${m.isPrimarySubMenu?"sidebar-submenu-item--primary":"sidebar-submenu-item--secondary"}
                    ${B||K?"sidebar-submenu-item--active":""}
                    focus-ring
                  `,onClick:()=>A(),"aria-current":B?"page":void 0,style:{"--item-circuit-color":m.color||T},children:[e.jsx("div",{className:`sidebar-submenu-item-icon-container ${B||K?"sidebar-submenu-item-icon-container--active":""}`,children:e.jsx(D,{Icon:k,size:m.isPrimarySubMenu?16:14,className:"sidebar-submenu-item-icon"})}),e.jsx("span",{className:"sidebar-submenu-item-label",children:m.label})]},m.to)})})})]})});pe.displayName="NavItem";const st=({title:a,type:t,children:n,isLastCategory:i})=>{const s=t==="forge-category",r=a==="Alimentation"||a==="Activité"||a==="Santé";return e.jsxs("div",{className:`space-y-1 ${s?"mt-4":""}`,children:[a&&e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"sidebar-category-separator"}),e.jsx("h3",{className:`sidebar-section-title ${ot(a,t)}`,role:"heading","aria-level":"3",children:a})]}),e.jsx("div",{className:"space-y-1",children:n})]})};function ot(a,t){if(t==="forge-category")return"sidebar-section--forge-category";switch(a){case"Rituels du Forgeron":return"sidebar-section--daily-tracking";case"Ateliers du Forgeron":return"sidebar-section--forge-tools";case"Mon Profil":return"sidebar-section--profile";default:return""}}const me=_.memo(({className:a=""})=>{const t=J(),n=Y(),i=l.useCallback(g=>t.pathname===g,[t.pathname]),[s,r]=l.useState({}),[u,b]=l.useState(null),h=Ie(),x=l.useCallback(async()=>{try{o.info("AUTH","Logout initiated"),await F.auth.signOut(),V.getState().setSession(null),V.getState().setProfile(null),o.info("AUTH","Logout successful, navigating to login"),n("/",{replace:!0})}catch(g){o.error("AUTH","Logout error",{error:g}),console.error("Logout error:",g),n("/",{replace:!0})}},[n]);_.useEffect(()=>{const g=t.pathname;let p=null;const d={};h.forEach(f=>{f.items.forEach(S=>{S.subItems&&S.subItems.length>0&&(S.subItems.some(A=>{const c=A.to.split("#")[0];return g===c})?(d[S.to]=!0,p=S.to):d[S.to]=!1)})}),r(d),b(p)},[t.pathname]),_.useEffect(()=>{o.trace("SIDEBAR","Component rendered",{currentPath:t.pathname})},[t.pathname]);const w=l.useCallback(g=>{r(p=>{if(p[g])return{...p,[g]:!1};const f={};return Object.keys(p).forEach(S=>{f[S]=!1}),f[g]=!0,b(g),f})},[]);return e.jsx("aside",{className:`hidden lg:flex flex-col ${a}
        sticky top-[88px] left-0
        h-[calc(100dvh-104px)]
        w-full
        sidebar-glass-enhanced rounded-2xl visionos-grid
      `,role:"complementary","aria-label":"Main navigation",children:e.jsxs("div",{className:"sidebar-content space-y-2 flex-1 pt-2",children:[h.map((g,p)=>e.jsxs(_.Fragment,{children:[e.jsx(st,{title:g.title,type:g.type,isLastCategory:p===h.length-1&&g.type==="forge-category",children:g.items.map(d=>e.jsx(pe,{to:d.to,icon:d.icon,label:d.label,subtitle:d.subtitle,actionLabel:d.actionLabel,isPrimary:d.isPrimary,isTwin:d.isTwin,isForge:d.isForge,isActive:i(d.to),circuitColor:d.circuitColor,tabs:d.tabs,subItems:d.subItems,isExpanded:s[d.to],onToggleExpand:()=>w(d.to)},d.to))}),g.type==="primary"&&e.jsx("div",{className:"sidebar-primary-separator","aria-hidden":"true"})]},g.title||g.type)),e.jsxs("div",{className:"mt-4 pt-2",children:[e.jsx("div",{className:"sidebar-category-separator mb-3"}),e.jsx("h3",{className:"sidebar-section-title text-white/50 text-xs uppercase tracking-wider font-semibold mb-1 px-1",children:"Compte"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"mb-2",children:e.jsx(Te,{})}),e.jsxs(Z,{to:"/profile",className:`
                sidebar-item group focus-ring
                ${i("/profile")?"text-white shadow-sm":"text-white/70 hover:text-white"}
              `,style:{"--item-circuit-color":"#FDC830"},children:[e.jsx("div",{className:`sidebar-item-icon-container ${i("/profile")?"sidebar-item-icon-container--active":""}`,children:e.jsx(D,{Icon:I.User,size:18,className:`sidebar-item-icon ${i("/profile")?"":"opacity-80 group-hover:opacity-100"}`,style:i("/profile")?{color:"#FDC830",filter:"drop-shadow(0 0 8px rgba(253, 200, 48, 0.6))"}:void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`sidebar-item-label font-medium text-xs truncate ${i("/profile")?"text-white":"text-white/82"}`,children:"Mon Profil"}),e.jsx("div",{className:`sidebar-item-subtitle text-xxs truncate mt-0 ${i("/profile")?"text-white/70":"text-white/50"}`,children:"Infos personnelles"})]})]}),e.jsxs(Z,{to:"/settings",className:`
                sidebar-item group focus-ring
                ${i("/settings")?"text-white shadow-sm":"text-white/70 hover:text-white"}
              `,style:{"--item-circuit-color":"#FDC830"},children:[e.jsx("div",{className:`sidebar-item-icon-container ${i("/settings")?"sidebar-item-icon-container--active":""}`,children:e.jsx(D,{Icon:I.Settings,size:18,className:`sidebar-item-icon ${i("/settings")?"":"opacity-80 group-hover:opacity-100"}`,style:i("/settings")?{color:"#FDC830",filter:"drop-shadow(0 0 8px rgba(253, 200, 48, 0.6))"}:void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`sidebar-item-label font-medium text-xs truncate ${i("/settings")?"text-white":"text-white/82"}`,children:"Paramètres"}),e.jsx("div",{className:`sidebar-item-subtitle text-xxs truncate mt-0 ${i("/settings")?"text-white/70":"text-white/50"}`,children:"Configuration"})]})]})]}),e.jsx("div",{className:"sidebar-category-separator my-2"}),e.jsxs("button",{onClick:x,className:"sidebar-item group focus-ring text-white/70 hover:text-white w-full",style:{"--item-circuit-color":"#FF6B35",textAlign:"left"},children:[e.jsx("div",{className:"sidebar-item-icon-container",style:{background:"linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(247, 147, 30, 0.15))",border:"1.5px solid rgba(255, 107, 53, 0.35)",boxShadow:"0 0 16px rgba(255, 107, 53, 0.18), inset 0 1px 0 rgba(255, 255, 255, 0.15)"},children:e.jsx(D,{Icon:I.LogOut,size:18,className:"sidebar-item-icon opacity-80 group-hover:opacity-100",style:{color:"#FF6B35",filter:"drop-shadow(0 0 6px rgba(255, 107, 53, 0.4))"}})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"sidebar-item-label font-medium text-xs truncate text-white/82 text-left",children:"Déconnexion"}),e.jsx("div",{className:"sidebar-item-subtitle text-xxs truncate mt-0 text-white/50 text-left",children:"Se déconnecter"})]})]})]})]})})});me.displayName="Sidebar";const lt=[{id:"meal-scan",label:"Repas",icon:"Utensils",route:"/meals",color:"#10B981"},{id:"fridge-scan",label:"Frigo",icon:"Refrigerator",route:"/fridge",color:"#EC4899"},{id:"activity",label:"Activité",icon:"Activity",route:"/activity",color:"#3B82F6"},{id:"fasting",label:"Jeûne",icon:"Timer",route:"/fasting",color:"#F59E0B"},{id:"training",label:"Coaching",icon:"Dumbbell",route:"/training",color:"#06B6D4"},{id:"twin",label:"Twin",icon:"User",route:"/avatar",color:"#8B5CF6"}];function ct({button:a,active:t,onClick:n,hasUnread:i,unreadCount:s}){const r=()=>{Je(a.color,t),n()};return e.jsxs(P.button,{onClick:r,className:"new-bottom-bar-button",style:{"--button-color":a.color,"--button-active":t?"1":"0"},whileHover:{scale:1.05},whileTap:{scale:.95},"aria-current":t?"page":void 0,"aria-label":`Aller à ${a.label}`,children:[e.jsx("div",{className:`new-bottom-bar-icon-container ${t?"new-bottom-bar-icon-container--active":""}`,children:e.jsx(D,{Icon:I[a.icon],size:20,style:{color:t?a.color:"rgba(255, 255, 255, 0.5)"}})}),e.jsx("div",{className:`new-bottom-bar-label ${t?"new-bottom-bar-label--active":""}`,children:a.label})]})}const dt=()=>{const{pathname:a}=J(),t=Y(),{close:n}=G(),{isPerformanceMode:i}=ne(),s=u=>{u.route&&(window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{t(u.route),n()},100))},r=u=>u.route?a.startsWith(u.route):!1;return e.jsx(e.Fragment,{children:e.jsx("nav",{className:"new-mobile-bottom-bar","aria-label":"Navigation principale mobile",style:{position:"fixed",bottom:"var(--new-bottom-bar-bottom-offset)",left:"8px",right:"8px",zIndex:9996,background:i?"rgba(11, 14, 23, 0.95)":void 0,backdropFilter:i?"blur(10px)":void 0,WebkitBackdropFilter:i?"blur(10px)":void 0,border:i?"1px solid rgba(255, 255, 255, 0.1)":void 0,borderRadius:"20px"},children:e.jsx("div",{className:"new-mobile-bottom-bar-container",children:e.jsx("div",{className:"new-mobile-bottom-bar-buttons",children:lt.map(u=>e.jsx(ct,{button:u,active:r(u),onClick:()=>s(u)},u.id))})})})})};function ut(){const a=l.useRef(!1),t=l.useRef(!1);return l.useEffect(()=>a.current||t.current?void 0:(a.current=!0,(async()=>{try{ee.initialized?(o.debug("VOICE_COACH_INIT","Voice coach orchestrator already initialized"),t.current=!0):(o.info("VOICE_COACH_INIT","Initializing voice coach orchestrator"),await ee.initialize(),t.current=!0,o.info("VOICE_COACH_INIT","Voice coach orchestrator ready"))}catch(i){o.error("VOICE_COACH_INIT","Failed to initialize voice coach orchestrator",{error:i instanceof Error?i.message:String(i),stack:i instanceof Error?i.stack:void 0})}finally{a.current=!1}})(),()=>{t.current&&(o.info("VOICE_COACH_INIT","Cleaning up voice coach orchestrator"),ee.cleanup(),t.current=!1)}),[]),{isInitialized:t.current}}function pt(){const{isInstallable:a,isInstalled:t}=Oe(),{isUpdateAvailable:n,updateInfo:i,applyUpdate:s,dismissUpdate:r}=at(),{showToast:u}=ce(),b=J(),{isAnyOpen:h,isOpen:x,close:w}=G(),g=x("centralMenu"),p=_.useRef(null);ut(),rt(),_.useEffect(()=>{const v=h();if(v){const m=document.body.style.overflow,k=document.body.style.position,z=document.body.style.width,U=document.body.style.height;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",o.debug("OVERLAY_BODY_LOCK","Body scroll locked",{anyOverlayOpen:v,timestamp:new Date().toISOString()}),()=>{document.body.style.overflow=m,document.body.style.position=k,document.body.style.width=z,document.body.style.height=U,o.debug("OVERLAY_BODY_UNLOCK","Body scroll unlocked",{timestamp:new Date().toISOString()})}}},[h]),_.useEffect(()=>{(()=>{try{document.documentElement.scrollTo(0,0),window.scrollTo(0,0);const m=document.getElementById("main-content");m&&m.scrollTo(0,0),document.querySelectorAll("[data-scroll-container]").forEach(z=>{z.scrollTo(0,0)})}catch(m){o.warn("APP_NAVIGATION","Scroll error",{error:m})}})(),o.debug("APP_NAVIGATION","Scroll to top on route change",{newPath:b.pathname,previousScrollY:window.scrollY,pwa:{isInstallable:a,isInstalled:t,isUpdateAvailable:n},timestamp:new Date().toISOString()})},[b.pathname]);const{isGenerating:d,isGeneratingDetailedRecipes:f,cancelDetailedRecipeGeneration:S}=Ve(),{isOpen:T,showModal:A,hideModal:c}=Ye(),N=b.pathname.startsWith("/body-scan")||b.pathname.startsWith("/avatar"),y=b.pathname.startsWith("/body-scan")||b.pathname.startsWith("/avatar");return l.useEffect(()=>{const v=k=>{if(d||f)return k.preventDefault(),k.returnValue="",A({title:d?"Génération de plan en cours":"Génération de recettes en cours",message:d?"Votre plan alimentaire est en cours de génération. Êtes-vous sûr de vouloir quitter ?":"Les recettes détaillées sont en cours de génération. Êtes-vous sûr de vouloir quitter ?",processName:d?"Génération de Plan Alimentaire":"Génération de Recettes Détaillées",onConfirm:()=>{d&&oe(),f&&S(),c(),window.location.reload()},onCancel:c}),""},m=k=>{(d||f)&&(k.preventDefault(),window.history.pushState(null,"",window.location.href),A({title:d?"Génération de plan en cours":"Génération de recettes en cours",message:d?"Votre plan alimentaire est en cours de génération. Êtes-vous sûr de vouloir quitter ?":"Les recettes détaillées sont en cours de génération. Êtes-vous sûr de vouloir quitter ?",processName:d?"Génération de Plan Alimentaire":"Génération de Recettes Détaillées",onConfirm:()=>{d&&oe(),f&&S(),c(),window.history.back()},onCancel:c}))};return(d||f)&&(window.addEventListener("beforeunload",v),window.addEventListener("popstate",m),window.history.pushState(null,"",window.location.href)),()=>{window.removeEventListener("beforeunload",v),window.removeEventListener("popstate",m)}},[d,f,A,c,S]),e.jsxs("div",{className:"min-h-screen flex flex-col z-auto-important will-change-auto-important position-static-important transform-none-important filter-none-important perspective-none-important contain-none-important isolation-auto-important overflow-visible-important",style:{position:"relative",zIndex:0},children:[e.jsx(ue,{}),e.jsxs("div",{className:"flex-1 flex min-w-0 position-static-important overflow-visible-important transform-none-important filter-none-important perspective-none-important contain-none-important isolation-auto-important z-auto-important",children:[e.jsx("div",{className:"hidden lg:flex lg:flex-col lg:w-[240px] xl:w-[260px] shrink-0 ml-6 mr-3 pt-20",children:e.jsx(me,{})}),e.jsx("main",{id:"main-content",className:`flex-1 min-w-0 px-4 py-4 md:px-6 lg:px-6 xl:px-8 md:pb-4 pt-20 pb-32 ${N?"body-scan-page":""}`,style:{position:"relative",overflow:"visible",minHeight:"100dvh",WebkitOverflowScrolling:"touch",scrollBehavior:"smooth"},role:"main","aria-label":"Contenu principal de l'application",children:e.jsx("div",{className:et("w-full min-w-0",{"mx-auto":!y}),children:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(be,{})})})})]}),a&&!t&&e.jsx(Pe,{variant:"floating",onInstallSuccess:()=>u({type:"success",title:"TwinForge installé !",message:"L'application est maintenant disponible sur votre écran d'accueil",duration:4e3})}),e.jsx(De,{isVisible:n,onUpdate:async()=>{try{await s(),u({type:"success",title:"Mise à jour appliquée",message:"TwinForge redémarre avec la nouvelle version",duration:4e3})}catch(v){o.error("PWA_UPDATE","Failed to apply update",{error:v instanceof Error?v.message:"Unknown error",timestamp:new Date().toISOString()}),u({type:"error",title:"Erreur de mise à jour",message:"Impossible d'appliquer la mise à jour. Réessayez plus tard.",duration:4e3})}},onDismiss:r,updateInfo:i}),e.jsx(dt,{}),e.jsx(ze,{}),e.jsx(de,{isOpen:g,onClose:w}),e.jsx(Re,{ref:p}),e.jsx(Le,{chatButtonRef:p})]})}function mt(){return e.jsx(pt,{})}function te(){}function gt({storage:a,key:t="REACT_QUERY_OFFLINE_CACHE",throttleTime:n=1e3,serialize:i=JSON.stringify,deserialize:s=JSON.parse,retry:r}){if(a){const u=b=>{try{a.setItem(t,i(b));return}catch(h){return h}};return{persistClient:ht(b=>{let h=b,x=u(h),w=0;for(;x&&h;)w++,h=r?.({persistedClient:h,error:x,errorCount:w}),h&&(x=u(h))},n),restoreClient:()=>{const b=a.getItem(t);if(b)return s(b)},removeClient:()=>{a.removeItem(t)}}}return{persistClient:te,restoreClient:te,removeClient:te}}function ht(a,t=100){let n=null,i;return function(...s){i=s,n===null&&(n=ve.setTimeout(()=>{a(...i),n=null},t))}}const xt=({children:a})=>(_.useEffect(()=>{},[]),e.jsx(e.Fragment,{children:a}));class ft extends _.Component{constructor(){super(...arguments);Q(this,"state",{hasError:!1})}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(n,i){if(/Loading chunk [\d]+ failed/i.test(String(n?.message))){o.debug("Chunk loading failed, auto-retrying:",n);return}o.error("React error boundary caught error:",n,i)}render(){return this.state.hasError?this.props.fallback??e.jsx("div",{className:"p-6 text-sm text-red-300 bg-red-900/20 rounded-xl",children:"Une erreur est survenue. Recharge la page ou réessaie."}):this.props.children}}const bt=l.createContext(null);function vt({children:a}){const[t,n]=l.useState(new Map),i=l.useCallback(p=>p.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").trim(),[]),s=l.useCallback(p=>{const d=i(p);return t.get(d)||null},[t,i]),r=l.useCallback((p,d)=>{const f=i(p);n(S=>{const T=new Map(S),A=T.get(f),c={exerciseName:A?.exerciseName||p,queueId:d.queueId||A?.queueId||"",status:d.status||A?.status||"queued",imageUrl:d.imageUrl||A?.imageUrl,illustrationId:d.illustrationId||A?.illustrationId,timestamp:d.timestamp||A?.timestamp||Date.now()};return T.set(f,c),o.debug("ILLUSTRATION_CACHE","Updated cache",{exerciseName:p,status:c.status,hasImageUrl:!!c.imageUrl}),T})},[i]),u=l.useCallback(p=>{const d=i(p);n(f=>{const S=new Map(f);return S.delete(d),o.debug("ILLUSTRATION_CACHE","Removed from cache",{exerciseName:p}),S})},[i]),b=l.useCallback(p=>{const d=s(p);return d?.status==="queued"||d?.status==="generating"},[s]),h=l.useCallback(()=>new Map(t),[t]),x=l.useCallback(()=>{n(new Map),o.info("ILLUSTRATION_CACHE","Cache cleared")},[]),w=l.useCallback(()=>{const p={total:t.size,queued:0,generating:0,completed:0,failed:0};return t.forEach(d=>{switch(d.status){case"queued":p.queued++;break;case"generating":p.generating++;break;case"completed":p.completed++;break;case"failed":p.failed++;break}}),p},[t]),g={getCachedIllustration:s,setCachedIllustration:r,removeCachedIllustration:u,isGenerating:b,getAllCached:h,clearCache:x,getStats:w};return e.jsx(bt.Provider,{value:g,children:a})}function yt(){return l.useEffect(()=>{const a=M.getConfig(),t=M.getCapabilities();return document.documentElement.style.setProperty("--glass-blur-adaptive",`${a.glassBlur}px`),document.documentElement.style.setProperty("--animation-duration-adaptive",`${a.animationDuration}ms`),document.documentElement.classList.remove("perf-high","perf-medium","perf-low"),document.documentElement.classList.add(`perf-${t.performanceLevel}`),t.isMobile&&document.documentElement.classList.add("is-mobile"),a.enableShimmer||document.documentElement.classList.add("disable-shimmer"),a.enablePulse||document.documentElement.classList.add("disable-pulse"),a.enableGlow||document.documentElement.classList.add("disable-glow"),()=>{M.destroy()}},[]),{capabilities:M.getCapabilities(),config:M.getConfig()}}class wt{constructor(){Q(this,"syncInterval",null);Q(this,"syncInProgress",new Set)}async performAutoSync(t){try{o.info("WEARABLE_AUTO_SYNC","Starting automatic sync",{userId:t});const i=(await X.getConnectedDevices(t)).filter(r=>r.connected&&!r.revoked);if(i.length===0)return o.info("WEARABLE_AUTO_SYNC","No active devices to sync",{userId:t}),[];const s=[];for(const r of i){if(this.syncInProgress.has(r.id)){o.info("WEARABLE_AUTO_SYNC","Sync already in progress for device",{deviceId:r.id});continue}try{this.syncInProgress.add(r.id);const u=r.last_sync?new Date(r.last_sync):null,b=new Date,h=u?(b.getTime()-u.getTime())/(1e3*60*60):1/0;if(h<1){o.info("WEARABLE_AUTO_SYNC","Device synced recently, skipping",{deviceId:r.id,hoursSinceSync:h}),this.syncInProgress.delete(r.id);continue}o.info("WEARABLE_AUTO_SYNC","Triggering sync for device",{deviceId:r.id,provider:r.provider,hoursSinceSync:h}),await X.triggerSync(r.id);const{data:x,error:w}=await F.from("activities").select("id").eq("user_id",t).eq("wearable_device_id",r.id).gte("created_at",u?.toISOString()||new Date(0).toISOString());if(w)throw w;s.push({success:!0,deviceId:r.id,activitiesImported:x?.length||0,lastSyncTime:b.toISOString()}),o.info("WEARABLE_AUTO_SYNC","Sync completed successfully",{deviceId:r.id,activitiesImported:x?.length||0})}catch(u){o.error("WEARABLE_AUTO_SYNC","Sync failed for device",{deviceId:r.id,error:u}),s.push({success:!1,deviceId:r.id,activitiesImported:0,lastSyncTime:new Date().toISOString(),error:u instanceof Error?u.message:"Unknown error"})}finally{this.syncInProgress.delete(r.id)}}return s}catch(n){throw o.error("WEARABLE_AUTO_SYNC","Auto sync failed",{error:n,userId:t}),n}}startAutoSync(t,n=60){this.syncInterval&&(o.warn("WEARABLE_AUTO_SYNC","Auto sync already running, clearing previous interval"),this.stopAutoSync()),o.info("WEARABLE_AUTO_SYNC","Starting auto sync scheduler",{userId:t,intervalMinutes:n}),this.performAutoSync(t).catch(i=>{o.error("WEARABLE_AUTO_SYNC","Initial auto sync failed",{error:i})}),this.syncInterval=setInterval(()=>{this.performAutoSync(t).catch(i=>{o.error("WEARABLE_AUTO_SYNC","Scheduled auto sync failed",{error:i})})},n*60*1e3)}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null,o.info("WEARABLE_AUTO_SYNC","Auto sync scheduler stopped"))}async checkForNewActivities(t,n){try{const s=(await X.getConnectedDevices(t)).find(h=>h.id===n);if(!s)throw new Error("Device not found");const r=s.last_sync?new Date(s.last_sync):new Date(0),{data:u,error:b}=await F.from("activities").select("id").eq("user_id",t).eq("wearable_device_id",n).gte("timestamp",r.toISOString());if(b)throw b;return u?.length||0}catch(i){throw o.error("WEARABLE_AUTO_SYNC","Failed to check for new activities",{error:i,userId:t,deviceId:n}),i}}async intelligentDataFusion(t,n,i){try{o.info("WEARABLE_AUTO_SYNC","Starting intelligent data fusion",{userId:t,manualActivityId:n,wearableActivityId:i});const{data:s,error:r}=await F.from("activities").select("*").eq("id",n).maybeSingle(),{data:u,error:b}=await F.from("activities").select("*").eq("id",i).maybeSingle();if(r||b)throw r||b;if(!s||!u)throw new Error("Activity not found");const h={...s},x=["hr_avg","hr_max","hr_min","hr_zone1_minutes","hr_zone2_minutes","hr_zone3_minutes","hr_zone4_minutes","hr_zone5_minutes","hrv_avg","hrv_rmssd","vo2max_est","distance_km","pace_avg","speed_avg","elevation_gain","cadence_avg","power_avg","calories_measured","recovery_score","training_effect","trimp_score"];x.forEach(p=>{u[p]!==null&&u[p]!==void 0&&(h[p]=u[p])});const{error:w}=await F.from("activities").update(h).eq("id",n);if(w)throw w;const{error:g}=await F.from("activities").delete().eq("id",i);if(g)throw g;o.info("WEARABLE_AUTO_SYNC","Data fusion completed successfully",{manualActivityId:n,wearableActivityId:i,fusedFields:x.filter(p=>h[p]!==null).length})}catch(s){throw o.error("WEARABLE_AUTO_SYNC","Data fusion failed",{error:s,userId:t,manualActivityId:n,wearableActivityId:i}),s}}}const ae=new wt;function St(a,t={}){const{enabled:n=!0,intervalMinutes:i=60}=t,{showToast:s}=ce(),r=_.useRef(s);_.useEffect(()=>{r.current=s},[s]),l.useEffect(()=>{if(!a||!n){o.info("AUTO_SYNC_HOOK","Auto sync not enabled",{userId:a,enabled:n});return}o.info("AUTO_SYNC_HOOK","Initializing auto sync",{userId:a,intervalMinutes:i}),ae.startAutoSync(a,i);const b=setInterval(async()=>{try{const x=(await ae.performAutoSync(a)).filter(g=>g.success),w=x.reduce((g,p)=>g+p.activitiesImported,0);w>0&&(r.current({type:"success",title:"Synchronisation réussie",message:`${w} nouvelle${w>1?"s":""} activité${w>1?"s":""} importée${w>1?"s":""}`,duration:5e3}),o.info("AUTO_SYNC_HOOK","Auto sync completed with new activities",{userId:a,totalActivities:w,devicesCount:x.length}))}catch(h){o.error("AUTO_SYNC_HOOK","Auto sync failed",{error:h,userId:a})}},i*60*1e3);return()=>{ae.stopAutoSync(),clearInterval(b),o.info("AUTO_SYNC_HOOK","Auto sync stopped",{userId:a})}},[a,n,i])}const ge=new ye({defaultOptions:{queries:{staleTime:10*60*1e3,gcTime:24*60*60*1e3,retry:1,refetchOnWindowFocus:!1,refetchOnMount:a=>{const t=a.queryKey;return!!(t.includes("meals-today")||t.includes("meals-week")||t.includes("meals-recent")||t.includes("daily-ai-summary"))},refetchOnReconnect:!1},mutations:{retry:1}}}),jt=gt({storage:window.localStorage,key:"twinforge-react-query-cache",serialize:JSON.stringify,deserialize:a=>{try{const t=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z?$/,i=JSON.parse(a,(s,r)=>{if(typeof r=="string"&&t.test(r)){const u=new Date(r);return isNaN(u.getTime())?r:u}return r});return i&&i.queries&&i.queries.forEach(s=>{s.state&&((s.state.dataUpdatedAt===null||s.state.dataUpdatedAt===void 0)&&(s.state.dataUpdatedAt=0),(s.state.fetchedAt===null||s.state.fetchedAt===void 0)&&(s.state.fetchedAt=0),typeof s.state.dataUpdatedAt=="number"&&isNaN(s.state.dataUpdatedAt)&&(s.state.dataUpdatedAt=0),typeof s.state.fetchedAt=="number"&&isNaN(s.state.fetchedAt)&&(s.state.fetchedAt=0))}),i}catch(t){return o.error("REACT_QUERY_PERSISTENCE","Failed to deserialize cache",{error:t instanceof Error?t.message:"Unknown error",timestamp:new Date().toISOString()}),null}}});let le=!1;const Et=async()=>{if(!le)try{o.info("REACT_QUERY_PERSISTENCE","Initializing cache persistence",{persisterKey:"twinforge-react-query-cache",storage:"localStorage",timestamp:new Date().toISOString()}),await Se({queryClient:ge,persister:jt,maxAge:24*60*60*1e3,hydrateOptions:{defaultOptions:{queries:{staleTime:10*60*1e3}}},dehydrateOptions:{shouldDehydrateQuery:a=>{const t=a.queryKey;return t.includes("fasting")?!1:t.includes("insights")||t.includes("progression")||t.includes("trend-analysis")||t.includes("daily-summary")?!0:!(t.includes("daily")&&!t.includes("summary")||t.includes("profile"))}}}),le=!0,o.info("REACT_QUERY_PERSISTENCE","Cache persistence initialized successfully",{cacheSize:Object.keys(localStorage).filter(a=>a.startsWith("twinforge-react-query")).length,timestamp:new Date().toISOString()})}catch(a){o.error("REACT_QUERY_PERSISTENCE","Failed to initialize cache persistence",{error:a instanceof Error?a.message:"Unknown error",timestamp:new Date().toISOString()})}};function At({children:a}){return yt(),e.jsx(e.Fragment,{children:a})}function _t({children:a}){const{profile:t}=V();return St(t?.id||null,{enabled:!0,intervalMinutes:60}),e.jsx(e.Fragment,{children:a})}function Ct(){const{showAlert:a,recommendation:t,dismissAlert:n}=We();return!a||!t?null:e.jsx(Me,{recommendation:t,onDismiss:n,onNavigateToSettings:n})}function Nt({children:a}){return _.useEffect(()=>{Et()},[]),e.jsx(ft,{children:e.jsx(we,{client:ge,children:e.jsx(xt,{children:e.jsx(Fe,{children:e.jsxs(Xe,{children:[e.jsx(Ue,{}),e.jsx(vt,{children:e.jsx(Be,{children:e.jsx(At,{children:e.jsxs(_t,{children:[e.jsx(Ct,{}),a]})})})})]})})})})})}const kt=({onSuccess:a})=>{const[t,n]=l.useState(!1),[i,s]=l.useState(""),[r,u]=l.useState(""),[b,h]=l.useState(""),[x,w]=l.useState(!1),[g,p]=l.useState(!1),[d,f]=l.useState(null),{setSession:S,fetchProfile:T}=V(),{formSubmit:A,error:c,click:N,success:y}=q(),v=Y(),{mode:m}=ne(),k=l.useMemo(()=>{const j=m==="high-performance",O=m==="balanced";return{backdropFilter:j?"none":O?"blur(8px) saturate(140%)":"blur(32px) saturate(180%)",background:j?"rgba(255, 255, 255, 0.08)":O?`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent) 0%, transparent 60%),
            rgba(255, 255, 255, 0.07)
          `:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-plasma-cyan) 14%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, rgba(255, 107, 53, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(61, 19, 179, 0.06) 0%, transparent 70%),
            rgba(255, 255, 255, 0.06)
          `,boxShadow:j?"0 16px 48px rgba(0, 0, 0, 0.4)":O?`
            0 20px 56px rgba(0, 0, 0, 0.45),
            0 0 32px color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.2)
          `:`
            0 24px 64px rgba(0, 0, 0, 0.5),
            0 0 48px color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent),
            0 0 96px color-mix(in srgb, var(--color-plasma-cyan) 12%, transparent),
            0 0 120px rgba(255, 107, 53, 0.08),
            inset 0 2px 0 rgba(255, 255, 255, 0.25),
            inset 0 -2px 0 rgba(0, 0, 0, 0.15)
          `,borderColor:j?"rgba(255, 255, 255, 0.2)":"color-mix(in srgb, var(--color-plasma-cyan) 30%, transparent)"}},[m]),z=l.useMemo(()=>m==="high-performance"?"none":m==="balanced"?"blur(12px) saturate(140%)":"blur(20px) saturate(160%)",[m]),U=l.useMemo(()=>m==="high-performance"?"none":m==="balanced"?"blur(8px) saturate(120%)":"blur(12px) saturate(130%)",[m]),R=l.useMemo(()=>m==="high-performance"?.3:m==="balanced"?.5:.8,[m]),L=m!=="high-performance",B=async()=>{p(!0),f(null),N();try{o.info("AUTH","Starting Google OAuth flow",{timestamp:new Date().toISOString()});const{data:j,error:O}=await F.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/`,queryParams:{access_type:"offline",prompt:"consent"}}});if(O)throw O;o.info("AUTH","Google OAuth redirect initiated",{timestamp:new Date().toISOString()})}catch(j){o.error("AUTH","Google authentication error",{error:j.message,timestamp:new Date().toISOString()}),c(),f(j.message||"Erreur lors de la connexion avec Google"),p(!1)}},K=async j=>{j.preventDefault(),w(!0),f(null),A();try{if(t){const{data:O,error:W}=await F.auth.signUp({email:i,password:r,options:{data:{display_name:b}}});if(W)throw W;O.session?(o.info("AUTH","User signed up successfully",{userId:O.session.user.id}),S(O.session),await T(),y(),setTimeout(()=>{v("/",{replace:!0})},500),a?.()):f("Veuillez vérifier votre email pour confirmer votre compte")}else{const{data:O,error:W}=await F.auth.signInWithPassword({email:i,password:r});if(W)throw W;o.info("AUTH","User signed in successfully",{userId:O.session.user.id}),S(O.session),await T(),y(),setTimeout(()=>{v("/",{replace:!0})},500),a?.()}}catch(O){o.error("AUTH","Authentication error",{error:O.message}),c(),f(O.message||"Erreur lors de l'authentification")}finally{w(!1)}},he=()=>{N(),n(!t),f(null)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-twinforge-visionos relative overflow-hidden",style:{position:"relative",zIndex:1,isolation:"isolate",background:`
          radial-gradient(circle at 20% 30%, rgba(24, 227, 255, 0.08) 0%, transparent 50%),
          radial-gradient(circle at 80% 70%, rgba(255, 107, 53, 0.06) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, rgba(61, 19, 179, 0.04) 0%, transparent 60%),
          linear-gradient(180deg, #0B0E17 0%, #0F1219 50%, #0B0E17 100%)
        `},children:e.jsx("div",{className:"w-full max-w-md mx-auto px-4 auth-form-wrapper",style:{position:"relative",zIndex:100,isolation:"isolate",transform:"translateZ(0)",pointerEvents:"auto"},children:e.jsx(P.div,{initial:L?{opacity:0,y:30,scale:.95}:!1,animate:{opacity:1,y:0,scale:1},transition:{duration:R,ease:"easeOut"},style:{position:"relative",zIndex:101,isolation:"isolate",transform:"translateZ(0)",pointerEvents:"auto"},children:e.jsxs(se,{className:"p-6 relative w-full auth-form-card",style:{position:"relative",zIndex:102,isolation:"isolate",transform:"translateZ(0)",pointerEvents:"auto",...k},children:[e.jsx(P.div,{className:"flex flex-col items-center justify-center mb-6",initial:L?{opacity:0,y:-20}:!1,animate:{opacity:1,y:0},transition:{duration:R*.75,delay:L?.15:0},style:{position:"relative",zIndex:103,pointerEvents:"auto"},children:e.jsx(P.div,{initial:L?{opacity:0,scale:.95}:!1,animate:{opacity:1,scale:1},transition:{duration:R*.875,delay:L?.2:0,ease:"easeOut"},style:{filter:m==="quality"?"drop-shadow(0 0 16px color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)) drop-shadow(0 0 8px rgba(255, 255, 255, 0.1))":"drop-shadow(0 0 8px color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent))"},children:e.jsx(re,{variant:"desktop",isHovered:!1})})}),e.jsxs("div",{style:{position:"relative",zIndex:103,pointerEvents:"auto"},children:[e.jsx("h1",{className:"text-xl font-bold text-white mb-2 text-center",children:t?"Rejoindre TwinForge":"Connexion TwinForge"}),e.jsx("p",{className:"text-white/70 text-sm text-center mb-4",children:t?"Créez votre Forge Spatiale":"Accédez à votre Forge Spatiale"})]}),e.jsx("form",{onSubmit:K,className:"auth-form-interactive",style:{position:"relative",zIndex:104,isolation:"isolate",transform:"translateZ(0)",pointerEvents:"auto"},children:e.jsxs(P.div,{initial:L?{opacity:0}:!1,animate:{opacity:1},transition:{duration:R*.75,delay:L?.3:0},style:{position:"relative",zIndex:105,pointerEvents:"auto"},children:[e.jsx(ie,{mode:"wait",children:t&&e.jsxs(P.div,{className:"mb-4",initial:L?{opacity:0,height:0,y:-10}:!1,animate:{opacity:1,height:"auto",y:0},exit:L?{opacity:0,height:0,y:-10}:void 0,transition:{duration:R*.375},style:{position:"relative",zIndex:106,pointerEvents:"auto"},children:[e.jsx("label",{htmlFor:"displayName",className:"block text-white/90 text-sm font-medium mb-1",children:"Nom d'affichage"}),e.jsx("input",{id:"displayName",type:"text",value:b,onChange:j=>h(j.target.value),className:"glass-input w-full auth-input",placeholder:"Votre nom dans la forge",required:t,style:{position:"relative",zIndex:107,pointerEvents:"auto",cursor:"text",userSelect:"auto",WebkitUserSelect:"auto"}})]},"displayName")}),e.jsxs("div",{className:"mb-4",style:{position:"relative",zIndex:106,pointerEvents:"auto"},children:[e.jsx("label",{htmlFor:"email",className:"block text-white/90 text-sm font-medium mb-1",children:"Adresse email"}),e.jsx("input",{id:"email",type:"email",value:i,onChange:j=>s(j.target.value),className:"glass-input w-full auth-input",placeholder:"votre@email.com",required:!0,style:{position:"relative",zIndex:107,pointerEvents:"auto",cursor:"text",userSelect:"auto",WebkitUserSelect:"auto"}})]}),e.jsxs("div",{className:"mb-4",style:{position:"relative",zIndex:106,pointerEvents:"auto"},children:[e.jsx("label",{htmlFor:"password",className:"block text-white/90 text-sm font-medium mb-1",children:"Mot de passe"}),e.jsx("input",{id:"password",type:"password",value:r,onChange:j=>u(j.target.value),className:"glass-input w-full auth-input",placeholder:"Votre mot de passe sécurisé",required:!0,minLength:6,style:{position:"relative",zIndex:107,pointerEvents:"auto",cursor:"text",userSelect:"auto",WebkitUserSelect:"auto"}})]}),e.jsx(ie,{children:d&&e.jsx(P.div,{className:"mb-4",initial:L?{opacity:0,y:-10,scale:.95}:!1,animate:{opacity:1,y:0,scale:1},exit:L?{opacity:0,y:-10,scale:.95}:void 0,transition:{duration:R*.375},style:{position:"relative",zIndex:106,pointerEvents:"auto"},children:e.jsx(se,{className:"p-3",style:{background:"rgba(239, 68, 68, 0.15)",borderColor:"rgba(239, 68, 68, 0.4)",backdropFilter:U,boxShadow:m==="high-performance"?"0 0 12px rgba(239, 68, 68, 0.25)":"0 0 20px rgba(239, 68, 68, 0.3)",position:"relative",zIndex:107,pointerEvents:"auto"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(D,{Icon:I.AlertTriangle,size:14,className:"text-red-300 mt-0.5"}),e.jsx("p",{className:"text-red-200 text-sm leading-relaxed",children:d})]})})})}),e.jsx("button",{type:"submit",disabled:x||g,className:"w-full auth-submit-button mb-4",style:{position:"relative",zIndex:106,pointerEvents:"auto",cursor:"pointer",background:`
                      linear-gradient(135deg,
                        color-mix(in srgb, var(--brand-primary) 80%, transparent),
                        color-mix(in srgb, var(--color-plasma-cyan) 60%, transparent)
                      )
                    `,backdropFilter:z,boxShadow:m==="high-performance"?"0 8px 24px color-mix(in srgb, var(--brand-primary) 30%, transparent), inset 0 2px 0 rgba(255,255,255,0.3)":m==="balanced"?`
                          0 10px 32px color-mix(in srgb, var(--brand-primary) 35%, transparent),
                          0 0 48px color-mix(in srgb, var(--brand-primary) 25%, transparent),
                          inset 0 2px 0 rgba(255,255,255,0.35)
                        `:`
                          0 12px 40px color-mix(in srgb, var(--brand-primary) 40%, transparent),
                          0 0 60px color-mix(in srgb, var(--brand-primary) 30%, transparent),
                          0 0 100px color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent),
                          inset 0 3px 0 rgba(255,255,255,0.4)
                        `,border:"2px solid color-mix(in srgb, var(--brand-primary) 60%, transparent)",borderRadius:"999px",padding:"0.75rem 1.5rem",minHeight:"48px",color:"white",fontWeight:"bold",fontSize:"1rem",transition:"all 0.2s ease"},onMouseEnter:j=>{!x&&!g&&(j.currentTarget.style.transform="translateY(-2px) scale(1.02)")},onMouseLeave:j=>{j.currentTarget.style.transform="translateY(0) scale(1)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[x?e.jsx(D,{Icon:I.Loader2,size:18,className:"text-white animate-spin"}):e.jsx(D,{Icon:t?I.UserPlus:I.LogIn,size:18,className:"text-white"}),e.jsx("span",{children:x||g?"Forge en cours...":t?"Créer ma Forge":"Accéder à ma Forge"})]})}),e.jsxs("div",{className:"flex items-center gap-4 my-4",style:{position:"relative",zIndex:106,pointerEvents:"auto"},children:[e.jsx("div",{className:"flex-1 h-px bg-white/20"}),e.jsx("span",{className:"text-white/50 text-sm",children:"ou"}),e.jsx("div",{className:"flex-1 h-px bg-white/20"})]}),e.jsx("button",{type:"button",onClick:B,disabled:g||x,className:"w-full auth-google-button mb-4",style:{position:"relative",zIndex:106,pointerEvents:"auto",cursor:"pointer",background:`
                      linear-gradient(135deg,
                        rgba(255, 255, 255, 0.95),
                        rgba(248, 250, 252, 0.9)
                      )
                    `,backdropFilter:z,boxShadow:m==="high-performance"?"0 6px 24px rgba(0, 0, 0, 0.12), inset 0 1px 0 rgba(255,255,255,0.7)":m==="balanced"?"0 7px 28px rgba(0, 0, 0, 0.135), 0 0 32px rgba(255, 255, 255, 0.08), inset 0 1.5px 0 rgba(255,255,255,0.75)":`
                          0 8px 32px rgba(0, 0, 0, 0.15),
                          0 0 40px rgba(255, 255, 255, 0.1),
                          inset 0 2px 0 rgba(255,255,255,0.8)
                        `,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"999px",padding:"0.75rem 1.5rem",minHeight:"48px",color:"#1f2937",fontWeight:"600",fontSize:"1rem",transition:"all 0.2s ease"},onMouseEnter:j=>{!x&&!g&&(j.currentTarget.style.transform="translateY(-2px) scale(1.02)")},onMouseLeave:j=>{j.currentTarget.style.transform="translateY(0) scale(1)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[g?e.jsx(D,{Icon:I.Loader2,size:18,style:{color:"#1f2937"},className:"animate-spin"}):e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),e.jsx("span",{children:g?"Redirection...":t?"Créer un compte avec Google":"Se connecter avec Google"})]})}),e.jsx("div",{className:"text-center",style:{position:"relative",zIndex:106,pointerEvents:"auto"},children:e.jsx("button",{type:"button",onClick:he,disabled:x||g,className:"text-white/70 hover:text-white text-sm transition-colors auth-toggle-button",style:{position:"relative",zIndex:107,pointerEvents:"auto",cursor:"pointer",background:"none",border:"none",padding:"0.5rem"},children:t?"Déjà un compte ? Se connecter":"Pas de compte ? Créer un compte"})})]})})]})})})})},It=l.lazy(()=>C(()=>import("./Home-BvehWoy3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Tt=l.lazy(()=>C(()=>import("./Profile-bO3qoX3E.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9,10,11,13,14,15]))),Ot=l.lazy(()=>C(()=>import("./ActivityPage-DC5KF59f.js"),__vite__mapDeps([16,1,2,3,4,5,6,7,8,9,10,11,17,18]))),Pt=l.lazy(()=>C(()=>import("./FastingPage--qs9B3r7.js"),__vite__mapDeps([19,1,2,3,4,5,6,7,8,9,10,11,13,20,14,15]))),Dt=l.lazy(()=>C(()=>import("./MealsPage-qvcVe9FA.js"),__vite__mapDeps([21,1,2,3,4,5,6,7,8,9,10,11,13,22,23]))),zt=l.lazy(()=>C(()=>import("./MealScanFlowPage-BfecSTyS.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,22,23,25]))),Rt=l.lazy(()=>C(()=>import("./FridgePage-D_AZSPmi.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9,10,11]))),Lt=l.lazy(()=>C(()=>import("./TrainingPage-grakMon4.js"),__vite__mapDeps([27,1,2,3,4,5,6,7,8,9,10,11,28]))),Ft=l.lazy(()=>C(()=>import("./SettingsPage-Dqe6oRsk.js"),__vite__mapDeps([29,1,2,3,4,5,6,7,8,9,10,11,28,30]))),Ut=l.lazy(()=>C(()=>import("./NotificationsPage-BbbjfsAl.js"),__vite__mapDeps([31,1,2,3,4,5,6,7,8,9,10,11,28])));l.lazy(()=>C(()=>import("./BodyScanPage-BdidJ1mK.js"),__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,10,11,28])));const Bt=l.lazy(()=>C(()=>import("./AvatarPage-C7ZEc3RK.js"),__vite__mapDeps([33,1,2,3,4,5,6,7,8,9,10,11,13,34,23,35]))),Wt=l.lazy(()=>C(()=>import("./BodyScan-DwlG9ziW.js"),__vite__mapDeps([36,1,2,3,4,5,6,7,8,9,10,11,37,38,23,35,14,15]))),Mt=l.lazy(()=>C(()=>import("./BodyScanCelebrationWithHeader-D9m2wtM8.js"),__vite__mapDeps([39,1,2,3,4,5,6,7,8,9,10,11,37,38]))),$t=l.lazy(()=>C(()=>import("./BodyScanReviewWithHeader-CYYnyCuS.js"),__vite__mapDeps([40,1,2,3,4,5,6,7,8,9,10,11,37,38,34,23,35]))),Ht=l.lazy(()=>C(()=>import("./ActivityInputPage-CzwlaJis.js"),__vite__mapDeps([41,1,2,3,4,5,6,7,8,9,10,11,17,18,42]))),Vt=l.lazy(()=>C(()=>import("./FastingInputPage-CoaoBC8a.js"),__vite__mapDeps([43,1,2,3,4,5,6,7,8,9,10,11,20]))),Yt=l.lazy(()=>C(()=>import("./FridgeScanPage-BoMqOv4M.js"),__vite__mapDeps([44,1,2,3,4,5,6,7,8,9,10,11]))),Gt=l.lazy(()=>C(()=>import("./VitalPage-BVlktQbt.js"),__vite__mapDeps([45,1,2,3,4,5,6,7,8,9,10,11]))),qt=l.lazy(()=>C(()=>import("./DevCachePage-C8Y_F_o4.js"),__vite__mapDeps([46,1,2,3,4,5,6,7,8,9,10,11]))),Kt=l.lazy(()=>C(()=>import("./LogoGalleryPage-DnX5Vldy.js"),__vite__mapDeps([47,1,2,3,4,5,6,7,8,9,10,11])));function Qt({children:a}){const[t,n]=l.useState(!0),[i,s]=l.useState(!1),[r,u]=l.useState(null),b=l.useRef(!1),{setSession:h,setAuthReady:x}=V();return l.useEffect(()=>{if(b.current)return;b.current=!0,(async()=>{try{o.debug("AUTH","Starting authentication initialization");const{data:{session:p}}=await F.auth.getSession();p?.user?(o.debug("AUTH","Found existing session"),u(p.user),s(!1),h(p),x(!0)):(o.debug("AUTH","No session found, showing auth form"),s(!0),h(null),x(!1))}catch(p){o.error("AUTH","Error during initialization",{error:p}),s(!0),h(null),x(!1)}finally{n(!1)}})();const{data:{subscription:g}}=F.auth.onAuthStateChange((p,d)=>{if(o.debug("AUTH","Auth state changed",{event:p,hasSession:!!d}),p==="SIGNED_OUT"){o.info("AUTH","User signed out, redirecting to auth form"),u(null),s(!0),h(null),x(!1),n(!1);return}d?.user?(u(d.user),s(!1),h(d),x(!0)):(u(null),s(!0),h(null),x(!1)),n(!1)});return()=>g.unsubscribe()},[]),t?e.jsx(E,{title:"Bienvenue sur TwinForge",subtitle:"Vérification de votre session..."}):i?e.jsx(kt,{onSuccess:()=>window.location.href="/"}):e.jsx(e.Fragment,{children:a})}const Zt=je([{path:"/",element:e.jsx(Qt,{children:e.jsx(mt,{})}),children:[{index:!0,element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(It,{})})},{path:"profile",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Tt,{})})},{path:"meals",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Dt,{})})},{path:"meals/scan",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(zt,{})})},{path:"activity",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Ot,{})})},{path:"activity/input",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Ht,{})})},{path:"fasting",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Pt,{})})},{path:"fasting/input",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Vt,{})})},{path:"fridge",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Rt,{})})},{path:"fridge/scan",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Yt,{})})},{path:"training",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Lt,{})})},{path:"settings",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Ft,{})})},{path:"notifications",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Ut,{})})},{path:"avatar",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Bt,{})})},{path:"body-scan",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Wt,{})})},{path:"body-scan/celebration",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Mt,{})})},{path:"body-scan/review",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx($t,{})})},{path:"vital",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Gt,{})})},{path:"dev/cache",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(qt,{})})},{path:"dev/logos",element:e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(Kt,{})})}]}]),Jt=!1,Xt=e.jsx(Nt,{children:e.jsx(Ae,{router:Zt})});Ee(document.getElementById("root")).render(Xt);o.info("APP","React app initialized",{strictMode:Jt,env:"production"});export{ft as E,E as L};
