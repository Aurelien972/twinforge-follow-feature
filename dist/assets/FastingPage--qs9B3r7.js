import{u as K,j as e,c as P,R as D,e as se,cW as ae,r as z,cX as W,cN as re}from"./vendor-BefW7Bxj.js";import{q as ne,G as N,S as j,I as p,P as ie,u as Y,o as oe,m as le,p as E,C as ce}from"./ui-components-lrK_WhZu.js";import{u as de}from"./useScrollMemory-DhxRhvvf.js";import{b as Q,c as xe,d as me,e as ue}from"./page-fridge-scan-C62RDC3k.js";import{a as O,c as ge}from"./stores-Dp3vmZ5-.js";import{u as G,a as k,l as f,s as $}from"./page-fridge-Cp-W9isk.js";import{g as pe,f as he,a as be,e as je,b as fe,F as ve,d as ye,c as Ne}from"./FastingTipsCard-Ma7Pp04F.js";import{h as we,F as J}from"./page-profile-CZR_5_Mb.js";import{m as v,A as Se}from"./motion-BQvLDPOm.js";import{s as H,g as X,f as S,h as q,p as I,j as R,k as Z,a as L,d as Ie}from"./date-utils-BlBdbPk_.js";import"./utils-CUtLAp28.js";import"./supabase-pyFrrmXL.js";import"./forms-BkbsF97i.js";function Ce(t,n,s){return t?{priority:"medium",color:"#EF4444",icon:"Timer",animation:"breathing"}:n?{priority:"medium",color:"#F59E0B",icon:"Timer",animation:"breathing"}:{priority:"high",color:"#F59E0B",icon:"Timer",animation:"pulse"}}function De(t,n,s,a,l){return t?{title:"Session Active",subtitle:`Votre jeûne progresse${l?` - Phase ${l.name}`:""}`,buttonText:"Gérer ma session",encouragement:"Continuez votre excellent travail !"}:n&&s?{title:"Prêt à jeûner",subtitle:`Démarrez votre protocole ${we(s)?.name||s}`,buttonText:"Commencer le jeûne",encouragement:"Votre protocole est configuré et prêt"}:{title:"Forgez votre métabolisme !",subtitle:"Commencez votre première session de jeûne intermittent",buttonText:"Démarrer une session",encouragement:"Maîtrisez votre sèche avec le jeûne"}}function Fe(t,n,s,a){const l=[];if(t){if(n>0){const d=Math.floor(n),i=Math.floor((n-d)*60);l.push(`${d}h ${i}m écoulées`)}s>0&&l.push(`Objectif ${s}h`),a&&l.push(`Phase ${a.name}`)}return l}const _e=({className:t=""})=>{const n=K(),{click:s}=G(),a=ne()==="reduced",{isPerformanceMode:l}=k(),{profile:d}=O(),{isActive:i,session:x}=Q();xe();const r=me(),m=ue(),o=r/3600,u=x?.targetHours||16,b=d?.nutrition?.fastingWindow?.protocol,h=!!(b&&b!==""),c=i?pe(o):null,g=Ce(i,h),y=De(i,h,b,o,c),F=Fe(i,o,u,c),_=l?"div":v.div,B=()=>{s(),n("/fasting/input")},w={background:`
      radial-gradient(circle at 30% 20%, color-mix(in srgb, ${g.color} 12%, transparent) 0%, transparent 60%),
      radial-gradient(circle at 70% 80%, color-mix(in srgb, ${g.color} 8%, transparent) 0%, transparent 50%),
      var(--glass-opacity)
    `,borderColor:`color-mix(in srgb, ${g.color} 25%, transparent)`,boxShadow:l?"0 12px 40px rgba(0, 0, 0, 0.25)":`
        0 12px 40px rgba(0, 0, 0, 0.25),
        0 0 30px color-mix(in srgb, ${g.color} 15%, transparent),
        inset 0 2px 0 rgba(255, 255, 255, 0.15)
      `,backdropFilter:l?"none":"blur(20px) saturate(160%)"},C={background:l?`linear-gradient(135deg, color-mix(in srgb, ${g.color} 35%, transparent), color-mix(in srgb, ${g.color} 25%, transparent))`:`
          radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
          radial-gradient(circle at 70% 70%, color-mix(in srgb, ${g.color} 15%, transparent) 0%, transparent 50%),
          linear-gradient(135deg, color-mix(in srgb, ${g.color} 35%, transparent), color-mix(in srgb, ${g.color} 25%, transparent))
        `,border:`2px solid color-mix(in srgb, ${g.color} 50%, transparent)`,boxShadow:l?"none":`
          0 0 30px color-mix(in srgb, ${g.color} 40%, transparent),
          0 0 60px color-mix(in srgb, ${g.color} 25%, transparent),
          inset 0 2px 0 rgba(255,255,255,0.3)
        `},M={background:`linear-gradient(135deg,
      color-mix(in srgb, ${g.color} 80%, transparent),
      color-mix(in srgb, ${g.color} 60%, transparent)
    )`,border:`2px solid color-mix(in srgb, ${g.color} 60%, transparent)`,boxShadow:l?`0 12px 40px color-mix(in srgb, ${g.color} 40%, transparent)`:`
          0 12px 40px color-mix(in srgb, ${g.color} 40%, transparent),
          0 0 60px color-mix(in srgb, ${g.color} 30%, transparent),
          inset 0 3px 0 rgba(255,255,255,0.4)
        `,backdropFilter:l?"none":"blur(20px) saturate(160%)",color:"#fff",transition:"all 0.2s ease"};return e.jsx("div",{className:`dynamic-fasting-cta w-full ${t}`,children:e.jsxs(N,{className:"p-6 md:p-8 pb-10 md:pb-12 text-center relative overflow-visible cursor-pointer w-full",onClick:B,interactive:!0,style:w,children:[e.jsx("div",{className:"training-hero-corners","aria-hidden":"true",children:[0,1,2,3].map(T=>e.jsx(_,{className:"corner-particle",style:{position:"absolute",width:"12px",height:"12px",borderRadius:"2px",background:`linear-gradient(135deg, ${g.color}, rgba(255, 255, 255, 0.8))`,boxShadow:l?"none":`0 0 20px ${g.color}`,top:T<2?"12px":"auto",bottom:T>=2?"12px":"auto",left:T%2===0?"12px":"auto",right:T%2===1?"12px":"auto",willChange:l?"auto":"transform, opacity"},...!l&&{initial:{rotate:T%2===0?45:-45},animate:{scale:[1,1.3,1],opacity:[.6,1,.6],rotate:T%2===0?[45,60,45]:[-45,-60,-45]},transition:{duration:3,repeat:1/0,delay:T*.2,ease:[.4,0,.2,1]}}},T))}),g.priority==="high"&&!l&&!a&&e.jsx("div",{className:"absolute inset-0 rounded-inherit pointer-events-none urgent-forge-glow-css",style:{background:`radial-gradient(circle at center, color-mix(in srgb, ${g.color} 8%, transparent) 0%, transparent 70%)`,filter:"blur(20px)",transform:"scale(1.2)",zIndex:-1}}),e.jsxs("div",{className:"relative z-10 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:`w-16 h-16 md:w-20 md:h-20 mx-auto rounded-full flex items-center justify-center relative ${!l&&g.animation==="pulse"&&!a?"icon-pulse-css":!l&&g.animation==="breathing"&&!a?"icon-breathing-css":""}`,style:C,children:[e.jsx(j,{Icon:p[g.icon],size:g.priority==="high"?36:32,style:{color:g.color}}),!l&&(g.priority==="high"||i)&&!a&&[...Array(i?4:6)].map((T,A)=>e.jsx("div",{className:`absolute w-2 h-2 rounded-full dynamic-particle-css dynamic-particle-css--${A+1}`,style:{left:`${15+A*15}%`,top:`${15+A%3*25}%`,background:g.color,boxShadow:`0 0 8px color-mix(in srgb, ${g.color} 60%, transparent)`}},A))]}),e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white",children:y.title}),i&&x&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl md:text-6xl font-black mb-2",style:{color:g.color},children:he(r)}),e.jsxs("div",{className:"text-lg md:text-xl text-white/90 font-semibold",children:["Objectif : ",x.targetHours,"h • ",Math.round(m),"% accompli"]})]}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(_,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${g.color}, color-mix(in srgb, ${g.color} 80%, white))`,boxShadow:l?"none":`0 0 12px color-mix(in srgb, ${g.color} 60%, transparent)`,width:`${m}%`},...!l&&{initial:{width:0},animate:{width:`${m}%`},transition:{duration:.8,ease:"easeOut"}},children:!l&&e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg,
                              transparent 0%,
                              rgba(255,255,255,0.4) 50%,
                              transparent 100%
                            )`,animation:"progressShimmer 2s ease-in-out infinite"}})})})})]}),e.jsx("p",{className:"text-white/80 text-base md:text-lg leading-relaxed max-w-md mx-auto",children:i&&c?`Phase ${c.name} • ${c.metabolicState}`:y.subtitle}),y.encouragement&&e.jsx("p",{className:"text-white/60 text-sm italic",children:y.encouragement})]}),F.length>0&&e.jsx("div",{className:"flex flex-wrap items-center justify-center gap-3 text-sm",children:F.map((T,A)=>e.jsx("div",{className:"px-3 py-1.5 rounded-full metric-badge-enter",style:{background:`color-mix(in srgb, ${g.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${g.color} 25%, transparent)`,color:g.color,backdropFilter:l?"none":"blur(8px) saturate(120%)",animationDelay:`${A*.1}s`},children:e.jsx("span",{className:"font-medium",children:T})},A))}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:B,className:`px-6 md:px-8 py-3 md:py-4 text-lg md:text-xl font-bold relative overflow-hidden rounded-full ${!l&&g.animation==="pulse"&&!a?"btn-breathing-css":""}`,style:M,children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(j,{Icon:p[g.icon],size:24,className:"text-white"}),e.jsx("span",{children:y.buttonText})]}),!l&&g.priority==="medium"&&!a&&e.jsx("div",{className:"absolute inset-0 rounded-inherit pointer-events-none dynamic-shimmer-css",style:{background:`linear-gradient(90deg,
                      transparent 0%,
                      rgba(255,255,255,0.3) 50%,
                      transparent 100%
                    )`}})]})}),!i&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("p",{className:"text-white/60 text-sm",children:"Prêt à forger votre métabolisme"})}),i&&c&&x&&e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-3 rounded-xl",style:{background:`color-mix(in srgb, ${c.color} 12%, transparent)`,border:`1px solid color-mix(in srgb, ${c.color} 25%, transparent)`},children:[e.jsxs("div",{className:"text-xl font-bold text-white mb-1",children:[Math.round(be(o,c)),"%"]}),e.jsxs("div",{className:"text-xs font-medium",style:{color:c.color},children:["Phase ",c.name]}),e.jsx("div",{className:"text-white/50 text-xs mt-0.5",children:"Progression"})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl",style:{background:"color-mix(in srgb, #EF4444 12%, transparent)",border:"1px solid color-mix(in srgb, #EF4444 25%, transparent)"},children:[e.jsx("div",{className:"text-xl font-bold text-red-400 mb-1",children:je(c,o,d?.weight_kg||70)}),e.jsx("div",{className:"text-red-300 text-xs font-medium",children:"Calories"}),e.jsx("div",{className:"text-white/50 text-xs mt-0.5",children:"Brûlées"})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-sm font-bold text-white mb-1 truncate",children:c.metabolicState}),e.jsx("div",{className:"text-white/70 text-xs font-medium",children:"État"}),e.jsx("div",{className:"text-white/50 text-xs mt-0.5",children:"Métabolique"})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-sm font-bold text-white mb-1 truncate",children:x.protocol}),e.jsx("div",{className:"text-white/70 text-xs font-medium",children:"Protocole"}),e.jsx("div",{className:"text-white/50 text-xs mt-0.5",children:"Actif"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl",style:{background:`color-mix(in srgb, ${c.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${c.color} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{Icon:p.Heart,size:14,style:{color:c.color}}),e.jsx("span",{className:"text-sm font-semibold",style:{color:c.color},children:"Message de la Forge"})]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed",children:fe(c)})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2 text-sm",children:[e.jsx(j,{Icon:p.Check,size:16,style:{color:c.color}}),"Bénéfices Actuels"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:c.benefits.slice(0,4).map((T,A)=>e.jsxs(_,{className:"flex items-center gap-2 p-2 rounded-lg",style:{background:`color-mix(in srgb, ${c.color} 6%, transparent)`,border:`1px solid color-mix(in srgb, ${c.color} 15%, transparent)`},...!l&&{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4,delay:A*.1}},children:[e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{background:c.color}}),e.jsx("span",{className:"text-white/80 text-xs",children:T})]},A))})]})]})]})]})})};function ke(t){if(t.length===0)return{totalFastedHours:0,sessionsCount:0,averageDuration:0,longestSession:0,consistency:"needs_improvement",motivationalMessage:"Commencez votre première session de jeûne pour forger votre discipline temporelle !"};const n=t.filter(x=>x.status==="completed"&&x.actual_duration_hours),s=n.reduce((x,r)=>x+(r.actual_duration_hours||0),0),a=n.length>0?s/n.length:0,l=Math.max(0,...n.map(x=>x.actual_duration_hours||0));let d="needs_improvement",i="";return s>=16?(d="excellent",i="Excellente discipline ! Votre forge temporelle est parfaitement maîtrisée aujourd'hui."):s>=12?(d="good",i="Bonne progression ! Vous développez une solide discipline temporelle."):s>0?(d="needs_improvement",i="Bon début ! Continuez à forger votre discipline temporelle étape par étape."):i="Prêt à commencer votre forge temporelle ? Chaque session vous rapproche de vos objectifs.",{totalFastedHours:s,sessionsCount:n.length,averageDuration:a,longestSession:l,consistency:d,motivationalMessage:i}}function ee(){const{session:t}=O(),n=t?.user?.id;return P({queryKey:["fasting","today",n],queryFn:async()=>{if(!n)throw new Error("User not authenticated");const s=new Date,a=H(s).toISOString(),l=X(s).toISOString();f.info("FASTING_TODAY_SESSIONS","Fetching today fasting sessions",{userId:n,startDate:a,endDate:l,timestamp:new Date().toISOString()});const{data:d,error:i}=await $.from("fasting_sessions").select("*").eq("user_id",n).gte("start_time",a).lte("start_time",l).order("start_time",{ascending:!1});if(i)throw f.error("FASTING_TODAY_SESSIONS","Failed to fetch today sessions",{error:i.message,userId:n,timestamp:new Date().toISOString()}),i;const x=d||[],r=ke(x);return f.info("FASTING_TODAY_SESSIONS","Today sessions fetched and stats calculated",{userId:n,sessionsCount:x.length,stats:r,timestamp:new Date().toISOString()}),{sessions:x,stats:r}},enabled:!!n,staleTime:2*60*1e3,refetchInterval:5*60*1e3,refetchOnWindowFocus:!0})}function Te(t){switch(t){case"excellent":return{color:"#22C55E",icon:"Check",badge:"Excellent",description:"Discipline temporelle parfaite"};case"good":return{color:"#F59E0B",icon:"Target",badge:"Bien",description:"Bonne progression"};case"needs_improvement":return{color:"#F59E0B",icon:"TrendingUp",badge:"À améliorer",description:"Continuez vos efforts"}}}const Ae=({className:t=""})=>{const{isPerformanceMode:n}=k(),{data:s,isLoading:a,error:l}=ee();if(a)return e.jsx(N,{className:`p-6 ${t}`,children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-48"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-32"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-20 bg-white/10 rounded-xl"}),e.jsx("div",{className:"h-20 bg-white/10 rounded-xl"}),e.jsx("div",{className:"h-20 bg-white/10 rounded-xl"})]})]})});if(l||!s)return e.jsx(N,{className:`p-6 ${t}`,style:{background:"color-mix(in srgb, #EF4444 8%, transparent)",borderColor:"color-mix(in srgb, #EF4444 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(j,{Icon:p.AlertCircle,size:16,className:"text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-300 font-semibold",children:"Erreur de Chargement"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Impossible de charger les données du jour"})]})]})});const{stats:d}=s,i=Te(d.consistency),x=S(new Date,"dd MMMM yyyy"),r=n?"div":v.div;return e.jsx(r,{...!n&&{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:[.25,.1,.25,1]}},className:t,children:e.jsx(N,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i.color} 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #F59E0B 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${i.color} 25%, transparent)`,boxShadow:n?"0 8px 32px rgba(0, 0, 0, 0.3)":`
              0 12px 40px rgba(0, 0, 0, 0.25),
              0 0 30px color-mix(in srgb, ${i.color} 15%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.15)
            `,backdropFilter:n?"none":"blur(20px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${i.color} 35%, transparent), color-mix(in srgb, ${i.color} 25%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${i.color} 50%, transparent)`,boxShadow:n?"none":`0 0 20px color-mix(in srgb, ${i.color} 30%, transparent)`},children:e.jsx(j,{Icon:p[i.icon],size:20,style:{color:i.color}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Dernière Session Forgée"}),e.jsxs("p",{className:"text-white/80 text-sm mt-0.5",children:[x," • ",i.description]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"px-3 py-1.5 rounded-full",style:{background:`color-mix(in srgb, ${i.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${i.color} 25%, transparent)`},children:e.jsx("span",{className:"text-sm font-medium",style:{color:i.color},children:i.badge})})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 12%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 25%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:[d.totalFastedHours.toFixed(1),"h"]}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Temps Total"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Jeûné"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #10B981 12%, transparent)",border:"1px solid color-mix(in srgb, #10B981 25%, transparent)"},children:[e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:d.sessionsCount}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Sessions"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Complétées"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #8B5CF6 12%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 25%, transparent)"},children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:d.averageDuration>0?`${d.averageDuration.toFixed(1)}h`:"--"}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Moyenne"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Durée"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:d.longestSession>0?`${d.longestSession.toFixed(1)}h`:"--"}),e.jsx("div",{className:"text-white/70 text-sm font-medium",children:"Record"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Aujourd'hui"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl",style:{background:`color-mix(in srgb, ${i.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${i.color} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{Icon:p.Lightbulb,size:14,style:{color:i.color}}),e.jsx("span",{className:"text-sm font-semibold",style:{color:i.color},children:"Motivation du Jour"})]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed",children:d.motivationalMessage})]})]})})})},Ee=({onLoadingChange:t})=>{const{profile:n}=O(),{isActive:s,session:a}=Q(),{isPerformanceMode:l}=k(),d=l?"div":v.div;return e.jsxs(d,{...!l&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"}},className:"space-y-6",children:[e.jsx(ie,{profile:n,forgeContext:"fasting"}),e.jsx(_e,{}),!s&&e.jsx(Ae,{}),e.jsx(ve,{})]})};function Oe(t,n,s){const a=[];f.debug("FASTING_INSIGHTS_MIN_DATA_CHECK","Checking minimum data requirements",{profileExists:!!t,sessionsCount:n,periodDays:s,profileData:t?{weight_kg:t.weight_kg,height_cm:t.height_cm,objective:t.objective,activity_level:t.activity_level}:null,minSessionsRequired:s===7?3:s===30?8:20,timestamp:new Date().toISOString()}),t?.weight_kg||a.push("Poids corporel"),t?.height_cm||a.push("Taille"),t?.objective||a.push("Objectif fitness"),t?.activity_level||a.push("Niveau d'activité");const l=s===7?3:s===30?8:20;return n<l&&a.push(`Au moins ${l} sessions de jeûne complétées`),f.debug("FASTING_INSIGHTS_MIN_DATA_RESULT","Minimum data check result",{sufficient:a.length===0,missingDataCount:a.length,missingData:a,minSessionsRequired:l,actualSessions:n,willProceedToEdgeFunction:a.length===0,timestamp:new Date().toISOString()}),{sufficient:a.length===0,missingData:a}}function Me(t=7){const{session:n,profile:s}=O(),a=n?.user?.id;return D.useEffect(()=>{f.debug("FASTING_INSIGHTS_HOOK_INIT","Hook initialized",{userId:a,periodDays:t,hasProfile:!!s,profileKeys:s?Object.keys(s):[],timestamp:new Date().toISOString()})},[a,t,s]),P({queryKey:["fasting","insights","ai",a,t],queryFn:async()=>{if(f.debug("FASTING_INSIGHTS_QUERY_START","Query function started",{userId:a,periodDays:t,timestamp:new Date().toISOString()}),!a)throw f.error("FASTING_INSIGHTS_QUERY_ERROR","User not authenticated",{userId:a,timestamp:new Date().toISOString()}),new Error("User not authenticated");const l=H(q(new Date,t)).toISOString(),d=new Date().toISOString();f.debug("FASTING_INSIGHTS_AI","Starting AI insights generation",{userId:a,periodDays:t,startDate:l,endDate:d,timestamp:new Date().toISOString()});const{data:i,error:x}=await $.from("fasting_sessions").select("id, status").eq("user_id",a).gte("start_time",l).lte("start_time",d);if(x)throw f.error("FASTING_INSIGHTS_AI","Failed to fetch sessions for data check",{error:x.message,userId:a,periodDays:t,timestamp:new Date().toISOString()}),x;const r=i||[],m=r.filter(g=>g.status==="completed").length;f.debug("FASTING_INSIGHTS_SESSIONS_DATA","Sessions fetched for insights",{userId:a,periodDays:t,totalSessions:r.length,completedSessions:m,sessionsData:r.map(g=>({id:g.id,status:g.status,date:g.start_time?g.start_time.split("T")[0]:"invalid"})),startDate:l,endDate:d,timestamp:new Date().toISOString()});const o=Oe(s,m,t);if(f.debug("FASTING_INSIGHTS_DATA_CHECK","Data sufficiency check result",{userId:a,periodDays:t,completedSessionsCount:m,minRequired:t===7?3:t===30?8:20,dataCheckSufficient:o.sufficient,missingData:o.missingData,willProceedToEdgeFunction:o.sufficient,profileData:{hasWeightKg:!!s?.weight_kg,hasHeightCm:!!s?.height_cm,hasObjective:!!s?.objective,hasActivityLevel:!!s?.activity_level},timestamp:new Date().toISOString()}),f.debug("FASTING_INSIGHTS_AI_DATA_CHECK","Data sufficiency check completed",{userId:a,periodDays:t,profileData:{hasWeightKg:!!s?.weight_kg,weightKg:s?.weight_kg,hasHeightCm:!!s?.height_cm,heightCm:s?.height_cm,hasObjective:!!s?.objective,objective:s?.objective,hasActivityLevel:!!s?.activity_level,activityLevel:s?.activity_level,hasEmotions:!!s?.emotions,chronotype:s?.emotions?.chronotype,hasNutrition:!!s?.nutrition,fastingProtocol:s?.nutrition?.fastingWindow?.protocol},sessionsData:{totalSessions:r.length,completedSessions:m,minRequired:t===7?3:t===30?8:15},dataCheckResult:{sufficient:o.sufficient,missingDataCount:o.missingData.length,missingData:o.missingData},timestamp:new Date().toISOString()}),!o.sufficient)return f.warn("FASTING_INSIGHTS_AI","Insufficient data for AI insights generation - returning basic summary",{userId:a,periodDays:t,sessionsCount:m,missingData:o.missingData,willReturnBasicData:!0,timestamp:new Date().toISOString()}),{summary:{overallScore:0,keyFindings:["Données insuffisantes pour l'analyse IA"],mainRecommendation:"Complétez votre profil et ajoutez plus de sessions de jeûne pour débloquer les insights de la Forge Spatiale",sentiment:"encouraging"},insights:[],dataQuality:"insufficient",analysisDate:new Date().toISOString(),periodDays:t,aiModel:"gpt-5-mini",tokensUsed:0,cached:!1,missingData:o.missingData};const u={userId:a,periodDays:t,profile:{weight_kg:s?.weight_kg,height_cm:s?.height_cm,objective:s?.objective,activity_level:s?.activity_level,sex:s?.sex,birthdate:s?.birthdate,emotions:s?.emotions,nutrition:s?.nutrition}};f.debug("FASTING_INSIGHTS_EDGE_CALL_PAYLOAD","About to call Edge Function with payload",{userId:a,periodDays:t,payload:u,payloadSize:JSON.stringify(u).length,timestamp:new Date().toISOString()}),f.debug("FASTING_INSIGHTS_AI_EDGE_CALL","About to call AI insights generator Edge Function",{userId:a,periodDays:t,profileKeys:s?Object.keys(s):[],completedSessionsCount:m,dataCheckPassed:!0,timestamp:new Date().toISOString()}),f.debug("FASTING_INSIGHTS_AI","Calling AI insights generator Edge Function",{userId:a,periodDays:t,profileKeys:s?Object.keys(s):[],timestamp:new Date().toISOString()});const{data:b,error:h}=await $.functions.invoke("fasting-insights-generator",{body:u});if(f.debug("FASTING_INSIGHTS_EDGE_RESPONSE","Edge Function response received",{userId:a,periodDays:t,hasResponse:!!b,hasError:!!h,errorMessage:h?.message,responseKeys:b?Object.keys(b):[],timestamp:new Date().toISOString()}),h)throw f.error("FASTING_INSIGHTS_AI","AI insights generation failed",{error:h.message,userId:a,periodDays:t,timestamp:new Date().toISOString()}),new Error(`AI insights generation failed: ${h.message}`);const c=b;return f.debug("FASTING_INSIGHTS_AI","AI insights generated successfully",{userId:a,periodDays:t,insightsCount:c.insights.length,dataQuality:c.dataQuality,overallScore:c.summary.overallScore,tokensUsed:c.tokensUsed,cached:c.cached,aiModel:c.aiModel,timestamp:new Date().toISOString()}),c},enabled:!!a,staleTime:15*60*1e3,gcTime:30*60*1e3,retry:1,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,structuralSharing:!1})}function $e(t){if(t.length===0)return{totalSessions:0,completedSessions:0,cancelledSessions:0,totalHours:0,averageDuration:0,longestSession:0,shortestSession:0,mostUsedProtocol:null,firstSessionDate:null,lastSessionDate:null};const n=t.filter(h=>h.status==="completed"&&h.actual_duration_hours),s=t.filter(h=>h.status==="cancelled"),a=n.reduce((h,c)=>h+(c.actual_duration_hours||0),0),l=n.length>0?a/n.length:0,d=n.map(h=>h.actual_duration_hours||0).filter(h=>h>0),i=d.length>0?Math.max(...d):0,x=d.length>0?Math.min(...d):0,r={};t.forEach(h=>{h.protocol_id&&(r[h.protocol_id]=(r[h.protocol_id]||0)+1)});const m=Object.entries(r).sort(([,h],[,c])=>c-h)[0]?.[0]||null,o=[...t].sort((h,c)=>new Date(h.start_time).getTime()-new Date(c.start_time).getTime()),u=o[0]?.start_time||null,b=o[o.length-1]?.start_time||null;return{totalSessions:t.length,completedSessions:n.length,cancelledSessions:s.length,totalHours:Math.round(a*10)/10,averageDuration:Math.round(l*10)/10,longestSession:Math.round(i*10)/10,shortestSession:Math.round(x*10)/10,mostUsedProtocol:m,firstSessionDate:u,lastSessionDate:b}}function Re(t,n){let s=[...t];if(n.status&&n.status!=="all"&&(s=s.filter(a=>a.status===n.status)),n.protocol&&(s=s.filter(a=>a.protocol_id===n.protocol)),n.dateRange){const a=H(n.dateRange.start).toISOString(),l=X(n.dateRange.end).toISOString();s=s.filter(d=>d.start_time>=a&&d.start_time<=l)}return n.minDuration!==void 0&&(s=s.filter(a=>a.actual_duration_hours&&a.actual_duration_hours>=n.minDuration)),n.maxDuration!==void 0&&(s=s.filter(a=>a.actual_duration_hours&&a.actual_duration_hours<=n.maxDuration)),s}function te(t=50,n={}){const{session:s}=O(),a=s?.user?.id;return P({queryKey:["fasting","history",a,t,n],queryFn:async()=>{if(!a)throw new Error("User not authenticated");f.debug("FASTING_HISTORY","Fetching fasting history",{userId:a,limit:t,filters:n,timestamp:new Date().toISOString()});let l=$.from("fasting_sessions").select("*").eq("user_id",a).order("start_time",{ascending:!1});t>0&&(l=l.limit(t));const{data:d,error:i}=await l;if(i)throw f.error("FASTING_HISTORY","Failed to fetch fasting history",{error:i.message,userId:a,timestamp:new Date().toISOString()}),i;const x=d||[],r=Re(x,n),m=$e(r);return f.debug("FASTING_HISTORY","History fetched and processed",{userId:a,totalSessions:x.length,filteredSessions:r.length,stats:m,timestamp:new Date().toISOString()}),{sessions:r,allSessions:x,stats:m,filters:n}},enabled:!!a,staleTime:15*60*1e3,cacheTime:30*60*1e3,retry:1,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,structuralSharing:!1})}function Be(){const t=se(),{session:n}=O(),{showToast:s}=Y(),{success:a,error:l}=G();return ae({mutationFn:async d=>{if(!n?.user?.id)throw new Error("User not authenticated");f.info("FASTING_HISTORY","Deleting fasting session",{sessionId:d,userId:n.user.id,timestamp:new Date().toISOString()});const{error:i}=await $.from("fasting_sessions").delete().eq("id",d).eq("user_id",n.user.id);if(i)throw f.error("FASTING_HISTORY","Failed to delete session",{error:i.message,sessionId:d,userId:n.user.id,timestamp:new Date().toISOString()}),i;f.info("FASTING_HISTORY","Session deleted successfully",{sessionId:d,userId:n.user.id,timestamp:new Date().toISOString()})},onSuccess:()=>{t.invalidateQueries({queryKey:["fasting"]}),a(),s({type:"success",title:"Session supprimée",message:"La session de jeûne a été supprimée avec succès",duration:3e3})},onError:d=>{l(),s({type:"error",title:"Erreur de suppression",message:"Impossible de supprimer la session. Réessayez plus tard.",duration:4e3})}})}function Pe(){const{session:t}=O(),n=t?.user?.id;return P({queryKey:["fasting","protocols",n],queryFn:async()=>{if(!n)throw new Error("User not authenticated");const{data:s,error:a}=await $.from("fasting_sessions").select("protocol_id").eq("user_id",n).not("protocol_id","is",null);if(a)throw a;return[...new Set((s||[]).map(d=>d.protocol_id))].filter(Boolean)},enabled:!!n,staleTime:10*60*1e3})}const Ge=t=>{switch(t){case 7:return 3;case 30:return 8;case 90:return 20;default:return 3}};function U(t){switch(t){case 7:return"7 jours";case 30:return"30 jours";case 90:return"90 jours";default:return`${t} jours`}}const ze=({selectedPeriod:t,onPeriodChange:n,availableSessionsCount:s=0,getMinSessionsForPeriod:a=Ge,className:l=""})=>{const{click:d}=G(),{isPerformanceMode:i}=k(),x=[{value:7,label:U(7)},{value:30,label:U(30)},{value:90,label:U(90)}],r=m=>{const o=a(m),u=s>=o;return f.debug("FASTING_PERIOD_SELECTOR","Period availability check",{periodValue:m,availableSessionsCount:s,threshold:o,available:u,calculation:`${s} >= ${o} = ${u}`,timestamp:new Date().toISOString()}),u};return e.jsx("div",{className:`flex justify-center ${l}`,children:e.jsx("div",{className:"inline-flex gap-2 p-1 rounded-lg",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:i?"none":"blur(10px)"},children:x.map(m=>{const o=r(m.value),u=t===m.value,b="#10B981";return e.jsx("button",{onClick:()=>{if(o)d(),n(m.value),f.info("FASTING_PERIOD_SELECTOR","Period changed",{newPeriod:m.value,availableSessionsCount:s,timestamp:new Date().toISOString()});else{const h=a(m.value);f.warn("FASTING_PERIOD_SELECTOR","Attempted to select unavailable period",{period:m.value,availableSessionsCount:s,requiredSessions:h,missingSessions:h-s,timestamp:new Date().toISOString()})}},disabled:!o,className:"px-6 py-2.5 rounded-lg text-sm font-medium",style:{background:u?`${b}33`:"transparent",color:u?b:o?"rgba(255, 255, 255, 0.7)":"rgba(255, 255, 255, 0.4)",border:u?`1px solid ${b}66`:"1px solid transparent",boxShadow:i?"none":u?`0 0 20px ${b}4D`:"none",opacity:o?1:.5,cursor:o?"pointer":"not-allowed",transition:i?"all 0.15s ease":"all 0.2s ease"},children:m.label},m.value)})})})},He=({className:t=""})=>{const{isPerformanceMode:n}=k(),s=n?"div":v.div;return e.jsxs("div",{className:`space-y-6 ${t}`,children:[e.jsx(s,{...!n&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6}},children:e.jsx(N,{className:"p-6 text-center",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 15%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #A855F7 12%, transparent) 0%, transparent 50%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #8B5CF6 30%, transparent)",boxShadow:n?"0 8px 32px rgba(0, 0, 0, 0.3)":`
                0 16px 48px rgba(0, 0, 0, 0.3),
                0 0 40px color-mix(in srgb, #8B5CF6 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.2)
              `,backdropFilter:n?"none":"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(s,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #8B5CF6 40%, transparent), color-mix(in srgb, #A855F7 30%, transparent))
                `,border:"3px solid color-mix(in srgb, #8B5CF6 60%, transparent)",boxShadow:n?"none":"0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent)"},...!n&&{animate:{scale:[1,1.05,1],boxShadow:["0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent)","0 0 60px color-mix(in srgb, #8B5CF6 80%, transparent)","0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}},children:e.jsx(j,{Icon:p.Lightbulb,size:40,style:{color:"#8B5CF6"},className:n?"":"animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Génération IA en Cours"}),e.jsx("p",{className:"text-white/80 text-lg",children:"GPT-5 mini analyse vos patterns de jeûne..."})]}),e.jsx("div",{className:"space-y-2 max-w-md mx-auto",children:["Récupération des sessions de jeûne","Analyse des patterns avec GPT-5 mini","Génération d'insights personnalisés","Mise en cache pour optimisation"].map((a,l)=>e.jsxs(s,{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5",...!n&&{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:l*.2}},children:[e.jsx(s,{className:"w-2 h-2 rounded-full bg-purple-400",...!n&&{animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,delay:l*.3}}}),e.jsx("span",{className:"text-white/70 text-sm",children:a})]},l))})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(s,{...!n&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2}},children:e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-48 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-32 animate-pulse"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-3 bg-white/10 rounded w-full animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-3/4 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-1/2 animate-pulse"})]})]})}),[1,2,3].map(a=>e.jsx(s,{...!n&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3+a*.1}},children:e.jsx(N,{className:"p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 animate-pulse flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-3/4 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-full animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-5/6 animate-pulse"})]}),e.jsx("div",{className:"h-8 bg-white/10 rounded w-32 animate-pulse"})]})]})})},a))]}),e.jsx(s,{...!n&&{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:1}},className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-purple-500/10 border border-purple-400/20",children:[e.jsx(s,{className:"w-2 h-2 rounded-full bg-purple-400",...!n&&{animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1,repeat:1/0}}}),e.jsx("span",{className:"text-purple-300 text-sm font-medium",children:"Génération IA en cours... (~15-45 secondes)"})]})})]})};function qe(t,n){switch(t){case"positive":return{color:"#22C55E",icon:"Check",badge:"Excellent",description:"Performance exceptionnelle"};case"encouraging":return{color:"#F59E0B",icon:"TrendingUp",badge:"En progression",description:"Vous êtes sur la bonne voie"};case"neutral":default:return{color:"#06B6D4",icon:"Target",badge:"Stable",description:"Continuez vos efforts"}}}const Le=({summary:t,periodDays:n,aiModel:s,tokensUsed:a,cached:l,className:d=""})=>{const{isPerformanceMode:i}=k(),x=i?"div":v.div,r=qe(t.sentiment,t.overallScore);return e.jsx(x,{...!i&&{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:[.25,.1,.25,1]}},className:d,children:e.jsx(N,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${r.color} 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, ${r.color} 10%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${r.color} 30%, transparent)`,boxShadow:i?"0 8px 32px rgba(0, 0, 0, 0.3)":`
              0 16px 48px rgba(0, 0, 0, 0.3),
              0 0 40px color-mix(in srgb, ${r.color} 25%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.2)
            `,backdropFilter:i?"none":"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${i?"":"breathing-icon"}`,style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${r.color} 40%, transparent), color-mix(in srgb, ${r.color} 30%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${r.color} 60%, transparent)`,boxShadow:i?"none":`0 0 25px color-mix(in srgb, ${r.color} 50%, transparent)`},children:e.jsx(j,{Icon:p[r.icon],size:20,style:{color:r.color},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Analyse de la Forge Temporelle"}),e.jsxs("p",{className:"text-white/80 text-sm mt-0.5",children:[n," derniers jours • ",r.description]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:r.color,boxShadow:`0 0 8px ${r.color}60`}}),e.jsx("span",{className:"text-white font-bold text-2xl",children:t.overallScore})]}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{background:`color-mix(in srgb, ${r.color} 15%, transparent)`,color:r.color},children:r.badge})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(j,{Icon:p.Search,size:16,style:{color:r.color}}),"Découvertes Clés"]}),e.jsx("div",{className:"space-y-2",children:t.keyFindings.map((m,o)=>e.jsxs(x,{className:"flex items-center gap-3 p-3 rounded-lg",style:{background:`color-mix(in srgb, ${r.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${r.color} 20%, transparent)`},...!i&&{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4,delay:.2+o*.1}},children:[e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{background:r.color}}),e.jsx("span",{className:"text-white/85 text-sm leading-relaxed",children:m})]},o))})]}),e.jsx(x,{className:"p-5 rounded-xl",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${r.color} 12%, transparent) 0%, transparent 60%),
                color-mix(in srgb, ${r.color} 6%, transparent)
              `,border:`2px solid color-mix(in srgb, ${r.color} 25%, transparent)`,boxShadow:i?"0 8px 32px rgba(0, 0, 0, 0.3)":`
                  0 8px 32px rgba(0, 0, 0, 0.2),
                  0 0 20px color-mix(in srgb, ${r.color} 20%, transparent),
                  inset 0 1px 0 rgba(255, 255, 255, 0.15)
                `},...!i&&{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.5}},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:`color-mix(in srgb, ${r.color} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${r.color} 30%, transparent)`},children:e.jsx(j,{Icon:p.Lightbulb,size:14,style:{color:r.color}})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold mb-2",style:{color:r.color},children:"Recommandation Principale"}),e.jsx("p",{className:"text-white/90 text-sm leading-relaxed",children:t.mainRecommendation})]})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs text-white/50 pt-2 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:p.Calendar,size:10}),e.jsxs("span",{children:["Période : ",n," jours"]})]}),s&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:p.Zap,size:10}),e.jsx("span",{children:s})]}),a&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:p.Activity,size:10}),e.jsxs("span",{children:[a," tokens"]})]}),l&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:p.Shield,size:10}),e.jsx("span",{children:"Mis en cache"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:p.Clock,size:10}),e.jsx("span",{children:"Mis à jour maintenant"})]})]})]})})})};function Ue(t){switch(t){case"high":return{borderWidth:"2px",glowIntensity:"25%",backgroundIntensity:"12%"};case"medium":return{borderWidth:"1.5px",glowIntensity:"20%",backgroundIntensity:"10%"};case"low":default:return{borderWidth:"1px",glowIntensity:"15%",backgroundIntensity:"8%"}}}function Ke(t,n){return{pattern:"BarChart3",recommendation:"Lightbulb",achievement:"Check",warning:"AlertTriangle"}[t]||n||"Info"}const Ve=({insight:t,index:n,className:s=""})=>{const{isPerformanceMode:a}=k(),l=a?"div":v.div,d=Ue(t.priority),i=Ke(t.type,t.icon);return e.jsx(l,{...!a&&{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.5,delay:n*.1,ease:[.25,.1,.25,1]}},className:s,children:e.jsxs(N,{className:"p-5 hover:scale-[1.01] transition-transform duration-200",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${t.color} ${d.backgroundIntensity}, transparent) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${t.color} 25%, transparent)`,borderWidth:d.borderWidth,boxShadow:a?"0 8px 32px rgba(0, 0, 0, 0.3)":`
              0 8px 32px rgba(0, 0, 0, 0.2),
              0 0 20px color-mix(in srgb, ${t.color} ${d.glowIntensity}, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.12)
            `,backdropFilter:a?"none":"blur(16px) saturate(150%)"},children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, ${t.color} 35%, transparent), color-mix(in srgb, ${t.color} 25%, transparent))
              `,border:`${d.borderWidth} solid color-mix(in srgb, ${t.color} 50%, transparent)`,boxShadow:a?"none":`0 0 20px color-mix(in srgb, ${t.color} 30%, transparent)`},children:e.jsx(j,{Icon:p[i],size:20,style:{color:t.color},variant:"pure"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-white font-bold text-lg leading-tight",children:t.title}),e.jsx("div",{className:"px-2 py-1 rounded-full flex-shrink-0",style:{background:`color-mix(in srgb, ${t.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${t.color} 25%, transparent)`},children:e.jsx("span",{className:"text-xs font-medium",style:{color:t.color},children:t.priority==="high"?"Priorité":t.priority==="medium"?"Important":"Info"})})]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed mb-4",children:t.content}),t.actionable&&e.jsx(l,{className:"p-3 rounded-lg",style:{background:`color-mix(in srgb, ${t.color} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${t.color} 20%, transparent)`},...!a&&{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2+n*.1}},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(j,{Icon:p.Target,size:12,style:{color:t.color},className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium text-sm mb-1",style:{color:t.color},children:"Action Recommandée"}),e.jsx("p",{className:"text-white/80 text-xs leading-relaxed",children:t.actionable})]})]})})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-3 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{background:t.color}}),e.jsx("span",{className:"text-white/60 text-xs font-medium",children:t.type==="pattern"?"Pattern détecté":t.type==="recommendation"?"Recommandation":t.type==="achievement"?"Accomplissement":"Attention"})]}),e.jsxs("div",{className:"text-white/40 text-xs",children:["Insight #",n+1]})]})]})})},We=t=>{switch(t){case 7:return 3;case 30:return 8;case 90:return 20;default:return 3}},Ye=()=>{const{profile:t}=O(),{showModal:n}=ge(),{showToast:s}=Y(),{isPerformanceMode:a}=k(),l=K(),[d,i]=z.useState(7),x=a?"div":v.div,{data:r}=te(100,{dateRange:{start:new Date(Date.now()-d*24*60*60*1e3),end:new Date}}),m=r?.sessions?.filter(c=>c.status==="completed").length||0,{data:o,isLoading:u,error:b}=Me(d),h=W(({currentLocation:c,nextLocation:g})=>u&&c.pathname!==g.pathname&&!o?.cached);return D.useEffect(()=>{h.state==="blocked"&&n({title:"Quitter la génération IA en cours ?",message:"La Forge Spatiale génère vos insights personnalisés avec GPT-5 mini. Quitter maintenant annulera l'analyse et pourrait engendrer des coûts sans résultat.",processName:"Génération IA",onConfirm:()=>{h.proceed()},onCancel:()=>{h.reset()}})},[h,n]),e.jsxs(x,{...!a&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"}},className:"space-y-6",children:[e.jsx(ze,{selectedPeriod:d,onPeriodChange:i,availableSessionsCount:m,getMinSessionsForPeriod:We}),u&&e.jsx(He,{}),b&&e.jsx(N,{className:"p-6",style:{background:"color-mix(in srgb, #EF4444 8%, transparent)",borderColor:"color-mix(in srgb, #EF4444 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(j,{Icon:p.AlertCircle,size:16,className:"text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-300 font-semibold",children:"Erreur d'Analyse"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Impossible de générer les insights. Réessayez dans quelques instants."})]})]})}),o&&!u&&o.insights.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Le,{summary:o.summary,periodDays:d,aiModel:o.aiModel,tokensUsed:o.tokensUsed,cached:o.cached}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-white font-semibold text-lg flex items-center gap-2",children:[e.jsx(j,{Icon:p.Lightbulb,size:18,className:"text-green-400"}),"Insights Détaillés (",o.insights.length,")"]}),e.jsx("div",{className:"space-y-4",children:o.insights.map((c,g)=>e.jsx(Ve,{insight:c,index:g},c.id))})]})]}),o&&o.insights.length===0&&!u&&e.jsx(N,{className:"p-8 text-center",style:{background:`
            radial-gradient(ellipse at center,
              rgba(16, 185, 129, 0.15) 0%,
              rgba(52, 211, 153, 0.08) 50%,
              rgba(0, 0, 0, 0.4) 100%)
          `,borderColor:"color-mix(in srgb, #10B981 30%, transparent)",boxShadow:`
            0 0 30px rgba(16, 185, 129, 0.2),
            0 8px 32px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1)
          `,backdropFilter:"blur(20px) saturate(1.2)"},children:e.jsxs("div",{className:"space-y-6 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                  rgba(16, 185, 129, 0.3) 0%,
                  rgba(52, 211, 153, 0.15) 70%,
                  transparent 100%)`,border:"1px solid rgba(16, 185, 129, 0.4)",boxShadow:`
                  0 0 25px rgba(16, 185, 129, 0.3),
                  0 4px 20px rgba(0, 0, 0, 0.2),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2)
                `},children:e.jsx(j,{Icon:p.Lightbulb,size:48,className:"text-green-400",style:{filter:`drop-shadow(0 0 12px rgba(16, 185, 129, 0.8))
                           drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3))`}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"Insights en Construction"}),e.jsx("p",{className:"text-white/70 text-lg",children:"Plus de sessions nécessaires pour l'analyse IA"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                      rgba(16, 185, 129, 0.3) 0%,
                      rgba(52, 211, 153, 0.1) 70%,
                      transparent 100%)`,border:"1px solid rgba(16, 185, 129, 0.4)",boxShadow:`
                      0 0 20px rgba(16, 185, 129, 0.3),
                      0 4px 15px rgba(0, 0, 0, 0.2),
                      inset 0 1px 0 rgba(255, 255, 255, 0.2)
                    `},children:e.jsx(j,{Icon:p.Brain,size:24,className:"text-green-400",style:{filter:`drop-shadow(0 0 8px rgba(16, 185, 129, 0.6))
                               drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Analyse IA Personnalisée"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Découvrez vos patterns de jeûne grâce à l'intelligence artificielle"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                      rgba(16, 185, 129, 0.3) 0%,
                      rgba(52, 211, 153, 0.1) 70%,
                      transparent 100%)`,border:"1px solid rgba(16, 185, 129, 0.4)",boxShadow:`
                      0 0 20px rgba(16, 185, 129, 0.3),
                      0 4px 15px rgba(0, 0, 0, 0.2),
                      inset 0 1px 0 rgba(255, 255, 255, 0.2)
                    `},children:e.jsx(j,{Icon:p.TrendingUp,size:24,className:"text-green-400",style:{filter:`drop-shadow(0 0 8px rgba(16, 185, 129, 0.6))
                               drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Recommandations Avancées"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Obtenez des conseils adaptés à vos objectifs et votre métabolisme"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                      rgba(16, 185, 129, 0.3) 0%,
                      rgba(52, 211, 153, 0.1) 70%,
                      transparent 100%)`,border:"1px solid rgba(16, 185, 129, 0.4)",boxShadow:`
                      0 0 20px rgba(16, 185, 129, 0.3),
                      0 4px 15px rgba(0, 0, 0, 0.2),
                      inset 0 1px 0 rgba(255, 255, 255, 0.2)
                    `},children:e.jsx(j,{Icon:p.Target,size:24,className:"text-green-400",style:{filter:`drop-shadow(0 0 8px rgba(16, 185, 129, 0.6))
                               drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Optimisation Continue"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Affinez votre pratique avec des insights évoluant avec vos progrès"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:()=>l("/fasting/input"),className:"group relative px-8 py-4 text-white font-semibold rounded-2xl transform hover:scale-105 transition-all duration-300",style:{background:`linear-gradient(135deg,
                    rgba(16, 185, 129, 0.8) 0%,
                    rgba(52, 211, 153, 0.9) 100%)`,border:"2px solid rgba(16, 185, 129, 0.6)",boxShadow:`
                    0 0 30px rgba(16, 185, 129, 0.4),
                    0 8px 25px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.2)
                  `,backdropFilter:"blur(10px) saturate(1.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{Icon:p.Timer,size:24,className:"group-hover:rotate-12 transition-transform duration-300",style:{color:"white",filter:`drop-shadow(0 0 10px rgba(16, 185, 129, 0.8))
                               drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3))`}}),e.jsx("span",{className:"text-lg",children:"Ajouter des Sessions de Jeûne"})]}),e.jsx("div",{className:"absolute inset-0 rounded-2xl blur-xl opacity-50 group-hover:opacity-75 transition-opacity duration-300 -z-10",style:{background:`linear-gradient(135deg,
                      rgba(16, 185, 129, 0.6) 0%,
                      rgba(52, 211, 153, 0.6) 100%)`}})]})}),e.jsx("div",{className:"text-white/50 text-sm p-3 rounded-xl",style:{background:`radial-gradient(ellipse at center,
                  rgba(16, 185, 129, 0.1) 0%,
                  transparent 70%)`,border:"1px solid rgba(16, 185, 129, 0.2)",boxShadow:"0 0 15px rgba(16, 185, 129, 0.1)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(j,{Icon:p.Info,size:16,className:"text-green-400",style:{filter:"drop-shadow(0 0 6px rgba(16, 185, 129, 0.6))"}}),e.jsx("span",{children:"Plus vous enregistrez de sessions, plus les insights deviennent précis et personnalisés !"})]})})]})})]})};function Qe(t){if(t.length===0)return{totalSessions:0,totalFastedHours:0,averageDuration:0,longestFast:0,bestStreak:0,currentStreak:0,successRate:0,consistencyScore:0};const n=t.filter(c=>c.status==="completed"&&c.actual_duration_hours),s=n.reduce((c,g)=>c+(g.actual_duration_hours||0),0),a=n.length>0?s/n.length:0,l=Math.max(0,...n.map(c=>c.actual_duration_hours||0)),d=n.filter(c=>c.actual_duration_hours&&c.target_hours&&c.actual_duration_hours/c.target_hours>=.9),i=n.length>0?d.length/n.length*100:0,x=n.map(c=>{try{const g=I(c.start_time);return R(g)?S(g,"yyyy-MM-dd"):(f.warn("FASTING_PROGRESSION_METRICS","Invalid date in session",{sessionId:c.id,startTime:c.start_time,timestamp:new Date().toISOString()}),null)}catch(g){return f.error("FASTING_PROGRESSION_METRICS","Date parsing error",{sessionId:c.id,startTime:c.start_time,error:g instanceof Error?g.message:"Unknown error",timestamp:new Date().toISOString()}),null}}).filter(c=>c!==null),r=[...new Set(x)].sort();let m=0,o=0,u=0;for(let c=0;c<r.length;c++)c===0||(()=>{try{const g=I(r[c]),y=I(r[c-1]);return!R(g)||!R(y)?!1:g.getTime()-y.getTime()===24*60*60*1e3}catch{return!1}})()?u++:(o=Math.max(o,u),u=1);o=Math.max(o,u);const b=S(new Date,"yyyy-MM-dd");if(r.includes(b)){m=1;for(let c=r.length-2;c>=0;c--)try{const g=I(r[c+1]),y=I(r[c]);if(!R(g)||!R(y))break;if((g.getTime()-y.getTime())/(24*60*60*1e3)===1)m++;else break}catch{break}}const h=Math.round(i*.7+Math.min(100,r.length/30*100)*.3);return{totalSessions:t.length,totalFastedHours:Math.round(s*10)/10,averageDuration:Math.round(a*10)/10,longestFast:Math.round(l*10)/10,bestStreak:o,currentStreak:m,successRate:Math.round(i),consistencyScore:h}}function Je(t,n){const s=new Date,a=q(s,n-1);return Z({start:a,end:s}).map(d=>{const i=S(d,"yyyy-MM-dd"),x=t.filter(u=>{try{const b=I(u.start_time);return R(b)?S(b,"yyyy-MM-dd")===i&&u.status==="completed":(f.warn("FASTING_PROGRESSION_CONSISTENCY","Invalid session date",{sessionId:u.id,startTime:u.start_time,timestamp:new Date().toISOString()}),!1)}catch(b){return f.error("FASTING_PROGRESSION_CONSISTENCY","Date filtering error",{sessionId:u.id,startTime:u.start_time,error:b instanceof Error?b.message:"Unknown error",timestamp:new Date().toISOString()}),!1}}),r=x.reduce((u,b)=>u+(b.actual_duration_hours||0),0),m=x.length>0?r/x.length:0;let o="none";if(x.length>0){const u=x.reduce((b,h)=>h.actual_duration_hours&&h.target_hours?b+h.actual_duration_hours/h.target_hours:b,0)/x.length;u>=.9?o="success":u>=.5?o="partial":o="missed"}return{date:i,hasFasted:x.length>0,totalHours:Math.round(r*10)/10,sessionsCount:x.length,averageDuration:Math.round(m*10)/10,outcome:o}})}function Xe(t,n){const s=new Date,a=q(s,n-1);return Z({start:a,end:s}).map(d=>{const i=S(d,"yyyy-MM-dd"),x=t.filter(o=>{try{const u=I(o.start_time);return R(u)?S(u,"yyyy-MM-dd")===i&&o.status==="completed":(f.warn("FASTING_PROGRESSION_TRENDS","Invalid session date",{sessionId:o.id,startTime:o.start_time,timestamp:new Date().toISOString()}),!1)}catch(u){return f.error("FASTING_PROGRESSION_TRENDS","Date filtering error",{sessionId:o.id,startTime:o.start_time,error:u instanceof Error?u.message:"Unknown error",timestamp:new Date().toISOString()}),!1}}),r=x.reduce((o,u)=>o+(u.actual_duration_hours||0),0),m=x.length>0?r/x.length:0;return{date:i,averageDuration:Math.round(m*10)/10,sessionsCount:x.length,totalHours:Math.round(r*10)/10}})}function Ze(t,n,s){const a=[];f.debug("FASTING_PROGRESSION_AI_DATA_CHECK_DETAILED","Checking minimum data requirements with full details",{profileExists:!!t,sessionsCount:n,periodDays:s,profileData:t?{weight_kg:t.weight_kg,height_cm:t.height_cm,objective:t.objective,activity_level:t.activity_level,sex:t.sex,hasEmotions:!!t.emotions,hasNutrition:!!t.nutrition}:null,timestamp:new Date().toISOString()}),t?.weight_kg||a.push("Poids corporel"),t?.height_cm||a.push("Taille"),t?.objective||a.push("Objectif fitness"),t?.activity_level||a.push("Niveau d'activité");const l=s===7?5:s===30?12:20;return n<l&&a.push(`Au moins ${l} sessions pour l'analyse IA`),f.debug("FASTING_PROGRESSION_AI_DATA_CHECK_RESULT","Minimum data check result (NO BYPASS)",{sufficient:a.length===0,missingDataCount:a.length,missingData:a,minSessionsRequired:l,actualSessions:n,willCallEdgeFunction:a.length===0,timestamp:new Date().toISOString()}),{sufficient:a.length===0,missingData:a}}function et(t=30){const{session:n,profile:s}=O(),a=n?.user?.id;return D.useEffect(()=>{f.debug("FASTING_PROGRESSION_HOOK_INIT","Hook initialized",{userId:a,periodDays:t,hasProfile:!!s,timestamp:new Date().toISOString()})},[a,t,s]),P({queryKey:["fasting","progression",a,t],queryFn:async()=>{if(f.debug("FASTING_PROGRESSION_QUERY_START","Query function started",{userId:a,periodDays:t,timestamp:new Date().toISOString()}),!a)throw f.error("FASTING_PROGRESSION_QUERY_ERROR","User not authenticated",{userId:a,timestamp:new Date().toISOString()}),new Error("User not authenticated");const l=H(q(new Date,t)).toISOString(),d=new Date().toISOString();f.debug("FASTING_PROGRESSION","Fetching progression data",{userId:a,periodDays:t,startDate:l,endDate:d,timestamp:new Date().toISOString()});const{data:i,error:x}=await $.from("fasting_sessions").select("*").eq("user_id",a).gte("start_time",l).lte("start_time",d).order("start_time",{ascending:!0});if(x)throw f.error("FASTING_PROGRESSION","Failed to fetch progression data",{error:x.message,userId:a,periodDays:t,timestamp:new Date().toISOString()}),x;const r=i||[];f.debug("FASTING_PROGRESSION_SESSIONS_DATA_DETAILED","Sessions fetched for progression with full details",{userId:a,periodDays:t,totalSessions:r.length,completedSessions:r.filter(w=>w.status==="completed").length,startDate:l,endDate:d,sessionsData:r.map(w=>({id:w.id,start_time:w.start_time,status:w.status,target_hours:w.target_hours,actual_duration_hours:w.actual_duration_hours,protocol_id:w.protocol_id})),timestamp:new Date().toISOString()});const m=Qe(r),o=Je(r,t),u=Xe(r,t);f.debug("FASTING_PROGRESSION_METRICS_CALCULATED","Metrics calculated from sessions",{userId:a,periodDays:t,metrics:{totalSessions:m.totalSessions,totalFastedHours:m.totalFastedHours,averageDuration:m.averageDuration,successRate:m.successRate,consistencyScore:m.consistencyScore},timestamp:new Date().toISOString()});let b="insufficient";const h=r.filter(w=>w.status==="completed");h.length>=20?b="excellent":h.length>=10?b="good":h.length>=3&&(b="limited");const c=Ze(s,h.length,t);f.debug("FASTING_PROGRESSION_AI_DATA_CHECK_FINAL","AI data check result with bypass state",{userId:a,periodDays:t,completedSessions:h.length,aiDataCheckSufficient:c.sufficient,missingData:c.missingData,willProceedToEdgeFunction:c.sufficient,profileData:{hasWeightKg:!!s?.weight_kg,hasHeightCm:!!s?.height_cm,hasObjective:!!s?.objective,hasActivityLevel:!!s?.activity_level},timestamp:new Date().toISOString()});let g,y,F,_;if(c.sufficient)try{const w={userId:a,periodDays:t,profile:{weight_kg:s?.weight_kg,height_cm:s?.height_cm,objective:s?.objective,activity_level:s?.activity_level,sex:s?.sex,birthdate:s?.birthdate,emotions:s?.emotions,nutrition:s?.nutrition}};f.debug("FASTING_PROGRESSION_EDGE_CALL_PAYLOAD_DETAILED","About to call Edge Function with full payload",{userId:a,periodDays:t,profileComplete:{hasWeightKg:!!s?.weight_kg,weightKg:s?.weight_kg,hasHeightCm:!!s?.height_cm,heightCm:s?.height_cm,hasObjective:!!s?.objective,objective:s?.objective,hasActivityLevel:!!s?.activity_level,activityLevel:s?.activity_level,hasSex:!!s?.sex,sex:s?.sex},payloadSize:JSON.stringify(w).length,timestamp:new Date().toISOString()}),f.debug("FASTING_PROGRESSION_AI","Calling AI progression analyzer Edge Function",{userId:a,periodDays:t,completedSessions:h.length,profileKeys:s?Object.keys(s):[],edgeFunctionName:"fasting-progression-analyzer",timestamp:new Date().toISOString()});const{data:C,error:M}=await $.functions.invoke("fasting-progression-analyzer",{body:w});f.debug("FASTING_PROGRESSION_EDGE_RESPONSE","Edge Function response received",{userId:a,periodDays:t,hasResponse:!!C,hasError:!!M,errorMessage:M?.message,errorDetails:M?.details,responseKeys:C?Object.keys(C):[],responseType:typeof C,edgeFunctionCallCompleted:!0,timestamp:new Date().toISOString()}),M?f.error("FASTING_PROGRESSION_AI","AI progression analysis failed",{error:M.message,errorDetails:M.details,errorCode:M.code,userId:a,periodDays:t,timestamp:new Date().toISOString()}):(C&&typeof C=="object"?(g=C.aiAnalysis,y=C.aiModel,F=C.tokensUsed,_=C.cached,f.debug("FASTING_PROGRESSION_AI_SUCCESS","AI analysis extracted from response",{userId:a,periodDays:t,hasAiAnalysis:!!g,aiModel:y,tokensUsed:F,cached:_,timestamp:new Date().toISOString()})):f.warn("FASTING_PROGRESSION_AI","Invalid AI response format",{userId:a,periodDays:t,responseType:typeof C,responseValue:C,timestamp:new Date().toISOString()}),f.debug("FASTING_PROGRESSION_AI","AI progression analysis completed",{userId:a,periodDays:t,tokensUsed:F,cached:_,aiModel:y,timestamp:new Date().toISOString()}))}catch(w){f.error("FASTING_PROGRESSION_AI","AI progression analysis exception",{error:w instanceof Error?w.message:"Unknown error",errorStack:w instanceof Error?w.stack:void 0,userId:a,periodDays:t,timestamp:new Date().toISOString()})}else f.warn("FASTING_PROGRESSION_AI","Insufficient data for AI progression analysis - showing local metrics only",{userId:a,periodDays:t,completedSessions:h.length,missingData:c.missingData,aiDataCheckSufficient:c.sufficient,reasonForSkipping:"aiDataCheck.sufficient === false",willShowLocalMetrics:!0,localMetricsAvailable:m.totalSessions>0,timestamp:new Date().toISOString()});f.debug("FASTING_PROGRESSION_METRICS_CALCULATED","Metrics calculated",{userId:a,periodDays:t,metrics:{totalSessions:m.totalSessions,totalFastedHours:m.totalFastedHours,averageDuration:m.averageDuration,successRate:m.successRate,consistencyScore:m.consistencyScore},timestamp:new Date().toISOString()});const B={metrics:m,aiAnalysis:g,consistencyData:o,durationTrends:u,heatmapData:o,dataQuality:b,analysisDate:new Date().toISOString(),periodDays:t,aiModel:y,tokensUsed:F,cached:_};return f.debug("FASTING_PROGRESSION_FINAL","Progression data ready - metrics available",{userId:a,periodDays:t,hasMetrics:!!m,metricsSessionsCount:m.totalSessions,metricsTotalHours:m.totalFastedHours,metricsAvgDuration:m.averageDuration,metricsConsistencyScore:m.consistencyScore,hasAiAnalysis:!!g,dataQuality:b,willDisplayLocalMetrics:m.totalSessions>0,metricsKeys:Object.keys(m),consistencyDataLength:o.length,timestamp:new Date().toISOString()}),f.debug("FASTING_PROGRESSION_AI_DATA_CHECK","AI data check result",{periodDays:t,totalSessions:r.length,completedSessions:h.length,willProceedToEdgeFunction:c.sufficient,dataQuality:b,metrics:{totalFastedHours:m.totalFastedHours,successRate:m.successRate,currentStreak:m.currentStreak},hasAiAnalysis:!!g,aiModel:y,tokensUsed:F,cached:_,timestamp:new Date().toISOString()}),B},enabled:!!a,staleTime:15*60*1e3,gcTime:30*60*1e3,retry:1,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,structuralSharing:!1})}const tt=({className:t=""})=>e.jsxs("div",{className:`space-y-6 ${t}`,children:[e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsx(N,{className:"p-6 text-center",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 15%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #3B82F6 12%, transparent) 0%, transparent 50%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #06B6D4 30%, transparent)",boxShadow:`
              0 16px 48px rgba(0, 0, 0, 0.3),
              0 0 40px color-mix(in srgb, #06B6D4 25%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.2)
            `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v.div,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #06B6D4 40%, transparent), color-mix(in srgb, #3B82F6 30%, transparent))
                `,border:"3px solid color-mix(in srgb, #06B6D4 60%, transparent)",boxShadow:`
                  0 0 40px color-mix(in srgb, #06B6D4 60%, transparent),
                  0 0 80px color-mix(in srgb, #06B6D4 40%, transparent)
                `},animate:{scale:[1,1.05,1],boxShadow:["0 0 40px color-mix(in srgb, #06B6D4 60%, transparent)","0 0 60px color-mix(in srgb, #06B6D4 80%, transparent)","0 0 40px color-mix(in srgb, #06B6D4 60%, transparent)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(j,{Icon:p.BarChart3,size:40,style:{color:"#06B6D4"},className:"animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Analyse IA de Progression"}),e.jsx("p",{className:"text-white/80 text-lg",children:"GPT-5 mini analyse vos données de progression..."})]}),e.jsx("div",{className:"space-y-2 max-w-md mx-auto",children:["Collecte des sessions de jeûne","Calcul des métriques de progression","Analyse narrative avec GPT-5 mini","Génération des recommandations IA"].map((n,s)=>e.jsxs(v.div,{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:s*.2},children:[e.jsx(v.div,{className:"w-2 h-2 rounded-full bg-cyan-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,delay:s*.3}}),e.jsx("span",{className:"text-white/70 text-sm",children:n})]},s))})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 bg-white/10 rounded w-48 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-32 animate-pulse"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[1,2,3,4].map(n=>e.jsxs("div",{className:"text-center p-4 rounded-xl bg-white/5",children:[e.jsx("div",{className:"h-8 bg-white/10 rounded w-16 mx-auto mb-2 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-20 mx-auto animate-pulse"})]},n))}),e.jsx("div",{className:"h-20 bg-white/10 rounded-xl animate-pulse"})]})}),[1,2].map(n=>e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3+n*.1},children:e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-40 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-24 animate-pulse"})]})]}),e.jsx("div",{className:"h-32 bg-white/10 rounded-xl animate-pulse mb-4"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[1,2,3,4].map(s=>e.jsx("div",{className:"h-3 bg-white/10 rounded animate-pulse"},s))})]})},n))]}),e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:1},className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-cyan-500/10 border border-cyan-400/20",children:[e.jsx(v.div,{className:"w-2 h-2 rounded-full bg-cyan-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1,repeat:1/0}}),e.jsx("span",{className:"text-cyan-300 text-sm font-medium",children:"Analyse IA en cours... (~20-60 secondes)"})]})})]});function st(t){return t>=80?{color:"#22C55E",icon:"Check",badge:"Excellent",description:"Performance exceptionnelle"}:t>=60?{color:"#F59E0B",icon:"TrendingUp",badge:"Bien",description:"Bonne progression"}:t>=40?{color:"#06B6D4",icon:"Target",badge:"Modéré",description:"En développement"}:{color:"#10B981",icon:"Timer",badge:"Débutant",description:"Commencez votre forge"}}const at=({metrics:t,periodDays:n,aiAnalysis:s,aiModel:a,tokensUsed:l,cached:d,className:i=""})=>{const{isPerformanceMode:x}=k();x||v.div;const r=st(t.consistencyScore);return e.jsx(v.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:[.25,.1,.25,1]},className:i,children:e.jsx(N,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${r.color} 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, ${r.color} 10%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${r.color} 30%, transparent)`,boxShadow:`
            0 16px 48px rgba(0, 0, 0, 0.3),
            0 0 40px color-mix(in srgb, ${r.color} 25%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.2)
          `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center breathing-icon",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${r.color} 40%, transparent), color-mix(in srgb, ${r.color} 30%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${r.color} 60%, transparent)`,boxShadow:`0 0 25px color-mix(in srgb, ${r.color} 50%, transparent)`},children:e.jsx(j,{Icon:p[r.icon],size:20,style:{color:r.color},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Progression Temporelle"}),e.jsxs("p",{className:"text-white/80 text-sm mt-0.5",children:[n," derniers jours • ",r.description]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:r.color,boxShadow:`0 0 8px ${r.color}60`}}),e.jsx("span",{className:"text-white font-bold text-2xl",children:t.consistencyScore})]}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{background:`color-mix(in srgb, ${r.color} 15%, transparent)`,color:r.color},children:r.badge})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(v.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 10%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1},children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:t.totalSessions}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Sessions"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Total"})]}),e.jsxs(v.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 10%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:[t.totalFastedHours,"h"]}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Temps Total"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Jeûné"})]}),e.jsxs(v.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #10B981 10%, transparent)",border:"1px solid color-mix(in srgb, #10B981 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.3},children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400 mb-1",children:[t.averageDuration,"h"]}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Moyenne"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Durée"})]}),e.jsxs(v.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #EF4444 10%, transparent)",border:"1px solid color-mix(in srgb, #EF4444 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.4},children:[e.jsxs("div",{className:"text-2xl font-bold text-red-400 mb-1",children:[t.longestFast,"h"]}),e.jsx("div",{className:"text-red-300 text-sm font-medium",children:"Record"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Personnel"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(v.div,{className:"p-4 rounded-xl",style:{background:`color-mix(in srgb, ${r.color} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${r.color} 20%, transparent)`},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`color-mix(in srgb, ${r.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${r.color} 25%, transparent)`},children:e.jsx(j,{Icon:p.Zap,size:16,style:{color:r.color}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t.currentStreak}),e.jsx("div",{className:"text-white/70 text-sm",children:"Série Actuelle"}),e.jsx("div",{className:"text-white/50 text-xs",children:"Jours consécutifs"})]})]})}),e.jsx(v.div,{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, #10B981 10%, transparent)",border:"1px solid color-mix(in srgb, #10B981 20%, transparent)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #10B981 15%, transparent)",border:"1px solid color-mix(in srgb, #10B981 25%, transparent)"},children:e.jsx(j,{Icon:p.Star,size:16,style:{color:"#10B981"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t.bestStreak}),e.jsx("div",{className:"text-white/70 text-sm",children:"Meilleure Série"}),e.jsx("div",{className:"text-white/50 text-xs",children:"Record personnel"})]})]})}),e.jsx(v.div,{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.7},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #22C55E 15%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 25%, transparent)"},children:e.jsx(j,{Icon:p.Target,size:16,style:{color:"#22C55E"}})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[t.successRate,"%"]}),e.jsx("div",{className:"text-white/70 text-sm",children:"Taux de Succès"}),e.jsx("div",{className:"text-white/50 text-xs",children:"Objectifs atteints"})]})]})})]}),e.jsxs(v.div,{className:"p-5 rounded-xl text-center",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${r.color} 12%, transparent) 0%, transparent 60%),
                color-mix(in srgb, ${r.color} 6%, transparent)
              `,border:`2px solid color-mix(in srgb, ${r.color} 25%, transparent)`,boxShadow:`
                0 8px 32px rgba(0, 0, 0, 0.2),
                0 0 20px color-mix(in srgb, ${r.color} 20%, transparent),
                inset 0 1px 0 rgba(255, 255, 255, 0.15)
              `},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.8},children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx(j,{Icon:p.Lightbulb,size:18,style:{color:r.color}}),e.jsx("h4",{className:"font-bold text-lg",style:{color:r.color},children:s?"Analyse IA de Performance":"Analyse de Performance"})]}),e.jsx("p",{className:"text-white/90 text-base leading-relaxed mb-4",children:s?s.motivationalMessage:t.consistencyScore>=80?`Excellente maîtrise ! Vous avez forgé une discipline temporelle remarquable avec ${t.totalSessions} sessions et ${t.totalFastedHours}h de jeûne total.`:t.consistencyScore>=60?`Bonne progression ! Votre régularité s'améliore avec ${t.currentStreak} jours de série actuelle. Continuez sur cette lancée.`:t.consistencyScore>=40?`Développement en cours. Votre record personnel est de ${t.longestFast}h. Visez la régularité pour optimiser les bénéfices.`:`Début de votre forge temporelle ! Chaque session compte. Votre meilleure série est de ${t.bestStreak} jours.`}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full",style:{background:`color-mix(in srgb, ${r.color} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${r.color} 20%, transparent)`},children:[e.jsx(j,{Icon:p.Target,size:14,style:{color:r.color}}),e.jsx("span",{className:"text-sm font-medium",style:{color:r.color},children:s?s.nextMilestone:t.currentStreak===0?"Objectif : Commencer une série":t.currentStreak<7?`Objectif : Atteindre 7 jours (${7-t.currentStreak} restants)`:t.bestStreak<14?"Objectif : Série de 14 jours":"Objectif : Maintenir l'excellence"})]})]}),s&&e.jsxs(v.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:1},children:[e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("h5",{className:"text-white font-semibold mb-2 flex items-center gap-2",children:[e.jsx(j,{Icon:p.FileText,size:14,className:"text-cyan-400"}),"Résumé Narratif IA"]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed",children:s.narrativeSummary})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("h5",{className:"text-white font-semibold mb-2 flex items-center gap-2",children:[e.jsx(j,{Icon:p.TrendingUp,size:14,className:"text-green-400"}),"Analyse de Tendances"]}),e.jsx("p",{className:"text-white/85 text-sm leading-relaxed",children:s.trendAnalysis})]}),s.strategicRecommendations.length>0&&e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("h5",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(j,{Icon:p.Target,size:14,className:"text-green-400"}),"Recommandations Stratégiques IA"]}),e.jsx("div",{className:"space-y-2",children:s.strategicRecommendations.map((m,o)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mt-2 flex-shrink-0"}),e.jsx("span",{className:"text-white/85 text-sm leading-relaxed",children:m})]},o))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-white/80 font-medium text-sm flex items-center gap-2",children:[e.jsx(j,{Icon:p.Clock,size:14,className:"text-cyan-400"}),"Métriques Temporelles"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Temps total jeûné"}),e.jsxs("span",{className:"text-white font-medium",children:[t.totalFastedHours,"h"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Durée moyenne"}),e.jsxs("span",{className:"text-white font-medium",children:[t.averageDuration,"h"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Record personnel"}),e.jsxs("span",{className:"text-white font-medium",children:[t.longestFast,"h"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-white/80 font-medium text-sm flex items-center gap-2",children:[e.jsx(j,{Icon:p.TrendingUp,size:14,className:"text-green-400"}),"Performance"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Taux de succès"}),e.jsxs("span",{className:"text-white font-medium",children:[t.successRate,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Série actuelle"}),e.jsxs("span",{className:"text-white font-medium",children:[t.currentStreak," jours"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-white/5",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Meilleure série"}),e.jsxs("span",{className:"text-white font-medium",children:[t.bestStreak," jours"]})]})]})]})]}),(a||l||d!==void 0)&&e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs text-white/50 pt-2 border-t border-white/10",children:[a&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:p.Zap,size:10}),e.jsx("span",{children:a})]}),l&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:p.Activity,size:10}),e.jsxs("span",{children:[l," tokens"]})]}),d&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:p.Shield,size:10}),e.jsx("span",{children:"Résultat mis en cache"})]})]})]})})})};function rt(t){switch(t){case"success":return"#22C55E";case"partial":return"#F59E0B";case"missed":return"#EF4444";case"none":return"rgba(255, 255, 255, 0.1)"}}function V(t){switch(t){case"success":return"Succès";case"partial":return"Partiel";case"missed":return"Manqué";case"none":return"Aucun jeûne"}}const nt=({data:t,periodDays:n,className:s=""})=>{const{isPerformanceMode:a}=k(),l=a?"div":v.div,d=D.useMemo(()=>{if(n<14)return null;const x=[];for(let r=0;r<t.length;r+=7){const m=t.slice(r,r+7),o=m.reduce((c,g)=>c+g.sessionsCount,0),u=m.reduce((c,g)=>c+g.totalHours,0),h=m.filter(c=>c.outcome==="success").length/7*100;x.push({weekStart:m[0]?.date||"",weekEnd:m[m.length-1]?.date||"",sessionsCount:o,totalHours:Math.round(u*10)/10,successRate:Math.round(h)})}return x},[t,n]),i=D.useMemo(()=>{const x=t.length,r=t.filter(u=>u.hasFasted).length,m=t.filter(u=>u.outcome==="success").length,o=t.filter(u=>u.outcome==="partial").length;return{totalDays:x,fastedDays:r,successfulDays:m,partialDays:o,consistencyRate:x>0?Math.round(r/x*100):0,successRate:r>0?Math.round(m/r*100):0}},[t]);return e.jsx(l,{...!a&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6}},className:s,children:e.jsx(N,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #3B82F6 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #06B6D4 25%, transparent)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #06B6D4 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `,backdropFilter:a?"none":"blur(20px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #06B6D4 35%, transparent), color-mix(in srgb, #06B6D4 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #06B6D4 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #06B6D4 30%, transparent)"},children:e.jsx(j,{Icon:p.BarChart3,size:20,style:{color:"#06B6D4"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Régularité du Jeûne"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[n," derniers jours • ",i.fastedDays,"/",i.totalDays," jours avec jeûne"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-cyan-400"}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[i.consistencyRate,"%"]})]}),e.jsx("div",{className:"text-cyan-300 text-xs",children:"Régularité"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(j,{Icon:p.Calendar,size:16,className:"text-cyan-400"}),"Consistance Quotidienne"]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-4",children:t.slice(-49).map((x,r)=>{const m=rt(x.outcome),o=x.outcome==="none"?.3:.8;return e.jsxs(l,{className:"aspect-square rounded-lg flex items-center justify-center relative group cursor-pointer",style:{backgroundColor:m,opacity:o},...!a&&{initial:{scale:0,opacity:0},animate:{scale:1,opacity:o},transition:{duration:.3,delay:r*.02}},title:`${S(I(x.date),"dd/MM")} - ${V(x.outcome)} ${x.totalHours>0?`(${x.totalHours}h)`:""}`,children:[x.sessionsCount>0&&e.jsx("span",{className:"text-white text-xs font-bold",children:x.sessionsCount}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black/80 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10",children:[S(I(x.date),"dd MMM")," - ",V(x.outcome),x.totalHours>0&&` (${x.totalHours}h)`]})]},x.date)})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-500"}),e.jsx("span",{className:"text-green-300",children:"Succès"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-orange-500"}),e.jsx("span",{className:"text-orange-300",children:"Partiel"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-red-500"}),e.jsx("span",{className:"text-red-300",children:"Manqué"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-white/20"}),e.jsx("span",{className:"text-white/60",children:"Aucun"})]})]})]}),d&&d.length>1&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(j,{Icon:p.CalendarRange,size:16,className:"text-cyan-400"}),"Résumé Hebdomadaire"]}),e.jsx("div",{className:"space-y-2",children:d.slice(-4).map((x,r)=>e.jsxs(l,{className:"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/10",...!a&&{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:r*.1}},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-white font-medium text-sm",children:["Semaine du ",S(I(x.weekStart),"dd MMM")]}),e.jsxs("div",{className:"text-white/60 text-xs",children:[x.sessionsCount," sessions • ",x.totalHours,"h total"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:x.successRate>=70?"color-mix(in srgb, #22C55E 15%, transparent)":x.successRate>=40?"color-mix(in srgb, #F59E0B 15%, transparent)":"color-mix(in srgb, #EF4444 15%, transparent)",color:x.successRate>=70?"#22C55E":x.successRate>=40?"#F59E0B":"#EF4444"},children:[x.successRate,"% succès"]})})]},x.weekStart))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)"},children:[e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:i.successfulDays}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Jours Réussis"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 10%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},children:[e.jsx("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:i.partialDays}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Jours Partiels"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #06B6D4 10%, transparent)",border:"1px solid color-mix(in srgb, #06B6D4 20%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-cyan-400 mb-1",children:[i.consistencyRate,"%"]}),e.jsx("div",{className:"text-cyan-300 text-sm font-medium",children:"Régularité"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:[i.successRate,"%"]}),e.jsx("div",{className:"text-white/70 text-sm font-medium",children:"Taux Succès"})]})]})]})})})},it=({sessions:t,periodDays:n,className:s=""})=>{const{isPerformanceMode:a}=k(),l=a?"div":v.div,d=D.useMemo(()=>{if(!t||t.length===0)return[];const o=[...t].filter(h=>h.status==="completed").sort((h,c)=>new Date(h.start_time).getTime()-new Date(c.start_time).getTime()),u=[];let b=null;return o.forEach((h,c)=>{const g=S(I(h.start_time),"yyyy-MM-dd");if(b?Ie(I(g),I(b.endDate))===1?(b.endDate=g,b.length+=1):(b.status="completed",u.push(b),b={startDate:g,endDate:g,length:1,status:"active"}):b={startDate:g,endDate:g,length:1,status:"active"},c===o.length-1&&b){const y=S(new Date,"yyyy-MM-dd"),F=S(new Date(Date.now()-864e5),"yyyy-MM-dd");b.endDate===y||b.endDate===F?b.status="active":b.status="completed",u.push(b)}}),u.sort((h,c)=>c.length-h.length)},[t]);if(d.length===0)return e.jsx(N,{className:`p-6 text-center ${s}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(j,{Icon:p.Flame,size:32,className:"text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Aucune Série Détectée"}),e.jsx("p",{className:"text-white/70",children:"Complétez des sessions de jeûne consécutives pour créer des séries"})]})]})});const i=d.find(o=>o.status==="active"),x=d[0],r=d.length,m=d.reduce((o,u)=>o+u.length,0)/r;return e.jsx(l,{...!a&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3}},className:s,children:e.jsx(N,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #EC4899 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #8B5CF6 25%, transparent)",boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, #8B5CF6 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `,backdropFilter:a?"none":"blur(20px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #8B5CF6 35%, transparent), color-mix(in srgb, #EC4899 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #8B5CF6 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #8B5CF6 30%, transparent)"},children:e.jsx(j,{Icon:p.Flame,size:20,style:{color:"#8B5CF6"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Séries de Jeûne"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[r," série",r>1?"s":""," détectée",r>1?"s":""]})]})]}),i&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"px-3 py-1.5 rounded-full mb-1",style:{background:"color-mix(in srgb, #22C55E 15%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 25%, transparent)"},children:e.jsx("span",{className:"text-sm font-medium text-green-300",children:"🔥 Série active"})}),e.jsx("p",{className:"text-2xl font-bold text-white",children:i.length}),e.jsxs("p",{className:"text-white/60 text-xs",children:["jour",i.length>1?"s":""]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"color-mix(in srgb, #F59E0B 10%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},children:[e.jsx("div",{className:"text-3xl font-bold text-orange-400 mb-1",children:x.length}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Record"}),e.jsx("div",{className:"text-orange-200 text-xs mt-1",children:S(I(x.startDate),"dd MMM",{locale:L})})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"color-mix(in srgb, #8B5CF6 10%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 20%, transparent)"},children:[e.jsx("div",{className:"text-3xl font-bold text-purple-400 mb-1",children:m.toFixed(1)}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Moyenne"}),e.jsx("div",{className:"text-purple-200 text-xs mt-1",children:"par série"})]}),e.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:"color-mix(in srgb, #EC4899 10%, transparent)",border:"1px solid color-mix(in srgb, #EC4899 20%, transparent)"},children:[e.jsx("div",{className:"text-3xl font-bold text-pink-400 mb-1",children:r}),e.jsx("div",{className:"text-pink-300 text-sm font-medium",children:"Séries"}),e.jsx("div",{className:"text-pink-200 text-xs mt-1",children:"au total"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(j,{Icon:p.TrendingUp,size:16,className:"text-purple-400"}),"Top 5 des Séries"]}),e.jsx("div",{className:"space-y-3",children:d.slice(0,5).map((o,u)=>{const b=o.status==="active",h=o===x;return e.jsx(l,{className:"relative p-4 rounded-xl",style:{background:b?"color-mix(in srgb, #22C55E 8%, transparent)":"rgba(255, 255, 255, 0.03)",border:b?"1px solid color-mix(in srgb, #22C55E 20%, transparent)":"1px solid rgba(255, 255, 255, 0.05)"},...!a&&{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:u*.1}},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:b?"linear-gradient(135deg, #22C55E, #10B981)":h?"linear-gradient(135deg, #F59E0B, #EF4444)":"linear-gradient(135deg, #8B5CF6, #EC4899)",boxShadow:b||h?`0 0 12px ${b?"#22C55E":"#F59E0B"}80`:"none"},children:e.jsx("span",{className:"text-white font-bold text-lg",children:u+1})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-white font-semibold text-lg",children:[o.length," jour",o.length>1?"s":""]}),h&&e.jsx("div",{className:"px-2 py-0.5 rounded-full bg-orange-500/20 border border-orange-400/30",children:e.jsx("span",{className:"text-orange-300 text-xs font-semibold",children:"🏆 Record"})}),b&&e.jsx("div",{className:"px-2 py-0.5 rounded-full bg-green-500/20 border border-green-400/30",children:e.jsx("span",{className:"text-green-300 text-xs font-semibold",children:"🔥 Active"})})]}),e.jsxs("div",{className:"text-white/60 text-xs mt-0.5",children:[S(I(o.startDate),"dd MMM",{locale:L})," - ",S(I(o.endDate),"dd MMM",{locale:L})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(j,{Icon:p.Flame,size:24,style:{color:b?"#22C55E":h?"#F59E0B":"#8B5CF6"}})})]})},`${o.startDate}-${u}`)})})]}),e.jsx("div",{className:"p-4 rounded-xl",style:{background:i?"color-mix(in srgb, #22C55E 6%, transparent)":"color-mix(in srgb, #8B5CF6 6%, transparent)",border:i?"1px solid color-mix(in srgb, #22C55E 18%, transparent)":"1px solid color-mix(in srgb, #8B5CF6 18%, transparent)",backdropFilter:a?"none":"blur(8px) saturate(120%)"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(j,{Icon:i?p.TrendingUp:p.Info,size:14,style:{color:i?"#22C55E":"#8B5CF6"},className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:i?"#22C55E":"#8B5CF6"},children:i?`Série active de ${i.length} jour${i.length>1?"s":""} !`:"Démarrez une nouvelle série"}),e.jsx("p",{className:"text-xs mt-1",style:{color:i?"#22C55ECC":"#8B5CF6CC"},children:i?i.length>=x.length?"🎉 Nouveau record en cours ! Continuez ainsi !":`Plus que ${x.length-i.length} jour${x.length-i.length>1?"s":""} pour égaler votre record`:"Complétez une session de jeûne aujourd'hui pour commencer une nouvelle série"})]})]})})]})})})},ot=({data:t,periodDays:n,className:s=""})=>{const{isPerformanceMode:a}=k(),l=a?"div":v.div,d=t.filter(m=>m.sessionsCount>0),i=D.useMemo(()=>{if(d.length===0)return{maxDuration:0,minDuration:0,averageDuration:0,trend:"stable",improvement:0};const m=d.map(w=>w.averageDuration),o=Math.max(...m),u=Math.min(...m),b=m.reduce((w,C)=>w+C,0)/m.length,h=Math.floor(d.length/2),c=d.slice(0,h),g=d.slice(h),y=c.length>0?c.reduce((w,C)=>w+C.averageDuration,0)/c.length:0,_=(g.length>0?g.reduce((w,C)=>w+C.averageDuration,0)/g.length:0)-y,B=_>.5?"improving":_<-.5?"declining":"stable";return{maxDuration:Math.round(o*10)/10,minDuration:Math.round(u*10)/10,averageDuration:Math.round(b*10)/10,trend:B,improvement:Math.round(_*10)/10}},[d]),r=(()=>{switch(i.trend){case"improving":return{color:"#22C55E",icon:"TrendingUp",label:"En amélioration",description:`+${i.improvement}h en moyenne`};case"declining":return{color:"#EF4444",icon:"TrendingDown",label:"En baisse",description:`${i.improvement}h en moyenne`};case"stable":default:return{color:"#06B6D4",icon:"Minus",label:"Stable",description:"Durées constantes"}}})();return d.length===0?e.jsx(N,{className:`p-6 text-center ${s}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-cyan-500/20 flex items-center justify-center",children:e.jsx(j,{Icon:p.LineChart,size:32,className:"text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Aucune Donnée de Tendance"}),e.jsx("p",{className:"text-white/70",children:"Complétez quelques sessions de jeûne pour voir l'évolution de vos durées"})]})]})}):e.jsx(l,{...!a&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2}},className:s,children:e.jsx(N,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${r.color} 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${r.color} 25%, transparent)`,boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, ${r.color} 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `,backdropFilter:a?"none":"blur(20px) saturate(160%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${r.color} 35%, transparent), color-mix(in srgb, ${r.color} 25%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${r.color} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${r.color} 30%, transparent)`},children:e.jsx(j,{Icon:p[r.icon],size:20,style:{color:r.color}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Évolution des Durées"}),e.jsxs("p",{className:"text-white/80 text-sm",children:[d.length," jours avec données • ",r.label]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"px-3 py-1.5 rounded-full",style:{background:`color-mix(in srgb, ${r.color} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${r.color} 25%, transparent)`},children:e.jsx("span",{className:"text-sm font-medium",style:{color:r.color},children:r.description})})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx(j,{Icon:p.LineChart,size:16,className:"text-purple-400"}),"Tendance des Durées"]}),e.jsx("div",{className:"relative h-32 bg-white/5 rounded-xl p-4 overflow-hidden",children:e.jsx("div",{className:"relative h-full flex items-end justify-between",children:d.slice(-14).map((m,o)=>{const u=i.maxDuration>0?m.averageDuration/i.maxDuration*100:0;return e.jsxs(l,{className:"flex flex-col items-center group cursor-pointer",style:{width:`${100/Math.min(d.length,14)}%`},...!a&&{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},transition:{duration:.5,delay:o*.05}},children:[e.jsx("div",{className:"w-2 bg-gradient-to-t from-cyan-500 to-purple-400 rounded-full mb-1 transition-all duration-200 group-hover:w-3",style:{height:`${Math.max(u,5)}%`}}),e.jsx("div",{className:"text-xs text-white/60 transform -rotate-45 origin-bottom-left whitespace-nowrap",children:S(I(m.date),"dd/MM")}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black/80 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10",children:[S(I(m.date),"dd MMM")," - ",m.averageDuration,"h",m.sessionsCount>1&&` (${m.sessionsCount} sessions)`]})]},m.date)})})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400 mb-1",children:[i.maxDuration,"h"]}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Maximum"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #06B6D4 10%, transparent)",border:"1px solid color-mix(in srgb, #06B6D4 20%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-cyan-400 mb-1",children:[i.averageDuration,"h"]}),e.jsx("div",{className:"text-cyan-300 text-sm font-medium",children:"Moyenne"})]}),e.jsxs("div",{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #8B5CF6 10%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 20%, transparent)"},children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:[i.minDuration,"h"]}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Minimum"})]})]})]})})})},lt=t=>{switch(t){case 7:return 5;case 30:return 12;case 90:return 20;default:return 5}},ct=()=>{const{profile:t,session:n}=O(),{isPerformanceMode:s}=k(),a=K(),[l,d]=z.useState(7),i=s?"div":v.div,{data:x}=ee(),{data:r,isLoading:m,error:o}=et(l),u=r?.metrics?.totalSessions||0;return e.jsxs(i,{...!s&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"}},className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"inline-flex gap-2 p-1 rounded-lg",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:s?"none":"blur(10px)"},children:[7,30,90].map(b=>{const h=l===b,c="#06B6D4",g=lt(b),y=u>=g;return e.jsx("button",{onClick:()=>{y&&d(b)},disabled:!y,className:"px-6 py-2.5 rounded-lg text-sm font-medium",style:{background:h?`${c}33`:"transparent",color:h?c:y?"rgba(255, 255, 255, 0.7)":"rgba(255, 255, 255, 0.4)",border:h?`1px solid ${c}66`:"1px solid transparent",boxShadow:s?"none":h?`0 0 20px ${c}4D`:"none",opacity:y?1:.5,cursor:y?"pointer":"not-allowed",transition:s?"all 0.15s ease":"all 0.2s ease"},children:b===7?"7 jours":b===30?"30 jours":"90 jours"},b)})})}),m&&e.jsx(tt,{}),o&&e.jsx(N,{className:"p-6",style:{background:"color-mix(in srgb, #EF4444 8%, transparent)",borderColor:"color-mix(in srgb, #EF4444 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(j,{Icon:p.AlertCircle,size:16,className:"text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-300 font-semibold",children:"Erreur d'Analyse"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Impossible de charger les données de progression."})]})]})}),r&&r.metrics.totalSessions===0&&!m&&e.jsx(N,{className:"p-8 text-center",style:{background:`
            radial-gradient(ellipse at center,
              rgba(6, 182, 212, 0.15) 0%,
              rgba(34, 211, 238, 0.08) 50%,
              rgba(0, 0, 0, 0.4) 100%)
          `,borderColor:"color-mix(in srgb, #06B6D4 30%, transparent)",boxShadow:s?"0 8px 32px rgba(0, 0, 0, 0.3)":`
              0 0 30px rgba(6, 182, 212, 0.2),
              0 8px 32px rgba(0, 0, 0, 0.3),
              inset 0 1px 0 rgba(255, 255, 255, 0.1)
            `,backdropFilter:s?"none":"blur(20px) saturate(1.2)"},children:e.jsxs("div",{className:"space-y-6 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-2xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                  rgba(6, 182, 212, 0.3) 0%,
                  rgba(34, 211, 238, 0.15) 70%,
                  transparent 100%)`,border:"1px solid rgba(6, 182, 212, 0.4)",boxShadow:s?"0 4px 20px rgba(0, 0, 0, 0.2)":`
                    0 0 25px rgba(6, 182, 212, 0.3),
                    0 4px 20px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2)
                  `},children:e.jsx(j,{Icon:p.TrendingUp,size:48,className:"text-cyan-400",style:{filter:s?"none":`drop-shadow(0 0 12px rgba(6, 182, 212, 0.8))
                       drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3))`}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"Progression en Construction"}),e.jsx("p",{className:"text-white/70 text-lg",children:"Plus de sessions nécessaires pour l'analyse"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                      rgba(6, 182, 212, 0.3) 0%,
                      rgba(34, 211, 238, 0.1) 70%,
                      transparent 100%)`,border:"1px solid rgba(6, 182, 212, 0.4)",boxShadow:s?"0 4px 15px rgba(0, 0, 0, 0.2)":`
                        0 0 20px rgba(6, 182, 212, 0.3),
                        0 4px 15px rgba(0, 0, 0, 0.2),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2)
                      `},children:e.jsx(j,{Icon:p.BarChart3,size:24,className:"text-cyan-400",style:{filter:s?"none":`drop-shadow(0 0 8px rgba(6, 182, 212, 0.6))
                           drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Graphiques Évolutifs"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Visualisez votre progression avec des graphiques détaillés"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                      rgba(6, 182, 212, 0.3) 0%,
                      rgba(34, 211, 238, 0.1) 70%,
                      transparent 100%)`,border:"1px solid rgba(6, 182, 212, 0.4)",boxShadow:s?"0 4px 15px rgba(0, 0, 0, 0.2)":`
                        0 0 20px rgba(6, 182, 212, 0.3),
                        0 4px 15px rgba(0, 0, 0, 0.2),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2)
                      `},children:e.jsx(j,{Icon:p.Activity,size:24,className:"text-cyan-400",style:{filter:s?"none":`drop-shadow(0 0 8px rgba(6, 182, 212, 0.6))
                           drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Métriques Avancées"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Suivez votre consistance, vos streaks et vos tendances"})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl flex items-center justify-center",style:{background:`radial-gradient(circle,
                      rgba(6, 182, 212, 0.3) 0%,
                      rgba(34, 211, 238, 0.1) 70%,
                      transparent 100%)`,border:"1px solid rgba(6, 182, 212, 0.4)",boxShadow:s?"0 4px 15px rgba(0, 0, 0, 0.2)":`
                        0 0 20px rgba(6, 182, 212, 0.3),
                        0 4px 15px rgba(0, 0, 0, 0.2),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2)
                      `},children:e.jsx(j,{Icon:p.Award,size:24,className:"text-cyan-400",style:{filter:s?"none":`drop-shadow(0 0 8px rgba(6, 182, 212, 0.6))
                           drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))`}})}),e.jsx("h3",{className:"font-semibold text-white",children:"Suivi des Objectifs"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Mesurez vos progrès vers vos objectifs de jeûne"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:()=>a("/fasting/input"),className:"group relative px-8 py-4 text-white font-semibold rounded-2xl",style:{background:`linear-gradient(135deg,
                    rgba(6, 182, 212, 0.8) 0%,
                    rgba(34, 211, 238, 0.9) 100%)`,border:"2px solid rgba(6, 182, 212, 0.6)",boxShadow:s?"0 8px 25px rgba(0, 0, 0, 0.3)":`
                      0 0 30px rgba(6, 182, 212, 0.4),
                      0 8px 25px rgba(0, 0, 0, 0.3),
                      inset 0 1px 0 rgba(255, 255, 255, 0.2),
                      inset 0 -1px 0 rgba(0, 0, 0, 0.2)
                    `,backdropFilter:s?"none":"blur(10px) saturate(1.2)",transform:s?"none":void 0,transition:s?"all 0.15s ease":"all 0.3s ease"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{Icon:p.Timer,size:24,className:s?"":"group-hover:rotate-12 transition-transform duration-300",style:{color:"white",filter:s?"none":`drop-shadow(0 0 10px rgba(6, 182, 212, 0.8))
                           drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3))`}}),e.jsx("span",{className:"text-lg",children:"Ajouter des Sessions de Jeûne"})]}),!s&&e.jsx("div",{className:"absolute inset-0 rounded-2xl blur-xl opacity-50 group-hover:opacity-75 transition-opacity duration-300 -z-10",style:{background:`linear-gradient(135deg,
                        rgba(6, 182, 212, 0.6) 0%,
                        rgba(34, 211, 238, 0.6) 100%)`}})]})}),e.jsx("div",{className:"text-white/50 text-sm p-3 rounded-xl",style:{background:`radial-gradient(ellipse at center,
                  rgba(6, 182, 212, 0.1) 0%,
                  transparent 70%)`,border:"1px solid rgba(6, 182, 212, 0.2)",boxShadow:s?"none":"0 0 15px rgba(6, 182, 212, 0.1)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(j,{Icon:p.Info,size:16,className:"text-cyan-400",style:{filter:s?"none":"drop-shadow(0 0 6px rgba(6, 182, 212, 0.6))"}}),e.jsx("span",{children:"Continuez à enregistrer vos sessions pour débloquer des analyses détaillées de votre évolution !"})]})})]})}),r&&r.metrics.totalSessions>0&&!m&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(at,{metrics:r.metrics,periodDays:l,aiAnalysis:r.aiAnalysis,aiModel:r.aiModel,tokensUsed:r.tokensUsed,cached:r.cached}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(nt,{data:r.consistencyData,periodDays:l}),e.jsx(ot,{data:r.durationTrend||[],periodDays:l})]}),r.sessions&&e.jsx(it,{sessions:r.sessions,periodDays:l})]})]})},dt=({filters:t,onFiltersChange:n,totalSessions:s,filteredSessions:a,className:l=""})=>{const{data:d}=Pe(),[i,x]=D.useState(!1),r=(u,b)=>{n({...t,[u]:b})},m=()=>{n({})},o=Object.keys(t).some(u=>{const b=t[u];return b!==void 0&&b!==""&&b!=="all"});return e.jsx(v.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},className:l,children:e.jsx(N,{className:"p-4",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #8B5CF6 20%, transparent)",boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.2),
            0 0 20px color-mix(in srgb, #8B5CF6 12%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #8B5CF6 15%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 25%, transparent)"},children:e.jsx(j,{Icon:p.Search,size:14,style:{color:"#8B5CF6"}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-purple-300 font-semibold",children:"Filtres d'Historique"}),e.jsxs("p",{className:"text-purple-200 text-sm",children:[a," / ",s," sessions"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsx("button",{onClick:m,className:"btn-glass--secondary-nav px-3 py-1.5 text-xs",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:p.RotateCcw,size:12}),e.jsx("span",{children:"Reset"})]})}),e.jsx("button",{onClick:()=>x(!i),className:"btn-glass px-3 py-1.5",children:e.jsx(j,{Icon:i?p.ChevronUp:p.ChevronDown,size:14})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:t.status||"all",onChange:u=>r("status",u.target.value==="all"?void 0:u.target.value),className:"glass-input text-sm py-2 px-3",style:{minWidth:"120px"},children:[e.jsx("option",{value:"all",children:"Tous les statuts"}),e.jsx("option",{value:"completed",children:"Complétées"}),e.jsx("option",{value:"cancelled",children:"Annulées"})]}),d&&d.length>0&&e.jsxs("select",{value:t.protocol||"",onChange:u=>r("protocol",u.target.value||void 0),className:"glass-input text-sm py-2 px-3",style:{minWidth:"140px"},children:[e.jsx("option",{value:"",children:"Tous les protocoles"}),d.map(u=>{const b=J.find(h=>h.id===u);return e.jsx("option",{value:u,children:b?.name||u},u)})]})]}),i&&e.jsxs(v.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"space-y-4 pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Durée minimale (heures)"}),e.jsx("input",{type:"number",min:"0",max:"48",step:"0.5",value:t.minDuration||"",onChange:u=>r("minDuration",u.target.value?Number(u.target.value):void 0),className:"glass-input text-sm",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Durée maximale (heures)"}),e.jsx("input",{type:"number",min:"0",max:"48",step:"0.5",value:t.maxDuration||"",onChange:u=>r("maxDuration",u.target.value?Number(u.target.value):void 0),className:"glass-input text-sm",placeholder:"48"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Date de début"}),e.jsx("input",{type:"date",value:t.dateRange?.start?format(t.dateRange.start,"yyyy-MM-dd"):"",onChange:u=>{if(u.target.value)r("dateRange",{...t.dateRange,start:new Date(u.target.value)});else{const{start:b,...h}=t.dateRange||{};r("dateRange",Object.keys(h).length>0?h:void 0)}},className:"glass-input text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-2",children:"Date de fin"}),e.jsx("input",{type:"date",value:t.dateRange?.end?format(t.dateRange.end,"yyyy-MM-dd"):"",onChange:u=>{if(u.target.value)r("dateRange",{...t.dateRange,end:new Date(u.target.value)});else{const{end:b,...h}=t.dateRange||{};r("dateRange",Object.keys(h).length>0?h:void 0)}},className:"glass-input text-sm"})]})]})]}),o&&e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 border-t border-white/10",children:[t.status&&t.status!=="all"&&e.jsxs("div",{className:"chip chip--on flex items-center gap-1",children:[e.jsxs("span",{children:["Statut: ",t.status==="completed"?"Complétées":"Annulées"]}),e.jsx("button",{onClick:()=>r("status",void 0),children:e.jsx(j,{Icon:p.X,size:10})})]}),t.protocol&&e.jsxs("div",{className:"chip chip--on flex items-center gap-1",children:[e.jsxs("span",{children:["Protocole: ",t.protocol]}),e.jsx("button",{onClick:()=>r("protocol",void 0),children:e.jsx(j,{Icon:p.X,size:10})})]}),t.minDuration!==void 0&&e.jsxs("div",{className:"chip chip--on flex items-center gap-1",children:[e.jsxs("span",{children:["Min: ",t.minDuration,"h"]}),e.jsx("button",{onClick:()=>r("minDuration",void 0),children:e.jsx(j,{Icon:p.X,size:10})})]}),t.maxDuration!==void 0&&e.jsxs("div",{className:"chip chip--on flex items-center gap-1",children:[e.jsxs("span",{children:["Max: ",t.maxDuration,"h"]}),e.jsx("button",{onClick:()=>r("maxDuration",void 0),children:e.jsx(j,{Icon:p.X,size:10})})]})]})]})})})};function xt(t){return t>=90?{color:"#22C55E",icon:"Check",badge:"Excellent",description:"Discipline exceptionnelle"}:t>=70?{color:"#F59E0B",icon:"Target",badge:"Bien",description:"Bonne régularité"}:t>=50?{color:"#06B6D4",icon:"TrendingUp",badge:"Modéré",description:"En progression"}:{color:"#8B5CF6",icon:"Timer",badge:"Débutant",description:"Développement en cours"}}const mt=({stats:t,className:n=""})=>{const s=t.totalSessions>0?t.completedSessions/t.totalSessions*100:0,a=xt(s);return e.jsx(v.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,ease:[.25,.1,.25,1]},className:n,children:e.jsx(N,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${a.color} 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, ${a.color} 10%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${a.color} 30%, transparent)`,boxShadow:`
            0 16px 48px rgba(0, 0, 0, 0.3),
            0 0 40px color-mix(in srgb, ${a.color} 25%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.2)
          `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center breathing-icon",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${a.color} 40%, transparent), color-mix(in srgb, ${a.color} 30%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${a.color} 60%, transparent)`,boxShadow:`0 0 25px color-mix(in srgb, ${a.color} 50%, transparent)`},children:e.jsx(j,{Icon:p[a.icon],size:20,style:{color:a.color},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Statistiques Globales"}),e.jsxs("p",{className:"text-white/80 text-sm mt-0.5",children:["Toutes vos sessions • ",a.description]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:a.color,boxShadow:`0 0 8px ${a.color}60`}}),e.jsxs("span",{className:"text-white font-bold text-2xl",children:[Math.round(s),"%"]})]}),e.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{background:`color-mix(in srgb, ${a.color} 15%, transparent)`,color:a.color},children:a.badge})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(v.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 10%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1},children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:t.totalSessions}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Sessions"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Total"})]}),e.jsxs(v.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},children:[e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:t.completedSessions}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Complétées"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Succès"})]}),e.jsxs(v.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 10%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.3},children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:[t.totalHours,"h"]}),e.jsx("div",{className:"text-orange-300 text-sm font-medium",children:"Temps Total"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Jeûné"})]}),e.jsxs(v.div,{className:"text-center p-4 rounded-xl",style:{background:"color-mix(in srgb, #8B5CF6 10%, transparent)",border:"1px solid color-mix(in srgb, #8B5CF6 20%, transparent)"},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.4},children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:[t.averageDuration,"h"]}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Moyenne"}),e.jsx("div",{className:"text-white/50 text-xs mt-1",children:"Durée"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-white/80 font-medium text-sm flex items-center gap-2",children:[e.jsx(j,{Icon:p.Star,size:14,className:"text-yellow-400"}),"Records Personnels"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Session la plus longue"}),e.jsxs("span",{className:"text-white font-bold",children:[t.longestSession,"h"]})]}),t.shortestSession>0&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Session la plus courte"}),e.jsxs("span",{className:"text-white font-bold",children:[t.shortestSession,"h"]})]}),t.mostUsedProtocol&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Protocole favori"}),e.jsx("span",{className:"text-white font-bold",children:t.mostUsedProtocol})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-white/80 font-medium text-sm flex items-center gap-2",children:[e.jsx(j,{Icon:p.Calendar,size:14,className:"text-cyan-400"}),"Historique"]}),e.jsxs("div",{className:"space-y-2",children:[t.firstSessionDate&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Première session"}),e.jsx("span",{className:"text-white font-bold",children:S(I(t.firstSessionDate),"dd/MM/yyyy")})]}),t.lastSessionDate&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Dernière session"}),e.jsx("span",{className:"text-white font-bold",children:S(I(t.lastSessionDate),"dd/MM/yyyy")})]}),t.cancelledSessions>0&&e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Sessions annulées"}),e.jsx("span",{className:"text-red-400 font-bold",children:t.cancelledSessions})]})]})]})]}),e.jsxs(v.div,{className:"p-5 rounded-xl text-center",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${a.color} 12%, transparent) 0%, transparent 60%),
                color-mix(in srgb, ${a.color} 6%, transparent)
              `,border:`2px solid color-mix(in srgb, ${a.color} 25%, transparent)`,boxShadow:`
                0 8px 32px rgba(0, 0, 0, 0.2),
                0 0 20px color-mix(in srgb, ${a.color} 20%, transparent),
                inset 0 1px 0 rgba(255, 255, 255, 0.15)
              `},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.5},children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx(j,{Icon:p.Lightbulb,size:18,style:{color:a.color}}),e.jsx("h4",{className:"font-bold text-lg",style:{color:a.color},children:"Bilan de votre Forge Temporelle"})]}),e.jsx("p",{className:"text-white/90 text-base leading-relaxed",children:s>=90?`Maîtrise exceptionnelle ! Vous avez complété ${t.completedSessions} sessions sur ${t.totalSessions} avec ${t.totalHours}h de jeûne total. Votre discipline temporelle est remarquable.`:s>=70?`Excellente progression ! ${Math.round(s)}% de taux de réussite avec une moyenne de ${t.averageDuration}h par session. Continuez cette régularité.`:s>=50?`Développement solide ! Votre record personnel est de ${t.longestSession}h. Visez plus de régularité pour optimiser les bénéfices métaboliques.`:`Début prometteur ! Chaque session forge votre discipline. Votre parcours temporel commence avec ${t.totalSessions} sessions tentées.`})]})]})})})};function ut(t){return t?J.find(s=>s.id===t)?.name||t:"Protocole personnalisé"}function gt(t){if(!t||t<=0)return"--";const n=Math.floor(t),s=Math.floor((t-n)*60);return`${n}h ${s.toString().padStart(2,"0")}m`}const pt=({session:t,index:n,onDelete:s,className:a=""})=>{const{click:l,error:d}=G(),i=Be(),[x,r]=D.useState(!1),m=t.actual_duration_hours&&t.target_hours?ye(t.actual_duration_hours,t.target_hours):"missed",o=Ne(m),u=ut(t.protocol_id),b=gt(t.actual_duration_hours),h=`${t.target_hours}h`,c=t.actual_duration_hours&&t.target_hours?Math.round(t.actual_duration_hours/t.target_hours*100):0,g=async()=>{try{await i.mutateAsync(t.id),s?.(t.id),r(!1)}catch{}},y=()=>{l(),r(!0)},F=()=>{l(),r(!1)};return e.jsx(v.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,delay:n*.05,ease:[.25,.1,.25,1]},className:a,children:e.jsxs(N,{className:"p-5 relative overflow-visible",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${o.primaryColor} 8%, transparent) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${o.primaryColor} 20%, transparent)`,boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.2),
            0 0 20px color-mix(in srgb, ${o.primaryColor} 12%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `,backdropFilter:"blur(16px) saturate(150%)"},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${o.primaryColor} 30%, transparent), color-mix(in srgb, ${o.primaryColor} 20%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${o.primaryColor} 40%, transparent)`,boxShadow:`0 0 16px color-mix(in srgb, ${o.primaryColor} 25%, transparent)`},children:e.jsx(j,{Icon:p[o.icon],size:16,style:{color:o.primaryColor}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold",children:S(I(t.start_time),"dd MMM yyyy")}),e.jsxs("p",{className:"text-white/70 text-sm",children:[u," • ",S(I(t.start_time),"HH:mm")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-3 py-1.5 rounded-full",style:{background:`color-mix(in srgb, ${o.primaryColor} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${o.primaryColor} 25%, transparent)`},children:e.jsx("span",{className:"text-xs font-medium",style:{color:o.primaryColor},children:t.status==="completed"?"Complétée":t.status==="cancelled"?"Annulée":"Active"})}),e.jsx("button",{onClick:y,className:"p-2 rounded-full hover:bg-red-500/20 transition-colors",title:"Supprimer cette session",children:e.jsx(j,{Icon:p.Trash2,size:14,className:"text-red-400"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg",style:{background:`color-mix(in srgb, ${o.primaryColor} 8%, transparent)`,border:`1px solid color-mix(in srgb, ${o.primaryColor} 15%, transparent)`},children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:b}),e.jsx("div",{className:"text-white/70 text-xs",children:"Durée Réelle"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:h}),e.jsx("div",{className:"text-white/70 text-xs",children:"Objectif"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"text-lg font-bold text-white mb-1",children:[c,"%"]}),e.jsx("div",{className:"text-white/70 text-xs",children:"Progression"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:t.end_time?S(I(t.end_time),"HH:mm"):"--:--"}),e.jsx("div",{className:"text-white/70 text-xs",children:"Fin"})]})]}),t.notes&&e.jsx("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(j,{Icon:p.FileText,size:14,className:"text-white/60 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-white/80 font-medium text-sm mb-1",children:"Notes"}),e.jsx("p",{className:"text-white/70 text-sm leading-relaxed",children:t.notes})]})]})}),t.status==="completed"&&t.actual_duration_hours&&t.target_hours&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm text-white/70 mb-2",children:[e.jsx("span",{children:"Progression vers l'objectif"}),e.jsxs("span",{children:[c,"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 overflow-hidden",children:e.jsx(v.div,{className:"h-2 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${o.primaryColor}, ${o.secondaryColor})`,boxShadow:`0 0 8px color-mix(in srgb, ${o.primaryColor} 60%, transparent)`,width:`${Math.min(100,c)}%`},initial:{width:0},animate:{width:`${Math.min(100,c)}%`},transition:{duration:.8,ease:"easeOut",delay:.2+n*.05},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                        transparent 0%, 
                        rgba(255,255,255,0.4) 50%, 
                        transparent 100%
                      )`,animation:"progressShimmer 2s ease-in-out infinite"}})})})]})]}),x&&e.jsx(v.div,{className:"absolute inset-0 rounded-inherit flex items-center justify-center",style:{background:"rgba(0, 0, 0, 0.9)",backdropFilter:"blur(8px)",zIndex:10},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs("div",{className:"text-center space-y-4 p-4",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #EF4444 20%, transparent)",border:"2px solid color-mix(in srgb, #EF4444 40%, transparent)"},children:e.jsx(j,{Icon:p.AlertTriangle,size:20,style:{color:"#EF4444"}})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-white font-bold mb-2",children:"Supprimer cette session ?"}),e.jsxs("p",{className:"text-white/80 text-sm",children:["Session du ",S(I(t.start_time),"dd/MM/yyyy")," • ",b]})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:g,disabled:i.isPending,className:"btn-glass--warning px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[i.isPending?e.jsx(j,{Icon:p.Loader2,size:12,className:"animate-spin"}):e.jsx(j,{Icon:p.Trash2,size:12}),e.jsx("span",{children:i.isPending?"Suppression...":"Supprimer"})]})}),e.jsx("button",{onClick:F,className:"btn-glass--secondary-nav px-4 py-2 text-sm",children:e.jsx("span",{children:"Annuler"})})]})]})})]})})},ht=({className:t=""})=>e.jsxs("div",{className:`space-y-6 ${t}`,children:[e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsx(N,{className:"p-6 text-center",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 15%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, #A855F7 12%, transparent) 0%, transparent 50%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, #8B5CF6 30%, transparent)",boxShadow:`
              0 16px 48px rgba(0, 0, 0, 0.3),
              0 0 40px color-mix(in srgb, #8B5CF6 25%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.2)
            `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(v.div,{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #8B5CF6 40%, transparent), color-mix(in srgb, #A855F7 30%, transparent))
                `,border:"3px solid color-mix(in srgb, #8B5CF6 60%, transparent)",boxShadow:`
                  0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent),
                  0 0 80px color-mix(in srgb, #8B5CF6 40%, transparent)
                `},animate:{scale:[1,1.05,1],boxShadow:["0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent)","0 0 60px color-mix(in srgb, #8B5CF6 80%, transparent)","0 0 40px color-mix(in srgb, #8B5CF6 60%, transparent)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(j,{Icon:p.History,size:40,style:{color:"#8B5CF6"},className:"animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Chargement de l'Historique"}),e.jsx("p",{className:"text-white/80 text-lg",children:"Récupération de vos sessions temporelles..."})]}),e.jsx("div",{className:"space-y-2 max-w-md mx-auto",children:["Récupération des sessions historiques","Calcul des statistiques globales","Organisation chronologique","Préparation de l'affichage"].map((n,s)=>e.jsxs(v.div,{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:s*.2},children:[e.jsx(v.div,{className:"w-2 h-2 rounded-full bg-purple-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,delay:s*.3}}),e.jsx("span",{className:"text-white/70 text-sm",children:n})]},s))})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 bg-white/10 rounded w-48 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-32 animate-pulse"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(n=>e.jsxs("div",{className:"text-center p-4 rounded-xl bg-white/5",children:[e.jsx("div",{className:"h-8 bg-white/10 rounded w-16 mx-auto mb-2 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-20 mx-auto animate-pulse"})]},n))})]})}),[1,2,3,4,5].map(n=>e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3+n*.1},children:e.jsxs(N,{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-32 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-24 animate-pulse"})]})]}),e.jsx("div",{className:"h-6 bg-white/10 rounded w-20 animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"text-center p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"h-5 bg-white/10 rounded w-12 mx-auto mb-1 animate-pulse"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-16 mx-auto animate-pulse"})]},s))})]})},n))]}),e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:1},className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-purple-500/10 border border-purple-400/20",children:[e.jsx(v.div,{className:"w-2 h-2 rounded-full bg-purple-400",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1,repeat:1/0}}),e.jsx("span",{className:"text-purple-300 text-sm font-medium",children:"Chargement de l'historique..."})]})})]}),bt=()=>{const{isPerformanceMode:t}=k(),[n,s]=z.useState({}),[a,l]=z.useState(!1),d=t?"div":v.div,{data:i,isLoading:x,error:r}=te(100,n),m=o=>{};return e.jsxs(d,{...!t&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"}},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-white font-semibold text-lg",children:"Historique Temporel"}),i&&e.jsxs("div",{className:"text-white/60 text-sm",children:[i.sessions.length," session",i.sessions.length>1?"s":"",i.sessions.length!==i.allSessions.length&&` sur ${i.allSessions.length}`]})]}),e.jsx("button",{onClick:()=>l(!a),className:"btn-glass px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{Icon:p.Search,size:14}),e.jsx("span",{children:"Filtres"}),e.jsx(j,{Icon:a?p.ChevronUp:p.ChevronDown,size:12})]})})]}),e.jsx(Se,{children:a&&e.jsx(dt,{filters:n,onFiltersChange:s,totalSessions:i?.allSessions.length||0,filteredSessions:i?.sessions.length||0})}),x&&e.jsx(ht,{}),r&&e.jsx(N,{className:"p-6",style:{background:"color-mix(in srgb, #EF4444 8%, transparent)",borderColor:"color-mix(in srgb, #EF4444 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(j,{Icon:p.AlertCircle,size:16,className:"text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-300 font-semibold",children:"Erreur de Chargement"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Impossible de charger l'historique. Réessayez dans quelques instants."})]})]})}),i&&!x&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(mt,{stats:i.stats}),i.sessions.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-white font-semibold text-lg flex items-center gap-2",children:[e.jsx(j,{Icon:p.History,size:18,className:"text-purple-400"}),"Sessions (",i.sessions.length,")"]}),e.jsx("div",{className:"space-y-3",children:i.sessions.map((o,u)=>e.jsx(pt,{session:o,index:u,onDelete:m},o.id))}),i.allSessions.length>i.sessions.length&&e.jsx("div",{className:"text-center pt-4",children:e.jsx("button",{onClick:()=>{},className:"btn-glass--secondary-nav px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{Icon:p.ChevronDown,size:16}),e.jsx("span",{children:"Charger plus de sessions"})]})})})]}):e.jsx(N,{className:"p-8 text-center",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 15%, transparent) 0%, transparent 60%),
                radial-gradient(circle at 70% 80%, color-mix(in srgb, #8B5CF6 12%, transparent) 0%, transparent 50%),
                linear-gradient(145deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.02) 100%),
                var(--glass-opacity)
              `,borderColor:"color-mix(in srgb, #8B5CF6 30%, transparent)",boxShadow:t?"0 12px 40px rgba(0, 0, 0, 0.25)":`
                  0 12px 40px rgba(0, 0, 0, 0.25),
                  0 0 30px color-mix(in srgb, #8B5CF6 20%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.15)
                `},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center",style:{background:`
                        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                        linear-gradient(135deg, color-mix(in srgb, #8B5CF6 30%, transparent), color-mix(in srgb, #8B5CF6 20%, transparent))
                      `,border:"2px solid color-mix(in srgb, #8B5CF6 40%, transparent)",boxShadow:t?"none":"0 0 30px color-mix(in srgb, #8B5CF6 30%, transparent)"},children:e.jsx(j,{Icon:p.History,size:40,style:{color:"#8B5CF6"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:Object.keys(n).length>0?"Aucune Session Trouvée":"Commencez Votre Historique"}),e.jsx("p",{className:"text-white/70 text-base",children:Object.keys(n).length>0?"Aucun résultat":"Vos sessions vous attendent"})]})]}),e.jsx("div",{children:e.jsx("p",{className:"text-white/70 text-base leading-relaxed max-w-lg mx-auto",children:Object.keys(n).length>0?"Aucune session ne correspond aux filtres sélectionnés. Essayez de modifier vos critères de recherche.":"Votre historique de jeûne apparaîtra ici après vos premières sessions. Commencez dès maintenant votre forge temporelle !"})}),Object.keys(n).length===0&&e.jsx("button",{onClick:()=>window.location.href="/fasting/input",className:"px-6 py-3 rounded-lg text-sm font-medium transition-all duration-200",style:{background:"linear-gradient(135deg, color-mix(in srgb, #8B5CF6 80%, transparent), color-mix(in srgb, #8B5CF6 60%, transparent))",border:"2px solid color-mix(in srgb, #8B5CF6 60%, transparent)",boxShadow:t?"0 12px 40px rgba(0, 0, 0, 0.3)":"0 12px 40px color-mix(in srgb, #8B5CF6 40%, transparent), 0 0 60px color-mix(in srgb, #8B5CF6 30%, transparent)",color:"#fff",transition:t?"all 0.15s ease":"all 0.2s ease"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{Icon:p.Timer,size:16}),e.jsx("span",{children:"Démarrer une Session"})]})})]})})]})]})};function jt(t){switch(t){case"daily":return{icon:"Timer",title:"Tracker",subtitle:"Suivez vos sessions de jeûne quotidiennes",circuit:"fasting",color:"#F59E0B"};case"insights":return{icon:"TrendingUp",title:"Insights",subtitle:"Analyses de vos patterns de jeûne",circuit:"fasting",color:"#10B981"};case"progression":return{icon:"BarChart3",title:"Progression",subtitle:"Évolution de votre pratique du jeûne",circuit:"fasting",color:"#06B6D4"};case"history":return{icon:"History",title:"Historique",subtitle:"Toutes vos sessions enregistrées",circuit:"fasting",color:"#8B5CF6"};default:return{icon:"Timer",title:"Jeûne Intermittent",subtitle:"Suivez et optimisez vos sessions de jeûne",circuit:"fasting",color:"#F59E0B"}}}const At=()=>{const t=re(),{click:n}=G(),[s,a]=D.useState(!1),[l,d]=D.useState(!1),[i,x]=D.useState(null),r=D.useMemo(()=>{const g=t.hash.replace("#","");return g&&["daily","insights","progression","history"].includes(g)?g:"daily"},[t.hash]),m=W(({currentLocation:g,nextLocation:y})=>g.pathname===y.pathname?!1:s);D.useEffect(()=>{m.state==="blocked"&&(f.info("FASTING_PAGE_AI_EXIT","Navigation blocked - AI generation in progress",{activeTab:r,isAIGenerationLoading:s,timestamp:new Date().toISOString()}),x(()=>()=>{m.proceed()}),d(!0))},[m.state,r,s]),oe(),de(`fasting:${r}`);const o=jt(r),u=D.useCallback(g=>{a(g),f.debug("FASTING_PAGE_AI_LOADING","AI generation loading state changed",{activeTab:r,isLoading:g,timestamp:new Date().toISOString()})},[r]),b=()=>{f.info("FASTING_PAGE_AI_EXIT","User chose to stop AI generation and exit",{activeTab:r,timestamp:new Date().toISOString()}),a(!1),d(!1),i&&(i(),x(null))},h=()=>{f.info("FASTING_PAGE_AI_EXIT","User chose to continue AI generation",{activeTab:r,timestamp:new Date().toISOString()}),d(!1),x(null),m.state==="blocked"&&m.reset()},c=g=>{n(),f.debug("FASTING_PAGE","Tab change triggered",{newTab:g})};return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsx(le,{icon:o.icon,title:o.title,subtitle:o.subtitle,circuit:o.circuit,iconColor:o.color}),e.jsxs(E,{defaultValue:r,className:"w-full min-w-0 fasting-tabs",onValueChange:c,forgeContext:"fasting",children:[e.jsxs(E.List,{role:"tablist","aria-label":"Sections du jeûne",className:"mb-6 w-full",children:[e.jsx(E.Trigger,{value:"daily",icon:"Calendar",children:e.jsx("span",{className:"tab-text",children:"Tracker"})}),e.jsx(E.Trigger,{value:"insights",icon:"TrendingUp",children:e.jsx("span",{className:"tab-text",children:"Insights"})}),e.jsx(E.Trigger,{value:"progression",icon:"BarChart3",children:e.jsx("span",{className:"tab-text",children:"Progression"})}),e.jsx(E.Trigger,{value:"history",icon:"History",children:e.jsx("span",{className:"tab-text",children:"Historique"})})]}),e.jsx(E.Panel,{value:"daily",children:e.jsx(Ee,{onLoadingChange:u})}),e.jsx(E.Panel,{value:"insights",children:e.jsx(Ye,{onLoadingChange:u})}),e.jsx(E.Panel,{value:"progression",children:e.jsx(ct,{onLoadingChange:u})}),e.jsx(E.Panel,{value:"history",children:e.jsx(bt,{})})]}),l&&e.jsx(ce,{isOpen:l,title:"Analyse IA en cours",message:"Une analyse IA est en cours de génération. Êtes-vous sûr de vouloir quitter ?",confirmLabel:"Quitter",cancelLabel:"Continuer l'analyse",onConfirm:b,onCancel:h})]})};export{At as default};
