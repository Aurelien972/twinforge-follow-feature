import{u as U,R as z,j as e,r as k,e as H}from"./vendor-DX97-qL9.js";import{u as V,l as w,s as ee}from"./page-fridge-BvAjnJpI.js";import{u as W,S as l,I as n,G as D,r as te,p as se}from"./ui-components-DWjWyKd7.js";import{b as X}from"./stores-DcNfcD_j.js";import{u as Q,e as re}from"./page-fridge-scan-ZLPWYd6x.js";import{m as E,A as L}from"./motion-DLE-fuXv.js";import{a as P,b as ae,e as ie,v as ne,h as Z}from"./ActivityUtils-B02xsDYH.js";import"./utils-CUtLAp28.js";import"./supabase-C_rF2iqf.js";import"./date-utils-sCOX3Ksr.js";const G=[{id:"capture",title:"Capture de Mouvement",subtitle:"Enregistrez votre session énergétique",icon:"Activity",color:"#3B82F6"},{id:"analysis",title:"Analyse de Forge",subtitle:"Traitement de votre empreinte énergétique",icon:"Zap",color:"#06B6D4"},{id:"review",title:"Revue Énergétique",subtitle:"Validation et ajustement de vos données",icon:"Target",color:"#1D4ED8"},{id:"insights_generation",title:"Génération d'Insights",subtitle:"Analyse avancée de vos patterns d'activité",icon:"Lightbulb",color:"#8B5CF6"}];function oe(){const s=U(),{success:a,error:r}=V(),{showToast:t}=W(),[i,c]=z.useState({currentStep:"capture",overallProgress:0,message:"Prêt à forger votre énergie",subMessage:"Commencez par enregistrer votre session d'activité",isActive:!1,steps:G}),o=z.useCallback((u="capture")=>{w.info("ACTIVITY_PIPELINE","Starting activity pipeline",{initialStep:u,timestamp:new Date().toISOString()});const f={capture:{message:"Forge Énergétique Activée",subMessage:"Décrivez votre session d'activité physique"},analysis:{message:"Analyse de Forge",subMessage:"Traitement de votre empreinte énergétique"},review:{message:"Revue Énergétique",subMessage:"Validation et ajustement de vos données"},insights_generation:{message:"Génération d'Insights Énergétiques",subMessage:"Analyse avancée de vos patterns d'activité"}}[u];c(F=>({...F,isActive:!0,currentStep:u,overallProgress:0,message:f.message,subMessage:f.subMessage}))},[]),p=z.useCallback((u,b,f,F)=>{c(v=>({...v,currentStep:u,overallProgress:b,message:f,subMessage:F||""}))},[]),m=z.useCallback(u=>{c(b=>({...b,audioData:u}))},[]),I=z.useCallback(u=>{c(b=>({...b,transcriptionResult:u}))},[]),g=z.useCallback(u=>{c(b=>({...b,analysisResult:u}))},[]),h=z.useCallback(()=>{w.info("ACTIVITY_PIPELINE","Pipeline completed successfully",{activitiesCount:i.analysisResult?.activities?.length||0,totalCalories:i.analysisResult?.totalCalories||0,timestamp:new Date().toISOString()}),c(u=>({...u,isActive:!1,currentStep:"capture",overallProgress:0,message:"Prêt à forger votre énergie",subMessage:"Commencez par enregistrer votre session d'activité",audioData:void 0,transcriptionResult:void 0,analysisResult:void 0})),a(),t({type:"success",title:"Forge Énergétique Complétée",message:"Vos activités ont été enregistrées avec succès",duration:4e3}),setTimeout(()=>{s("/activity#daily")},1e3)},[i.analysisResult,a,t,s]),C=z.useCallback(()=>{w.info("ACTIVITY_PIPELINE","Pipeline cancelled by user",{currentStep:i.currentStep,progress:i.overallProgress,timestamp:new Date().toISOString()}),c(u=>({...u,isActive:!1,currentStep:"capture",overallProgress:0,message:"Prêt à forger votre énergie",subMessage:"Commencez par enregistrer votre session d'activité",audioData:void 0,transcriptionResult:void 0,analysisResult:void 0})),s("/activity")},[i.currentStep,i.overallProgress,s]),S=z.useCallback((u,b)=>{w.error("ACTIVITY_PIPELINE","Pipeline error occurred",{error:u,step:b,timestamp:new Date().toISOString()}),r(),t({type:"error",title:"Erreur de la Forge",message:u,duration:5e3});const f=G.findIndex(v=>v.id===b),F=f>0?G[f-1].id:"capture";c(v=>({...v,currentStep:F,overallProgress:Math.max(0,v.overallProgress-33),message:"Erreur de Forge - Réessayez",subMessage:"Une erreur est survenue, veuillez réessayer"}))},[r,t]);return{state:i,actions:{startPipeline:o,setStep:p,setAudioData:m,setTranscriptionResult:I,setAnalysisResult:g,completePipeline:h,cancelPipeline:C,handleError:S}}}const le=({hasConnectedWearable:s,connectedDevicesCount:a,selectedInputMode:r,onModeChange:t,loading:i=!1})=>{const c=U(),{click:o}=V(),p=()=>{o(),s?t("wearable"):c("/settings")},m=r==="wearable";return i?e.jsx("div",{className:"capture-mode-button-3d opacity-50",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-success",children:e.jsx(l,{Icon:n.Loader2,size:32,className:"text-white/60 animate-spin",variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Chargement..."})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"Vérification de vos appareils"})]})}):s?e.jsx("button",{onClick:p,className:`capture-mode-button-3d ${m?"capture-mode-button-3d-active capture-mode-button-3d-active-success":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-success relative",children:[e.jsx(l,{Icon:n.Watch,size:32,style:{color:m?"#22C55E":"rgba(255, 255, 255, 0.6)"},variant:"pure"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full bg-green-400 border-2 border-white/20",style:{boxShadow:"0 0 12px rgba(34, 197, 94, 0.6)"}})]}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Montre Connectée"})]}),e.jsxs("p",{className:"text-white/70 text-sm text-left",children:[a," appareil",a>1?"s":""," connecté",a>1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),e.jsx("span",{className:"text-green-300",children:"Synchronisation active"})]})]})}):e.jsx("button",{onClick:p,className:`capture-mode-button-3d ${m?"capture-mode-button-3d-active capture-mode-button-3d-active-info":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-info",children:e.jsx(l,{Icon:n.Watch,size:32,style:{color:m?"#0EA5E9":"rgba(255, 255, 255, 0.6)"},variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Montre Connectée"}),e.jsx("div",{className:"flex-1"}),e.jsx(l,{Icon:n.ChevronRight,size:24,className:"text-white/40"})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"Connectez votre montre pour un tracking automatique"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-sky-400"}),e.jsx("span",{className:"text-sky-300",children:"Tracking automatique et précis"})]})]})})},ce=({selectedInputMode:s,onInputModeChange:a})=>{const{click:r}=V(),{hasConnectedWearable:t,connectedDevicesCount:i,loading:c}=Q(),o=m=>{r(),a(m),setTimeout(()=>{const I=document.querySelector(".capture-input-interface");I&&I.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},p=()=>s==="wearable"?"Vos activités sont automatiquement synchronisées depuis votre montre connectée":s==="audio"?"Votre enregistrement sera analysé par notre Forge IA pour extraire automatiquement les activités, durées et calories brûlées":s==="text"?"Votre description sera analysée par notre Forge IA pour extraire automatiquement les activités, durées et calories brûlées":"Choisissez votre méthode préférée pour enregistrer vos activités";return e.jsx(e.Fragment,{children:e.jsxs(D,{className:"p-6 capture-stage-card",children:[e.jsxs("div",{className:"capture-mode-selector",children:[e.jsx(le,{hasConnectedWearable:t,connectedDevicesCount:i,selectedInputMode:s,onModeChange:o,loading:c}),e.jsx("button",{onClick:()=>o("audio"),className:`capture-mode-button-3d ${s==="audio"?"capture-mode-button-3d-active":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-primary",children:e.jsx(l,{Icon:n.Mic,size:32,style:{color:s==="audio"?"#3B82F6":"rgba(255, 255, 255, 0.6)"},variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Enregistrement Vocal"})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"Décrivez votre activité à voix haute"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300",children:"Rapide et naturel"})]})]})}),e.jsx("button",{onClick:()=>o("text"),className:`capture-mode-button-3d ${s==="text"?"capture-mode-button-3d-active capture-mode-button-3d-active-accent":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-accent",children:e.jsx(l,{Icon:n.FileText,size:32,style:{color:s==="text"?"#8B5CF6":"rgba(255, 255, 255, 0.6)"},variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Saisie Manuelle"})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"Écrivez votre description d'activité"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-400"}),e.jsx("span",{className:"text-purple-300",children:"Précis et détaillé"})]})]})})]}),e.jsx("div",{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)"},children:e.jsx(l,{Icon:n.Zap,size:16,style:{color:"var(--color-plasma-cyan)"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-cyan-300 font-semibold text-sm",children:"Forge IA Intelligente"}),e.jsx("p",{className:"text-cyan-200 text-xs",children:p()})]})]})})]})})},de=({isRecording:s,recordingDuration:a,audioBlob:r,onStartRecording:t,onStopRecording:i,onProcessAudio:c,isProcessing:o})=>{const{click:p}=V(),m=g=>{const h=Math.floor(g/60),C=g%60;return`${h}:${C.toString().padStart(2,"0")}`},I=()=>{p(),s?i():r||t()};return e.jsx(D,{className:"capture-audio-container capture-stage-card capture-input-interface",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("button",{className:`capture-audio-visualizer-3d ${s?"capture-audio-visualizer-recording-3d":"capture-audio-visualizer-idle-3d"}`,onClick:I,"aria-label":s?"Arrêter l'enregistrement":"Démarrer l'enregistrement",children:e.jsx("div",{className:"capture-audio-icon-wrapper",children:e.jsx(l,{Icon:s?n.Square:n.Mic,size:56,style:{color:s?"#EF4444":"#3B82F6"},variant:"pure"})})}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"capture-audio-ring-1"}),e.jsx("div",{className:"capture-audio-ring-2"}),e.jsx("div",{className:"capture-audio-ring-3"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:s?"Enregistrement en cours...":"Parlez dans le Micro"}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-md mx-auto",children:s?"Décrivez votre session d'activité physique en cours...":"Cliquez sur le microphone pour commencer à décrire votre activité"})]}),s&&e.jsx(E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center",children:e.jsxs("div",{className:"capture-audio-status",children:[e.jsx("div",{className:"capture-audio-status-indicator"}),e.jsx("span",{className:"capture-audio-timer",children:m(a)})]})}),e.jsxs("div",{className:"flex justify-center gap-4",children:[s&&e.jsx("button",{onClick:i,className:"capture-action-button-3d capture-action-button-3d-danger",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{Icon:n.Square,size:24,className:"text-white"}),e.jsx("span",{children:"Terminer l'Enregistrement"})]})}),r&&!s&&!o&&e.jsx("button",{onClick:c,className:"capture-action-button-3d capture-action-button-3d-success",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{Icon:n.Zap,size:24,className:"text-white"}),e.jsx("span",{children:"Processer ma Forge"})]})})]}),!s&&!r&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 8%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #3B82F6 15%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 25%, transparent)"},children:e.jsx(l,{Icon:n.Mic,size:16,style:{color:"#3B82F6"}})}),e.jsx("h4",{className:"text-blue-300 font-semibold text-sm",children:"Cliquez sur le microphone pour commencer"})]}),e.jsxs("div",{className:"text-blue-200 text-sm space-y-1 text-left",children:[e.jsx("p",{children:"• Cliquez une fois pour démarrer l'enregistrement"}),e.jsx("p",{children:"• Parlez clairement en décrivant vos activités"}),e.jsx("p",{children:"• Cliquez à nouveau pour arrêter l'enregistrement"}),e.jsx("p",{children:"• Puis traitez votre enregistrement avec le bouton vert"})]})]})]})})},me=({textInput:s,onTextInputChange:a,onProcessText:r,isProcessing:t})=>{const{showToast:i}=W(),c=()=>{if(!s.trim()){i({type:"error",title:"Texte requis",message:"Veuillez décrire votre activité avant de continuer",duration:3e3});return}if(s.trim().length<10){i({type:"warning",title:"Description trop courte",message:"Ajoutez plus de détails sur votre activité pour une analyse précise",duration:3e3});return}r(s.trim())};return e.jsx(D,{className:"capture-text-container capture-stage-card capture-input-interface",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"capture-text-icon-3d",children:e.jsx("div",{className:"capture-text-icon-inner",children:e.jsx(l,{Icon:n.FileText,size:40,style:{color:"#8B5CF6"},variant:"pure"})})})}),e.jsx("h2",{className:"text-3xl font-bold text-white",children:"Saisie Manuelle"}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-md mx-auto",children:"Décrivez votre session d'activité physique en détail"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"activity-description",className:"block text-white/90 text-sm font-medium text-left",children:"Description de votre activité"}),e.jsx("textarea",{id:"activity-description",value:s,onChange:o=>a(o.target.value),className:"capture-text-input",placeholder:"Ex: J'ai fait 30 minutes de course à pied ce matin à intensité modérée, puis 10 minutes d'étirements pour récupérer..."}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-white/60 text-left",children:s.length<10?"Ajoutez plus de détails pour une analyse précise":"Description complète"}),e.jsxs("span",{className:`font-medium ${s.length<10?"text-orange-400":s.length<50?"text-yellow-400":"text-green-400"}`,children:[s.length," caractères"]})]})]}),s.trim()&&!t&&e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsx("button",{onClick:c,className:"capture-action-button-3d capture-action-button-3d-primary",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{Icon:n.Zap,size:24,className:"text-white"}),e.jsx("span",{children:"Processer ma Forge"})]})})}),e.jsxs("div",{className:"capture-text-hint",children:[e.jsxs("h4",{className:"text-purple-300 font-semibold mb-2 flex items-center gap-2",children:[e.jsx(l,{Icon:n.Info,size:16,style:{color:"#8B5CF6"}}),"Conseils pour une Description Optimale"]}),e.jsxs("div",{className:"text-purple-200 text-sm space-y-1 text-left",children:[e.jsx("p",{children:"• Décrivez clairement chaque activité et sa durée"}),e.jsx("p",{children:"• Précisez l'intensité (facile, modéré, intense, très intense)"}),e.jsx("p",{children:"• Ajoutez des détails sur le contexte (matin, soir, etc.)"}),e.jsx("p",{children:'• Exemple : "Course 45min intense + étirements 10min"'})]})]})]})})},ue=({connectedDevicesCount:s})=>{const a=U(),{click:r}=V(),{session:t}=X(),{devices:i,loading:c,syncing:o,syncDevice:p}=re(t?.user?.id||null),m=()=>{r(),a("/settings")},I=async()=>{if(r(),i.length>0)try{await p(i[0].id)}catch(g){console.error("Sync failed:",g)}};return e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4,ease:[.4,0,.2,1]},className:"space-y-4 capture-input-interface",children:e.jsx(D,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("div",{className:"w-24 h-24 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(34, 197, 94, 0.25) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05))
                `,border:"2px solid rgba(34, 197, 94, 0.3)",boxShadow:"0 0 40px rgba(34, 197, 94, 0.2)"},children:[e.jsx(l,{Icon:n.Watch,size:48,style:{color:"#22C55E"}}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-green-400 border-2 border-white/20 flex items-center justify-center",style:{boxShadow:"0 0 16px rgba(34, 197, 94, 0.6)"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:s})})]}),[...Array(3)].map((g,h)=>{const C=h*120-90,S=50,u=Math.cos(C*Math.PI/180)*S,b=Math.sin(C*Math.PI/180)*S;return e.jsx(E.div,{className:"absolute w-2 h-2 rounded-full bg-green-400",style:{left:"50%",top:"50%",marginLeft:"-4px",marginTop:"-4px",boxShadow:"0 0 12px rgba(34, 197, 94, 0.8)"},animate:{x:[0,u,0],y:[0,b,0],opacity:[.8,0,.8]},transition:{duration:2,repeat:1/0,delay:h*.66,ease:"easeInOut"}},h)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Synchronisation Active"}),e.jsx("p",{className:"text-white/70 text-base",children:"Vos activités sont automatiquement trackées par votre montre connectée"})]}),!c&&i.length>0&&e.jsx("div",{className:"space-y-3",children:i.slice(0,3).map(g=>e.jsx("div",{className:"p-4 rounded-xl text-left",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1))",border:"1px solid rgba(34, 197, 94, 0.3)"},children:e.jsx(l,{Icon:n.Watch,size:20,style:{color:"#22C55E"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:g.displayName||g.provider.toUpperCase()}),e.jsx("p",{className:"text-white/50 text-xs",children:g.lastSyncAt?`Dernière synchro: ${new Date(g.lastSyncAt).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}`:"Pas encore synchronisé"})]}),e.jsxs("div",{className:"px-2 py-1 rounded-full text-xs",style:{background:"rgba(34, 197, 94, 0.15)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#22C55E"},children:[g.status==="connected"&&"Connecté",g.status==="syncing"&&"Synchro...",g.status==="error"&&"Erreur"]})]})},g.id))}),e.jsx("div",{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)"},children:e.jsx(l,{Icon:n.Info,size:16,style:{color:"var(--color-plasma-cyan)"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-cyan-300 font-semibold text-sm mb-1",children:"Tracking Automatique"}),e.jsx("p",{className:"text-cyan-200/80 text-xs leading-relaxed",children:"Vos activités sont automatiquement enregistrées. Pas besoin de saisie manuelle ! Les données sont synchronisées en temps réel depuis votre montre."})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:I,disabled:o||c,className:"flex-1 px-6 py-3 rounded-xl font-semibold text-white transition-all duration-300",style:{background:o?"rgba(255, 255, 255, 0.1)":"linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(34, 197, 94, 0.2))",border:"1px solid rgba(34, 197, 94, 0.4)",boxShadow:o?"none":"0 4px 16px rgba(34, 197, 94, 0.2)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(l,{Icon:n.RefreshCw,size:20,className:o?"animate-spin":""}),e.jsx("span",{children:o?"Synchronisation...":"Synchroniser maintenant"})]})}),e.jsx("button",{onClick:m,className:"px-6 py-3 rounded-xl font-semibold text-white transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.15)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(l,{Icon:n.Settings,size:20}),e.jsx("span",{children:"Gérer"})]})})]})]})})},"wearable-interface")},xe=({isRecording:s,recordingDuration:a,audioBlob:r,onStartRecording:t,onStopRecording:i,onProcessAudio:c,onProcessText:o,isProcessing:p,selectedInputMode:m,onInputModeChange:I})=>{const[g,h]=k.useState(""),{hasConnectedWearable:C,connectedDevicesCount:S,loading:u}=Q();k.useEffect(()=>{!u&&C&&m===null&&I("wearable")},[C,u,m,I]);const b=v=>{h(v)},f=v=>{o(v)},F=[{id:"wearable",icon:"Watch",color:"#22C55E",title:"Objet Connecté",description:"Synchronisation automatique recommandée"},{id:"daily",icon:"Calendar",color:"#3B82F6",title:"Saisie Quotidienne",description:"Recommandé si pas d'objet connecté"},{id:"insights",icon:"Zap",color:"#8B5CF6",title:"Insights IA",description:"Analyse et recommandations personnalisées"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ce,{selectedInputMode:m,onInputModeChange:I}),e.jsxs(L,{mode:"wait",children:[m==="wearable"&&e.jsx(ue,{connectedDevicesCount:S},"wearable-interface"),m==="audio"&&e.jsx(de,{isRecording:s,recordingDuration:a,audioBlob:r,onStartRecording:t,onStopRecording:i,onProcessAudio:c,isProcessing:p},"audio-interface"),m==="text"&&e.jsx(me,{textInput:g,onTextInputChange:b,onProcessText:f,isProcessing:p},"text-interface")]}),e.jsx(te,{benefits:F,themeColor:"#3B82F6",title:"Pourquoi tracker mes activités ?"})]})},pe=({reduceMotion:s,progress:a})=>{const r={primary:"#3B82F6",secondary:"#06B6D4"};return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-24 h-24 mx-auto rounded-full flex items-center justify-center relative ${s?"":"breathing-icon"}`,style:{background:`
            radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
            radial-gradient(circle at 70% 70%, color-mix(in srgb, ${r.primary} 25%, transparent) 0%, transparent 50%),
            linear-gradient(135deg, color-mix(in srgb, ${r.primary} 50%, transparent), color-mix(in srgb, ${r.secondary} 40%, transparent))
          `,border:`4px solid color-mix(in srgb, ${r.primary} 70%, transparent)`,boxShadow:`
            0 0 40px color-mix(in srgb, ${r.primary} 70%, transparent),
            0 0 80px color-mix(in srgb, ${r.primary} 50%, transparent),
            0 0 120px color-mix(in srgb, ${r.secondary} 40%, transparent),
            inset 0 4px 0 rgba(255,255,255,0.5),
            inset 0 -2px 0 rgba(0,0,0,0.2)
          `,backdropFilter:"blur(20px) saturate(170%)",WebkitBackdropFilter:"blur(20px) saturate(170%)"},children:e.jsx(l,{Icon:n.Zap,size:48,style:{color:r.primary,filter:`
              drop-shadow(0 0 12px color-mix(in srgb, ${r.primary} 90%, transparent))
              drop-shadow(0 0 24px color-mix(in srgb, ${r.primary} 70%, transparent))
              drop-shadow(0 0 36px color-mix(in srgb, ${r.secondary} 50%, transparent))
            `},variant:"pure"})}),!s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-2 animate-ping",style:{borderColor:`color-mix(in srgb, ${r.primary} 50%, transparent)`,animationDuration:"2s"}}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 animate-ping",style:{borderColor:`color-mix(in srgb, ${r.secondary} 40%, transparent)`,animationDuration:"2.5s",animationDelay:"0.5s"}}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 animate-ping",style:{borderColor:`color-mix(in srgb, ${r.primary} 30%, transparent)`,animationDuration:"3s",animationDelay:"1s"}})]})]})},ge=({progress:s,reduceMotion:a})=>{const r={primary:"#3B82F6",secondary:"#06B6D4"},t=Math.min(100,Math.max(0,s));return e.jsxs("div",{className:"max-w-md mx-auto mt-6",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 overflow-hidden",children:e.jsx(E.div,{className:"h-2 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, 
              ${r.primary} 0%, 
              ${r.secondary} 50%, 
              ${r.primary} 100%
            )`,boxShadow:`
              0 0 12px color-mix(in srgb, ${r.primary} 60%, transparent),
              inset 0 1px 0 rgba(255,255,255,0.3)
            `,width:`${t}%`,transition:"width 0.8s ease-out"},initial:{width:0},animate:{width:`${t}%`},transition:{duration:.8,ease:"easeOut"},children:!a&&e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,animation:"energyShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"Initialisation"}),e.jsxs("span",{className:"font-bold text-white",style:{color:r.primary},children:[Math.round(t),"%"]}),e.jsx("span",{children:"Complété"})]})]})},he=({progress:s,reduceMotion:a})=>{const r=[{icon:"Volume2",label:"Décodage Énergétique",sublabel:"Extraction des données vocales",color:"#3B82F6",active:s>=10},{icon:"Target",label:"Analyse de Mouvement",sublabel:"Identification des activités",color:"#06B6D4",active:s>=40},{icon:"Zap",label:"Calcul Énergétique",sublabel:"Optimisation des métriques",color:"#10B981",active:s>=70}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-8",children:r.map((t,i)=>e.jsxs(E.div,{className:"p-6 rounded-xl relative overflow-hidden",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, ${t.color} ${t.active?"15":"8"}%, transparent) 0%, transparent 60%),
              rgba(255,255,255,${t.active?"0.08":"0.04"})
            `,border:`2px solid color-mix(in srgb, ${t.color} ${t.active?"40":"20"}%, transparent)`,backdropFilter:"blur(12px) saturate(140%)",WebkitBackdropFilter:"blur(12px) saturate(140%)",boxShadow:t.active?`0 0 20px color-mix(in srgb, ${t.color} 30%, transparent)`:`0 0 8px color-mix(in srgb, ${t.color} 15%, transparent)`,transition:"all 0.6s ease"},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:i*.2},children:[t.active&&!a&&e.jsx("div",{className:"absolute top-2 right-2 w-3 h-3 rounded-full",style:{background:t.color,boxShadow:`0 0 12px color-mix(in srgb, ${t.color} 80%, transparent)`,animation:"energyPulse 1.5s ease-in-out infinite"}}),e.jsx("div",{className:"flex items-center justify-center gap-3 mb-3",children:e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${t.active&&!a?"breathing-icon":""}`,style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${t.color} 40%, transparent), color-mix(in srgb, ${t.color} 30%, transparent))
                `,border:`2px solid color-mix(in srgb, ${t.color} 60%, transparent)`,boxShadow:`
                  0 0 20px color-mix(in srgb, ${t.color} 50%, transparent),
                  inset 0 2px 0 rgba(255,255,255,0.3)
                `},children:e.jsx(l,{Icon:n[t.icon],size:20,style:{color:t.color},variant:"pure"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-base font-bold mb-1",style:{color:t.color},children:t.label}),e.jsx("div",{className:"text-xs text-white/60",children:t.sublabel})]}),t.active&&!a&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 rounded-b-xl overflow-hidden",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  ${t.color} 50%, 
                  transparent 100%
                )`,animation:"energyFlow 2s ease-in-out infinite"}})]},t.label))})},be=({reduceMotion:s})=>s?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden rounded-inherit",children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-1 opacity-60",style:{left:"25%",borderRadius:"inherit",background:`linear-gradient(180deg, 
              transparent 0%, 
              color-mix(in srgb, #3B82F6 80%, transparent) 50%, 
              transparent 100%
            )`,animation:"energyScanVertical 3s ease-in-out infinite",animationDelay:"0s"}}),e.jsx("div",{className:"absolute top-0 bottom-0 w-1 opacity-60",style:{left:"75%",borderRadius:"inherit",background:`linear-gradient(180deg, 
              transparent 0%, 
              color-mix(in srgb, #06B6D4 80%, transparent) 50%, 
              transparent 100%
            )`,animation:"energyScanVertical 3s ease-in-out infinite",animationDelay:"1.5s"}})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden rounded-inherit",children:[...Array(8)].map((a,r)=>e.jsx("div",{className:"absolute w-2 h-2 rounded-full",style:{left:`${15+r*12}%`,top:`${20+r%3*25}%`,background:r%2===0?"#3B82F6":"#06B6D4",boxShadow:`0 0 12px color-mix(in srgb, ${r%2===0?"#3B82F6":"#06B6D4"} 80%, transparent)`,animation:"energyParticleFloat 4s ease-in-out infinite",animationDelay:`${r*.5}s`}},r))}),e.jsx("div",{className:"absolute inset-4 pointer-events-none overflow-hidden",style:{borderRadius:"inherit",background:`
            linear-gradient(90deg, color-mix(in srgb, #3B82F6 20%, transparent) 1px, transparent 1px),
            linear-gradient(180deg, color-mix(in srgb, #06B6D4 20%, transparent) 1px, transparent 1px)
          `,backgroundSize:"40px 40px",opacity:.3,animation:"energyGridPulse 2s ease-in-out infinite"}})]}),ve=({isProcessing:s,progress:a,currentMessage:r,subMessage:t})=>{const i=se()==="reduced";return e.jsx("div",{className:"space-y-6 relative overflow-hidden",children:e.jsxs(D,{className:"p-8 text-center relative overflow-hidden",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #3B82F6 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #06B6D4 12%, transparent) 0%, transparent 50%),
            linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08)),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #3B82F6 30%, transparent)",boxShadow:`
            0 20px 60px rgba(0, 0, 0, 0.4),
            0 0 40px color-mix(in srgb, #3B82F6 20%, transparent),
            0 0 80px color-mix(in srgb, #06B6D4 18%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.25),
            inset 0 -2px 0 rgba(0, 0, 0, 0.15)
          `,backdropFilter:"blur(28px) saturate(170%)",WebkitBackdropFilter:"blur(28px) saturate(170%)"},children:[e.jsx(be,{reduceMotion:i}),e.jsxs("div",{className:"space-y-6 relative z-10",children:[e.jsx(pe,{reduceMotion:i,progress:a}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:r||"Analyse de Forge en Cours"}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-lg mx-auto",children:t||"Votre empreinte énergétique est en cours de traitement par la Forge Spatiale"}),e.jsx(ge,{progress:a,reduceMotion:i})]}),e.jsx(he,{progress:a,reduceMotion:i})]})]})})},ye=()=>e.jsxs(D,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, #06B6D4 20%, transparent)",backdropFilter:"blur(16px) saturate(140%)"},children:[e.jsxs("h4",{className:"text-cyan-300 font-semibold mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #06B6D4 15%, transparent)",border:"1px solid color-mix(in srgb, #06B6D4 25%, transparent)"},children:e.jsx(l,{Icon:n.Info,size:14,style:{color:"#06B6D4"}})}),"Processus de la Forge Spatiale"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-300 font-medium",children:"Décodage Énergétique"}),e.jsx("div",{className:"text-blue-200 text-xs",children:"Transformation de votre voix en données structurées"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-cyan-300 font-medium",children:"Analyse de Mouvement"}),e.jsx("div",{className:"text-cyan-200 text-xs",children:"Identification précise de vos activités physiques"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-green-300 font-medium",children:"Calcul Énergétique"}),e.jsx("div",{className:"text-green-200 text-xs",children:"Estimation des calories et métriques de performance"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-purple-300 font-medium",children:"Optimisation Forge"}),e.jsx("div",{className:"text-purple-200 text-xs",children:"Personnalisation selon votre profil énergétique"})]})]})]})]})]}),fe=({progress:s,currentMessage:a,subMessage:r})=>{const t={primary:"#3B82F6"},i=()=>s<20?"Initialisation de la Forge Énergétique...":s<40?"Décodage de votre empreinte énergétique...":s<60?"Analyse des patterns de mouvement...":s<80?"Calcul des métriques énergétiques...":"Finalisation de l'analyse de Forge...",c=Math.min(100,Math.max(0,s));return e.jsx("div",{className:"mt-8 p-6 rounded-xl",style:{background:`
        radial-gradient(circle at center, color-mix(in srgb, ${t.primary} 8%, transparent) 0%, transparent 70%),
        rgba(255,255,255,0.04)
      `,border:`1px solid color-mix(in srgb, ${t.primary} 20%, transparent)`,backdropFilter:"blur(8px) saturate(120%)"},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{background:`color-mix(in srgb, ${t.primary} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${t.primary} 30%, transparent)`},children:e.jsx(l,{Icon:n.Zap,size:12,style:{color:t.primary}})}),"Forge Énergétique Active"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:i().includes("Initialisation")?"🔄":i().includes("Décodage")?"🎤":i().includes("Analyse")?"⚡":i().includes("Calcul")?"🔥":"✨"}),e.jsx("div",{className:"text-xs text-white/60",children:"Phase Active"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:t.primary},children:[Math.round(c),"%"]}),e.jsx("div",{className:"text-xs text-white/60",children:"Progression"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:s<50?"⏳":s<80?"⚡":"🎯"}),e.jsx("div",{className:"text-xs text-white/60",children:"Statut"})]})]})]})})},je=({isProcessing:s,progress:a,currentMessage:r,subMessage:t})=>e.jsxs("div",{className:"space-y-6 relative overflow-hidden",children:[e.jsx(ve,{isProcessing:s,progress:a,currentMessage:r,subMessage:t}),e.jsx(fe,{progress:a,currentMessage:r,subMessage:t}),e.jsx(ye,{}),e.jsx("style",{children:`
        @keyframes energyScanVertical {
          0%, 100% { transform: translateY(-100%); opacity: 0; }
          10%, 90% { opacity: 0.6; }
          50% { transform: translateY(0); opacity: 1; }
        }

        @keyframes energyParticleFloat {
          0%, 100% { transform: translateY(0) scale(1); opacity: 0.6; }
          25% { transform: translateY(-8px) scale(1.2); opacity: 1; }
          50% { transform: translateY(-4px) scale(0.9); opacity: 0.8; }
          75% { transform: translateY(-12px) scale(1.1); opacity: 1; }
        }

        @keyframes energyGridPulse {
          0%, 100% { opacity: 0.2; }
          50% { opacity: 0.4; }
        }

        @keyframes energyPulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.7; transform: scale(1.2); }
        }

        @keyframes energyShimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(200%); }
        }

        @keyframes energyFlow {
          0% { transform: translateX(-100%); opacity: 0; }
          50% { opacity: 1; }
          100% { transform: translateX(100%); opacity: 0; }
        }
      `})]}),Ne=({activities:s,totalCalories:a,totalDuration:r})=>e.jsxs(D,{className:"p-8 text-center",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-ember-copper) 15%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #F59E0B 12%, transparent) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, var(--color-ember-copper) 30%, transparent)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px color-mix(in srgb, var(--color-ember-copper) 20%, transparent),
          0 0 60px color-mix(in srgb, #F59E0B 15%, transparent),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center breathing-icon",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
              radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--color-ember-copper) 20%, transparent) 0%, transparent 50%),
              linear-gradient(135deg, color-mix(in srgb, var(--color-ember-copper) 45%, transparent), color-mix(in srgb, #F59E0B 35%, transparent))
            `,border:"3px solid color-mix(in srgb, var(--color-ember-copper) 70%, transparent)",boxShadow:`
              0 0 40px color-mix(in srgb, var(--color-ember-copper) 70%, transparent),
              0 0 80px color-mix(in srgb, var(--color-ember-copper) 50%, transparent),
              0 0 120px color-mix(in srgb, #F59E0B 40%, transparent),
              inset 0 4px 0 rgba(255,255,255,0.5),
              inset 0 -2px 0 rgba(0,0,0,0.2)
            `,backdropFilter:"blur(20px) saturate(170%)",WebkitBackdropFilter:"blur(20px) saturate(170%)"},children:e.jsx(l,{Icon:n.Fire,size:48,style:{color:"var(--color-ember-copper)",filter:`
                drop-shadow(0 0 12px color-mix(in srgb, var(--color-ember-copper) 90%, transparent))
                drop-shadow(0 0 24px color-mix(in srgb, var(--color-ember-copper) 70%, transparent))
                drop-shadow(0 0 36px color-mix(in srgb, #F59E0B 50%, transparent))
              `},variant:"pure"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline justify-center gap-2",children:[e.jsx("span",{className:"text-6xl md:text-7xl font-black leading-none",style:{color:"var(--color-ember-copper)",textShadow:`
                  0 0 20px color-mix(in srgb, var(--color-ember-copper) 60%, transparent),
                  0 0 40px color-mix(in srgb, var(--color-ember-copper) 40%, transparent),
                  0 0 60px color-mix(in srgb, #F59E0B 30%, transparent)
                `,letterSpacing:"-0.02em"},children:a}),e.jsx("span",{className:"text-2xl font-bold mb-2",style:{color:"color-mix(in srgb, var(--color-ember-copper) 80%, white)",textShadow:"0 0 12px color-mix(in srgb, var(--color-ember-copper) 40%, transparent)"},children:"kcal"})]}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Énergie Forgée"}),e.jsx("p",{className:"text-white/80 text-lg",children:"Votre session énergétique a été analysée avec succès"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center p-6 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)",backdropFilter:"blur(12px) saturate(130%)"},children:[e.jsx("div",{className:"text-3xl font-bold text-green-400 mb-2",children:s.length}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Activités"}),e.jsx("div",{className:"text-white/60 text-xs mt-1",children:"Forgées"})]}),e.jsxs("div",{className:"text-center p-6 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 10%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)",backdropFilter:"blur(12px) saturate(130%)"},children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400 mb-2",children:r}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Minutes"}),e.jsx("div",{className:"text-white/60 text-xs mt-1",children:"Actives"})]})]})]}),we=({activities:s,updateActivity:a,removeActivity:r})=>e.jsx("div",{className:"space-y-4",children:s.map((t,i)=>e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:i*.1},children:e.jsxs(D,{className:"p-6",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${P(t.intensity)} 8%, transparent) 0%, transparent 60%),
                var(--glass-opacity)
              `,borderColor:`color-mix(in srgb, ${P(t.intensity)} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                      linear-gradient(135deg, color-mix(in srgb, ${P(t.intensity)} 30%, transparent), color-mix(in srgb, ${P(t.intensity)} 20%, transparent))
                    `,border:`2px solid color-mix(in srgb, ${P(t.intensity)} 40%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${P(t.intensity)} 30%, transparent)`},children:e.jsx(l,{Icon:n[ae(t.type)],size:20,style:{color:P(t.intensity)}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:t.type}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Intensité ",ie(t.intensity)]})]})]}),e.jsx("button",{onClick:()=>r(i),className:"p-2 rounded-full transition-all duration-200",style:{background:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)"},title:"Supprimer cette activité",children:e.jsx(l,{Icon:n.Trash2,size:16,className:"text-red-400"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white/80 text-sm font-medium",children:"Durée (minutes)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a(i,{duration_min:Math.max(5,t.duration_min-5)}),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx(l,{Icon:n.Minus,size:14,className:"text-white"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-white font-bold text-lg",children:t.duration_min}),e.jsx("div",{className:"text-white/60 text-xs",children:"min"})]}),e.jsx("button",{onClick:()=>a(i,{duration_min:Math.min(300,t.duration_min+5)}),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx(l,{Icon:n.Plus,size:14,className:"text-white"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white/80 text-sm font-medium",children:"Intensité"}),e.jsxs("select",{value:t.intensity,onChange:c=>a(i,{intensity:c.target.value}),className:"glass-input w-full",children:[e.jsx("option",{value:"low",children:"Faible"}),e.jsx("option",{value:"medium",children:"Modérée"}),e.jsx("option",{value:"high",children:"Intense"}),e.jsx("option",{value:"very_high",children:"Très Intense"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white/80 text-sm font-medium",children:"Calories"}),e.jsxs("div",{className:"text-center",children:[e.jsx(E.div,{initial:{scale:1.2,opacity:.8},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"},className:"text-2xl font-bold text-white",children:t.calories_est},t.calories_est),e.jsx("div",{className:"text-white/60 text-xs",children:"kcal brûlées"})]})]})]}),t.notes&&e.jsx("div",{className:"mt-4 p-3 rounded-xl",style:{background:`color-mix(in srgb, ${P(t.intensity)} 6%, transparent)`,border:`1px solid color-mix(in srgb, ${P(t.intensity)} 15%, transparent)`},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(l,{Icon:n.FileText,size:14,style:{color:P(t.intensity)},className:"mt-0.5"}),e.jsx("p",{className:"text-white/80 text-sm",children:t.notes})]})})]})},i))}),Ie=({showAddForm:s,setShowAddForm:a,newActivity:r,setNewActivity:t,addNewActivity:i,profile:c})=>e.jsx(L,{children:s?e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsxs(D,{className:"p-6",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 60%),
                var(--glass-opacity)
              `,borderColor:"color-mix(in srgb, #8B5CF6 25%, transparent)"},children:[e.jsxs("h4",{className:"text-white font-bold text-lg mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #8B5CF6 30%, transparent), color-mix(in srgb, #8B5CF6 20%, transparent))
                  `,border:"2px solid color-mix(in srgb, #8B5CF6 40%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #8B5CF6 30%, transparent)"},children:e.jsx(l,{Icon:n.Plus,size:16,style:{color:"#8B5CF6"}})}),"Nouveau Mouvement"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Type d'activité"}),e.jsx("input",{type:"text",value:r.type||"",onChange:o=>t(p=>({...p,type:o.target.value})),className:"glass-input w-full",placeholder:"Ex: Course à pied, Musculation..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Durée (minutes)"}),e.jsx("input",{type:"number",value:r.duration_min||30,onChange:o=>t(p=>({...p,duration_min:parseInt(o.target.value)||30})),className:"glass-input w-full",min:"5",max:"300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Intensité"}),e.jsxs("select",{value:r.intensity||"medium",onChange:o=>t(p=>({...p,intensity:o.target.value})),className:"glass-input w-full",children:[e.jsx("option",{value:"low",children:"Faible"}),e.jsx("option",{value:"medium",children:"Modérée"}),e.jsx("option",{value:"high",children:"Intense"}),e.jsx("option",{value:"very_high",children:"Très Intense"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Notes (optionnel)"}),e.jsx("input",{type:"text",value:r.notes||"",onChange:o=>t(p=>({...p,notes:o.target.value})),className:"glass-input w-full",placeholder:"Détails supplémentaires..."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 add-form-submit-button-3d",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(l,{Icon:n.Check,size:16,className:"text-white"}),e.jsx("span",{children:"Ajouter"})]})}),e.jsx("button",{onClick:()=>{a(!1),t({type:"",duration_min:30,intensity:"medium",calories_est:0})},className:"add-form-cancel-button-3d",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{Icon:n.X,size:16}),e.jsx("span",{children:"Annuler"})]})})]})]})}):e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsx("button",{onClick:()=>a(!0),className:"add-activity-cta-3d",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"add-activity-icon-3d",children:e.jsx(l,{Icon:n.Plus,size:20,style:{color:"#8B5CF6"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold text-lg",children:"Ajouter un Mouvement"}),e.jsx("div",{className:"text-white/60 text-sm",children:"Enrichissez votre forge énergétique"})]})]})})})}),Ce=({forgeInsights:s})=>!s||s.length===0?null:e.jsxs(D,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #F59E0B 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, #F59E0B 20%, transparent)"},children:[e.jsxs("h4",{className:"text-white font-bold text-lg mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #F59E0B 30%, transparent), color-mix(in srgb, #F59E0B 20%, transparent))
            `,border:"2px solid color-mix(in srgb, #F59E0B 40%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(l,{Icon:n.Lightbulb,size:16,style:{color:"#F59E0B"}})}),"Insights de la Forge"]}),e.jsx("div",{className:"space-y-3",children:s.map((a,r)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 6%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 15%, transparent)"},children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center mt-0.5",style:{background:"color-mix(in srgb, #F59E0B 15%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 25%, transparent)"},children:e.jsx(l,{Icon:n.Zap,size:12,style:{color:"#F59E0B"}})}),e.jsx("p",{className:"text-white/80 text-sm flex-1",children:a})]},r))})]}),Se=({onCancel:s,handleSave:a,isSaving:r,isEditing:t})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center gap-3 p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 8%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #F59E0B 15%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 25%, transparent)"},children:e.jsx(l,{Icon:n.Edit,size:14,style:{color:"#F59E0B"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-orange-300 font-semibold",children:"Modifications détectées"}),e.jsx("div",{className:"text-orange-200 text-sm",children:"Vos ajustements seront sauvegardés"})]})]})}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:s,disabled:r,className:"px-6 py-3 text-lg font-semibold rounded-full",style:{background:"color-mix(in srgb, #6B7280 15%, transparent)",border:"1px solid color-mix(in srgb, #6B7280 25%, transparent)",color:"#9CA3AF",backdropFilter:"blur(12px) saturate(130%)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{Icon:n.X,size:18}),e.jsx("span",{children:"Annuler"})]})}),e.jsx("button",{onClick:a,disabled:r,className:"px-8 py-3 text-lg font-bold rounded-full relative overflow-hidden",style:{background:`linear-gradient(135deg, 
              color-mix(in srgb, #22C55E 80%, transparent), 
              color-mix(in srgb, #10B981 60%, transparent)
            )`,border:"2px solid color-mix(in srgb, #22C55E 60%, transparent)",boxShadow:`
              0 12px 40px color-mix(in srgb, #22C55E 40%, transparent),
              0 0 60px color-mix(in srgb, #22C55E 30%, transparent),
              inset 0 3px 0 rgba(255,255,255,0.4)
            `,backdropFilter:"blur(20px) saturate(160%)",color:"#fff",transition:"all 0.2s ease",opacity:r?.7:1},children:e.jsxs("div",{className:"flex items-center gap-2",children:[r?e.jsx(l,{Icon:n.Loader2,size:20,className:"text-white animate-spin"}):e.jsx(l,{Icon:n.Save,size:20,className:"text-white"}),e.jsx("span",{children:r?"Sauvegarde...":"Enregistrer ma Forge"})]})})]})]}),_e=({analysisResult:s,onComplete:a,onCancel:r})=>{const[t,i]=k.useState(s?.activities||[]),[c,o]=k.useState(!1),[p,m]=k.useState(!1),[I,g]=k.useState(!1),[h,C]=k.useState({type:"",duration_min:30,intensity:"medium",calories_est:0}),{success:S,click:u,error:b}=V(),{showToast:f}=W(),{profile:F,session:v}=X(),M=H(),O=t.reduce((d,x)=>d+x.calories_est,0),Y=t.reduce((d,x)=>d+x.duration_min,0),J=d=>{const x=F?.weight_kg||70;return Z(d.type,d.intensity,d.duration_min,x)},y=(d,x)=>{i(A=>{const j=[...A];return j[d]={...j[d],...x},(x.duration_min!==void 0||x.intensity!==void 0)&&(j[d].calories_est=J(j[d])),j}),o(!0)},B=d=>{i(x=>x.filter((A,j)=>j!==d)),o(!0)},$=()=>{if(!h.type||!h.duration_min){f({type:"error",title:"Informations manquantes",message:"Veuillez renseigner le type et la durée de l'activité",duration:3e3});return}const d=ne({type:h.type,duration_min:h.duration_min,intensity:h.intensity});if(!d.isValid){f({type:"error",title:"Données invalides",message:d.errors.join(", "),duration:4e3});return}const x=F?.weight_kg||70,A=Z(h.type,h.intensity,h.duration_min,x),j={type:h.type,duration_min:h.duration_min,intensity:h.intensity,calories_est:A,notes:h.notes};i(N=>[...N,j]),C({type:"",duration_min:30,intensity:"medium",calories_est:0}),g(!1),o(!0),S(),f({type:"success",title:"Activité ajoutée",message:"Nouvelle activité ajoutée à votre forge énergétique",duration:3e3})},T=async()=>{if(!v?.user?.id){b(),f({type:"error",title:"Erreur d'authentification",message:"Vous devez être connecté pour sauvegarder",duration:4e3});return}if(t.length===0){b(),f({type:"error",title:"Aucune activité à sauvegarder",message:"Ajoutez au moins une activité avant de sauvegarder",duration:3e3});return}m(!0);try{w.info("ACTIVITY_REVIEW","Saving activities to database",{userId:v.user.id,activitiesCount:t.length,totalCalories:O,totalDuration:Y,activitiesData:t.map(N=>({type:N.type,duration_min:N.duration_min,intensity:N.intensity,calories_est:N.calories_est})),timestamp:new Date().toISOString()});const d=new Date().toISOString(),x=t.map(N=>({user_id:v.user.id,type:N.type,duration_min:N.duration_min,intensity:N.intensity,calories_est:N.calories_est,notes:N.notes||null,timestamp:d,created_at:d}));w.info("ACTIVITY_REVIEW","Prepared activities for database insertion",{userId:v.user.id,activitiesToSave:x,totalActivities:x.length,timestamp:new Date().toISOString()});const{data:A,error:j}=await ee.from("activities").insert(x).select();if(j)throw w.error("ACTIVITY_REVIEW","Supabase insertion failed",{error:j.message,errorDetails:j,errorCode:j.code,errorHint:j.hint,userId:v.user.id,activitiesCount:t.length,timestamp:new Date().toISOString()}),j;w.info("ACTIVITY_REVIEW","Activities saved successfully",{userId:v.user.id,savedCount:A?.length||0,savedActivities:A?.map(N=>({id:N.id,type:N.type,duration_min:N.duration_min,calories_est:N.calories_est,timestamp:N.timestamp})),timestamp:new Date().toISOString()}),await M.invalidateQueries({queryKey:["activities","daily",v.user.id]}),await M.invalidateQueries({queryKey:["activities","stats",v.user.id]}),await M.invalidateQueries({queryKey:["activities","recent",v.user.id]}),S(),f({type:"success",title:"Forge Énergétique Sauvegardée",message:`${t.length} activité${t.length>1?"s":""} enregistrée${t.length>1?"s":""} avec succès`,duration:4e3}),setTimeout(()=>{a()},1e3)}catch(d){w.error("ACTIVITY_REVIEW","Failed to save activities",{error:d instanceof Error?d.message:"Unknown error",errorStack:d instanceof Error?d.stack:void 0,userId:v.user.id,activitiesCount:t.length,activitiesData:t.map(x=>({type:x.type,duration_min:x.duration_min,intensity:x.intensity,calories_est:x.calories_est})),timestamp:new Date().toISOString()}),b(),f({type:"error",title:"Erreur de Sauvegarde",message:d instanceof Error?`Erreur: ${d.message}. Vérifiez votre connexion et réessayez.`:"Impossible de sauvegarder vos activités. Réessayez.",duration:4e3})}finally{m(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ne,{activities:t,totalCalories:O,totalDuration:Y}),e.jsx(we,{activities:t,updateActivity:y,removeActivity:B}),e.jsx(Ie,{showAddForm:I,setShowAddForm:g,newActivity:h,setNewActivity:C,addNewActivity:$,profile:F}),e.jsx(Ce,{forgeInsights:s?.forgeInsights}),e.jsx(Se,{onCancel:r,handleSave:T,isSaving:p,isEditing:c})]})},ke="_wrap_1mo7s_11",Fe="_card_1mo7s_18",Te="_grid_1mo7s_32",Ae="_icon_1mo7s_42",Ee="_iconHalo_1mo7s_66",Be="_iconGlyph_1mo7s_77",De="_center_1mo7s_83",Pe="_title_1mo7s_91",ze="_subtitle_1mo7s_102",$e="_rail_1mo7s_112",Me="_seg_1mo7s_119",Ve="_segBlue_1mo7s_127",qe="_segCyan_1mo7s_131",Re="_isCurrent_1mo7s_135",Oe="_isComplete_1mo7s_139",Ye="_fill_1mo7s_143",Ue="_fillBlue_1mo7s_151",We="_fillCyan_1mo7s_157",Je="_step_1mo7s_164",Ge="_percent_1mo7s_173",_={wrap:ke,card:Fe,grid:Te,icon:Ae,iconHalo:Ee,iconGlyph:Be,center:De,title:Pe,subtitle:ze,rail:$e,seg:Me,segBlue:Ve,segCyan:qe,isCurrent:Re,isComplete:Oe,fill:Ye,fillBlue:Ue,fillCyan:We,step:Je,percent:Ge},Xe={capture:"Camera",analysis:"Scan",review:"Eye",complete:"Check"},Le=({steps:s,currentStepId:a,progress:r,message:t,subMessage:i,className:c=""})=>{const o=Number.isFinite(r)?Math.min(100,Math.max(0,r)):0,p=100/s.length,m=Math.max(0,s.findIndex(S=>S.id===a)),I=m*p,g=Math.max(0,Math.min(1,(o-I)/p)),h=Xe[a]||"Activity",C={gridTemplateColumns:`repeat(${s.length}, 1fr)`};return e.jsx("div",{className:`${_.wrap} ${c}`,children:e.jsx(D,{className:_.card,children:e.jsxs("div",{className:_.grid,"data-energy-forge":!0,children:[e.jsxs("div",{className:_.icon,children:[e.jsx("div",{className:_.iconHalo}),e.jsx(l,{Icon:n[h],size:26,className:_.iconGlyph})]}),e.jsxs("div",{className:_.center,children:[e.jsx("h2",{className:_.title,children:t||"Forge Énergétique"}),i&&e.jsx("p",{className:_.subtitle,children:i}),e.jsx("div",{className:_.rail,style:C,role:"progressbar","aria-valuenow":Math.round(o),"aria-valuemin":0,"aria-valuemax":100,children:s.map((S,u)=>{const b=u<m,f=u===m,F=b?"100%":f?`${g*100}%`:"0%",v=u%2===0?_.segBlue:_.segCyan,M=u%2===0?_.fillBlue:_.fillCyan;return e.jsx("div",{className:`${_.seg} ${v} ${b?_.isComplete:""} ${f?_.isCurrent:""}`,children:(b||f)&&e.jsx(E.span,{className:`${_.fill} ${M}`,initial:{width:0},animate:{width:F},transition:{duration:.45,ease:"easeOut"}})},S.id)})}),e.jsxs("div",{className:_.step,children:["Forge ",m+1," / ",s.length]})]}),e.jsxs("div",{className:_.percent,"aria-hidden":"true",children:[Math.round(o),"%"]})]})})})},nt=()=>{U();const{state:s,actions:a}=oe(),{profile:r,session:t}=X(),{showToast:i}=W(),{error:c}=V(),[o,p]=k.useState(!1),[m,I]=k.useState(0),[g,h]=k.useState(null),C=k.useRef(null),S=k.useRef(null),[u,b]=k.useState(null),[f,F]=k.useState(!1),v=k.useCallback(async()=>{try{const y=await navigator.mediaDevices.getUserMedia({audio:!0}),B=new MediaRecorder(y),$=[];B.ondataavailable=T=>{T.data.size>0&&$.push(T.data)},B.onstop=()=>{const T=new Blob($,{type:"audio/webm;codecs=opus"});h(T),y.getTracks().forEach(d=>d.stop())},B.start(),C.current=B,p(!0),I(0),S.current=setInterval(()=>{I(T=>T+1)},1e3),w.info("ACTIVITY_INPUT","Audio recording started",{userId:t?.user?.id,timestamp:new Date().toISOString()})}catch(y){w.error("ACTIVITY_INPUT","Failed to start recording",{error:y instanceof Error?y.message:"Unknown error"}),c(),i({type:"error",title:"Erreur Microphone",message:"Impossible d'accéder au microphone. Vérifiez les permissions.",duration:4e3})}},[t,c,i]),M=k.useCallback(()=>{C.current&&o&&(C.current.stop(),p(!1),S.current&&(clearInterval(S.current),S.current=null),w.info("ACTIVITY_INPUT","Audio recording stopped",{duration:m,userId:t?.user?.id,timestamp:new Date().toISOString()}))},[o,m,t]),O=k.useCallback(async()=>{if(!g){c(),i({type:"error",title:"Aucun Audio",message:"Veuillez d'abord enregistrer un audio",duration:3e3});return}if(!t?.user?.id){c(),i({type:"error",title:"Authentification requise",message:"Vous devez être connecté pour continuer",duration:4e3});return}F(!0),a.setStep("analysis",25,"Transcription Audio","Conversion de votre voix en texte...");try{const y=new FileReader,$=await new Promise((q,R)=>{y.onloadend=()=>{const K=y.result.split(",")[1];q(K)},y.onerror=R,y.readAsDataURL(g)});a.setAudioData($),w.info("ACTIVITY_INPUT","Calling activity-transcriber",{userId:t.user.id,audioSize:g.size,timestamp:new Date().toISOString()});const T="https://kwipydbtjagypocpvbwn.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U",x=await fetch(`${T}/functions/v1/activity-transcriber`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({audioBase64:$,userId:t.user.id,clientTraceId:`activity_transcription_${Date.now()}`})});if(!x.ok)throw new Error(`Transcription failed: ${x.statusText}`);const A=await x.json();a.setTranscriptionResult(A),w.info("ACTIVITY_INPUT","Transcription completed",{cleanText:A.cleanText,confidence:A.confidence,timestamp:new Date().toISOString()}),a.setStep("analysis",60,"Analyse Énergétique","Extraction et calcul des activités...");const j=await fetch(`${T}/functions/v1/activity-analyzer`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({text:A.cleanText,userId:t.user.id,userProfile:{weight_kg:r?.weight_kg||70,height_cm:r?.height_cm,sex:r?.sex,age:r?.birthdate?new Date().getFullYear()-new Date(r.birthdate).getFullYear():void 0},clientTraceId:`activity_analysis_${Date.now()}`})});if(!j.ok){let q=`Analysis failed: ${j.statusText}`;try{const R=await j.json();q=R.message||R.error||q,w.error("ACTIVITY_INPUT","API Error Details (Audio Path)",{status:j.status,statusText:j.statusText,errorData:R,timestamp:new Date().toISOString()})}catch{}throw new Error(q)}const N=await j.json();a.setAnalysisResult(N),w.info("ACTIVITY_INPUT","Analysis completed",{activitiesCount:N.activities.length,totalCalories:N.totalCalories,totalDuration:N.totalDuration,timestamp:new Date().toISOString()}),a.setStep("review",100,"Revue Énergétique","Validez vos activités avant sauvegarde")}catch(y){w.error("ACTIVITY_INPUT","Processing failed",{error:y instanceof Error?y.message:"Unknown error",userId:t.user.id,timestamp:new Date().toISOString()}),a.handleError(y instanceof Error?y.message:"Erreur lors du traitement de l'audio","analysis")}finally{F(!1)}},[g,t,r,a,c,i]),Y=k.useCallback(async y=>{if(!y||y.trim().length<10){c(),i({type:"error",title:"Texte trop court",message:"Veuillez saisir au moins 10 caractères",duration:3e3});return}if(!t?.user?.id){c(),i({type:"error",title:"Authentification requise",message:"Vous devez être connecté pour continuer",duration:4e3});return}F(!0),a.setStep("analysis",40,"Analyse Énergétique","Extraction et calcul des activités...");try{w.info("ACTIVITY_INPUT","Processing text input",{textLength:y.length,userId:t.user.id,timestamp:new Date().toISOString()});const T=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/activity-analyzer",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U","Content-Type":"application/json"},body:JSON.stringify({cleanText:y,userId:t.user.id,userProfile:{weight_kg:r?.weight_kg||70,height_cm:r?.height_cm,sex:r?.sex,age:r?.birthdate?new Date().getFullYear()-new Date(r.birthdate).getFullYear():void 0},clientTraceId:`activity_analysis_text_${Date.now()}`})});if(!T.ok){let x=`Analysis failed: ${T.statusText}`;try{const A=await T.json();x=A.message||A.error||x,w.error("ACTIVITY_INPUT","API Error Details (Text Path)",{status:T.status,statusText:T.statusText,errorData:A,timestamp:new Date().toISOString()})}catch{}throw new Error(x)}const d=await T.json();a.setAnalysisResult(d),w.info("ACTIVITY_INPUT","Text analysis completed",{activitiesCount:d.activities.length,totalCalories:d.totalCalories,totalDuration:d.totalDuration,timestamp:new Date().toISOString()}),a.setStep("review",100,"Revue Énergétique","Validez vos activités avant sauvegarde")}catch(B){w.error("ACTIVITY_INPUT","Text processing failed",{error:B instanceof Error?B.message:"Unknown error",userId:t.user.id,timestamp:new Date().toISOString()}),a.handleError(B instanceof Error?B.message:"Erreur lors de l'analyse du texte","analysis")}finally{F(!1)}},[t,r,a,c,i]),J=k.useCallback(y=>{b(y),h(null),I(0),w.info("ACTIVITY_INPUT","Input mode changed",{mode:y})},[]);return z.useEffect(()=>(a.startPipeline("capture"),()=>{S.current&&clearInterval(S.current),C.current&&o&&C.current.stop()}),[]),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"max-w-4xl mx-auto mt-4 space-y-6",children:[e.jsx(Le,{steps:s.steps,currentStepId:s.currentStep,progress:s.progress,message:s.message,subMessage:s.subMessage}),e.jsxs(L,{mode:"wait",children:[s.currentStep==="capture"&&e.jsx(E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(xe,{isRecording:o,recordingDuration:m,audioBlob:g,onStartRecording:v,onStopRecording:M,onProcessAudio:O,onProcessText:Y,isProcessing:f,selectedInputMode:u,onInputModeChange:J})},"capture"),s.currentStep==="analysis"&&e.jsx(E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(je,{isProcessing:f,progress:s.overallProgress,currentMessage:s.message,subMessage:s.subMessage})},"analysis"),s.currentStep==="review"&&e.jsx(E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(_e,{analysisResult:s.analysisResult,onComplete:a.completePipeline,onCancel:a.cancelPipeline})},"review")]})]})};export{nt as default};
