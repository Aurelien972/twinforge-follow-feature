var Re=Object.defineProperty;var Me=(t,s,a)=>s in t?Re(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var Z=(t,s,a)=>Me(t,typeof s!="symbol"?s+"":s,a);import{j as e,R as _,f as de,r as R,u as me}from"./vendor-DX97-qL9.js";import{G as F,S as o,I as n,u as re,a as Oe,P as Le,b as fe,c as ee}from"./ui-components-DWjWyKd7.js";import{u as K,l as h,c as ze,H as Be,s as W}from"./page-fridge-BvAjnJpI.js";import{m as P,A as X}from"./motion-DLE-fuXv.js";import{o as V,s as z,_ as J,n as B,p as we,a as ue,b as $,c as U}from"./forms-BNC8g0IA.js";import{b as G,f as Y}from"./stores-DcNfcD_j.js";import{u as He}from"./page-fridge-scan-ZLPWYd6x.js";import{b as qe,a as Ge}from"./date-utils-sCOX3Ksr.js";function $e(t,s,a){const i=typeof t=="number"&&!isNaN(t)&&t>0,r=typeof s=="number"&&!isNaN(s)&&s>0,c=a===void 0||typeof a=="number"&&!isNaN(a)&&a>0;return i&&r&&c}function ke(t,s){if(!t||!s||t<=0||s<=0)return 0;const a=s/100,i=t/(a*a);return!Number.isFinite(i)||Number.isNaN(i)?0:i}function Ue(t,s){const a=ke(t,s);return a===0?"--":a.toFixed(1)}function Ve(t,s){if(!t||!s||t<=0||s<=0)return"--";const a=t-s;return!Number.isFinite(a)||Number.isNaN(a)?"--":`${a>0?"+":""}${a.toFixed(1)} kg`}function We(t){return!Number.isFinite(t)||Number.isNaN(t)||t<=0?"--":t<18.5?"Insuffisant":t<25?"Normal":t<30?"Surpoids":"Obésité"}const Ye=({percentage:t,title:s,subtitle:a,color:i="#60A5FA"})=>e.jsxs(F,{className:"p-6 mb-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i} 8%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:`color-mix(in srgb, ${i} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-white font-semibold text-xl mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${i} 35%, transparent), color-mix(in srgb, ${i} 25%, transparent))
                `,border:`2px solid color-mix(in srgb, ${i} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${i} 30%, transparent)`},children:e.jsx(o,{Icon:n.User,size:20,style:{color:i},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:s}),a&&e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:a})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:i,boxShadow:`0 0 8px ${i}60`}}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[t,"%"]})]}),e.jsx("span",{className:"text-white/60 text-xs",children:"Complété"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(P.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${i}, color-mix(in srgb, ${i} 80%, white))`,boxShadow:`0 0 12px ${i}60, inset 0 1px 0 rgba(255,255,255,0.3)`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:1.2,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,animation:"progressShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]})]}),xe=({isDirty:t,isSaving:s,onSave:a,sectionName:i})=>{const{formSubmit:r}=K();return t?e.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>{r(),a()},disabled:s,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(o,{Icon:n.Loader2,size:14,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:14}),e.jsx("span",{children:s?"Sauvegarde...":`Sauvegarder ${i}`})]})})}):null},Ke=({height:t,weight:s,targetWeight:a})=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(F,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(52, 211, 153, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(52, 211, 153, 0.2)"},children:[e.jsxs("h3",{className:"text-white font-semibold text-xl mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(o,{Icon:n.Activity,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Calculs Automatiques"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Métriques calculées en temps réel"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-6 rounded-xl bg-emerald-500/10 border border-emerald-400/20",children:[e.jsx("div",{className:"text-3xl font-bold text-emerald-400 mb-2",children:Ue(s,t)}),e.jsx("div",{className:"text-emerald-300 text-sm font-medium",children:"Indice de Masse Corporelle"})]}),e.jsxs("div",{className:"text-center p-6 rounded-xl bg-blue-500/10 border border-blue-400/20",children:[e.jsx("div",{className:"text-xl font-bold text-blue-400 mb-2",children:We(ke(s,t))}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Catégorie"})]}),e.jsxs("div",{className:"text-center p-6 rounded-xl bg-purple-500/10 border border-purple-400/20",children:[e.jsx("div",{className:"text-xl font-bold text-purple-400 mb-2",children:Ve(a,s)}),e.jsx("div",{className:"text-purple-300 text-sm font-medium",children:"Objectif"})]})]})]})}),Je=V({displayName:z().min(1,"Le nom est requis").max(50,"Le nom ne peut pas dépasser 50 caractères"),sex:J(["male","female"],{required_error:"Le genre est requis"}),height_cm:we(t=>t===""||t===null||t===void 0?null:Number(t),B().nullable().refine(t=>t!==null&&t>0,{message:"La taille est requise et doit être supérieure à 0"}).refine(t=>t===null||t>=120&&t<=230,{message:"La taille doit être entre 120 et 230 cm"})),weight_kg:we(t=>t===""||t===null||t===void 0?null:Number(t),B().nullable().refine(t=>t!==null&&t>0,{message:"Le poids est requis et doit être supérieur à 0"}).refine(t=>t===null||t>=30&&t<=300,{message:"Le poids doit être entre 30 et 300 kg"})),birthdate:z().nullable().optional().transform(t=>!t||t===""?null:t),target_weight_kg:B().min(30,"Le poids cible doit être d'au moins 30 kg").max(300,"Le poids cible ne peut pas dépasser 300 kg").nullable().optional().transform(t=>t===0||!t?null:t),activity_level:J(["sedentary","light","moderate","active","athlete"]).nullable().optional().transform(t=>!t||t===""?null:t),objective:J(["fat_loss","recomp","muscle_gain"]).nullable().optional().transform(t=>!t||t===""?null:t),job_category:J(["office","field","shift","manual","student","other"]).nullable().optional().transform(t=>!t||t===""?null:t),phone_number:z().nullable().optional().transform(t=>!t||t===""?null:t),country:z().nullable().optional().transform(t=>!t||t===""?null:t)});function Ze(){const{profile:t,updateProfile:s,saving:a}=G(),{showToast:i}=re(),{success:r,formSubmit:c}=K(),[l,d]=_.useState(null),x=de({resolver:ue(Je),defaultValues:{displayName:t?.displayName||"",sex:t?.sex||"",height_cm:t?.height_cm??null,weight_kg:t?.weight_kg??null,birthdate:t?.birthdate||null,target_weight_kg:t?.target_weight_kg??null,activity_level:t?.activity_level||null,objective:t?.objective||null,job_category:t?.job_category||null,phone_number:t?.phoneNumber||null,country:t?.country||null},mode:"onChange"}),{register:u,handleSubmit:b,formState:w,watch:y,setValue:S,reset:m,trigger:g}=x,{errors:N,isValid:C,isDirty:j,dirtyFields:f}=w,v=y();_.useEffect(()=>{Y.getState().setTabDirty("identity",j)},[j]);const I=async()=>{d("required");try{if(!await g(["displayName","sex","height_cm","weight_kg"]))return;await s({displayName:v.displayName,sex:v.sex,height_cm:v.height_cm,weight_kg:v.weight_kg,updated_at:new Date().toISOString()}),m({displayName:v.displayName,sex:v.sex,height_cm:v.height_cm,weight_kg:v.weight_kg,birthdate:v.birthdate,target_weight_kg:v.target_weight_kg,activity_level:v.activity_level,objective:v.objective,job_category:v.job_category,phone_number:v.phone_number,country:v.country}),Y.getState().resetTabDirty("identity"),r(),i({type:"success",title:"Informations de base sauvegardées",message:"Vos informations essentielles ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les informations de base",duration:4e3})}finally{d(null)}},p=async()=>{d("optional");try{h.jsonLog("PROFILE_IDENTITY_SAVE_OPTIONAL","Starting optional section save",{watchedValues:{birthdate:v.birthdate,target_weight_kg:v.target_weight_kg,activity_level:v.activity_level,objective:v.objective,job_category:v.job_category,phone_number:v.phone_number,country:v.country},timestamp:new Date().toISOString()}),await s({birthdate:v.birthdate||null,target_weight_kg:v.target_weight_kg||null,activity_level:v.activity_level||null,objective:v.objective||null,job_category:v.job_category||null,phoneNumber:v.phone_number||null,country:v.country||null,updated_at:new Date().toISOString()}),m({displayName:v.displayName,sex:v.sex,height_cm:v.height_cm,weight_kg:v.weight_kg,birthdate:v.birthdate,target_weight_kg:v.target_weight_kg,activity_level:v.activity_level,objective:v.objective,job_category:v.job_category,phone_number:v.phone_number,country:v.country}),Y.getState().resetTabDirty("identity"),h.jsonLog("PROFILE_IDENTITY_SAVE_OPTIONAL_SUCCESS","Optional section save completed",{timestamp:new Date().toISOString()}),r(),i({type:"success",title:"Informations complémentaires sauvegardées",message:"Vos préférences ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les informations complémentaires",duration:4e3})}finally{d(null)}},T=async k=>{try{c(),h.info("PROFILE_IDENTITY","Submitting complete profile updates",{userId:t?.userId,philosophy:"complete_profile_submission"}),await s({displayName:k.displayName,sex:k.sex,height_cm:k.height_cm,weight_kg:k.weight_kg,birthdate:k.birthdate||null,target_weight_kg:k.target_weight_kg||null,activity_level:k.activity_level||null,objective:k.objective||null,job_category:k.job_category||null,phoneNumber:k.phone_number||null,country:k.country||null,updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Profil complet sauvegardé",message:"Toutes vos informations ont été mises à jour",duration:4e3}),Y.getState().resetTabDirty("identity"),m({displayName:k.displayName||"",sex:k.sex||"",height_cm:k.height_cm||null,weight_kg:k.weight_kg||null,birthdate:k.birthdate||null,target_weight_kg:k.target_weight_kg||null,activity_level:k.activity_level||null,objective:k.objective||null,job_category:k.job_category||null,phone_number:k.phone_number||null,country:k.country||null})}catch(D){h.error("PROFILE_IDENTITY","Profile update failed",{error:D instanceof Error?D.message:"Unknown error",userId:t?.userId}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder votre profil",duration:4e3})}},E=!!(f.displayName||f.sex||f.height_cm||f.weight_kg),A=!!(f.birthdate||f.target_weight_kg||f.activity_level||f.objective||f.job_category||f.phone_number||f.country);return{form:{register:u,handleSubmit:b,errors:N,isValid:C,isDirty:j,dirtyFields:f,watchedValues:v,setValue:S,trigger:g},actions:{saveRequiredSection:I,saveOptionalSection:p,onSubmit:T},state:{saving:a,sectionSaving:l,hasRequiredChanges:E,hasOptionalChanges:A}}}function ae(t,s){const a=s.split(".");let i=t;for(const r of a){if(!i||i[r]===void 0||i[r]===null)return!1;i=i[r]}return s==="nutrition.allergies"?t?.nutrition?.noKnownAllergies===!0?!0:Array.isArray(i)&&i.length>0:s==="nutrition.intolerances"?Array.isArray(i):typeof i=="string"?i.trim()!=="":Array.isArray(i)?i.length>0:typeof i=="boolean"?!0:typeof i=="object"?Object.keys(i).length>0:typeof i=="number"?new Set(["householdDetails.children","sensoryPreferences.spiceTolerance"]).has(s)?Number.isFinite(i)&&i>=0:Number.isFinite(i)&&i>0:!0}function Xe(t){if(!t)return 0;const s=["displayName","sex","height_cm","weight_kg","birthdate","target_weight_kg","activity_level","objective","job_category","phoneNumber"],a=s.filter(i=>ae(t,i));return Math.round(a.length/s.length*100)}function Qe(t){if(!t)return 0;const s=["nutrition.diet","nutrition.budgetLevel","nutrition.allergies","nutrition.intolerances","householdDetails.adults","householdDetails.children","mealPrepPreferences.weekdayTimeMin","mealPrepPreferences.weekendTimeMin","mealPrepPreferences.cookingSkill","kitchenEquipment.oven","kitchenEquipment.stove","kitchenEquipment.microwave","foodPreferences.cuisines","foodPreferences.ingredients","sensoryPreferences.spiceTolerance","shoppingPreferences.frequencyPerWeek"];let a=0;const i=s.length;for(const c of s)ae(t,c)&&a++;return Math.max(0,Math.min(100,Math.round(a/i*100)))}function et(t){if(!t)return 0;const s=["fastingWindow.protocol","fastingWindow.start","fastingWindow.end","fastingWindow.windowHours","fastingWindow.mealsPerDay","nutrition.proteinTarget_g","macroTargets.kcal"],a=s.filter(i=>ae(t,i));return Math.round(a.length/s.length*100)}function tt(t){if(!t)return 0;const s=t.health;if(!s)return 0;if(s.version==="2.0"){const r=["health.basic.bloodType","health.medical_history.conditions","health.medical_history.medications","health.medical_history.family_history","health.vital_signs.blood_pressure_systolic","health.vital_signs.resting_heart_rate","health.lifestyle.smoking_status","health.lifestyle.alcohol_frequency","health.lifestyle.sleep_hours_avg","health.lifestyle.stress_level","health.lifestyle.physical_activity_level","health.vaccinations.up_to_date","health.physical_limitations","health.last_checkup_date"],c=r.filter(l=>ae(t,l));return Math.round(c.length/r.length*100)}const a=["health.bloodType","health.conditions","health.medications","health.physicalLimitations","constraints"],i=a.filter(r=>ae(t,r));return Math.round(i.length/a.length*100)}const st=_.memo(()=>{const{form:t,actions:s,state:a}=Ze(),{register:i,handleSubmit:r,errors:c,isValid:l,isDirty:d,watchedValues:x}=t,{saveRequiredSection:u,onSubmit:b}=s,{saving:w,sectionSaving:y,hasRequiredChanges:S,hasOptionalChanges:m}=a,{profile:g}=G(),N=()=>{const j=document.getElementById("global-save-button-container");j&&j.scrollIntoView({behavior:"smooth"})},C=Xe(g);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ye,{percentage:C,title:"Identité Personnelle",subtitle:"Vos informations de base et mesures corporelles",color:"#60A5FA"}),e.jsxs("form",{onSubmit:r(b),className:"space-y-6",children:[e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(96, 165, 250, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(96, 165, 250, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #60A5FA 35%, transparent), color-mix(in srgb, #60A5FA 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #60A5FA 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #60A5FA 30%, transparent)"},children:e.jsx(o,{Icon:n.User,size:20,style:{color:"#60A5FA"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Informations Essentielles"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Vos données de base et mesures corporelles"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-sm font-medium",children:"Requis"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"displayName",className:"block text-white/90 text-sm font-medium mb-3",children:"Nom d'affichage *"}),e.jsx("input",{...i("displayName"),type:"text",id:"displayName",className:"glass-input",placeholder:"Votre nom"}),c.displayName&&e.jsxs("p",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.displayName.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sex",className:"block text-white/90 text-sm font-medium mb-3",children:"Genre *"}),e.jsxs("select",{...i("sex"),id:"sex",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre genre"}),e.jsx("option",{value:"male",children:"Homme"}),e.jsx("option",{value:"female",children:"Femme"})]}),c.sex&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.sex.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"height_cm",className:"block text-white/90 text-sm font-medium mb-3",children:"Taille (cm) *"}),e.jsx("input",{...i("height_cm",{valueAsNumber:!0}),type:"number",id:"height_cm",min:"120",max:"230",step:"1",className:"glass-input",placeholder:"175"}),c.height_cm&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.height_cm.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"weight_kg",className:"block text-white/90 text-sm font-medium mb-3",children:"Poids (kg) *"}),e.jsx("input",{...i("weight_kg",{valueAsNumber:!0}),type:"number",id:"weight_kg",min:"30",max:"300",step:"0.1",className:"glass-input",placeholder:"70"}),c.weight_kg&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.weight_kg.message]})]})]}),e.jsx(xe,{isDirty:S,isSaving:y==="required",onSave:u,sectionName:"Essentielles"})]}),e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(96, 165, 250, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(96, 165, 250, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #60A5FA 35%, transparent), color-mix(in srgb, #60A5FA 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #60A5FA 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #60A5FA 30%, transparent)"},children:e.jsx(o,{Icon:n.Calendar,size:20,style:{color:"#60A5FA"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Détails Personnels"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Informations complémentaires et contexte"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-blue-300 text-sm font-medium",children:"Optionnel"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"birthdate",className:"block text-white/90 text-sm font-medium mb-3",children:"Date de naissance"}),e.jsx("input",{...i("birthdate"),type:"date",id:"birthdate",className:"glass-input"}),c.birthdate&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.birthdate.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone_number",className:"block text-white/90 text-sm font-medium mb-3",children:"Numéro de téléphone"}),e.jsx("input",{...i("phone_number"),type:"tel",id:"phone_number",className:"glass-input",placeholder:"+33 6 12 34 56 78"}),c.phone_number&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.phone_number.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-white/90 text-sm font-medium mb-3",children:"Pays"}),e.jsxs("select",{...i("country"),id:"country",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre pays"}),e.jsx("option",{value:"Belgique",children:"Belgique"}),e.jsx("option",{value:"Bénin",children:"Bénin"}),e.jsx("option",{value:"Burkina Faso",children:"Burkina Faso"}),e.jsx("option",{value:"Burundi",children:"Burundi"}),e.jsx("option",{value:"Cameroun",children:"Cameroun"}),e.jsx("option",{value:"Canada",children:"Canada"}),e.jsx("option",{value:"Centrafrique",children:"Centrafrique"}),e.jsx("option",{value:"Comores",children:"Comores"}),e.jsx("option",{value:"Congo",children:"Congo"}),e.jsx("option",{value:"Congo (RDC)",children:"Congo (RDC)"}),e.jsx("option",{value:"Côte d'Ivoire",children:"Côte d'Ivoire"}),e.jsx("option",{value:"Djibouti",children:"Djibouti"}),e.jsx("option",{value:"France",children:"France"}),e.jsx("option",{value:"Gabon",children:"Gabon"}),e.jsx("option",{value:"Guinée",children:"Guinée"}),e.jsx("option",{value:"Guinée équatoriale",children:"Guinée équatoriale"}),e.jsx("option",{value:"Guyane",children:"Guyane"}),e.jsx("option",{value:"Guadeloupe",children:"Guadeloupe"}),e.jsx("option",{value:"Haïti",children:"Haïti"}),e.jsx("option",{value:"Luxembourg",children:"Luxembourg"}),e.jsx("option",{value:"Madagascar",children:"Madagascar"}),e.jsx("option",{value:"Mali",children:"Mali"}),e.jsx("option",{value:"Maroc",children:"Maroc"}),e.jsx("option",{value:"Martinique",children:"Martinique"}),e.jsx("option",{value:"Maurice",children:"Maurice"}),e.jsx("option",{value:"Mauritanie",children:"Mauritanie"}),e.jsx("option",{value:"Mayotte",children:"Mayotte"}),e.jsx("option",{value:"Monaco",children:"Monaco"}),e.jsx("option",{value:"Niger",children:"Niger"}),e.jsx("option",{value:"Nouvelle-Calédonie",children:"Nouvelle-Calédonie"}),e.jsx("option",{value:"Polynésie française",children:"Polynésie française"}),e.jsx("option",{value:"Réunion",children:"Réunion"}),e.jsx("option",{value:"Rwanda",children:"Rwanda"}),e.jsx("option",{value:"Saint-Barthélemy",children:"Saint-Barthélemy"}),e.jsx("option",{value:"Saint-Martin",children:"Saint-Martin"}),e.jsx("option",{value:"Saint-Pierre-et-Miquelon",children:"Saint-Pierre-et-Miquelon"}),e.jsx("option",{value:"Sénégal",children:"Sénégal"}),e.jsx("option",{value:"Seychelles",children:"Seychelles"}),e.jsx("option",{value:"Suisse",children:"Suisse"}),e.jsx("option",{value:"Tchad",children:"Tchad"}),e.jsx("option",{value:"Togo",children:"Togo"}),e.jsx("option",{value:"Tunisie",children:"Tunisie"}),e.jsx("option",{value:"Vanuatu",children:"Vanuatu"}),e.jsx("option",{value:"Wallis-et-Futuna",children:"Wallis-et-Futuna"}),e.jsx("option",{value:"Afrique du Sud",children:"Afrique du Sud"}),e.jsx("option",{value:"Australie",children:"Australie"}),e.jsx("option",{value:"États-Unis",children:"États-Unis"}),e.jsx("option",{value:"Inde",children:"Inde"}),e.jsx("option",{value:"Irlande",children:"Irlande"}),e.jsx("option",{value:"Jamaïque",children:"Jamaïque"}),e.jsx("option",{value:"Kenya",children:"Kenya"}),e.jsx("option",{value:"Nigéria",children:"Nigéria"}),e.jsx("option",{value:"Nouvelle-Zélande",children:"Nouvelle-Zélande"}),e.jsx("option",{value:"Royaume-Uni",children:"Royaume-Uni"}),e.jsx("option",{value:"Singapour",children:"Singapour"})]}),c.country&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.country.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"job_category",className:"block text-white/90 text-sm font-medium mb-3",children:"Catégorie professionnelle"}),e.jsxs("select",{...i("job_category"),id:"job_category",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre activité"}),e.jsx("option",{value:"office",children:"Bureau"}),e.jsx("option",{value:"field",children:"Terrain"}),e.jsx("option",{value:"shift",children:"Équipes"}),e.jsx("option",{value:"manual",children:"Manuel"}),e.jsx("option",{value:"student",children:"Étudiant"}),e.jsx("option",{value:"other",children:"Autre"})]}),c.job_category&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.job_category.message]})]})]}),e.jsx(xe,{isDirty:m,isSaving:!1,onSave:N,sectionName:"Personnels"})]}),e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(96, 165, 250, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(96, 165, 250, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #60A5FA 35%, transparent), color-mix(in srgb, #60A5FA 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #60A5FA 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #60A5FA 30%, transparent)"},children:e.jsx(o,{Icon:n.Target,size:20,style:{color:"#60A5FA"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Objectifs Fitness"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Vos cibles et préférences d'entraînement"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-blue-300 text-sm font-medium",children:"Recommandé"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"target_weight_kg",className:"block text-white/90 text-sm font-medium mb-3",children:"Poids cible (kg)"}),e.jsx("input",{...i("target_weight_kg",{valueAsNumber:!0}),type:"number",id:"target_weight_kg",min:"30",max:"300",step:"0.1",className:"glass-input",placeholder:"65"}),c.target_weight_kg&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.target_weight_kg.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"activity_level",className:"block text-white/90 text-sm font-medium mb-3",children:"Niveau d'activité"}),e.jsxs("select",{...i("activity_level"),id:"activity_level",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre niveau"}),e.jsx("option",{value:"sedentary",children:"Sédentaire"}),e.jsx("option",{value:"light",children:"Léger"}),e.jsx("option",{value:"moderate",children:"Modéré"}),e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"athlete",children:"Athlète"})]}),c.activity_level&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.activity_level.message]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"objective",className:"block text-white/90 text-sm font-medium mb-3",children:"Objectif principal"}),e.jsxs("select",{...i("objective"),id:"objective",className:"glass-input",children:[e.jsx("option",{value:"",children:"Sélectionnez votre objectif"}),e.jsx("option",{value:"fat_loss",children:"Perte de graisse"}),e.jsx("option",{value:"recomp",children:"Recomposition corporelle"}),e.jsx("option",{value:"muscle_gain",children:"Prise de muscle"})]}),c.objective&&e.jsxs("div",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),c.objective.message]})]})]}),e.jsx(xe,{isDirty:m,isSaving:!1,onSave:N,sectionName:"Fitness"})]}),$e(x.height_cm,x.weight_kg,x.target_weight_kg)&&e.jsx(Ke,{height:x.height_cm,weight:x.weight_kg,targetWeight:x.target_weight_kg}),e.jsx("div",{id:"global-save-button-container",className:"flex justify-center pt-4",children:e.jsx("button",{type:"submit",disabled:w||!d||!l,className:`btn-glass--primary px-8 py-4 text-lg font-semibold ${!d||!l?"opacity-50 cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[w?e.jsx(o,{Icon:n.Loader2,size:20,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:20}),e.jsx("span",{children:w?"Sauvegarde globale...":l?d?"Sauvegarder Tout":"Aucun changement":`Erreurs (${Object.keys(c).length})`})]})})}),Object.keys(c).length>0&&e.jsxs(F,{className:"p-4",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h4",{className:"text-red-300 font-medium mb-3 flex items-center gap-2",children:[e.jsx(o,{Icon:n.AlertCircle,size:16}),"Erreurs de validation (",Object.keys(c).length,")"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(c).map(([j,f])=>e.jsxs("div",{className:"text-red-200 text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),e.jsxs("strong",{children:[j,":"]})," ",f.message]},j))})]})]})]})});st.displayName="ProfileIdentityTab";const he=V({name:z().min(1,"Le nom est requis"),state:J(["like","neutral","dislike","ban"]),intensity:B().min(1).max(5).optional()}),it=V({adults:B().min(1).max(20).default(1),children:B().min(0).max(20).default(0),dietaryRestrictions:U(z()).default([])}),at=V({weekdayTimeMin:B().min(5).max(180).default(30),weekendTimeMin:B().min(5).max(300).default(60),cookingSkill:J(["beginner","intermediate","advanced"]).default("intermediate"),preferredMealTimes:V({breakfast:z().optional(),lunch:z().optional(),dinner:z().optional()}).optional()}),rt=V({oven:$().default(!0),stove:$().default(!0),microwave:$().default(!0),airFryer:$().default(!1),slowCooker:$().default(!1),blender:$().default(!1),foodProcessor:$().default(!1),standMixer:$().default(!1),riceCooker:$().default(!1),grill:$().default(!1),steamBasket:$().default(!1),pressureCooker:$().default(!1)}),nt=V({cuisines:U(he).default([]),ingredients:U(he).default([]),flavors:U(he).default([])}),lt=V({spiceTolerance:B().min(0).max(3).default(1),textureAversions:U(z()).default([]),temperaturePreferences:U(z()).default([])}),ot=V({kcal:B().min(800).max(5e3).optional(),fiberMinG:B().min(0).max(100).optional(),sugarMaxG:B().min(0).max(200).optional(),saltMaxMg:B().min(0).max(1e4).optional(),carbsMaxG:B().min(0).max(1e3).optional(),fatMinG:B().min(0).max(300).optional()}),ct=V({frequencyPerWeek:B().min(1).max(7).default(2),defaultPortionsPerMeal:B().min(1).max(12).default(2),batchCooking:J(["never","sometimes","often"]).default("sometimes"),bias:U(z()).default([]),preferredStores:U(z()).default([]),budgetPerWeek:B().min(0).max(1e3).optional()}),dt=V({diet:z().optional(),allergies:U(z()).default([]),intolerances:U(z()).default([]),budgetLevel:J(["low","medium","high"]).optional(),noKnownAllergies:$().default(!1),householdDetails:it.optional(),mealPrepPreferences:at.optional(),kitchenEquipment:rt.optional(),foodPreferences:nt.optional(),sensoryPreferences:lt.optional(),macroTargets:ot.optional(),shoppingPreferences:ct.optional()});function mt(){const{profile:t,updateProfile:s,saving:a}=G(),{showToast:i}=re(),{success:r,formSubmit:c}=K(),[l,d]=_.useState(null),x=de({resolver:ue(dt),defaultValues:{diet:t?.nutrition?.diet||"",allergies:t?.nutrition?.allergies||[],intolerances:t?.nutrition?.intolerances||[],budgetLevel:t?.nutrition?.budgetLevel||void 0,noKnownAllergies:t?.nutrition?.noKnownAllergies??!1,householdDetails:{adults:t?.householdDetails?.adults||1,children:t?.householdDetails?.children||0,dietaryRestrictions:t?.householdDetails?.dietaryRestrictions||[]},mealPrepPreferences:{weekdayTimeMin:t?.mealPrepPreferences?.weekdayTimeMin||30,weekendTimeMin:t?.mealPrepPreferences?.weekendTimeMin||60,cookingSkill:t?.mealPrepPreferences?.cookingSkill||"intermediate",preferredMealTimes:t?.mealPrepPreferences?.preferredMealTimes||{}},kitchenEquipment:{oven:t?.kitchenEquipment?.oven??!0,stove:t?.kitchenEquipment?.stove??!0,microwave:t?.kitchenEquipment?.microwave??!0,airFryer:t?.kitchenEquipment?.airFryer??!1,slowCooker:t?.kitchenEquipment?.slowCooker??!1,blender:t?.kitchenEquipment?.blender??!1,foodProcessor:t?.kitchenEquipment?.foodProcessor??!1,standMixer:t?.kitchenEquipment?.standMixer??!1,riceCooker:t?.kitchenEquipment?.riceCooker??!1,grill:t?.kitchenEquipment?.grill??!1,steamBasket:t?.kitchenEquipment?.steamBasket??!1,pressureCooker:t?.kitchenEquipment?.pressureCooker??!1},foodPreferences:{cuisines:t?.foodPreferences?.cuisines||[],ingredients:t?.foodPreferences?.ingredients||[],flavors:t?.foodPreferences?.flavors||[]},sensoryPreferences:{spiceTolerance:t?.sensoryPreferences?.spiceTolerance||1,textureAversions:t?.sensoryPreferences?.textureAversions||[],temperaturePreferences:t?.sensoryPreferences?.temperaturePreferences||[]},macroTargets:{kcal:t?.macroTargets?.kcal||void 0,fiberMinG:t?.macroTargets?.fiberMinG||void 0,sugarMaxG:t?.macroTargets?.sugarMaxG||void 0,saltMaxMg:t?.macroTargets?.saltMaxMg||void 0,carbsMaxG:t?.macroTargets?.carbsMaxG||void 0,fatMinG:t?.macroTargets?.fatMinG||void 0},shoppingPreferences:{frequencyPerWeek:t?.shoppingPreferences?.frequencyPerWeek||2,defaultPortionsPerMeal:t?.shoppingPreferences?.defaultPortionsPerMeal||2,batchCooking:t?.shoppingPreferences?.batchCooking||"sometimes",bias:t?.shoppingPreferences?.bias||[],preferredStores:t?.shoppingPreferences?.preferredStores||[],budgetPerWeek:t?.shoppingPreferences?.budgetPerWeek||void 0}},mode:"onChange"}),{register:u,handleSubmit:b,formState:w,watch:y,setValue:S,reset:m,trigger:g}=x,{errors:N,isDirty:C,dirtyFields:j}=w,f=y();_.useEffect(()=>{Y.getState().setTabDirty("nutrition",C)},[C]);const v=async()=>{d("diet");try{await s({nutrition:{...t?.nutrition,diet:f.diet,budgetLevel:f.budgetLevel},updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Régime alimentaire sauvegardé",message:"Vos préférences alimentaires ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder le régime alimentaire",duration:4e3})}finally{d(null)}},I=async()=>{d("restrictions");try{h.debug("PROFILE_NUTRITION_RESTRICTIONS","Saving restrictions section",{allergies:f.allergies,intolerances:f.intolerances,noKnownAllergies:f.noKnownAllergies,userId:t?.userId,philosophy:"restrictions_save_debug"}),await s({nutrition:{...t?.nutrition,allergies:f.allergies,intolerances:f.intolerances,noKnownAllergies:f.noKnownAllergies??!1},updated_at:new Date().toISOString()}),r(),h.debug("PROFILE_NUTRITION_RESTRICTIONS","Restrictions section saved successfully",{userId:t?.userId,philosophy:"restrictions_save_success"}),i({type:"success",title:"Restrictions alimentaires sauvegardées",message:"Vos allergies et intolérances ont été mises à jour",duration:3e3})}catch(O){h.error("PROFILE_NUTRITION_RESTRICTIONS","Failed to save restrictions section",{error:O instanceof Error?O.message:"Unknown error",userId:t?.userId,philosophy:"restrictions_save_error"}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les restrictions",duration:4e3})}finally{d(null)}},p=async()=>{d("essentials");try{await s({householdDetails:f.householdDetails,mealPrepPreferences:f.mealPrepPreferences,kitchenEquipment:f.kitchenEquipment,updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Informations essentielles sauvegardées",message:"Votre foyer et préférences de cuisine ont été mis à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les informations essentielles",duration:4e3})}finally{d(null)}},T=async()=>{d("preferences");try{await s({foodPreferences:f.foodPreferences,sensoryPreferences:f.sensoryPreferences,updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Préférences alimentaires sauvegardées",message:"Vos goûts et préférences ont été mis à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les préférences",duration:4e3})}finally{d(null)}},E=async()=>{d("nutrition");try{await s({macroTargets:f.macroTargets,updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Objectifs nutritionnels sauvegardés",message:"Vos cibles nutritionnelles ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les objectifs nutritionnels",duration:4e3})}finally{d(null)}},A=async()=>{d("shopping");try{await s({shoppingPreferences:f.shoppingPreferences,updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Préférences de courses sauvegardées",message:"Vos habitudes de courses ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les préférences de courses",duration:4e3})}finally{d(null)}},k=async O=>{try{c(),h.debug("PROFILE_NUTRITION_SUBMIT","Submitting complete nutrition form",{nutritionData:{diet:O.diet,allergies:O.allergies,intolerances:O.intolerances,noKnownAllergies:O.noKnownAllergies,budgetLevel:O.budgetLevel},userId:t?.userId,philosophy:"complete_nutrition_submit_debug"}),h.info("PROFILE_NUTRITION","Submitting complete enhanced nutrition updates",{userId:t?.userId,philosophy:"complete_enhanced_nutrition_submission"}),await s({nutrition:{...t?.nutrition,diet:O.diet,allergies:O.allergies,intolerances:O.intolerances,budgetLevel:O.budgetLevel,noKnownAllergies:O.noKnownAllergies??!1},householdDetails:O.householdDetails,mealPrepPreferences:O.mealPrepPreferences,kitchenEquipment:O.kitchenEquipment,foodPreferences:O.foodPreferences,sensoryPreferences:O.sensoryPreferences,macroTargets:O.macroTargets,shoppingPreferences:O.shoppingPreferences,updated_at:new Date().toISOString()}),r(),h.debug("PROFILE_NUTRITION_SUBMIT","Complete nutrition form submitted successfully",{userId:t?.userId,philosophy:"complete_nutrition_submit_success"}),i({type:"success",title:"Profil nutritionnel complet sauvegardé",message:"Toutes vos données nutritionnelles ont été mises à jour",duration:4e3}),Y.getState().resetTabDirty("nutrition")}catch(le){h.error("PROFILE_NUTRITION_SUBMIT","Complete nutrition form submission failed",{error:le instanceof Error?le.message:"Unknown error",userId:t?.userId,philosophy:"complete_nutrition_submit_error"}),h.error("PROFILE_NUTRITION","Enhanced nutrition update failed",{error:le instanceof Error?le.message:"Unknown error",userId:t?.userId}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder votre profil nutritionnel",duration:4e3})}},D=!!(j.diet||j.budgetLevel),M=!!(j.allergies||j.intolerances||j.noKnownAllergies),H=!!(j.householdDetails||j.mealPrepPreferences||j.kitchenEquipment),L=!!(j.foodPreferences||j.sensoryPreferences),q=!!j.macroTargets,te=!!j.shoppingPreferences,ne=_.useMemo(()=>({register:u,handleSubmit:b,errors:N,isDirty:C,dirtyFields:j,watchedValues:f,setValue:S,trigger:g}),[u,b,N,C,j,f,S,g]),Pe=_.useMemo(()=>({saveDietSection:v,saveRestrictionsSection:I,saveEssentialsSection:p,savePreferencesSection:T,saveNutritionSection:E,saveShoppingSection:A,onSubmit:k}),[v,I,p,T,E,A,k]),Fe=_.useMemo(()=>({saving:a,sectionSaving:l,hasDietChanges:D,hasRestrictionsChanges:M,hasEssentialsChanges:H,hasPreferencesChanges:L,hasNutritionChanges:q,hasShoppingChanges:te}),[a,l,D,M,H,L,q,te]);return{form:ne,actions:Pe,state:Fe}}const ut=({percentage:t,title:s,subtitle:a,color:i="#10B981"})=>e.jsxs(F,{className:"p-6 mb-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i} 8%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:`color-mix(in srgb, ${i} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-white font-semibold text-xl mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${i} 35%, transparent), color-mix(in srgb, ${i} 25%, transparent))
                `,border:`2px solid color-mix(in srgb, ${i} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${i} 30%, transparent)`},children:e.jsx(o,{Icon:n.Utensils,size:20,style:{color:i},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:s}),a&&e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:a})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:i,boxShadow:`0 0 8px ${i}60`}}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[t,"%"]})]}),e.jsx("span",{className:"text-white/60 text-xs",children:"Complété"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(P.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${i}, color-mix(in srgb, ${i} 80%, white))`,boxShadow:`0 0 12px ${i}60, inset 0 1px 0 rgba(255,255,255,0.3)`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:1.2,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]})]}),se=({isDirty:t,isSaving:s,onSave:a,sectionName:i})=>{const{formSubmit:r}=K();return t?e.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>{r(),a()},disabled:s,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(o,{Icon:n.Loader2,size:14,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:14}),e.jsx("span",{children:s?"Sauvegarde...":`Sauvegarder ${i}`})]})})}):null},oe=_.memo(({items:t,newItem:s,setNewItem:a,onAdd:i,onRemove:r,placeholder:c,itemColor:l,itemLabel:d})=>{const{click:x}=K(),u=_.useRef(null),b=_.useRef(null),w=_.useRef(null),y=_.useRef(t.length);_.useEffect(()=>{t.length>y.current&&(x(),setTimeout(()=>{w.current&&w.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},50),setTimeout(()=>{u.current&&u.current.focus()},100)),y.current=t.length},[t.length,x]);const S=_.useCallback(()=>{s.trim()&&i()},[s,i]),m=_.useCallback(g=>{g.key==="Enter"&&(g.preventDefault(),S())},[S]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"text",value:s,onChange:g=>a(g.target.value),className:"glass-input flex-1",placeholder:c,onKeyDown:m}),e.jsx("button",{type:"button",onClick:S,className:"btn-glass px-4",disabled:!s.trim(),children:e.jsx(o,{Icon:n.Plus,size:14})})]}),e.jsx("div",{ref:b,className:"flex flex-wrap gap-2",children:e.jsx(X,{mode:"popLayout",children:t.map((g,N)=>e.jsxs(P.div,{ref:N===t.length-1?w:null,className:"chip chip--on flex items-center gap-2",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},style:{background:`color-mix(in srgb, ${l}, 0.15)`,borderColor:`color-mix(in srgb, ${l}, 0.30)`,color:l},children:[e.jsx("span",{children:g}),e.jsx("button",{type:"button",onClick:()=>r(N),className:"hover:opacity-80 transition-opacity",style:{color:l},"aria-label":`Retirer ${d} "${g}"`,children:e.jsx(o,{Icon:n.X,size:12})})]},`${g}-${N}`))})})]})},(t,s)=>{if(t.items.length!==s.items.length||t.newItem!==s.newItem||t.placeholder!==s.placeholder||t.itemColor!==s.itemColor||t.itemLabel!==s.itemLabel)return!1;for(let a=0;a<t.items.length;a++)if(t.items[a]!==s.items[a])return!1;return!0}),ge=_.memo(({items:t,onUpdate:s,suggestions:a,placeholder:i,itemColor:r})=>{const[c,l]=_.useState(""),[d,x]=_.useState(!1),u=_.useCallback(m=>{if(m.trim()&&!t.find(g=>g.name===m.trim())){const g=[...t,{name:m.trim(),preference:"neutral"}];s(g),l(""),x(!1)}},[t,s]),b=_.useCallback((m,g)=>{const N=t[m];if(N&&N.preference!==g){const C=[...t];C[m]={...C[m],preference:g},s(C)}},[t,s]),w=_.useCallback(m=>{const g=t.filter((N,C)=>C!==m);s(g)},[t,s]),y=_.useCallback(m=>{switch(m){case"like":return"#10B981";case"neutral":return"#6B7280";case"dislike":return"#F59E0B";case"ban":return"#EF4444";default:return"#6B7280"}},[]),S=_.useCallback(m=>{switch(m){case"like":return n.Heart;case"neutral":return n.Minus;case"dislike":return n.X;case"ban":return n.Ban;default:return n.Minus}},[]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:m=>l(m.target.value),onFocus:()=>x(!0),className:"glass-input flex-1",placeholder:i,onKeyDown:m=>{m.key==="Enter"&&(m.preventDefault(),u(c))}}),e.jsx("button",{type:"button",onClick:()=>u(c),className:"btn-glass px-4",children:e.jsx(o,{Icon:n.Plus,size:14})})]}),d&&a.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-black/80 backdrop-blur-xl border border-white/20 rounded-xl p-2 z-10",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:a.filter(m=>!t.find(g=>g.name===m)).map(m=>e.jsx("button",{type:"button",onClick:()=>u(m),className:"text-xs px-2 py-1 rounded-lg bg-white/10 hover:bg-white/20 text-white/80 hover:text-white transition-colors",children:m},m))})})]}),e.jsx("div",{className:"space-y-2",children:t.map((m,g)=>e.jsxs(P.div,{className:"flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/10",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},children:[e.jsx("span",{className:"flex-1 text-white",children:m.name}),e.jsx("div",{className:"flex items-center gap-1",children:["like","neutral","dislike","ban"].map(N=>e.jsx("button",{type:"button",onClick:()=>b(g,N),className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors ${m.preference===N?"bg-white/20 border border-white/30":"bg-white/5 hover:bg-white/10"}`,style:{color:m.preference===N?y(N):"#9CA3AF"},children:e.jsx(o,{Icon:S(N),size:14})},N))}),e.jsx("button",{type:"button",onClick:()=>w(g),className:"w-8 h-8 rounded-lg flex items-center justify-center bg-white/5 hover:bg-red-500/20 text-white/60 hover:text-red-400 transition-colors",children:e.jsx(o,{Icon:n.Trash2,size:14})})]},g))})]})},(t,s)=>{if(t.items.length!==s.items.length||t.placeholder!==s.placeholder||t.itemColor!==s.itemColor)return!1;for(let a=0;a<t.items.length;a++)if(t.items[a].name!==s.items[a].name||t.items[a].preference!==s.items[a].preference)return!1;if(t.suggestions.length!==s.suggestions.length)return!1;for(let a=0;a<t.suggestions.length;a++)if(t.suggestions[a]!==s.suggestions[a])return!1;return!0}),xt=({register:t,isDirty:s,isSaving:a,onSave:i})=>e.jsxs(F,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(16, 185, 129, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(o,{Icon:n.Utensils,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Régime & Budget"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Vos préférences alimentaires et contraintes budgétaires"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Base"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"diet",className:"block text-white/90 text-sm font-medium mb-3",children:"Type de régime"}),e.jsxs("select",{...t("diet"),id:"diet",className:"glass-input",children:[e.jsx("option",{value:"",children:"Aucun régime spécifique"}),e.jsx("option",{value:"omnivore",children:"Omnivore"}),e.jsx("option",{value:"vegetarian",children:"Végétarien"}),e.jsx("option",{value:"vegan",children:"Végétalien"}),e.jsx("option",{value:"pescatarian",children:"Pescétarien"}),e.jsx("option",{value:"keto",children:"Cétogène"}),e.jsx("option",{value:"paleo",children:"Paléo"}),e.jsx("option",{value:"mediterranean",children:"Méditerranéen"}),e.jsx("option",{value:"low_carb",children:"Faible en glucides"}),e.jsx("option",{value:"intermittent_fasting",children:"Jeûne intermittent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"budgetLevel",className:"block text-white/90 text-sm font-medium mb-3",children:"Niveau de budget"}),e.jsxs("select",{...t("budgetLevel"),id:"budgetLevel",className:"glass-input",children:[e.jsx("option",{value:"",children:"Non spécifié"}),e.jsx("option",{value:"low",children:"Économique"}),e.jsx("option",{value:"medium",children:"Modéré"}),e.jsx("option",{value:"high",children:"Élevé"})]})]})]}),e.jsx(se,{isDirty:s,isSaving:a,onSave:i,sectionName:"Régime"})]}),ht=({register:t,name:s,label:a,description:i,checked:r,color:c="#06B6D4",icon:l,compact:d=!1})=>e.jsxs("label",{className:`flex items-center gap-3 rounded-xl bg-white/5 border border-white/10 cursor-pointer hover:bg-white/8 transition-colors ${d?"p-3":"p-4"}`,children:[e.jsx("input",{...t(s),type:"checkbox",className:"sr-only"}),e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${r?"border-cyan-400":"border-white/30"}`,style:{backgroundColor:r?c:"transparent"},children:r&&e.jsx(o,{Icon:n.Check,size:12,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`text-white font-medium flex items-center gap-2 ${d?"text-sm":""}`,children:[l&&e.jsx(o,{Icon:l,size:16,className:"text-white/60"}),a]}),i&&!d&&e.jsx("div",{className:"text-white/60 text-sm",children:i})]})]}),gt=({register:t,watchedValues:s})=>{const a=[{key:"oven",label:"Four",icon:n.Flame},{key:"stove",label:"Plaques",icon:n.Circle},{key:"microwave",label:"Micro-ondes",icon:n.Zap},{key:"dishwasher",label:"Lave-vaisselle",icon:n.Droplets},{key:"blender",label:"Mixeur",icon:n.Zap},{key:"airFryer",label:"Air Fryer",icon:n.Wind},{key:"slowCooker",label:"Mijoteuse",icon:n.Clock},{key:"pressureCooker",label:"Cocotte-minute",icon:n.Timer},{key:"foodProcessor",label:"Robot",icon:n.Settings},{key:"standMixer",label:"Batteur",icon:n.RotateCcw},{key:"grill",label:"Grill",icon:n.Flame},{key:"steamer",label:"Vapeur",icon:n.Cloud}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:a.map(({key:i,label:r,icon:c})=>e.jsx(ht,{register:t,name:`kitchenEquipment.${i}`,label:r,description:"",checked:s.kitchenEquipment?.[i]||!1,color:"#06B6D4",icon:c,compact:!0},i))})},pt=({register:t,watchedValues:s,isDirty:a,isSaving:i,onSave:r})=>e.jsxs(F,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(16, 185, 129, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(o,{Icon:n.Users,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Informations Essentielles"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Foyer, temps de cuisine et équipement disponible"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Essentiel"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white/90 text-sm font-medium mb-4",children:"Composition du foyer"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"householdDetails.adults",className:"block text-white/80 text-sm mb-2",children:"Adultes"}),e.jsx("input",{...t("householdDetails.adults",{valueAsNumber:!0}),type:"number",id:"householdDetails.adults",min:"1",max:"20",className:"glass-input",placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"householdDetails.children",className:"block text-white/80 text-sm mb-2",children:"Enfants"}),e.jsx("input",{...t("householdDetails.children",{valueAsNumber:!0}),type:"number",id:"householdDetails.children",min:"0",max:"20",className:"glass-input",placeholder:"0"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white/90 text-sm font-medium mb-4",children:"Temps disponible par repas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mealPrepPreferences.weekdayTimeMin",className:"block text-white/80 text-sm mb-2",children:"Semaine (minutes)"}),e.jsx("input",{...t("mealPrepPreferences.weekdayTimeMin",{valueAsNumber:!0}),type:"number",id:"mealPrepPreferences.weekdayTimeMin",min:"5",max:"180",className:"glass-input",placeholder:"30"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mealPrepPreferences.weekendTimeMin",className:"block text-white/80 text-sm mb-2",children:"Week-end (minutes)"}),e.jsx("input",{...t("mealPrepPreferences.weekendTimeMin",{valueAsNumber:!0}),type:"number",id:"mealPrepPreferences.weekendTimeMin",min:"5",max:"300",className:"glass-input",placeholder:"60"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mealPrepPreferences.cookingSkill",className:"block text-white/80 text-sm mb-2",children:"Niveau de cuisine"}),e.jsxs("select",{...t("mealPrepPreferences.cookingSkill"),id:"mealPrepPreferences.cookingSkill",className:"glass-input",children:[e.jsx("option",{value:"beginner",children:"🌱 Débutant"}),e.jsx("option",{value:"intermediate",children:"👨‍🍳 Intermédiaire"}),e.jsx("option",{value:"advanced",children:"👨‍🍳⭐ Confirmé"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white/90 text-sm font-medium mb-4",children:"Équipement de cuisine disponible"}),e.jsx(gt,{register:t,watchedValues:s})]})]}),e.jsx(se,{isDirty:a,isSaving:i,onSave:r,sectionName:"Essentiels"})]}),ft=({register:t,watchedValues:s,setValue:a,isDirty:i,isSaving:r,onSave:c})=>{const[l,d]=_.useState(""),x=_.useCallback(()=>{if(l.trim()){const N=s.sensoryPreferences?.textureAversions||[],C=l.trim();N.includes(C)||(a("sensoryPreferences.textureAversions",[...N,C],{shouldDirty:!0}),d(""))}},[l,s.sensoryPreferences?.textureAversions,a]),u=_.useCallback(N=>{const C=s.sensoryPreferences?.textureAversions||[];a("sensoryPreferences.textureAversions",C.filter((j,f)=>f!==N),{shouldDirty:!0})},[s.sensoryPreferences?.textureAversions,a]),b=_.useCallback(N=>{a("foodPreferences.cuisines",N,{shouldDirty:!0})},[a]),w=_.useCallback(N=>{a("foodPreferences.ingredients",N,{shouldDirty:!0})},[a]),y=_.useCallback(N=>{a("foodPreferences.flavors",N,{shouldDirty:!0})},[a]),S=_.useMemo(()=>["Française","Italienne","Asiatique","Mexicaine","Indienne","Méditerranéenne","Japonaise","Thaï","Libanaise","Marocaine"],[]),m=_.useMemo(()=>["Légumes verts","Fruits rouges","Poissons gras","Légumineuses","Céréales complètes","Fromages","Épices","Herbes fraîches"],[]),g=_.useMemo(()=>["Sucré","Salé","Épicé","Acide","Amer","Umami","Fumé","Grillé","Crémeux","Croquant"],[]);return e.jsxs(F,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(16, 185, 129, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(o,{Icon:n.Heart,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Préférences Alimentaires"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Vos goûts et préférences culinaires détaillées"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Goûts"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Cuisines du monde"}),e.jsx(ge,{items:s.foodPreferences?.cuisines||[],onUpdate:b,suggestions:S,placeholder:"Ajouter une cuisine...",itemColor:"#A855F7"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Ingrédients et familles d'aliments"}),e.jsx(ge,{items:s.foodPreferences?.ingredients||[],onUpdate:w,suggestions:m,placeholder:"Ajouter un ingrédient...",itemColor:"#EC4899"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Saveurs et goûts"}),e.jsx(ge,{items:s.foodPreferences?.flavors||[],onUpdate:y,suggestions:g,placeholder:"Ajouter une saveur...",itemColor:"#F59E0B"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white/90 text-sm font-medium mb-4",children:"Préférences sensorielles"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sensoryPreferences.spiceTolerance",className:"block text-white/80 text-sm mb-3",children:"Tolérance au piment (0-3)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{...t("sensoryPreferences.spiceTolerance",{valueAsNumber:!0}),type:"range",id:"sensoryPreferences.spiceTolerance",min:"0",max:"3",step:"1",className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, 
                      #22C55E 0%, #F59E0B 33%, #EF4444 66%, #DC2626 100%
                    )`}}),e.jsxs("div",{className:"flex justify-between text-xs text-white/60",children:[e.jsx("span",{children:"Aucun"}),e.jsx("span",{children:"Doux"}),e.jsx("span",{children:"Moyen"}),e.jsx("span",{children:"Fort"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-3",children:"Textures à éviter"}),e.jsx(oe,{items:s.sensoryPreferences?.textureAversions||[],newItem:l,setNewItem:d,onAdd:x,onRemove:u,placeholder:"Ex: Gélatineux, Granuleux...",itemColor:"#A855F7",itemLabel:"texture"})]})]})]})]}),e.jsx(se,{isDirty:i,isSaving:r,onSave:c,sectionName:"Préférences"})]})},bt=({register:t,watchedValues:s,setValue:a,isDirty:i,isSaving:r,onSave:c})=>{const[l,d]=_.useState(""),[x,u]=_.useState(""),b=_.useCallback(()=>{if(l.trim()){const g=s.allergies||[],N=l.trim();g.includes(N)||(a("allergies",[...g,N],{shouldDirty:!0}),d(""))}},[l,s.allergies,a]),w=_.useCallback(g=>{const N=s.allergies||[];a("allergies",N.filter((C,j)=>j!==g),{shouldDirty:!0})},[s.allergies,a]),y=_.useCallback(()=>{if(x.trim()){const g=s.intolerances||[],N=x.trim();g.includes(N)||(a("intolerances",[...g,N],{shouldDirty:!0}),u(""))}},[x,s.intolerances,a]),S=_.useCallback(g=>{const N=s.intolerances||[];a("intolerances",N.filter((C,j)=>j!==g),{shouldDirty:!0})},[s.intolerances,a]),m=_.useCallback(g=>{a("noKnownAllergies",g.target.checked,{shouldDirty:!0}),g.target.checked&&a("allergies",[],{shouldDirty:!0})},[a]);return e.jsxs(F,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #EF4444 35%, transparent), color-mix(in srgb, #EF4444 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #EF4444 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EF4444 30%, transparent)"},children:e.jsx(o,{Icon:n.AlertCircle,size:20,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Restrictions Alimentaires"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Allergies et intolérances importantes"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-sm font-medium",children:"Critique"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Allergies alimentaires"}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/10 cursor-pointer hover:bg-white/8 transition-colors",children:[e.jsx("input",{...t("noKnownAllergies"),type:"checkbox",onChange:m,className:"sr-only"}),e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${s.noKnownAllergies?"border-green-400 bg-green-500":"border-white/30"}`,children:s.noKnownAllergies&&e.jsx(o,{Icon:n.Check,size:12,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Je n'ai pas d'allergies alimentaires connues"}),e.jsx("div",{className:"text-white/60 text-sm",children:"Cochez cette case si vous n'avez aucune allergie"})]})]})}),!s.noKnownAllergies&&e.jsx(oe,{items:s.allergies||[],newItem:l,setNewItem:d,onAdd:b,onRemove:w,placeholder:"Ajouter une allergie...",itemColor:"#EF4444",itemLabel:"allergie"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Intolérances alimentaires"}),e.jsx(oe,{items:s.intolerances||[],newItem:x,setNewItem:u,onAdd:y,onRemove:S,placeholder:"Ajouter une intolérance...",itemColor:"#F59E0B",itemLabel:"intolérance"})]})]}),e.jsx(se,{isDirty:i,isSaving:r,onSave:c,sectionName:"Restrictions"})]})},vt=({register:t,isDirty:s,isSaving:a,onSave:i})=>e.jsxs(F,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(34, 197, 94, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(34, 197, 94, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #22C55E 35%, transparent), color-mix(in srgb, #22C55E 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #22C55E 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #22C55E 30%, transparent)"},children:e.jsx(o,{Icon:n.Target,size:20,style:{color:"#22C55E"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Objectifs Nutritionnels"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Cibles nutritionnelles optionnelles pour l'IA"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Optionnel"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.kcal",className:"block text-white/80 text-sm mb-2",children:"Calories/jour"}),e.jsx("input",{...t("macroTargets.kcal",{valueAsNumber:!0}),type:"number",id:"macroTargets.kcal",min:"800",max:"5000",step:"50",className:"glass-input",placeholder:"2000"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.fiberMinG",className:"block text-white/80 text-sm mb-2",children:"Fibres min (g)"}),e.jsx("input",{...t("macroTargets.fiberMinG",{valueAsNumber:!0}),type:"number",id:"macroTargets.fiberMinG",min:"0",max:"100",className:"glass-input",placeholder:"25"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.sugarMaxG",className:"block text-white/80 text-sm mb-2",children:"Sucre max (g)"}),e.jsx("input",{...t("macroTargets.sugarMaxG",{valueAsNumber:!0}),type:"number",id:"macroTargets.sugarMaxG",min:"0",max:"200",className:"glass-input",placeholder:"50"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.saltMaxMg",className:"block text-white/80 text-sm mb-2",children:"Sel max (mg)"}),e.jsx("input",{...t("macroTargets.saltMaxMg",{valueAsNumber:!0}),type:"number",id:"macroTargets.saltMaxMg",min:"0",max:"10000",step:"100",className:"glass-input",placeholder:"2300"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.carbsMaxG",className:"block text-white/80 text-sm mb-2",children:"Glucides max (g)"}),e.jsx("input",{...t("macroTargets.carbsMaxG",{valueAsNumber:!0}),type:"number",id:"macroTargets.carbsMaxG",min:"0",max:"1000",className:"glass-input",placeholder:"250"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"macroTargets.fatMinG",className:"block text-white/80 text-sm mb-2",children:"Lipides min (g)"}),e.jsx("input",{...t("macroTargets.fatMinG",{valueAsNumber:!0}),type:"number",id:"macroTargets.fatMinG",min:"0",max:"300",className:"glass-input",placeholder:"60"})]})]}),e.jsx(se,{isDirty:s,isSaving:a,onSave:i,sectionName:"Nutrition"})]}),jt=({register:t,watchedValues:s,setValue:a,isDirty:i,isSaving:r,onSave:c})=>{const[l,d]=_.useState(""),x=_.useCallback(()=>{if(l.trim()){const b=s.shoppingPreferences?.bias||[],w=l.trim();b.includes(w)||(a("shoppingPreferences.bias",[...b,w],{shouldDirty:!0}),d(""))}},[l,s.shoppingPreferences?.bias,a]),u=_.useCallback(b=>{const w=s.shoppingPreferences?.bias||[];a("shoppingPreferences.bias",w.filter((y,S)=>S!==b),{shouldDirty:!0})},[s.shoppingPreferences?.bias,a]);return e.jsxs(F,{className:"p-6",style:{background:`
        radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:"rgba(16, 185, 129, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #10B981 35%, transparent), color-mix(in srgb, #10B981 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #10B981 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #10B981 30%, transparent)"},children:e.jsx(o,{Icon:n.ShoppingCart,size:20,style:{color:"#10B981"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Habitudes de Courses"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Fréquence, portions et préférences d'achat"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300 text-sm font-medium",children:"Courses"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shoppingPreferences.frequencyPerWeek",className:"block text-white/80 text-sm mb-2",children:"Fréquence courses/semaine"}),e.jsx("input",{...t("shoppingPreferences.frequencyPerWeek",{valueAsNumber:!0}),type:"number",id:"shoppingPreferences.frequencyPerWeek",min:"1",max:"7",className:"glass-input",placeholder:"2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shoppingPreferences.defaultPortionsPerMeal",className:"block text-white/80 text-sm mb-2",children:"Portions par repas par défaut"}),e.jsx("input",{...t("shoppingPreferences.defaultPortionsPerMeal",{valueAsNumber:!0}),type:"number",id:"shoppingPreferences.defaultPortionsPerMeal",min:"1",max:"12",className:"glass-input",placeholder:"2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shoppingPreferences.batchCooking",className:"block text-white/80 text-sm mb-2",children:"Batch cooking"}),e.jsxs("select",{...t("shoppingPreferences.batchCooking"),id:"shoppingPreferences.batchCooking",className:"glass-input",children:[e.jsx("option",{value:"never",children:"❌ Jamais"}),e.jsx("option",{value:"sometimes",children:"🔄 Parfois"}),e.jsx("option",{value:"often",children:"✅ Souvent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shoppingPreferences.budgetPerWeek",className:"block text-white/80 text-sm mb-2",children:"Budget/semaine (€)"}),e.jsx("input",{...t("shoppingPreferences.budgetPerWeek",{valueAsNumber:!0}),type:"number",id:"shoppingPreferences.budgetPerWeek",min:"0",max:"1000",step:"10",className:"glass-input",placeholder:"100"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Biais d'achat (bio, local, format familial...)"}),e.jsx(oe,{items:s.shoppingPreferences?.bias||[],newItem:l,setNewItem:d,onAdd:x,onRemove:u,placeholder:"Ex: Bio, Local, Format familial...",itemColor:"#EC4899",itemLabel:"préférence"})]}),e.jsx(se,{isDirty:i,isSaving:r,onSave:c,sectionName:"Courses"})]})},Fs=()=>{const{profile:t}=G(),s=ze(t),{form:a,actions:i,state:r}=mt();Y(D=>D.setTabDirty);const c=Qe(t),{register:l,handleSubmit:d,errors:x,isDirty:u,watchedValues:b,setValue:w}=a,{saveDietSection:y,saveRestrictionsSection:S,saveEssentialsSection:m,savePreferencesSection:g,saveNutritionSection:N,saveShoppingSection:C,onSubmit:j}=i,{saving:f,sectionSaving:v,hasDietChanges:I,hasRestrictionsChanges:p,hasEssentialsChanges:T,hasPreferencesChanges:E,hasNutritionChanges:A,hasShoppingChanges:k}=r;return e.jsxs(P.div,{className:"space-y-6",variants:Oe,initial:"initial",animate:"enter",exit:"exit",children:[e.jsx(X,{children:!s.isSufficient&&e.jsx(Le,{completion:s,variant:"banner",showDismiss:!1})}),e.jsx(ut,{percentage:c,title:"Forge Nutritionnelle",subtitle:"Configurez vos préférences alimentaires complètes pour l'IA",color:"#10B981"}),e.jsxs("form",{onSubmit:d(j),className:"space-y-6",children:[e.jsx(xt,{register:l,isDirty:I,isSaving:v==="diet",onSave:y}),e.jsx(pt,{register:l,watchedValues:b,isDirty:T,isSaving:v==="essentials",onSave:m}),e.jsx(ft,{register:l,watchedValues:b,setValue:w,isDirty:E,isSaving:v==="preferences",onSave:g}),e.jsx(bt,{register:l,watchedValues:b,setValue:w,isDirty:p,isSaving:v==="restrictions",onSave:S}),e.jsx(vt,{register:l,isDirty:A,isSaving:v==="nutrition",onSave:N}),e.jsx(jt,{register:l,watchedValues:b,setValue:w,isDirty:k,isSaving:v==="shopping",onSave:C}),e.jsx(P.div,{className:"flex justify-center pt-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.3},children:e.jsx("button",{type:"submit",disabled:f||!u,className:`btn-glass--primary px-8 py-4 text-lg font-semibold ${u?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>Be.tap(),children:e.jsxs("div",{className:"flex items-center gap-3",children:[f?e.jsx(o,{Icon:n.Loader2,size:20,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:20}),e.jsx("span",{children:f?"Sauvegarde...":"Sauvegarder Tout"})]})})}),Object.keys(x).length>0&&e.jsxs(F,{className:"p-4",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h4",{className:"text-red-300 font-medium mb-3 flex items-center gap-2",children:[e.jsx(o,{Icon:n.AlertCircle,size:16}),"Erreurs de validation"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(x).map(([D,M])=>e.jsxs("p",{className:"text-red-200 text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),M?.message]},D))})]})]})]})},yt=V({bloodType:J(["A+","A-","B+","B-","AB+","AB-","O+","O-"]).optional(),conditions:U(z()).default([]),medications:U(z()).default([]),constraints:U(z()).default([]),physicalLimitations:U(z()).default([]),declaredNoIssues:$().default(!1)});function Nt(){const{profile:t,updateProfile:s,saving:a}=G(),{showToast:i}=re(),{success:r,formSubmit:c}=K(),[l,d]=_.useState(null),x=de({resolver:ue(yt),defaultValues:{bloodType:t?.health?.bloodType||void 0,conditions:t?.health?.conditions||[],medications:t?.health?.medications||[],constraints:t?.constraints?Object.values(t.constraints):[],physicalLimitations:t?.health?.physicalLimitations||[],declaredNoIssues:t?.health?.declaredNoIssues||!1},mode:"onChange"}),{register:u,handleSubmit:b,formState:w,watch:y,setValue:S,reset:m,trigger:g}=x,{errors:N,isDirty:C,dirtyFields:j}=w,f=y();_.useEffect(()=>{Y.getState().setTabDirty("health",C)},[C]);const v=async()=>{d("basic");try{await s({health:{...t?.health,bloodType:f.bloodType},updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Informations de base sauvegardées",message:"Vos données médicales de base ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les informations de base",duration:4e3})}finally{d(null)}},I=async()=>{d("medical");try{await s({health:{...t?.health,conditions:f.conditions,medications:f.medications,physicalLimitations:f.physicalLimitations,declaredNoIssues:f.declaredNoIssues},updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Données médicales sauvegardées",message:"Vos conditions et médicaments ont été mis à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les données médicales",duration:4e3})}finally{d(null)}},p=async()=>{d("constraints");try{const D=(f.constraints||[]).reduce((M,H,L)=>(M[`constraint_${L}`]=H,M),{});await s({constraints:D,updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Contraintes sauvegardées",message:"Vos contraintes alimentaires ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les contraintes",duration:4e3})}finally{d(null)}},T=async D=>{try{c(),h.info("PROFILE_HEALTH","Submitting complete health updates",{userId:t?.userId,philosophy:"complete_health_submission"});const M=(D.constraints||[]).reduce((H,L,q)=>(H[`constraint_${q}`]=L,H),{});await s({health:{...t?.health,bloodType:D.bloodType,conditions:D.conditions,medications:D.medications,physicalLimitations:D.physicalLimitations,declaredNoIssues:D.declaredNoIssues},constraints:M,updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Profil santé sauvegardé",message:"Toutes vos données de santé ont été mises à jour",duration:4e3}),Y.getState().resetTabDirty("health")}catch(M){h.error("PROFILE_HEALTH","Health update failed",{error:M instanceof Error?M.message:"Unknown error",userId:t?.userId}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder votre profil santé",duration:4e3})}},E=!!j.bloodType,A=!!(j.conditions||j.medications||j.physicalLimitations),k=!!j.constraints;return{form:{register:u,handleSubmit:b,errors:N,isDirty:C,dirtyFields:j,watchedValues:f,setValue:S,trigger:g},actions:{saveBasicHealthSection:v,saveMedicalSection:I,saveConstraintsSection:p,onSubmit:T},state:{saving:a,sectionSaving:l,hasBasicChanges:E,hasMedicalChanges:A,hasConstraintsChanges:k}}}const wt=({percentage:t,title:s,subtitle:a,color:i="#EF4444"})=>e.jsxs(F,{className:"p-6 mb-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i} 8%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:`color-mix(in srgb, ${i} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-white font-semibold text-xl mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${i} 35%, transparent), color-mix(in srgb, ${i} 25%, transparent))
                `,border:`2px solid color-mix(in srgb, ${i} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${i} 30%, transparent)`},children:e.jsx(o,{Icon:n.Heart,size:20,style:{color:i},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:s}),a&&e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:a})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:i,boxShadow:`0 0 8px ${i}60`}}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[t,"%"]})]}),e.jsx("span",{className:"text-white/60 text-xs",children:"Complété"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(P.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${i}, color-mix(in srgb, ${i} 80%, white))`,boxShadow:`0 0 12px ${i}60, inset 0 1px 0 rgba(255,255,255,0.3)`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:1.2,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,animation:"progressShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]})]}),_t=({isDirty:t,isSaving:s,onSave:a,sectionName:i})=>{const{formSubmit:r}=K();return t?e.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>{r(),a()},disabled:s,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(o,{Icon:n.Loader2,size:14,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:14}),e.jsx("span",{children:s?"Sauvegarde...":`Sauvegarder ${i}`})]})})}):null},Ee=({items:t,newItem:s,setNewItem:a,onAdd:i,onRemove:r,placeholder:c,itemColor:l,itemLabel:d})=>{const{click:x}=K(),u=_.useRef(null),b=_.useRef(null),w=_.useRef(null),y=_.useRef(t.length);_.useEffect(()=>{t.length>y.current&&(x(),setTimeout(()=>{w.current&&w.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},50),setTimeout(()=>{u.current&&u.current.focus()},100)),y.current=t.length},[t.length,x]);const S=()=>{s.trim()&&i()};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"text",value:s,onChange:m=>a(m.target.value),className:"glass-input flex-1",placeholder:c,onKeyDown:m=>{m.key==="Enter"&&(m.preventDefault(),S())}}),e.jsx("button",{type:"button",onClick:S,className:"btn-glass px-4",disabled:!s.trim(),children:e.jsx(o,{Icon:n.Plus,size:14})})]}),e.jsx("div",{ref:b,className:"flex flex-wrap gap-2",children:e.jsx(X,{mode:"popLayout",children:t.map((m,g)=>e.jsxs(P.div,{ref:g===t.length-1?w:null,className:"chip chip--on flex items-center gap-2",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},style:{background:`${l}15`,borderColor:`${l}30`,color:l},children:[e.jsx("span",{children:m}),e.jsx("button",{type:"button",onClick:()=>r(g),className:"hover:opacity-80 transition-opacity",style:{color:l},"aria-label":`Retirer ${d} "${m}"`,children:e.jsx(o,{Icon:n.X,size:12})})]},`${m}-${g}`))})})]})},St=({physicalLimitations:t,newPhysicalLimitation:s,setNewPhysicalLimitation:a,onAddPhysicalLimitation:i,onRemovePhysicalLimitation:r,onSave:c,isSaving:l,isDirty:d})=>e.jsxs(F,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #EF4444 35%, transparent), color-mix(in srgb, #EF4444 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #EF4444 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EF4444 30%, transparent)"},children:e.jsx(o,{Icon:n.AlertTriangle,size:20,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Blessures et Limitations"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Douleurs, blessures et limitations physiques"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-sm font-medium",children:"Important"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 rounded-xl bg-red-500/10 border border-red-400/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.Info,size:16,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-200 text-sm leading-relaxed mb-2",children:"Indiquez vos blessures passées, douleurs chroniques ou limitations physiques pour adapter vos programmes d'entraînement et éviter les mouvements à risque."}),e.jsxs("div",{className:"text-red-300 text-xs",children:[e.jsx("strong",{children:"Exemples :"}),' "Douleur au genou gauche", "Problème de dos", "Épaule fragile", "Tendinite du coude", "Entorse cheville droite"']})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Limitations physiques et blessures"}),e.jsx(Ee,{items:t,newItem:s,setNewItem:a,onAdd:i,onRemove:r,placeholder:"Ex: Douleur au genou, problème de dos...",itemColor:"rgba(239, 68, 68",itemLabel:"limitation"})]})]}),d&&c&&e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:c,disabled:l,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(o,{Icon:n.Loader2,size:14,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:14}),e.jsx("span",{children:l?"Sauvegarde...":"Sauvegarder"})]})})})]}),Ct=({vaccinations:t,countryData:s,onAddVaccination:a,onUpdateVaccination:i,onRemoveVaccination:r,onToggleUpToDate:c,upToDate:l,onSave:d,isSaving:x,isDirty:u})=>{const[b,w]=_.useState(!1),[y,S]=_.useState(""),[m,g]=_.useState(""),[N,C]=_.useState(""),j=_.useMemo(()=>{if(!s?.vaccination_requirements)return[];const E=s.vaccination_requirements.required||[],A=s.vaccination_requirements.recommended||[];return[...new Set([...E,...A])]},[s]),f=E=>{const A=t.find(k=>k.name.toLowerCase()===E.toLowerCase());if(!A)return"missing";if(A.next_due){const k=new Date(A.next_due),D=new Date;if(k<D)return"overdue";if(Math.floor((k.getTime()-D.getTime())/(1e3*60*60*24))<=90)return"due_soon"}return"up_to_date"},v=()=>{if(!y||!m)return;const E={name:y,date:m,next_due:N||void 0,required:j.some(A=>A.toLowerCase()===y.toLowerCase())};a(E),S(""),g(""),C(""),w(!1)},I=E=>{switch(E){case"up_to_date":return{bg:"bg-green-500/10",border:"border-green-400/20",text:"text-green-300",dot:"bg-green-400"};case"due_soon":return{bg:"bg-yellow-500/10",border:"border-yellow-400/20",text:"text-yellow-300",dot:"bg-yellow-400"};case"overdue":return{bg:"bg-red-500/10",border:"border-red-400/20",text:"text-red-300",dot:"bg-red-400"};default:return{bg:"bg-gray-500/10",border:"border-gray-400/20",text:"text-gray-300",dot:"bg-gray-400"}}},p=_.useMemo(()=>{if(j.length===0)return"unknown";const E=j.map(f);return E.some(A=>A==="overdue")?"overdue":E.some(A=>A==="due_soon")?"due_soon":E.some(A=>A==="missing")?"incomplete":"complete"},[j,t]),T={complete:{color:"#10B981",label:"À jour",icon:n.CheckCircle},incomplete:{color:"#F59E0B",label:"Incomplet",icon:n.AlertCircle},due_soon:{color:"#F59E0B",label:"Rappels à prévoir",icon:n.Clock},overdue:{color:"#EF4444",label:"En retard",icon:n.AlertTriangle},unknown:{color:"#6B7280",label:"Non défini",icon:n.Info}}[p];return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, 0.2))
                `,border:"2px solid rgba(239, 68, 68, 0.5)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.4)"},children:e.jsx(o,{Icon:n.Shield,size:24,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Vaccinations"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:s?`Recommandations pour ${s.country_name}`:"Gestion de vos vaccinations"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:T.color,boxShadow:`0 0 8px ${T.color}66`}}),e.jsx("span",{className:"text-white/80 text-sm font-medium",children:T.label})]})]}),e.jsx("div",{className:"mb-6 p-4 rounded-xl bg-white/5 border border-white/10",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:E=>c(E.target.checked),className:"glass-checkbox"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-white/90 font-medium text-sm group-hover:text-white transition-colors",children:"Mes vaccinations sont à jour"}),e.jsx("p",{className:"text-white/50 text-xs mt-0.5",children:"Cochez si tous vos vaccins obligatoires et recommandés sont à jour"})]})]})}),j.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-white/90 font-medium text-sm mb-3 flex items-center gap-2",children:[e.jsx(o,{Icon:n.MapPin,size:16,className:"text-cyan-400"}),"Vaccins recommandés dans votre pays"]}),e.jsx("div",{className:"space-y-2",children:j.map((E,A)=>{const k=f(E),D=I(k),M=t.find(H=>H.name.toLowerCase()===E.toLowerCase());return e.jsx("div",{className:`p-3 rounded-lg border ${D.bg} ${D.border}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${D.dot}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium text-sm",children:E}),M&&e.jsxs("div",{className:"text-white/50 text-xs mt-0.5",children:["Dernière dose: ",new Date(M.date).toLocaleDateString("fr-FR"),M.next_due&&` • Prochain rappel: ${new Date(M.next_due).toLocaleDateString("fr-FR")}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[k==="missing"&&e.jsx("button",{type:"button",onClick:()=>{S(E),w(!0)},className:"px-3 py-1 rounded-lg bg-green-500/20 hover:bg-green-500/30 border border-green-400/30 transition-colors",children:e.jsx("span",{className:`text-xs ${D.text}`,children:"Ajouter"})}),k==="overdue"&&e.jsx("span",{className:"px-2 py-1 rounded text-xs bg-red-500/20 text-red-300",children:"Rappel en retard"}),k==="due_soon"&&e.jsx("span",{className:"px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-300",children:"Rappel bientôt"}),k==="up_to_date"&&e.jsx(o,{Icon:n.Check,size:16,className:"text-green-400"})]})]})},A)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Vaccinations additionnelles"}),e.jsxs("button",{type:"button",onClick:()=>w(!b),className:"text-sm text-cyan-400 hover:text-cyan-300 transition-colors flex items-center gap-1",children:[e.jsx(o,{Icon:b?n.X:n.Plus,size:14}),b?"Annuler":"Ajouter"]})]}),e.jsx(X,{children:b&&e.jsx(P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4 p-4 rounded-xl bg-white/5 border border-white/10",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-xs mb-2",children:"Nom du vaccin *"}),e.jsx("input",{type:"text",value:y,onChange:E=>S(E.target.value),className:"glass-input text-sm",placeholder:"Ex: COVID-19, Tétanos, Grippe..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-xs mb-2",children:"Date d'administration *"}),e.jsx("input",{type:"date",value:m,onChange:E=>g(E.target.value),className:"glass-input text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-xs mb-2",children:"Prochain rappel"}),e.jsx("input",{type:"date",value:N,onChange:E=>C(E.target.value),className:"glass-input text-sm"})]})]}),e.jsxs("button",{type:"button",onClick:v,disabled:!y||!m,className:"btn-glass w-full py-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(o,{Icon:n.Plus,size:14,className:"inline mr-2"}),"Ajouter la vaccination"]})]})})}),t.filter(E=>!j.some(A=>A.toLowerCase()===E.name.toLowerCase())).length>0&&e.jsx("div",{className:"space-y-2",children:t.filter(E=>!j.some(A=>A.toLowerCase()===E.name.toLowerCase())).map((E,A)=>e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium text-sm",children:E.name}),e.jsxs("div",{className:"text-white/50 text-xs mt-0.5",children:[new Date(E.date).toLocaleDateString("fr-FR"),E.next_due&&` • Rappel: ${new Date(E.next_due).toLocaleDateString("fr-FR")}`]})]}),e.jsx("button",{type:"button",onClick:()=>r(t.indexOf(E)),className:"text-red-400 hover:text-red-300 transition-colors p-2",children:e.jsx(o,{Icon:n.Trash2,size:16})})]},A))}),t.length===0&&!b&&e.jsxs("div",{className:"text-center py-8 text-white/50 text-sm",children:[e.jsx(o,{Icon:n.Shield,size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aucune vaccination enregistrée"}),e.jsx("p",{className:"text-xs mt-1",children:"Ajoutez vos vaccinations pour un suivi complet"})]})]}),e.jsx(X,{children:u&&e.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:d,disabled:x,className:"btn-glass px-6 py-2.5 text-sm",style:{background:"rgba(239, 68, 68, 0.2)",borderColor:"rgba(239, 68, 68, 0.4)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[x?e.jsx(o,{Icon:n.Loader2,size:16,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:16}),e.jsx("span",{children:x?"Sauvegarde...":"Sauvegarder"})]})})})}),e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-blue-500/10 border border-blue-400/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(o,{Icon:n.Info,size:14,className:"text-blue-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-white/70 text-xs leading-relaxed",children:"Les vaccinations recommandées sont basées sur votre pays de résidence. Consultez votre médecin pour un calendrier vaccinal personnalisé."})]})})]})})},It=["Diabète Type 1","Diabète Type 2","Hypertension","Asthme","Arthrite","Migraine chronique","Apnée du sommeil","Cholestérol élevé","Thyroïde","Reflux gastro-oesophagien"],At=({conditions:t,newCondition:s,setNewCondition:a,onAddCondition:i,onRemoveCondition:r,onDeclareNoConditions:c,hasDeclaredNoConditions:l,onSave:d,isSaving:x,isDirty:u})=>{const[b,w]=_.useState(!1),y=It.filter(m=>m.toLowerCase().includes(s.toLowerCase())&&!t.includes(m)),S=m=>{a(m),w(!1)};return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, 0.2))
              `,border:"2px solid rgba(239, 68, 68, 0.5)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.4)"},children:e.jsx(o,{Icon:n.AlertCircle,size:24,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Conditions Médicales"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Maladies chroniques et conditions actuelles"})]}),t.length>0&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-red-500/20",children:e.jsx("span",{className:"text-red-300 font-bold text-sm",children:t.length})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Ajouter une condition médicale"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx("input",{type:"text",value:s,onChange:m=>{a(m.target.value),w(!0)},onFocus:()=>w(!0),onBlur:()=>setTimeout(()=>w(!1),200),className:"glass-input w-full",placeholder:"Ex: Diabète Type 2, Asthme..."})}),e.jsxs("button",{type:"button",onClick:i,disabled:!s.trim(),className:"btn-glass py-2 px-4 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:[e.jsx(o,{Icon:n.Plus,size:14,className:"inline mr-1"}),"Ajouter"]})]}),b&&s.length>0&&y.length>0&&e.jsx(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute z-10 mt-2 w-full max-h-60 overflow-y-auto rounded-xl bg-gray-900/95 border border-white/10 backdrop-blur-xl shadow-2xl",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-white/50 text-xs px-3 py-2",children:"Suggestions courantes:"}),y.map((m,g)=>e.jsx("button",{type:"button",onClick:()=>S(m),className:"w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-colors text-white text-sm",children:m},g))]})})]}),t.length>0&&e.jsx("div",{className:"space-y-2",children:t.map((m,g)=>e.jsxs(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:g*.05},className:"flex items-center justify-between p-3 rounded-lg bg-red-500/10 border border-red-400/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-white font-medium text-sm",children:m})]}),e.jsx("button",{type:"button",onClick:()=>r(g),className:"text-red-400 hover:text-red-300 transition-colors p-2",children:e.jsx(o,{Icon:n.X,size:16})})]},g))}),t.length===0&&!l&&e.jsxs("div",{className:"text-center py-6 text-white/50 text-sm",children:[e.jsx(o,{Icon:n.AlertCircle,size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aucune condition médicale ajoutée"})]}),e.jsx(X,{children:u&&d&&e.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:d,disabled:x,className:"btn-glass px-6 py-2.5 text-sm",style:{background:"rgba(239, 68, 68, 0.2)",borderColor:"rgba(239, 68, 68, 0.4)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[x?e.jsx(o,{Icon:n.Loader2,size:16,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:16}),e.jsx("span",{children:x?"Sauvegarde...":"Sauvegarder"})]})})})}),e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-cyan-500/10 border border-cyan-400/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(o,{Icon:n.Info,size:14,className:"text-cyan-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-white/70 text-xs leading-relaxed",children:"Ces informations permettent de personnaliser vos programmes d'entraînement et d'éviter les exercices contre-indiqués."})]})})]})})},kt=["Metformine","Lisinopril","Atorvastatine","Levothyroxine","Oméprazole","Amlodipine","Aspirine","Ibuprofène","Paracétamol","Ventoline (Salbutamol)"],Et=({medications:t,newMedication:s,setNewMedication:a,onAddMedication:i,onRemoveMedication:r,onSave:c,isSaving:l,isDirty:d})=>{const[x,u]=_.useState(!1),b=kt.filter(y=>y.toLowerCase().includes(s.toLowerCase())&&!t.includes(y)),w=y=>{a(y),u(!1)};return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, 0.2))
              `,border:"2px solid rgba(239, 68, 68, 0.5)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.4)"},children:e.jsx(o,{Icon:n.Pill,size:24,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Médicaments Actuels"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Traitements en cours et suppléments"})]}),t.length>0&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-blue-500/20",children:e.jsx("span",{className:"text-blue-300 font-bold text-sm",children:t.length})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Ajouter un médicament"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx("input",{type:"text",value:s,onChange:y=>{a(y.target.value),u(!0)},onFocus:()=>u(!0),onBlur:()=>setTimeout(()=>u(!1),200),className:"glass-input w-full",placeholder:"Ex: Metformine, Aspirine..."})}),e.jsxs("button",{type:"button",onClick:i,disabled:!s.trim(),className:"btn-glass py-2 px-4 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:[e.jsx(o,{Icon:n.Plus,size:14,className:"inline mr-1"}),"Ajouter"]})]}),x&&s.length>0&&b.length>0&&e.jsx(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute z-10 mt-2 w-full max-h-60 overflow-y-auto rounded-xl bg-gray-900/95 border border-white/10 backdrop-blur-xl shadow-2xl",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-white/50 text-xs px-3 py-2",children:"Médicaments courants:"}),b.map((y,S)=>e.jsx("button",{type:"button",onClick:()=>w(y),className:"w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-colors text-white text-sm",children:y},S))]})})]}),t.length>0&&e.jsx("div",{className:"space-y-2",children:t.map((y,S)=>e.jsxs(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:S*.05},className:"flex items-center justify-between p-3 rounded-lg bg-blue-500/10 border border-blue-400/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-white font-medium text-sm",children:y})]}),e.jsx("button",{type:"button",onClick:()=>r(S),className:"text-blue-400 hover:text-blue-300 transition-colors p-2",children:e.jsx(o,{Icon:n.X,size:16})})]},S))}),t.length===0&&e.jsxs("div",{className:"text-center py-6 text-white/50 text-sm",children:[e.jsx(o,{Icon:n.Pill,size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aucun médicament ajouté"}),e.jsx("p",{className:"text-xs mt-1",children:"Incluez les traitements et suppléments réguliers"})]}),e.jsx(X,{children:d&&c&&e.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:c,disabled:l,className:"btn-glass px-6 py-2.5 text-sm",style:{background:"rgba(239, 68, 68, 0.2)",borderColor:"rgba(239, 68, 68, 0.4)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(o,{Icon:n.Loader2,size:16,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:16}),e.jsx("span",{children:l?"Sauvegarde...":"Sauvegarder"})]})})})}),e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-amber-500/10 border border-amber-400/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(o,{Icon:n.AlertTriangle,size:14,className:"text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-white/70 text-xs leading-relaxed",children:"Important: Incluez tous vos médicaments prescrits et en vente libre. Ces informations peuvent influencer les recommandations nutritionnelles et sportives."})]})})]})})},Tt=["Arachides","Fruits à coque","Lait","Œufs","Soja","Blé/Gluten","Poisson","Fruits de mer","Sésame"],Dt=["Pénicilline","Aspirine","Ibuprofène","Codéine","Morphine","Sulfamides"],Pt=["Pollen","Acariens","Poils de chat","Poils de chien","Moisissures","Latex","Piqûres d'insectes"],_e={mild:{label:"Légère",color:"#10B981",icon:n.Info},moderate:{label:"Modérée",color:"#F59E0B",icon:n.AlertCircle},severe:{label:"Sévère",color:"#EF4444",icon:n.AlertTriangle},anaphylaxis:{label:"Anaphylaxie",color:"#991B1B",icon:n.AlertTriangle}},Ft=({allergies:t,onAddAllergy:s,onRemoveAllergy:a,onSave:i,isSaving:r,isDirty:c})=>{const[l,d]=_.useState(!1),[x,u]=_.useState(""),[b,w]=_.useState("food"),[y,S]=_.useState("mild"),[m,g]=_.useState(!1),C=(()=>{switch(b){case"food":return Tt;case"medication":return Dt;case"environmental":return Pt}})().filter(p=>p.toLowerCase().includes(x.toLowerCase())&&!t.some(T=>T.name===p&&T.category===b)),j=()=>{x.trim()&&(s({name:x.trim(),category:b,severity:y}),u(""),S("mild"),d(!1))},f=p=>{switch(p){case"food":return{label:"Alimentaire",icon:n.Apple,color:"#F59E0B"};case"medication":return{label:"Médicament",icon:n.Pill,color:"#EF4444"};case"environmental":return{label:"Environnement",icon:n.Wind,color:"#10B981"};default:return{label:"Autre",icon:n.AlertCircle,color:"#6B7280"}}},v={food:t.filter(p=>p.category==="food"),medication:t.filter(p=>p.category==="medication"),environmental:t.filter(p=>p.category==="environmental")},I=t.some(p=>p.severity==="anaphylaxis");return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, 0.2))
              `,border:"2px solid rgba(239, 68, 68, 0.5)",boxShadow:"0 0 20px rgba(239, 68, 68, 0.4)"},children:e.jsx(o,{Icon:n.AlertTriangle,size:24,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Allergies"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Allergies alimentaires, médicamenteuses et environnementales"})]}),t.length>0&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-orange-500/20",children:e.jsx("span",{className:"text-orange-300 font-bold text-sm",children:t.length})})]}),I&&e.jsx(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-xl bg-red-900/30 border-2 border-red-500/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.AlertTriangle,size:20,className:"text-red-400 mt-0.5 flex-shrink-0 animate-pulse"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-red-300 font-bold text-sm mb-1",children:"RISQUE D'ANAPHYLAXIE"}),e.jsx("p",{className:"text-white/70 text-xs",children:"Vous avez déclaré des allergies pouvant causer une réaction anaphylactique. Assurez-vous d'avoir toujours votre EpiPen accessible."})]})]})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Ajouter une allergie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:x,onChange:p=>{u(p.target.value),g(!0)},onFocus:()=>g(!0),onBlur:()=>setTimeout(()=>g(!1),200),className:"glass-input w-full",placeholder:"Ex: Arachides, Pénicilline..."}),m&&x.length>0&&C.length>0&&e.jsx("div",{className:"absolute z-10 mt-2 w-full max-h-48 overflow-y-auto rounded-lg bg-gray-900/95 border border-white/10 backdrop-blur-xl shadow-2xl",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-white/50 text-xs px-3 py-2",children:"Suggestions courantes:"}),C.map((p,T)=>e.jsx("button",{type:"button",onClick:()=>{u(p),g(!1)},className:"w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-colors text-white text-sm",children:p},T))]})})]}),e.jsxs("button",{type:"button",onClick:()=>d(!l),className:"btn-glass py-2 px-4 text-sm flex-shrink-0",children:[e.jsx(o,{Icon:l?n.ChevronUp:n.ChevronDown,size:14,className:"inline mr-1"}),l?"Masquer":"Options"]})]})]}),e.jsx(X,{children:l&&e.jsx(P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4 p-4 rounded-xl bg-white/5 border border-white/10",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-2",children:"Catégorie"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["food","medication","environmental"].map(p=>{const T=f(p);return e.jsxs("button",{type:"button",onClick:()=>w(p),className:`p-3 rounded-lg border-2 transition-all ${b===p?"bg-white/10 border-white/30":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[e.jsx(o,{Icon:T.icon,size:20,style:{color:T.color},className:"mx-auto mb-1"}),e.jsx("div",{className:"text-white text-xs",children:T.label})]},p)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm mb-2",children:"Sévérité"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Object.entries(_e).map(([p,T])=>e.jsx("button",{type:"button",onClick:()=>S(p),className:`p-2 rounded-lg border-2 transition-all ${y===p?"border-white/30":"border-white/10 hover:border-white/20"}`,style:{background:y===p?`${T.color}20`:"transparent"},children:e.jsx("div",{className:"text-xs font-medium",style:{color:T.color},children:T.label})},p))})]}),e.jsxs("button",{type:"button",onClick:j,disabled:!x.trim(),className:"btn-glass w-full py-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(o,{Icon:n.Plus,size:14,className:"inline mr-2"}),"Ajouter avec ces options"]})]})})}),e.jsx("div",{className:"space-y-6",children:["food","medication","environmental"].map(p=>{const T=v[p];if(T.length===0)return null;const E=f(p);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:E.icon,size:16,style:{color:E.color}}),e.jsxs("h4",{className:"text-white/90 font-medium text-sm",children:[E.label,"s"]}),e.jsxs("span",{className:"text-white/50 text-xs",children:["(",T.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:T.map((A,k)=>{const D=_e[A.severity];return e.jsxs(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:D.color}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-white font-medium text-sm",children:A.name}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{background:`${D.color}20`,color:D.color},children:D.label})})]})]}),e.jsx("button",{type:"button",onClick:()=>a(t.indexOf(A)),className:"text-red-400 hover:text-red-300 transition-colors p-2",children:e.jsx(o,{Icon:n.Trash2,size:16})})]},k)})})]},p)})}),t.length===0&&!l&&e.jsxs("div",{className:"text-center py-8 text-white/50 text-sm",children:[e.jsx(o,{Icon:n.Shield,size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aucune allergie enregistrée"}),e.jsx("p",{className:"text-xs mt-1",children:"Ajoutez vos allergies pour une meilleure personnalisation"})]}),c&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:i,disabled:r,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[r?e.jsx(o,{Icon:n.Loader2,size:14,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:14}),e.jsx("span",{children:r?"Sauvegarde...":"Sauvegarder"})]})})}),e.jsx("div",{className:"mt-6 p-3 rounded-lg bg-red-500/10 border border-red-400/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(o,{Icon:n.Info,size:14,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-white/70 text-xs leading-relaxed",children:"Ces informations sont essentielles pour votre sécurité. Elles seront utilisées pour adapter vos plans nutritionnels et alerter en cas d'urgence médicale."})]})})]})})};function Te(t,s){const{formName:a,userId:i,data:r}=s;return h.error(`HEALTH_SAVE_ERROR_${a}`,"Save operation failed",{error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0,userId:i,dataKeys:r?Object.keys(r):[],timestamp:new Date().toISOString()}),t instanceof Error&&(t.name==="QuotaExceededError"||t.message.includes("QuotaExceededError")||t.message.includes("quota")||t.message.includes("exceeded the quota"))?{type:"DATABASE",message:"Espace de stockage insuffisant",originalError:t,retryable:!0,userMessage:"Mémoire locale saturée. Un nettoyage automatique a été effectué. Veuillez réessayer."}:t instanceof Error&&(t.message.includes("fetch")||t.message.includes("network")||t.message.includes("timeout")||t.message.includes("Network request failed"))?{type:"NETWORK",message:"Erreur réseau lors de la sauvegarde",originalError:t,retryable:!0,userMessage:"Problème de connexion. Veuillez vérifier votre connexion internet et réessayer."}:t instanceof Error&&(t.message.includes("permission")||t.message.includes("policy")||t.message.includes("RLS")||t.message.includes("JWT"))?{type:"PERMISSION",message:"Erreur de permissions",originalError:t,retryable:!1,userMessage:"Vous n'avez pas les permissions nécessaires. Veuillez vous reconnecter."}:t instanceof Error&&(t.message.includes("constraint")||t.message.includes("duplicate")||t.message.includes("foreign key")||t.message.includes("null value"))?{type:"DATABASE",message:"Erreur de base de données",originalError:t,details:{constraint:t.message},retryable:!1,userMessage:"Données invalides. Veuillez vérifier les informations saisies."}:t instanceof Error&&(t.name==="ZodError"||t.message.includes("validation")||t.message.includes("invalid"))?{type:"VALIDATION",message:"Erreur de validation",originalError:t,retryable:!1,userMessage:"Certains champs contiennent des erreurs. Veuillez les corriger."}:{type:"UNKNOWN",message:t instanceof Error?t.message:"Erreur inconnue",originalError:t instanceof Error?t:void 0,retryable:!0,userMessage:"Une erreur inattendue s'est produite. Veuillez réessayer."}}const Rt={maxAttempts:3,baseDelay:1e3,maxDelay:5e3};async function Mt(t,s,a=Rt){let i,r=0;for(;r<a.maxAttempts;){r++;try{h.debug(`HEALTH_SAVE_RETRY_${s.formName}`,`Attempt ${r}/${a.maxAttempts}`,{userId:s.userId,timestamp:new Date().toISOString()});const c=await t();return r>1&&h.info(`HEALTH_SAVE_RETRY_${s.formName}`,`Succeeded on attempt ${r}`,{userId:s.userId,timestamp:new Date().toISOString()}),c}catch(c){i=c;const l=Te(c,{...s,data:void 0});if(!l.retryable)throw h.error(`HEALTH_SAVE_RETRY_${s.formName}`,"Non-retryable error, aborting",{errorType:l.type,attempt:r,userId:s.userId,timestamp:new Date().toISOString()}),c;if(r>=a.maxAttempts)throw h.error(`HEALTH_SAVE_RETRY_${s.formName}`,"Max retry attempts reached",{attempts:r,userId:s.userId,timestamp:new Date().toISOString()}),c;const d=Math.min(a.baseDelay*Math.pow(2,r-1),a.maxDelay);h.info(`HEALTH_SAVE_RETRY_${s.formName}`,`Retrying after ${d}ms`,{attempt:r,nextAttempt:r+1,maxAttempts:a.maxAttempts,userId:s.userId,timestamp:new Date().toISOString()}),await new Promise(x=>setTimeout(x,d))}}throw i}function Ot(t,s){const a=[];return s.formName==="ALLERGIES"&&t.allergies&&!Array.isArray(t.allergies)&&a.push("Allergies must be an array"),s.formName==="VACCINATIONS"&&t.vaccinations&&!Array.isArray(t.vaccinations)&&a.push("Vaccinations must be an array"),s.formName==="MEDICAL_CONDITIONS"&&(t.conditions&&!Array.isArray(t.conditions)&&a.push("Conditions must be an array"),t.medications&&!Array.isArray(t.medications)&&a.push("Medications must be an array")),{valid:a.length===0,errors:a}}function je(){const{profile:t,updateProfile:s,saving:a}=G(),{showToast:i}=re(),{success:r}=K(),[c,l]=R.useState(null),[d,x]=R.useState([]),u=R.useRef(!1),b=R.useCallback(async S=>{const{section:m,data:g,onSuccess:N,onError:C}=S;if(u.current){h.warn("HEALTH_PROFILE_SAVE","Save already in progress, queuing operation",{section:m,userId:t?.userId}),x(j=>[...j,S]);return}u.current=!0,l(m);try{h.info("HEALTH_PROFILE_SAVE",`Starting save for section: ${m}`,{section:m,userId:t?.userId,dataKeys:Object.keys(g),timestamp:new Date().toISOString()});const j=Ot(g,{formName:m.toUpperCase()});if(!j.valid)throw new Error(`Validation failed: ${j.errors.join(", ")}`);await Mt(async()=>{const f=t?.health;let v;switch(m){case"basic":v={...f,version:"2.0",basic:{...f?.basic,...g}};break;case"allergies":v={...f,version:"2.0",medical_history:{...f?.medical_history,conditions:f?.medical_history?.conditions||[],medications:f?.medical_history?.medications||[],allergies:g.allergies||[]}};break;case"vaccinations":v={...f,version:"2.0",vaccinations:{up_to_date:g.up_to_date||!1,records:g.records||[],last_reviewed:new Date().toISOString()}};break;case"medical_conditions":v={...f,version:"2.0",medical_history:{...f?.medical_history,conditions:g.conditions||[],medications:g.medications||[],allergies:f?.medical_history?.allergies||[]},declaredNoIssues:g.declaredNoIssues||!1};break;case"family_history":v={...f,version:"2.0",family_history:g};break;case"lifestyle":v={...f,version:"2.0",lifestyle:g};break;case"vital_signs":v={...f,version:"2.0",vital_signs:g};break;case"intimacy":v={...f,version:"2.0",intimacy:g};break;case"geographic":await s({country:g.country,updated_at:new Date().toISOString()});return;default:throw new Error(`Unknown health section: ${m}`)}await s({health:v,updated_at:new Date().toISOString()}),h.info("HEALTH_PROFILE_SAVE",`Successfully saved section: ${m}`,{section:m,userId:t?.userId,timestamp:new Date().toISOString()})},{formName:m.toUpperCase(),userId:t?.userId}),r(),i({type:"success",title:"Sauvegardé",message:Lt(m),duration:3e3}),N&&N()}catch(j){h.error("HEALTH_PROFILE_SAVE",`Failed to save section: ${m}`,{error:j instanceof Error?j.message:String(j),stack:j instanceof Error?j.stack:void 0,section:m,userId:t?.userId,timestamp:new Date().toISOString()});const f=Te(j,{formName:m.toUpperCase(),userId:t?.userId,data:g});throw i({type:"error",title:zt(f.type),message:f.userMessage,duration:5e3}),C&&C(f),j}finally{u.current=!1,l(null),x(j=>{if(j.length>0){const[f,...v]=j;return setTimeout(()=>b(f),100),v}return j})}},[t,s,i,r]),w=R.useCallback(S=>c===S||a,[c,a]),y=R.useCallback(()=>c!==null||a||d.length>0,[c,a,d.length]);return{saveSection:b,isSectionSaving:w,isAnySectionSaving:y,savingSection:c,pendingOperationsCount:d.length}}function Lt(t){return{basic:"Informations de base sauvegardées",allergies:"Allergies sauvegardées",vaccinations:"Vaccinations sauvegardées",medical_conditions:"Conditions médicales sauvegardées",family_history:"Antécédents familiaux sauvegardés",lifestyle:"Informations de vie sauvegardées",vital_signs:"Signes vitaux sauvegardés",intimacy:"Informations intimes sauvegardées",geographic:"Données géographiques sauvegardées"}[t]||"Informations sauvegardées"}function zt(t){return{VALIDATION:"Erreur de validation",NETWORK:"Erreur réseau",PERMISSION:"Erreur de permissions",DATABASE:"Erreur de base de données",UNKNOWN:"Erreur inconnue"}[t]||"Erreur"}function ce(t,s){if(t===s)return!0;if(t==null||s==null||typeof t!="object"||typeof s!="object")return t===s;if(Array.isArray(t)!==Array.isArray(s))return!1;if(Array.isArray(t))return t.length!==s.length?!1:t.every((r,c)=>ce(r,s[c]));const a=Object.keys(t),i=Object.keys(s);return a.length!==i.length?!1:a.every(r=>ce(t[r],s[r]))}function ie(t){if(t===""||t===null||t===void 0)return null;if(Array.isArray(t))return t.length===0?null:t.map(ie);if(typeof t=="object"&&t!==null){const s={};for(const a in t){const i=ie(t[a]);i!==null&&(s[a]=i)}return Object.keys(s).length===0?null:s}return t}function ye({currentValues:t,initialValues:s,formName:a,enabled:i=!0}){const[r,c]=R.useState(!1),[l,d]=R.useState([]),[x,u]=R.useState(!1),b=R.useRef(null),w=R.useRef(!1);R.useEffect(()=>{!x&&s&&(b.current=ie(s),u(!0),w.current||(h.debug(`HEALTH_FORM_DIRTY_${a}`,"Form initialized with values",{initialValues:b.current,timestamp:new Date().toISOString()}),w.current=!0))},[s,x,a]),R.useEffect(()=>{if(!i||!x||!b.current)return;const m=ie(t),g=b.current,N=ce(m,g),C=r,j=!N;if(C!==j)if(c(j),j){const f=[];for(const v in m)ce(m[v],g[v])||f.push(v);d(f),h.info(`HEALTH_FORM_DIRTY_${a}`,"Form became dirty",{changedFields:f,currentValues:m,initialValues:g,timestamp:new Date().toISOString()})}else d([]),h.info(`HEALTH_FORM_DIRTY_${a}`,"Form became clean",{timestamp:new Date().toISOString()})},[t,i,x,r,a]);const y=R.useCallback(m=>{const g=m||t;b.current=ie(g),c(!1),d([]),h.info(`HEALTH_FORM_DIRTY_${a}`,"Dirty state reset",{newInitialValues:b.current,timestamp:new Date().toISOString()})},[t,a]),S=R.useCallback(m=>{c(m),h.info(`HEALTH_FORM_DIRTY_${a}`,"Dirty state set manually",{isDirty:m,timestamp:new Date().toISOString()})},[a]);return{isDirty:i?r:!1,changedFields:l,isInitialized:x,resetDirtyState:y,setDirtyManually:S,changedFieldsCount:l.length}}function Bt(t){const{profile:s}=G(),{saveSection:a,isSectionSaving:i}=je(),r=s?.health,[c,l]=_.useState([]),[d,x]=_.useState(!1),[u,b]=_.useState({vaccinations:[],upToDate:!1}),w=f=>{l(v=>[...v,f]),h.info("VACCINATIONS_FORM","Added vaccination",{name:f.name})},y=(f,v)=>{l(I=>{const p=[...I];return p[f]=v,p}),h.info("VACCINATIONS_FORM","Updated vaccination",{index:f,name:v.name})},S=f=>{l(v=>v.filter((I,p)=>p!==f)),h.info("VACCINATIONS_FORM","Removed vaccination",{index:f})};_.useEffect(()=>{const f=r?.vaccinations?.records||[],v=r?.vaccinations?.up_to_date||!1;l(f),x(v),b({vaccinations:f,upToDate:v}),h.debug("VACCINATIONS_FORM","Initialized vaccinations from database",{recordsCount:f.length,upToDate:v,timestamp:new Date().toISOString()})},[r?.vaccinations?.records,r?.vaccinations?.up_to_date]);const{isDirty:m,changedFieldsCount:g,resetDirtyState:N}=ye({currentValues:{vaccinations:c,upToDate:d},initialValues:u,formName:"VACCINATIONS"});return{vaccinations:c,upToDate:d,onAddVaccination:w,onUpdateVaccination:y,onRemoveVaccination:S,onToggleUpToDate:f=>{x(f),h.info("VACCINATIONS_FORM","Toggled up to date status",{checked:f})},onSave:async()=>{try{h.info("VACCINATIONS_FORM","Saving vaccinations",{userId:s?.userId,count:c.length,upToDate:d}),await a({section:"vaccinations",data:{up_to_date:d,records:c},onSuccess:()=>{b({vaccinations:c,upToDate:d}),N({vaccinations:c,upToDate:d}),h.info("VACCINATIONS_FORM","Successfully saved and reset dirty state",{recordsCount:c.length,upToDate:d})}})}catch(f){h.error("VACCINATIONS_FORM","Save failed (already handled by saveSection)",{error:f instanceof Error?f.message:"Unknown error"})}},isSaving:i("vaccinations"),isDirty:m,changedFieldsCount:g}}function Ht(){const{profile:t}=G(),{saveSection:s,isSectionSaving:a}=je(),i=t?.health,[r,c]=R.useState([]),[l,d]=R.useState([]),[x,u]=R.useState(""),[b,w]=R.useState(""),[y,S]=R.useState(!1),[m,g]=R.useState({conditions:[],medications:[],hasDeclaredNoIssues:!1});R.useEffect(()=>{const A=i?.medical_history?.conditions||[],k=i?.medical_history?.medications||[],D=i?.declaredNoIssues||!1;c(A),d(k),S(D),g({conditions:A,medications:k,hasDeclaredNoIssues:D}),h.debug("MEDICAL_CONDITIONS_FORM","Initialized from database",{conditionsCount:A.length,medicationsCount:k.length,declaredNoIssues:D,timestamp:new Date().toISOString()})},[i?.medical_history?.conditions,i?.medical_history?.medications,i?.declaredNoIssues]);const{isDirty:N,changedFieldsCount:C,resetDirtyState:j}=ye({currentValues:{conditions:r,medications:l,hasDeclaredNoIssues:y},initialValues:m,formName:"MEDICAL_CONDITIONS"}),f=R.useCallback(()=>{x.trim()&&(c(A=>[...A,x.trim()]),u(""),y&&S(!1),h.info("MEDICAL_CONDITIONS_FORM","Added condition",{condition:x.trim()}))},[x,y]),v=R.useCallback(A=>{c(k=>k.filter((D,M)=>M!==A)),h.info("MEDICAL_CONDITIONS_FORM","Removed condition",{index:A})},[]),I=R.useCallback(()=>{b.trim()&&(d(A=>[...A,b.trim()]),w(""),y&&S(!1),h.info("MEDICAL_CONDITIONS_FORM","Added medication",{medication:b.trim()}))},[b,y]),p=R.useCallback(A=>{d(k=>k.filter((D,M)=>M!==A)),h.info("MEDICAL_CONDITIONS_FORM","Removed medication",{index:A})},[]),T=R.useCallback(async()=>{try{h.info("MEDICAL_CONDITIONS_FORM","Declaring no health issues"),await s({section:"medical_conditions",data:{conditions:[],medications:[],declaredNoIssues:!0},onSuccess:()=>{c([]),d([]),S(!0),g({conditions:[],medications:[],hasDeclaredNoIssues:!0}),j({conditions:[],medications:[],hasDeclaredNoIssues:!0}),h.info("MEDICAL_CONDITIONS_FORM","Successfully declared no issues")}})}catch(A){h.error("MEDICAL_CONDITIONS_FORM","Failed to declare no issues",{error:A instanceof Error?A.message:"Unknown error"})}},[s,j]),E=R.useCallback(async()=>{try{h.info("MEDICAL_CONDITIONS_FORM","Saving medical conditions and medications",{conditionsCount:r.length,medicationsCount:l.length,declaredNoIssues:y}),await s({section:"medical_conditions",data:{conditions:r,medications:l,declaredNoIssues:r.length===0&&l.length===0?y:!1},onSuccess:()=>{g({conditions:r,medications:l,hasDeclaredNoIssues:y}),j({conditions:r,medications:l,hasDeclaredNoIssues:y}),h.info("MEDICAL_CONDITIONS_FORM","Successfully saved and reset dirty state",{conditionsCount:r.length,medicationsCount:l.length})}})}catch(A){h.error("MEDICAL_CONDITIONS_FORM","Save failed (already handled by saveSection)",{error:A instanceof Error?A.message:"Unknown error"})}},[r,l,y,s,j]);return{conditions:r,medications:l,newCondition:x,newMedication:b,setNewCondition:u,setNewMedication:w,addCondition:f,removeCondition:v,addMedication:I,removeMedication:p,declareNoIssues:T,hasDeclaredNoIssues:y,saveChanges:E,saving:a("medical_conditions"),isDirty:N,changedFieldsCount:C}}function qt(){const{profile:t}=G(),{saveSection:s,isSectionSaving:a}=je(),i=t?.health,[r,c]=_.useState([]),[l,d]=_.useState([]);_.useEffect(()=>{const g=(i?.medical_history?.allergies||[]).map(N=>({name:N,category:"food",severity:"mild"}));c(g),d(g),h.debug("ALLERGIES_FORM","Initialized allergies from database",{count:g.length,allergies:g,timestamp:new Date().toISOString()})},[i?.medical_history?.allergies]);const{isDirty:x,changedFieldsCount:u,resetDirtyState:b}=ye({currentValues:{allergies:r},initialValues:{allergies:l},formName:"ALLERGIES"});return{allergies:r,onAddAllergy:m=>{c(g=>[...g,m]),h.info("ALLERGIES_FORM","Added allergy",{name:m.name,category:m.category,severity:m.severity})},onRemoveAllergy:m=>{c(g=>g.filter((N,C)=>C!==m)),h.info("ALLERGIES_FORM","Removed allergy",{index:m})},onSave:async()=>{try{h.info("ALLERGIES_FORM","Saving allergies",{userId:t?.userId,count:r.length,allergies:r.map(g=>g.name)});const m=r.map(g=>g.name);await s({section:"allergies",data:{allergies:m},onSuccess:()=>{d(r),b({allergies:r}),h.info("ALLERGIES_FORM","Successfully saved and reset dirty state",{count:r.length})}})}catch(m){h.error("ALLERGIES_FORM","Save failed (already handled by saveSection)",{error:m instanceof Error?m.message:"Unknown error"})}},isSaving:a("allergies"),isDirty:x,changedFieldsCount:u}}function Gt(t){const[s,a]=_.useState(null);return _.useEffect(()=>{if(!t){a(null);return}(async()=>{try{h.info("COUNTRY_HEALTH","Fetching country health data",{countryCode:t});const{data:r,error:c}=await W.from("country_health_data").select("*").eq("country_code",t).maybeSingle();if(c){h.error("COUNTRY_HEALTH","Failed to fetch country health data",{error:c.message,countryCode:t});return}r&&(a(r),h.info("COUNTRY_HEALTH","Country health data loaded",{countryCode:t,countryName:r.country_name}))}catch(r){h.error("COUNTRY_HEALTH","Error fetching country health data",{error:r instanceof Error?r.message:"Unknown error",countryCode:t})}})()},[t]),s}const Rs=()=>{const{profile:t}=G(),{form:s,actions:a,state:i}=Nt(),{handleSubmit:r,errors:c,isDirty:l,watchedValues:d,setValue:x}=s,{saveMedicalSection:u,saveConstraintsSection:b,onSubmit:w}=a,{saving:y,sectionSaving:S,hasConstraintsChanges:m}=i,[g,N]=_.useState(""),[C,j]=_.useState(""),f=tt(t),v=Gt(t?.country),I=Bt(),p=Ht(),T=qt(),E=()=>{if(g.trim()){const M=d.constraints||[];x("constraints",[...M,g.trim()],{shouldDirty:!0}),N("")}},A=M=>{const H=d.constraints||[];x("constraints",H.filter((L,q)=>q!==M),{shouldDirty:!0})},k=()=>{if(C.trim()){const M=d.physicalLimitations||[];x("physicalLimitations",[...M,C.trim()],{shouldDirty:!0}),j("")}},D=M=>{const H=d.physicalLimitations||[];x("physicalLimitations",H.filter((L,q)=>q!==M),{shouldDirty:!0})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(wt,{percentage:f,title:"Profil Santé & Médical",subtitle:"Configurez vos informations médicales et contraintes",color:"#EF4444"}),e.jsxs("form",{onSubmit:r(w),className:"space-y-6",children:[e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(239, 68, 68, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #EF4444 35%, transparent), color-mix(in srgb, #EF4444 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #EF4444 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EF4444 30%, transparent)"},children:e.jsx(o,{Icon:n.Lock,size:20,style:{color:"#EF4444"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Contraintes Alimentaires"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Restrictions spécifiques et contraintes médicales"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-sm font-medium",children:"Spécifique"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/90 text-sm font-medium mb-3",children:"Contraintes spécifiques (ex: faible en sodium, sans gluten)"}),e.jsx(Ee,{items:d.constraints||[],newItem:g,setNewItem:N,onAdd:E,onRemove:A,placeholder:"Ajouter une contrainte...",itemColor:"rgba(139, 92, 246",itemLabel:"contrainte"})]})}),e.jsx(_t,{isDirty:m,isSaving:S==="constraints",onSave:b,sectionName:"Contraintes"})]}),e.jsx(Ct,{vaccinations:I.vaccinations,countryData:v,onAddVaccination:I.onAddVaccination,onUpdateVaccination:I.onUpdateVaccination,onRemoveVaccination:I.onRemoveVaccination,onToggleUpToDate:I.onToggleUpToDate,upToDate:I.upToDate,onSave:I.onSave,isSaving:I.isSaving,isDirty:I.isDirty}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(At,{conditions:p.conditions,newCondition:p.newCondition,setNewCondition:p.setNewCondition,onAddCondition:p.addCondition,onRemoveCondition:p.removeCondition,onSave:p.saveChanges,isSaving:p.saving,isDirty:p.isDirty}),e.jsx(Ft,{allergies:T.allergies,onAddAllergy:T.onAddAllergy,onRemoveAllergy:T.onRemoveAllergy,onSave:T.onSave,isSaving:T.isSaving,isDirty:T.isDirty})]}),e.jsx(Et,{medications:p.medications,newMedication:p.newMedication,setNewMedication:p.setNewMedication,onAddMedication:p.addMedication,onRemoveMedication:p.removeMedication,onSave:p.saveChanges,isSaving:p.saving,isDirty:p.isDirty}),e.jsx(St,{physicalLimitations:d.physicalLimitations||[],newPhysicalLimitation:C,setNewPhysicalLimitation:j,onAddPhysicalLimitation:k,onRemovePhysicalLimitation:D,onSave:u,isSaving:S==="medical",isDirty:m}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{type:"submit",disabled:y||!l,className:`btn-glass--primary px-8 py-4 text-lg font-semibold ${l?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[y?e.jsx(o,{Icon:n.Loader2,size:20,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:20}),e.jsx("span",{children:y?"Sauvegarde globale...":"Sauvegarder Tout"})]})})}),Object.keys(c).length>0&&e.jsxs(F,{className:"p-4",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h4",{className:"text-red-300 font-medium mb-3 flex items-center gap-2",children:[e.jsx(o,{Icon:n.AlertCircle,size:16}),"Erreurs de validation"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(c).map(([M,H])=>e.jsxs("p",{className:"text-red-200 text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),H.message]},M))})]})]})]})};function $t(t){const s={recommended:120,min:100,max:150,reasoning:"Estimation basée sur un adulte moyen",formula:"Valeur par défaut"};if(!t?.weight_kg||t.weight_kg<=0)return s;const a=t.weight_kg;let i=1.6,r="";t.objective==="muscle_gain"?(i=2.2,r="Prise de muscle - besoins élevés pour la synthèse protéique"):t.objective==="fat_loss"?(i=2,r="Perte de graisse - protéines élevées pour préserver la masse musculaire"):t.objective==="recomp"?(i=1.8,r="Recomposition - équilibre entre maintien et développement musculaire"):(i=1.6,r="Maintenance - besoins standards pour un adulte actif"),t.activity_level==="athlete"?(i+=.2,r+=" + bonus athlète"):t.activity_level==="active"?(i+=.1,r+=" + bonus actif"):t.activity_level==="sedentary"&&(i-=.1,r+=" - ajustement sédentaire");const c=Math.round(a*i),l=Math.round(a*(i-.2)),d=Math.round(a*(i+.3));return{recommended:c,min:l,max:d,reasoning:r,formula:`${a}kg × ${i.toFixed(1)}g/kg = ${c}g`}}function Ut(t){return!!(t?.weight_kg&&t.weight_kg>0)}const be=[{id:"16:8",name:"16:8 (Classique)",description:"16h de jeûne, 8h d'alimentation - Le plus populaire et accessible",windowHours:16,eatingHours:8,difficulty:"beginner",benefits:["Facile à maintenir","Améliore la sensibilité à l'insuline","Favorise la perte de graisse"],suggestedTimes:{morning:{start:"20:00",end:"12:00"},evening:{start:"22:00",end:"14:00"},intermediate:{start:"21:00",end:"13:00"}}},{id:"18:6",name:"18:6 (Intermédiaire)",description:"18h de jeûne, 6h d'alimentation - Plus strict, résultats accélérés",windowHours:18,eatingHours:6,difficulty:"intermediate",benefits:["Autophagie renforcée","Perte de graisse accélérée","Clarté mentale"],suggestedTimes:{morning:{start:"19:00",end:"13:00"},evening:{start:"21:00",end:"15:00"},intermediate:{start:"20:00",end:"14:00"}}},{id:"20:4",name:"20:4 (Warrior)",description:`20h de jeûne, 4h d'alimentation - Protocole avancé type "Warrior Diet"`,windowHours:20,eatingHours:4,difficulty:"advanced",benefits:["Autophagie maximale","Discipline mentale","Optimisation hormonale"],suggestedTimes:{morning:{start:"18:00",end:"14:00"},evening:{start:"20:00",end:"16:00"},intermediate:{start:"19:00",end:"15:00"}}},{id:"14:10",name:"14:10 (Débutant)",description:"14h de jeûne, 10h d'alimentation - Idéal pour commencer en douceur",windowHours:14,eatingHours:10,difficulty:"beginner",benefits:["Introduction douce","Facile à adapter","Moins de contraintes"],suggestedTimes:{morning:{start:"21:00",end:"11:00"},evening:{start:"23:00",end:"13:00"},intermediate:{start:"22:00",end:"12:00"}}}];function Vt(t){return be.find(s=>s.id===t)||null}function Wt(t,s){const a=s||"intermediate";return t.suggestedTimes[a]}const Yt=V({fastingWindow:V({start:z().optional(),end:z().optional(),windowHours:B().min(8).max(24).optional(),mealsPerDay:B().min(1).max(8).optional(),protocol:z().optional()}).optional(),proteinTarget_g:B().min(0).max(300).optional(),caloriesTarget:B().min(800).max(5e3).optional()});function Kt(){const{profile:t,updateProfile:s,saving:a}=G(),{showToast:i}=re(),{success:r,formSubmit:c}=K(),[l,d]=_.useState(null),x=_.useMemo(()=>Ut(t)?$t(t):null,[t?.weight_kg,t?.objective,t?.activity_level]),[u,b]=_.useState(""),w=de({resolver:ue(Yt),defaultValues:{fastingWindow:{start:t?.fastingWindow?.start||"",end:t?.fastingWindow?.end||"",windowHours:t?.fastingWindow?.windowHours||void 0,mealsPerDay:t?.fastingWindow?.mealsPerDay||void 0,protocol:t?.fastingWindow?.protocol||""},proteinTarget_g:t?.nutrition?.proteinTarget_g||x?.recommended||void 0,caloriesTarget:t?.macroTargets?.kcal||void 0},mode:"onChange"}),{register:y,handleSubmit:S,formState:m,watch:g,setValue:N,reset:C,trigger:j}=w,{errors:f,isDirty:v,dirtyFields:I}=m,p=g();_.useEffect(()=>{Y.getState().setTabDirty("fasting",v)},[v]),_.useEffect(()=>{t&&!v&&C({fastingWindow:{start:t.fastingWindow?.start||"",end:t.fastingWindow?.end||"",windowHours:t.fastingWindow?.windowHours||void 0,mealsPerDay:t.fastingWindow?.mealsPerDay||void 0,protocol:t.fastingWindow?.protocol||""},proteinTarget_g:t.nutrition?.proteinTarget_g||x?.recommended||void 0,caloriesTarget:t.macroTargets?.kcal||void 0})},[t,v,C]),_.useEffect(()=>{p.fastingWindow?.protocol!==void 0&&b(p.fastingWindow.protocol)},[p.fastingWindow?.protocol]);const T=L=>{if(b(L),L==="custom"){N("fastingWindow.protocol",L,{shouldDirty:!0});return}if(L===""){N("fastingWindow.protocol","",{shouldDirty:!0}),N("fastingWindow.windowHours",void 0,{shouldDirty:!0}),N("fastingWindow.start","",{shouldDirty:!0}),N("fastingWindow.end","",{shouldDirty:!0});return}const q=Vt(L);if(q){N("fastingWindow.protocol",L,{shouldDirty:!0}),N("fastingWindow.windowHours",q.windowHours,{shouldDirty:!0});const te=t?.emotions?.chronotype,ne=Wt(q,te);N("fastingWindow.start",ne.start,{shouldDirty:!0}),N("fastingWindow.end",ne.end,{shouldDirty:!0})}},E=()=>{x&&N("proteinTarget_g",x.recommended,{shouldDirty:!0})},A=async()=>{d("fasting");try{await s({fastingWindow:p.fastingWindow,updated_at:new Date().toISOString()}),C({fastingWindow:p.fastingWindow,proteinTarget_g:p.proteinTarget_g,caloriesTarget:p.caloriesTarget}),Y.getState().resetTabDirty("fasting"),r(),i({type:"success",title:"Protocole de jeûne sauvegardé",message:"Votre fenêtre de jeûne a été mise à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder le protocole de jeûne",duration:4e3})}finally{d(null)}},k=async()=>{d("objectives");try{await s({nutrition:{...t?.nutrition,proteinTarget_g:p.proteinTarget_g},macroTargets:{...t?.macroTargets,kcal:p.caloriesTarget},updated_at:new Date().toISOString()}),C({fastingWindow:p.fastingWindow,proteinTarget_g:p.proteinTarget_g,caloriesTarget:p.caloriesTarget}),Y.getState().resetTabDirty("fasting"),r(),i({type:"success",title:"Objectifs nutritionnels sauvegardés",message:"Vos cibles ont été mises à jour",duration:3e3})}catch{i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder les objectifs",duration:4e3})}finally{d(null)}},D=async L=>{try{c(),h.info("PROFILE_FASTING","Submitting complete fasting updates",{userId:t?.userId,philosophy:"complete_fasting_submission"}),await s({fastingWindow:L.fastingWindow,nutrition:{...t?.nutrition,proteinTarget_g:L.proteinTarget_g},macroTargets:{...t?.macroTargets,kcal:L.caloriesTarget},updated_at:new Date().toISOString()}),r(),i({type:"success",title:"Profil de jeûne sauvegardé",message:"Toutes vos données de jeûne ont été mises à jour",duration:4e3}),Y.getState().resetTabDirty("fasting")}catch(q){h.error("PROFILE_FASTING","Fasting update failed",{error:q instanceof Error?q.message:"Unknown error",userId:t?.userId}),i({type:"error",title:"Erreur de sauvegarde",message:"Impossible de sauvegarder votre profil de jeûne",duration:4e3})}},M=!!I.fastingWindow,H=!!(I.proteinTarget_g||I.caloriesTarget);return{form:{register:y,handleSubmit:S,errors:f,isDirty:v,dirtyFields:I,watchedValues:p,setValue:N,trigger:j},actions:{saveFastingSection:A,saveObjectivesSection:k,onSubmit:D},state:{saving:a,sectionSaving:l,hasFastingChanges:M,hasObjectivesChanges:H},helpers:{proteinCalculation:x,selectedFastingProtocol:u,handleFastingProtocolChange:T,resetProteinTarget:E}}}const Jt=({percentage:t,title:s,subtitle:a,color:i="#F59E0B"})=>e.jsxs(F,{className:"p-6 mb-6",style:{background:`
        radial-gradient(circle at 30% 20%, color-mix(in srgb, ${i} 8%, transparent) 0%, transparent 60%),
        var(--glass-opacity)
      `,borderColor:`color-mix(in srgb, ${i} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{children:e.jsxs("h3",{className:"text-white font-semibold text-xl mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, ${i} 35%, transparent), color-mix(in srgb, ${i} 25%, transparent))
                `,border:`2px solid color-mix(in srgb, ${i} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${i} 30%, transparent)`},children:e.jsx(o,{Icon:n.Timer,size:20,style:{color:i},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:s}),a&&e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:a})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:i,boxShadow:`0 0 8px ${i}60`}}),e.jsxs("span",{className:"text-white font-bold text-lg",children:[t,"%"]})]}),e.jsx("span",{className:"text-white/60 text-xs",children:"Complété"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(P.div,{className:"h-3 rounded-full relative overflow-hidden",style:{background:`linear-gradient(90deg, ${i}, color-mix(in srgb, ${i} 80%, white))`,boxShadow:`0 0 12px ${i}60, inset 0 1px 0 rgba(255,255,255,0.3)`},initial:{width:0},animate:{width:`${t}%`},transition:{duration:1.2,ease:"easeOut"},children:e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`linear-gradient(90deg, 
                  transparent 0%, 
                  rgba(255,255,255,0.4) 50%, 
                  transparent 100%
                )`,animation:"progressShimmer 2s ease-in-out infinite"}})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-white/50",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]})]}),Se=({isDirty:t,isSaving:s,onSave:a,sectionName:i})=>{const{formSubmit:r}=K();return t?e.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>{r(),a()},disabled:s,className:"btn-glass px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(o,{Icon:n.Loader2,size:14,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:14}),e.jsx("span",{children:s?"Sauvegarde...":`Sauvegarder ${i}`})]})})}):null},Ms=()=>{const{profile:t}=G(),{form:s,actions:a,state:i,helpers:r}=Kt(),{register:c,handleSubmit:l,errors:d,isDirty:x,watchedValues:u}=s,{saveFastingSection:b,saveObjectivesSection:w,onSubmit:y}=a,{saving:S,sectionSaving:m,hasFastingChanges:g,hasObjectivesChanges:N}=i,{proteinCalculation:C,selectedFastingProtocol:j,handleFastingProtocolChange:f,resetProteinTarget:v}=r,I=et(t);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Jt,{percentage:I,title:"Jeûne Intermittent",subtitle:"Configurez vos protocoles de jeûne et objectifs nutritionnels",color:"#F59E0B"}),e.jsxs("form",{onSubmit:l(y),className:"space-y-6",children:[e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(245, 158, 11, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(245, 158, 11, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(o,{Icon:n.Timer,size:20,style:{color:"#F59E0B"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Protocoles de Jeûne"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Configurez votre fenêtre de jeûne intermittent"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-400"}),e.jsx("span",{className:"text-orange-300 text-sm font-medium",children:"Temporel"})]})]}),e.jsx("div",{className:"mb-6 p-4 rounded-xl bg-orange-500/10 border border-orange-400/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.Info,size:16,className:"text-orange-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-orange-300 font-medium text-sm mb-2",children:"Qu'est-ce que le jeûne intermittent ?"}),e.jsx("p",{className:"text-orange-200 text-sm leading-relaxed",children:"Le jeûne intermittent alterne entre des périodes de jeûne et d'alimentation. Il peut améliorer la composition corporelle, la sensibilité à l'insuline et favoriser l'autophagie cellulaire."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fastingWindow.protocol",className:"block text-white/90 text-sm font-medium mb-3",children:"Protocole de jeûne"}),e.jsxs("select",{value:j,onChange:p=>f(p.target.value),className:"glass-input",id:"fastingWindow.protocol",children:[e.jsx("option",{value:"",children:"Aucun jeûne"}),be.map(p=>e.jsxs("option",{value:p.id,children:[p.name," - ",p.description]},p.id)),e.jsx("option",{value:"custom",children:"Personnalisé"})]}),j==="custom"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{htmlFor:"fastingWindow.windowHours",className:"block text-white/90 text-sm font-medium mb-2",children:"Fenêtre de jeûne personnalisée (heures)"}),e.jsx("input",{...c("fastingWindow.windowHours",{valueAsNumber:!0}),type:"number",id:"fastingWindow.windowHours",min:"8",max:"24",step:"1",className:"glass-input",placeholder:"16"})]}),j&&j!=="custom"&&e.jsx("div",{className:"mt-3 p-3 rounded-xl bg-orange-500/10 border border-orange-400/20",children:(()=>{const p=be.find(T=>T.id===j);return p?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p.difficulty==="beginner"?"bg-green-400":p.difficulty==="intermediate"?"bg-orange-400":"bg-red-400"}`}),e.jsx("span",{className:"text-orange-300 text-sm font-medium",children:p.difficulty==="beginner"?"Débutant":p.difficulty==="intermediate"?"Intermédiaire":"Avancé"})]}),e.jsxs("div",{className:"text-orange-200 text-xs",children:[e.jsx("strong",{children:"Bénéfices :"})," ",p.benefits.slice(0,2).join(", ")]})]}):null})()})]}),(j||u.fastingWindow?.windowHours)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"fastingWindow.start",className:"block text-white/90 text-sm font-medium mb-3",children:["Début du jeûne",e.jsx("span",{className:"text-orange-300 text-xs ml-2",children:"(dernière prise alimentaire)"})]}),e.jsx("input",{...c("fastingWindow.start"),type:"time",id:"fastingWindow.start",className:"glass-input"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"fastingWindow.end",className:"block text-white/90 text-sm font-medium mb-3",children:["Fin du jeûne",e.jsx("span",{className:"text-orange-300 text-xs ml-2",children:"(première prise alimentaire)"})]}),e.jsx("input",{...c("fastingWindow.end"),type:"time",id:"fastingWindow.end",className:"glass-input"})]})]}),(j||u.fastingWindow?.windowHours)&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{htmlFor:"fastingWindow.mealsPerDay",className:"block text-white/90 text-sm font-medium mb-3",children:["Nombre de repas par jour",e.jsx("span",{className:"text-orange-300 text-xs ml-2",children:"(pendant la fenêtre d'alimentation)"})]}),e.jsxs("select",{...c("fastingWindow.mealsPerDay",{valueAsNumber:!0}),id:"fastingWindow.mealsPerDay",className:"glass-input",children:[e.jsx("option",{value:"",children:"Flexible"}),e.jsx("option",{value:1,children:"1 repas (OMAD)"}),e.jsx("option",{value:2,children:"2 repas"}),e.jsx("option",{value:3,children:"3 repas"}),e.jsx("option",{value:4,children:"4 repas"}),e.jsx("option",{value:5,children:"5 repas"}),e.jsx("option",{value:6,children:"6 repas"})]})]})]}),(j||u.fastingWindow?.windowHours)&&u.fastingWindow?.start&&u.fastingWindow?.end&&e.jsxs("div",{className:"mt-6 p-4 rounded-xl bg-orange-500/10 border border-orange-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{Icon:n.Clock,size:14,className:"text-orange-400"}),e.jsx("span",{className:"text-orange-300 font-medium text-sm",children:"Résumé de votre jeûne"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Fenêtre :"}),e.jsxs("div",{className:"text-orange-200 font-medium",children:[u.fastingWindow.windowHours||0,"h de jeûne"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Alimentation :"}),e.jsxs("div",{className:"text-orange-200 font-medium",children:[u.fastingWindow.end," - ",u.fastingWindow.start]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Repas :"}),e.jsxs("div",{className:"text-orange-200 font-medium",children:[u.fastingWindow.mealsPerDay||"Flexible"," par jour"]})]})]})]}),e.jsx(Se,{isDirty:g,isSaving:m==="fasting",onSave:b,sectionName:"Jeûne"})]}),e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(245, 158, 11, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(245, 158, 11, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(o,{Icon:n.Target,size:20,style:{color:"#F59E0B"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Objectifs Nutritionnels"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Cibles nutritionnelles et macronutriments"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-400"}),e.jsx("span",{className:"text-orange-300 text-sm font-medium",children:"Cibles"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{htmlFor:"proteinTarget_g",className:"text-white/90 text-sm font-medium",children:"Cible protéines (g/jour)"}),C&&e.jsxs("button",{type:"button",onClick:v,className:"text-orange-400 text-xs hover:text-orange-300 transition-colors flex items-center gap-1",title:`Calculé: ${C.recommended}g (${C.formula})`,children:[e.jsx(o,{Icon:n.RotateCcw,size:12}),"Auto (",C.recommended,"g)"]})]}),e.jsx("input",{...c("proteinTarget_g",{valueAsNumber:!0}),type:"number",id:"proteinTarget_g",min:"0",max:"300",step:"1",className:"glass-input",placeholder:C?.recommended?.toString()||"120"}),C&&e.jsxs("p",{className:"text-orange-300 text-xs mt-2 leading-relaxed",children:["🔥 ",C.reasoning]}),d.proteinTarget_g&&e.jsxs("p",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),d.proteinTarget_g.message]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"caloriesTarget",className:"block text-white/90 text-sm font-medium mb-3",children:"Cible calories (kcal/jour)"}),e.jsx("input",{...c("caloriesTarget",{valueAsNumber:!0}),type:"number",id:"caloriesTarget",min:"800",max:"5000",step:"50",className:"glass-input",placeholder:"2000"}),d.caloriesTarget&&e.jsxs("p",{className:"text-red-300 text-xs mt-2 flex items-center gap-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:12}),d.caloriesTarget.message]})]})]}),e.jsx(Se,{isDirty:N,isSaving:m==="objectives",onSave:w,sectionName:"Objectifs"})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{type:"submit",disabled:S||!x,className:`btn-glass--primary px-8 py-4 text-lg font-semibold ${x?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[S?e.jsx(o,{Icon:n.Loader2,size:20,className:"animate-spin"}):e.jsx(o,{Icon:n.Save,size:20}),e.jsx("span",{children:S?"Sauvegarde globale...":"Sauvegarder Tout"})]})})}),Object.keys(d).length>0&&e.jsxs(F,{className:"p-4",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:[e.jsxs("h4",{className:"text-red-300 font-medium mb-3 flex items-center gap-2",children:[e.jsx(o,{Icon:n.AlertCircle,size:16}),"Erreurs de validation"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(d).map(([p,T])=>e.jsxs("p",{className:"text-red-200 text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),T.message]},p))})]})]})]})},Zt=()=>{const t=me(),{click:s}=K(),{hasConnectedWearable:a,connectedDevicesCount:i,loading:r}=He(),c=()=>{s(),t("/settings")};return r?e.jsx("div",{className:"p-4 rounded-xl",style:{background:`
            radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.08) 0%, transparent 60%),
            linear-gradient(145deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02))
          `,border:"2px solid rgba(255, 255, 255, 0.15)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 min-w-12 min-h-12 flex-shrink-0 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #94A3B8 35%, transparent), color-mix(in srgb, #94A3B8 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #94A3B8 50%, transparent)",boxShadow:`
                0 4px 12px color-mix(in srgb, #94A3B8 40%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.3)
              `},children:e.jsx(o,{Icon:n.Loader2,size:24,className:"text-white/60 animate-spin",variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold text-base",children:"Vérification..."}),e.jsx("p",{className:"text-white/60 text-sm",children:"Chargement des appareils"})]})]})}):a?e.jsx("button",{onClick:c,className:"w-full text-left p-4 rounded-xl transition-all duration-300",style:{background:`
          radial-gradient(circle at 30% 30%, rgba(34, 197, 94, 0.15) 0%, transparent 60%),
          linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04))
        `,border:"2px solid color-mix(in srgb, #22C55E 40%, transparent)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",boxShadow:"0 0 20px color-mix(in srgb, #22C55E 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-12 h-12 min-w-12 min-h-12 flex-shrink-0 rounded-full flex items-center justify-center relative",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #22C55E 35%, transparent), color-mix(in srgb, #22C55E 25%, transparent))
            `,border:"2px solid color-mix(in srgb, #22C55E 50%, transparent)",boxShadow:`
              0 4px 12px color-mix(in srgb, #22C55E 40%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.3)
            `},children:[e.jsx(o,{Icon:n.Watch,size:24,style:{color:"rgba(255, 255, 255, 0.9)"},variant:"pure"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-green-400 border-2 border-white/20",style:{boxShadow:"0 0 12px rgba(34, 197, 94, 0.6)"}})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-white font-semibold text-base",children:[i," appareil",i>1?"s":""," connecté",i>1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),e.jsx("p",{className:"text-green-300 text-sm font-medium",children:"Synchronisation active"})]})]}),e.jsx(o,{Icon:n.ChevronRight,size:20,className:"text-white/40 flex-shrink-0"})]})}):e.jsx("button",{onClick:c,className:"w-full text-left p-4 rounded-xl transition-all duration-300",style:{background:`
            radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.08) 0%, transparent 60%),
            linear-gradient(145deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02))
          `,border:"2px solid rgba(255, 255, 255, 0.15)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 min-w-12 min-h-12 flex-shrink-0 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #F59E0B 35%, transparent), color-mix(in srgb, #F59E0B 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #F59E0B 50%, transparent)",boxShadow:`
                0 4px 12px color-mix(in srgb, #F59E0B 40%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.3)
              `},children:e.jsx(o,{Icon:n.Watch,size:24,style:{color:"rgba(255, 255, 255, 0.8)"},variant:"pure"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-semibold text-base",children:"Aucune montre connectée"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Connectez un appareil pour suivre vos performances"})]}),e.jsx(o,{Icon:n.ChevronRight,size:20,className:"text-white/40 flex-shrink-0"})]})})},Os=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.12)",border:"2px solid rgba(6, 182, 212, 0.5)"},children:e.jsx(o,{Icon:n.Dumbbell,size:24,style:{color:"#06B6D4"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Profil Sportif"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Configuration de vos préférences d'entraînement"})]})]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-white/40 mb-4",children:e.jsx(o,{Icon:n.Settings,size:48,className:"mx-auto mb-4"})}),e.jsx("h4",{className:"text-white/70 text-lg font-medium mb-2",children:"Section en construction"}),e.jsx("p",{className:"text-white/50 text-sm max-w-md mx-auto",children:"Les préférences d'entraînement seront bientôt disponibles."})]})]}),e.jsx(Zt,{})]});class Xt{constructor(){Z(this,"name","Météo-France");Z(this,"priority",10);Z(this,"FRENCH_TERRITORIES",["FR","GP","MQ","GF","RE","YT","PM","BL","MF","WF","PF","NC"])}supportsRegion(s){return this.FRENCH_TERRITORIES.includes(s)}async fetchWeather(s,a){try{const i=`https://api.open-meteo.com/v1/meteofrance?latitude=${s}&longitude=${a}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,wind_speed_10m,wind_direction_10m,pressure_msl&timezone=auto`;h.info("METEO_FRANCE","Fetching weather data via Météo-France model",{lat:s,lon:a});const r=await fetch(i);if(!r.ok){const x=new Error(`Météo-France API error: ${r.statusText}`);throw x.provider=this.name,x.statusCode=r.status,x.retryable=r.status>=500,x}const l=(await r.json()).current,d={0:"Ciel dégagé",1:"Principalement dégagé",2:"Partiellement nuageux",3:"Couvert",45:"Brouillard",48:"Brouillard givrant",51:"Bruine légère",53:"Bruine modérée",55:"Bruine dense",61:"Pluie faible",63:"Pluie modérée",65:"Pluie forte",66:"Pluie verglaçante légère",67:"Pluie verglaçante forte",71:"Chute de neige faible",73:"Chute de neige modérée",75:"Chute de neige forte",77:"Grains de neige",80:"Averses faibles",81:"Averses modérées",82:"Averses fortes",85:"Averses de neige faibles",86:"Averses de neige fortes",95:"Orage",96:"Orage avec grêle légère",99:"Orage avec grêle forte"};return{temperature_celsius:l.temperature_2m,feels_like_celsius:l.apparent_temperature,humidity_percent:l.relative_humidity_2m,wind_speed_ms:l.wind_speed_10m,wind_direction:l.wind_direction_10m,precipitation_mm:l.precipitation,cloud_cover_percent:l.cloud_cover,pressure_hpa:l.pressure_msl,weather_condition:d[l.weather_code]||"Conditions variables",last_updated:new Date().toISOString()}}catch(i){if(i&&typeof i=="object"&&"provider"in i)throw i;const r=new Error(`Météo-France weather fetch failed: ${i instanceof Error?i.message:"Unknown error"}`);throw r.provider=this.name,r.retryable=!0,r}}async fetchAirQuality(s,a){try{const i=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${s}&longitude=${a}&current=european_aqi,pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,ozone&timezone=auto`;h.info("METEO_FRANCE","Fetching air quality data (via fallback)",{lat:s,lon:a});const r=await fetch(i);if(!r.ok){const d=new Error(`Air quality API error: ${r.statusText}`);throw d.provider=this.name,d.statusCode=r.status,d.retryable=r.status>=500,d}const l=(await r.json()).current;return{aqi:l.european_aqi||50,pm2_5:l.pm2_5,pm10:l.pm10,co:l.carbon_monoxide,no2:l.nitrogen_dioxide,o3:l.ozone,so2:l.sulphur_dioxide}}catch(i){if(i&&typeof i=="object"&&"provider"in i)throw i;const r=new Error(`Air quality fetch failed: ${i instanceof Error?i.message:"Unknown error"}`);throw r.provider=this.name,r.retryable=!0,r}}}class Qt{constructor(){Z(this,"name","Open-Meteo");Z(this,"priority",90)}supportsRegion(s){return!0}async fetchWeather(s,a){try{const i=`https://api.open-meteo.com/v1/forecast?latitude=${s}&longitude=${a}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,wind_speed_10m,wind_direction_10m,pressure_msl,visibility&timezone=auto`;h.info("OPEN_METEO","Fetching weather data",{lat:s,lon:a});const r=await fetch(i);if(!r.ok){const x=new Error(`Open-Meteo API error: ${r.statusText}`);throw x.provider=this.name,x.statusCode=r.status,x.retryable=r.status>=500,x}const l=(await r.json()).current,d={0:"Dégagé",1:"Principalement dégagé",2:"Partiellement nuageux",3:"Couvert",45:"Brouillard",48:"Brouillard givrant",51:"Bruine légère",53:"Bruine modérée",55:"Bruine dense",61:"Pluie légère",63:"Pluie modérée",65:"Pluie forte",71:"Chute de neige légère",73:"Chute de neige modérée",75:"Chute de neige forte",80:"Averses légères",81:"Averses modérées",82:"Averses fortes",95:"Orage",96:"Orage avec grêle légère",99:"Orage avec grêle forte"};return{temperature_celsius:l.temperature_2m,feels_like_celsius:l.apparent_temperature,humidity_percent:l.relative_humidity_2m,wind_speed_ms:l.wind_speed_10m,wind_direction:l.wind_direction_10m,precipitation_mm:l.precipitation,cloud_cover_percent:l.cloud_cover,pressure_hpa:l.pressure_msl,visibility_km:l.visibility?l.visibility/1e3:void 0,weather_condition:d[l.weather_code]||"Inconnu",last_updated:new Date().toISOString()}}catch(i){if(i&&typeof i=="object"&&"provider"in i)throw i;const r=new Error(`Open-Meteo weather fetch failed: ${i instanceof Error?i.message:"Unknown error"}`);throw r.provider=this.name,r.retryable=!0,r}}async fetchAirQuality(s,a){try{const i=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${s}&longitude=${a}&current=european_aqi,pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,ozone&timezone=auto`;h.info("OPEN_METEO","Fetching air quality data",{lat:s,lon:a});const r=await fetch(i);if(!r.ok){const d=new Error(`Open-Meteo Air Quality API error: ${r.statusText}`);throw d.provider=this.name,d.statusCode=r.status,d.retryable=r.status>=500,d}const l=(await r.json()).current;return{aqi:l.european_aqi||50,pm2_5:l.pm2_5,pm10:l.pm10,co:l.carbon_monoxide,no2:l.nitrogen_dioxide,o3:l.ozone,so2:l.sulphur_dioxide}}catch(i){if(i&&typeof i=="object"&&"provider"in i)throw i;const r=new Error(`Open-Meteo air quality fetch failed: ${i instanceof Error?i.message:"Unknown error"}`);throw r.provider=this.name,r.retryable=!0,r}}}class es{constructor(){Z(this,"providers");this.providers=[new Xt,new Qt],this.providers.sort((s,a)=>s.priority-a.priority)}getBestProvider(s){return this.providers.filter(a=>a.supportsRegion(s)).sort((a,i)=>a.priority-i.priority)}async fetchWeather(s,a,i){const r=this.getBestProvider(s),c=[];h.info("WEATHER_MANAGER","Fetching weather data",{countryCode:s,lat:a,lon:i,availableProviders:r.length});for(const l of r)try{h.info("WEATHER_MANAGER",`Trying provider: ${l.name}`,{priority:l.priority});const d=await l.fetchWeather(a,i);return h.info("WEATHER_MANAGER",`Successfully fetched weather from ${l.name}`,{countryCode:s}),{data:d,provider:l.name}}catch(d){const x=d instanceof Error?d.message:"Unknown error",u=d.retryable!==!1;if(h.warn("WEATHER_MANAGER",`Provider ${l.name} failed`,{error:x,retryable:u,countryCode:s}),c.push({provider:l.name,error:x}),!u)continue}throw h.error("WEATHER_MANAGER","All weather providers failed",{countryCode:s,errors:c}),new Error(`Impossible de récupérer les données météo. Tous les fournisseurs ont échoué: ${c.map(l=>l.provider).join(", ")}`)}async fetchAirQuality(s,a,i){const r=this.getBestProvider(s),c=[];h.info("WEATHER_MANAGER","Fetching air quality data",{countryCode:s,lat:a,lon:i,availableProviders:r.length});for(const l of r)try{h.info("WEATHER_MANAGER",`Trying provider: ${l.name} for air quality`,{priority:l.priority});const d=await l.fetchAirQuality(a,i);return h.info("WEATHER_MANAGER",`Successfully fetched air quality from ${l.name}`,{countryCode:s}),{data:d,provider:l.name}}catch(d){const x=d instanceof Error?d.message:"Unknown error",u=d.retryable!==!1;if(h.warn("WEATHER_MANAGER",`Provider ${l.name} failed for air quality`,{error:x,retryable:u,countryCode:s}),c.push({provider:l.name,error:x}),!u)continue}throw h.error("WEATHER_MANAGER","All air quality providers failed",{countryCode:s,errors:c}),new Error(`Impossible de récupérer les données de qualité de l'air. Tous les fournisseurs ont échoué: ${c.map(l=>l.provider).join(", ")}`)}getAvailableProviders(s){return this.getBestProvider(s).map(a=>a.name)}}const Ne=new es,ts=1,De={FR:{lat:48.8566,lon:2.3522,city:"Paris"},GP:{lat:16.265,lon:-61.551,city:"Basse-Terre"},MQ:{lat:14.6415,lon:-61.0242,city:"Fort-de-France"},GF:{lat:4.9227,lon:-52.3269,city:"Cayenne"},RE:{lat:-20.8823,lon:55.4504,city:"Saint-Denis"},YT:{lat:-12.8275,lon:45.1662,city:"Mamoudzou"},PM:{lat:46.7738,lon:-56.1815,city:"Saint-Pierre"},BL:{lat:17.9,lon:-62.8333,city:"Gustavia"},MF:{lat:18.0731,lon:-63.0822,city:"Marigot"},WF:{lat:-13.2829,lon:-176.1745,city:"Mata-Utu"},PF:{lat:-17.5516,lon:-149.5585,city:"Papeete"},NC:{lat:-22.2758,lon:166.4572,city:"Nouméa"},BE:{lat:50.8503,lon:4.3517,city:"Bruxelles"},CH:{lat:46.948,lon:7.4474,city:"Berne"},LU:{lat:49.6116,lon:6.1319,city:"Luxembourg"},MC:{lat:43.7384,lon:7.4246,city:"Monaco"},DZ:{lat:36.7538,lon:3.0588,city:"Alger"},MA:{lat:34.0209,lon:-6.8416,city:"Rabat"},TN:{lat:36.8065,lon:10.1815,city:"Tunis"},SN:{lat:14.6928,lon:-17.4467,city:"Dakar"},CI:{lat:6.827,lon:-5.2893,city:"Yamoussoukro"},CM:{lat:3.848,lon:11.5021,city:"Yaoundé"},CD:{lat:-4.3217,lon:15.3125,city:"Kinshasa"},CG:{lat:-4.2634,lon:15.2429,city:"Brazzaville"},GA:{lat:.4162,lon:9.4673,city:"Libreville"},ML:{lat:12.6392,lon:-8.0029,city:"Bamako"},BJ:{lat:6.4969,lon:2.6289,city:"Porto-Novo"},NE:{lat:13.5127,lon:2.1128,city:"Niamey"},BF:{lat:12.3714,lon:-1.5197,city:"Ouagadougou"},TG:{lat:6.1256,lon:1.2116,city:"Lomé"},TD:{lat:12.1348,lon:15.0557,city:"N'Djamena"},CF:{lat:4.3947,lon:18.5582,city:"Bangui"},GN:{lat:9.6412,lon:-13.5784,city:"Conakry"},RW:{lat:-1.9536,lon:30.0606,city:"Kigali"},BI:{lat:-3.3614,lon:29.3599,city:"Bujumbura"},DJ:{lat:11.5721,lon:43.1456,city:"Djibouti"},MG:{lat:-18.8792,lon:47.5079,city:"Antananarivo"},MU:{lat:-20.1609,lon:57.5012,city:"Port-Louis"},SC:{lat:-4.6796,lon:55.492,city:"Victoria"},KM:{lat:-11.7172,lon:43.2473,city:"Moroni"},CA:{lat:45.4215,lon:-75.6972,city:"Ottawa"},HT:{lat:18.5944,lon:-72.3074,city:"Port-au-Prince"},LB:{lat:33.8886,lon:35.4955,city:"Beyrouth"},VN:{lat:21.0285,lon:105.8542,city:"Hanoï"},KH:{lat:11.5564,lon:104.9282,city:"Phnom Penh"},LA:{lat:17.9757,lon:102.6331,city:"Vientiane"},VU:{lat:-17.7333,lon:168.3273,city:"Port-Vila"},US:{lat:38.9072,lon:-77.0369,city:"Washington D.C."},GB:{lat:51.5074,lon:-.1278,city:"London"},DE:{lat:52.52,lon:13.405,city:"Berlin"},ES:{lat:40.4168,lon:-3.7038,city:"Madrid"},IT:{lat:41.9028,lon:12.4964,city:"Rome"},PT:{lat:38.7223,lon:-9.1393,city:"Lisbonne"},NL:{lat:52.3676,lon:4.9041,city:"Amsterdam"},AT:{lat:48.2082,lon:16.3738,city:"Vienne"},GR:{lat:37.9838,lon:23.7275,city:"Athènes"},AU:{lat:-35.2809,lon:149.13,city:"Canberra"},JP:{lat:35.6762,lon:139.6503,city:"Tokyo"},CN:{lat:39.9042,lon:116.4074,city:"Beijing"},BR:{lat:-15.8267,lon:-47.9218,city:"Brasília"},IN:{lat:28.6139,lon:77.209,city:"New Delhi"},MX:{lat:19.4326,lon:-99.1332,city:"Mexico City"},RU:{lat:55.7558,lon:37.6173,city:"Moscow"},ZA:{lat:-25.7479,lon:28.2293,city:"Pretoria"},AR:{lat:-34.6037,lon:-58.3816,city:"Buenos Aires"},CL:{lat:-33.4489,lon:-70.6693,city:"Santiago"},CO:{lat:4.711,lon:-74.0721,city:"Bogotá"},PE:{lat:-12.0464,lon:-77.0428,city:"Lima"},EG:{lat:30.0444,lon:31.2357,city:"Le Caire"},KE:{lat:-1.2921,lon:36.8219,city:"Nairobi"},NG:{lat:9.0765,lon:7.3986,city:"Abuja"},ET:{lat:9.032,lon:38.7469,city:"Addis-Abeba"},GH:{lat:5.6037,lon:-.187,city:"Accra"},TH:{lat:13.7563,lon:100.5018,city:"Bangkok"},MY:{lat:3.139,lon:101.6869,city:"Kuala Lumpur"},SG:{lat:1.3521,lon:103.8198,city:"Singapour"},ID:{lat:-6.2088,lon:106.8456,city:"Jakarta"},PH:{lat:14.5995,lon:120.9842,city:"Manille"},KR:{lat:37.5665,lon:126.978,city:"Séoul"},TR:{lat:39.9334,lon:32.8597,city:"Ankara"},SA:{lat:24.7136,lon:46.6753,city:"Riyad"},AE:{lat:24.4539,lon:54.3773,city:"Abu Dhabi"},IL:{lat:31.7683,lon:35.2137,city:"Jérusalem"},PL:{lat:52.2297,lon:21.0122,city:"Varsovie"},CZ:{lat:50.0755,lon:14.4378,city:"Prague"},HU:{lat:47.4979,lon:19.0402,city:"Budapest"},RO:{lat:44.4268,lon:26.1025,city:"Bucarest"},BG:{lat:42.6977,lon:23.3219,city:"Sofia"},SE:{lat:59.3293,lon:18.0686,city:"Stockholm"},NO:{lat:59.9139,lon:10.7522,city:"Oslo"},DK:{lat:55.6761,lon:12.5683,city:"Copenhague"},FI:{lat:60.1699,lon:24.9384,city:"Helsinki"},IE:{lat:53.3498,lon:-6.2603,city:"Dublin"},NZ:{lat:-41.2865,lon:174.7762,city:"Wellington"}};function ss(t){return t<=50?"good":t<=100?"moderate":t<=150?"unhealthy_sensitive":t<=200?"unhealthy":t<=300?"very_unhealthy":"hazardous"}function is(t){switch(t){case"good":return["Qualité de l'air excellente. Activités en extérieur recommandées."];case"moderate":return["Qualité de l'air acceptable.","Personnes sensibles: limitez les efforts intenses prolongés en extérieur."];case"unhealthy_sensitive":return["Qualité de l'air nocive pour les groupes sensibles.","Réduisez les efforts physiques prolongés en extérieur.","Personnes à risque: restez à l'intérieur autant que possible."];case"unhealthy":return["Qualité de l'air malsaine.","Évitez les efforts physiques en extérieur.","Portez un masque si vous devez sortir.","Gardez les fenêtres fermées."];case"very_unhealthy":return["Qualité de l'air très malsaine.","Restez à l'intérieur.","Utilisez un purificateur d'air.","Évitez tout exercice physique."];case"hazardous":return["Alerte pollution: risque sanitaire majeur.","Ne sortez pas sauf urgence absolue.","Portez un masque FFP2 si vous devez sortir.","Consultez un médecin en cas de symptômes."]}}async function as(t,s,a){try{const{data:i,provider:r}=await Ne.fetchWeather(t,s,a);return h.info("GEOGRAPHIC_SERVICE","Weather data fetched successfully",{provider:r,countryCode:t,lat:s,lon:a}),{...i,provider:r}}catch(i){throw h.error("GEOGRAPHIC_SERVICE","Failed to fetch weather data from all providers",{error:i instanceof Error?i.message:"Unknown error",countryCode:t,lat:s,lon:a}),i}}async function rs(t,s,a){try{const{data:i,provider:r}=await Ne.fetchAirQuality(t,s,a),c=i.aqi,l=ss(c),d={"PM2.5":i.pm2_5,PM10:i.pm10,CO:i.co,NO2:i.no2,O3:i.o3,SO2:i.so2},x=Object.entries(d).filter(([,u])=>u!==void 0&&u>0).sort(([,u],[,b])=>(b||0)-(u||0))[0]?.[0]||"PM2.5";return h.info("GEOGRAPHIC_SERVICE","Air quality data fetched successfully",{provider:r,countryCode:t,aqi:c,level:l}),{aqi:c,level:l,pm2_5:i.pm2_5,pm10:i.pm10,co:i.co,no2:i.no2,o3:i.o3,so2:i.so2,dominant_pollutant:x,health_recommendations:is(l),last_updated:new Date().toISOString()}}catch(i){throw h.error("GEOGRAPHIC_SERVICE","Failed to fetch air quality data from all providers",{error:i instanceof Error?i.message:"Unknown error",countryCode:t,lat:s,lon:a}),i}}function Ce(t,s,a){const i=s?s*.033:2;let r=0;t.temperature_celsius>25&&(r=(t.temperature_celsius-25)/5*.5);let c=0;t.humidity_percent<30?c=.3:t.humidity_percent>80&&(c=.2);const l=r+c,x=a?{sedentary:0,light:.3,moderate:.6,active:1,athlete:1.5}[a]:0,u=Math.round((i+l+x)*10)/10,b=[`Objectif d'hydratation: ${u}L par jour`];t.temperature_celsius>30&&b.push("⚠️ Température élevée: augmentez votre consommation d'eau"),t.humidity_percent<30&&b.push("🌵 Air sec: hydratez-vous régulièrement"),a&&["active","athlete"].includes(a)&&b.push("🏃 Activité intense: buvez avant, pendant et après l'exercice");const w=[];return u>4&&w.push("Conditions extrêmes détectées. Surveillez votre hydratation attentivement."),{base_amount_liters:Math.round(i*10)/10,weather_adjustment_liters:Math.round(l*10)/10,activity_adjustment_liters:Math.round(x*10)/10,total_recommended_liters:u,factors:{temperature:t.temperature_celsius,humidity:t.humidity_percent,physical_activity_level:a||"non renseigné",user_weight_kg:s},recommendations:b,alerts:w}}function ns(t){const s=t.level==="good"||t.level==="moderate"?"low":t.level==="unhealthy_sensitive"?"moderate":t.level==="unhealthy"?"high":"severe",a=[];t.pm2_5&&t.pm2_5>25&&a.push("Particules fines (PM2.5)"),t.pm10&&t.pm10>50&&a.push("Particules (PM10)"),t.no2&&t.no2>40&&a.push("Dioxyde d'azote (NO2)"),t.o3&&t.o3>100&&a.push("Ozone (O3)");const i=[];return(s==="moderate"||s==="high")&&(i.push("Limitez les activités extérieures intenses"),i.push("Fermez les fenêtres pendant les pics de pollution")),(s==="high"||s==="severe")&&(i.push("Portez un masque lors des sorties"),i.push("Utilisez un purificateur d'air intérieur")),{air_quality:t,pollution_sources:a,exposure_level:s,protective_measures:i}}function Ie(){return Object.keys(De)}async function ls(t,s,a,i){try{const r=De[s];if(!r)throw h.warn("GEOGRAPHIC_SERVICE","Country not supported for geographic data",{countryCode:s,userId:t,supportedCountries:Ie().length}),new Error(`Le pays "${s}" n'est pas encore supporté pour les données géographiques. ${Ie().length} pays disponibles.`);const c=`${s}_${r.city.replace(/\s/g,"")}`,{data:l,error:d}=await W.from("geographic_data_cache").select("*").eq("user_id",t).eq("location_key",c).gt("expires_at",new Date().toISOString()).maybeSingle();if(l&&!d){h.info("GEOGRAPHIC_SERVICE","Using cached geographic data",{userId:t,locationKey:c});const m=l.weather_data,g=Ce(m,a,i);return{user_id:t,country_code:s,city:r.city,latitude:r.lat,longitude:r.lon,weather:m,air_quality:l.air_quality_data,environmental_exposure:l.environmental_data,hydration_recommendation:g,last_updated:l.created_at,next_update_due:l.expires_at}}h.info("GEOGRAPHIC_SERVICE","Fetching fresh geographic data",{userId:t,countryCode:s,city:r.city,availableProviders:Ne.getAvailableProviders(s)});const[x,u]=await Promise.all([as(s,r.lat,r.lon),rs(s,r.lat,r.lon)]),b=ns(u),w=Ce(x,a,i),y=new Date;y.setHours(y.getHours()+ts);const{error:S}=await W.from("geographic_data_cache").upsert({user_id:t,country_code:s,city:r.city,location_key:c,weather_data:x,air_quality_data:u,environmental_data:b,hydration_data:w,expires_at:y.toISOString()},{onConflict:"user_id,location_key"});return S&&h.error("GEOGRAPHIC_SERVICE","Failed to cache geographic data",{error:S.message,userId:t}),await os(t,s,r,x,u,b,w),{user_id:t,country_code:s,city:r.city,latitude:r.lat,longitude:r.lon,weather:x,air_quality:u,environmental_exposure:b,hydration_recommendation:w,last_updated:new Date().toISOString(),next_update_due:y.toISOString()}}catch(r){const c=r instanceof Error?r.message:"Unknown error";throw c.includes("pas encore supporté")?h.warn("GEOGRAPHIC_SERVICE","Unsupported country requested",{error:c,userId:t,countryCode:s}):h.error("GEOGRAPHIC_SERVICE","Failed to get geographic data",{error:c,userId:t,countryCode:s}),r}}async function os(t,s,a,i,r,c,l){try{const d=new Date;d.setHours(0,0,0,0);const x=new Date(d);x.setDate(x.getDate()+1);const{data:u}=await W.from("geographic_data_history").select("id").eq("user_id",t).gte("recorded_at",d.toISOString()).lt("recorded_at",x.toISOString()).maybeSingle();if(u){h.debug("GEOGRAPHIC_SERVICE","Geographic data already saved for today",{userId:t});return}const{error:b}=await W.from("geographic_data_history").insert({user_id:t,country_code:s,city:a.city,latitude:a.lat,longitude:a.lon,weather:i,air_quality:r,hydration_recommendation:l,environmental_exposure:c,recorded_at:new Date().toISOString()});b?h.error("GEOGRAPHIC_SERVICE","Failed to save geographic data history",{error:b.message,userId:t}):h.info("GEOGRAPHIC_SERVICE","Saved geographic data history",{userId:t,date:d.toISOString()})}catch(d){h.error("GEOGRAPHIC_SERVICE","Failed to save geographic data history",{error:d instanceof Error?d.message:"Unknown error",userId:t})}}const Ae={France:"FR",Guadeloupe:"GP",Martinique:"MQ",Guyane:"GF",Réunion:"RE",Mayotte:"YT","Saint-Pierre-et-Miquelon":"PM","Saint-Barthélemy":"BL","Saint-Martin":"MF","Wallis-et-Futuna":"WF","Polynésie française":"PF","Nouvelle-Calédonie":"NC",Belgique:"BE",Suisse:"CH",Luxembourg:"LU",Monaco:"MC",Algérie:"DZ",Maroc:"MA",Tunisie:"TN",Sénégal:"SN","Côte d'Ivoire":"CI",Mali:"ML",Bénin:"BJ",Niger:"NE","Burkina Faso":"BF",Togo:"TG",Guinée:"GN",Mauritanie:"MR",Cameroun:"CM","Congo (RDC)":"CD",Congo:"CG",Gabon:"GA",Tchad:"TD",Centrafrique:"CF","Guinée équatoriale":"GQ",Rwanda:"RW",Burundi:"BI",Djibouti:"DJ",Madagascar:"MG",Maurice:"MU",Seychelles:"SC",Comores:"KM",Canada:"CA",Haïti:"HT",Liban:"LB","Viêt Nam":"VN",Cambodge:"KH",Laos:"LA",Vanuatu:"VU","États-Unis":"US","Royaume-Uni":"GB",Australie:"AU","Nouvelle-Zélande":"NZ","Afrique du Sud":"ZA",Inde:"IN",Irlande:"IE",Jamaïque:"JM",Kenya:"KE",Nigéria:"NG",Singapour:"SG",Allemagne:"DE",Espagne:"ES",Italie:"IT",Portugal:"PT","Pays-Bas":"NL",Autriche:"AT",Grèce:"GR",Japon:"JP",Chine:"CN",Brésil:"BR",Mexique:"MX",Russie:"RU",Argentine:"AR",Chili:"CL",Colombie:"CO",Pérou:"PE",Égypte:"EG",Éthiopie:"ET",Ghana:"GH",Thaïlande:"TH",Malaisie:"MY",Indonésie:"ID",Philippines:"PH","Corée du Sud":"KR",Turquie:"TR","Arabie Saoudite":"SA","Émirats Arabes Unis":"AE",Israël:"IL",Pologne:"PL","République Tchèque":"CZ",Hongrie:"HU",Roumanie:"RO",Bulgarie:"BG",Suède:"SE",Norvège:"NO",Danemark:"DK",Finlande:"FI"};function cs(t){if(!t)return null;const s=Ae[t];if(s)return s;const a=t.trim(),i=Object.entries(Ae).find(([r])=>r.toLowerCase()===a.toLowerCase());return i?i[1]:null}function ds(){const{profile:t}=G(),[s,a]=R.useState(null),[i,r]=R.useState(!0),[c,l]=R.useState(null),[d,x]=R.useState(null),u=R.useCallback(async()=>{if(!t?.userId||!t?.country){r(!1),l(new Error("User profile or country not available"));return}try{r(!0),l(null);const w=cs(t.country);if(!w)throw new Error(`Le pays "${t.country}" n'est pas encore supporté pour les données météo.`);h.info("USE_GEOGRAPHIC_DATA","Fetching geographic data",{userId:t.userId,countryName:t.country,countryCode:w});const y=t?.weight_kg||t?.health?.basic?.weight_kg,S=t?.health?.lifestyle?.physical_activity_level||t?.training?.physical_activity_level,m=await ls(t.userId,w,y,S);a(m),x(m.last_updated),h.info("USE_GEOGRAPHIC_DATA","Geographic data loaded successfully",{userId:t.userId,countryName:t.country,countryCode:w})}catch(w){const y=w instanceof Error?w:new Error("Failed to fetch geographic data");l(y),h.error("USE_GEOGRAPHIC_DATA","Failed to fetch geographic data",{error:y.message,userId:t?.userId,countryName:t?.country})}finally{r(!1)}},[t?.userId,t?.country]),b=R.useCallback(async()=>{await u()},[u]);return R.useEffect(()=>{u()},[u]),{data:s,loading:i,error:c,refresh:b,lastUpdated:d}}const ms=({countryData:t,loading:s=!1})=>s?e.jsx(F,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(o,{Icon:n.Loader2,size:20,className:"animate-spin text-cyan-400"}),e.jsx("span",{className:"text-white/90",children:"Chargement des données sanitaires du pays..."})]})}):t?e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-4",children:e.jsxs(F,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(6, 182, 212, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(6, 182, 212, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, #06B6D4 35%, transparent), color-mix(in srgb, #06B6D4 25%, transparent))
                `,border:"2px solid color-mix(in srgb, #06B6D4 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #06B6D4 30%, transparent)"},children:e.jsx(o,{Icon:n.Globe,size:20,style:{color:"#06B6D4"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-lg",children:t.country_name}),e.jsx("p",{className:"text-white/60 text-sm",children:"Contexte sanitaire local"})]})]}),e.jsxs("div",{className:"text-xs text-white/50",children:["Mis à jour: ",new Date(t.last_updated).toLocaleDateString("fr-FR")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.endemic_diseases&&t.endemic_diseases.length>0&&e.jsxs("div",{className:"p-4 rounded-xl bg-orange-500/10 border border-orange-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Biohazard,size:16,className:"text-orange-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Maladies Endémiques"})]}),e.jsx("div",{className:"space-y-1",children:t.endemic_diseases.slice(0,5).map((a,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-white/70 text-sm",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-orange-400"}),a]},i))})]}),t.vaccination_requirements&&e.jsxs("div",{className:"p-4 rounded-xl bg-green-500/10 border border-green-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Syringe,size:16,className:"text-green-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Vaccinations Recommandées"})]}),e.jsx("div",{className:"space-y-1",children:t.vaccination_requirements.recommended?.slice(0,5).map((a,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-white/70 text-sm",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-green-400"}),a]},i))})]}),t.common_deficiencies&&t.common_deficiencies.length>0&&e.jsxs("div",{className:"p-4 rounded-xl bg-yellow-500/10 border border-yellow-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Pill,size:16,className:"text-yellow-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Carences Communes"})]}),e.jsx("div",{className:"space-y-1",children:t.common_deficiencies.map((a,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-white/70 text-sm",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-yellow-400"}),a]},i))})]}),t.climate_data&&e.jsxs("div",{className:"p-4 rounded-xl bg-blue-500/10 border border-blue-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Cloud,size:16,className:"text-blue-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Climat"})]}),e.jsxs("div",{className:"space-y-2 text-white/70 text-sm",children:[t.climate_data.climate_zones&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Zone:"}),e.jsx("span",{className:"font-medium text-white/90",children:t.climate_data.climate_zones.join(", ")})]}),t.climate_data.avg_temperature_celsius&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Temp. moyenne:"}),e.jsxs("span",{className:"font-medium text-white/90",children:[t.climate_data.avg_temperature_celsius,"°C"]})]}),t.climate_data.avg_humidity_percent&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Humidité:"}),e.jsxs("span",{className:"font-medium text-white/90",children:[t.climate_data.avg_humidity_percent,"%"]})]})]})]})]}),t.health_risks&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-red-500/10 border border-red-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Bug,size:16,className:"text-red-400"}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:"Risques Sanitaires Spécifiques"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.health_risks.vector_borne_diseases&&t.health_risks.vector_borne_diseases.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Maladies vectorielles:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.health_risks.vector_borne_diseases.map((a,i)=>e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-red-500/20 text-red-300",children:a},i))})]}),t.health_risks.waterborne_diseases&&t.health_risks.waterborne_diseases.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs mb-1",children:"Maladies hydriques:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.health_risks.waterborne_diseases.map((a,i)=>e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-blue-500/20 text-blue-300",children:a},i))})]})]})]})]})}):e.jsx(F,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{Icon:n.AlertCircle,size:20,className:"text-orange-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/90 font-medium",children:"Données pays non disponibles"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Sélectionnez votre pays dans l'onglet Identité pour voir les risques sanitaires locaux."})]})]})}),us="https://restcountries.com/v3.1",xs=30,Q=class Q{constructor(){}static getInstance(){return Q.instance||(Q.instance=new Q),Q.instance}async enrichCountryData(s){try{h.info("COUNTRY_HEALTH_ENRICHMENT","Starting enrichment",{countryName:s});const a=await this.getCachedCountryData(s);if(a&&this.isCacheValid(a.last_updated))return h.info("COUNTRY_HEALTH_ENRICHMENT","Using cached data",{countryName:s}),a;const i=await this.getCountryCode(s);if(!i)return h.warn("COUNTRY_HEALTH_ENRICHMENT","Country code not found",{countryName:s}),this.getStaticCountryData(s);const r=await this.fetchRestCountriesData(s),c={country_code:i,country_name:s,endemic_diseases:this.getEndemicDiseasesByRegion(r?.region||""),vaccination_requirements:this.getVaccinationRequirements(i),health_risks:this.getHealthRisksByRegion(r?.region||"",r?.subregion||""),common_deficiencies:this.getCommonDeficiencies(r?.region||""),climate_data:this.inferClimateData(r?.latlng),last_updated:new Date().toISOString(),data_source:"rest_countries_api"};return await this.saveCountryData(c),h.info("COUNTRY_HEALTH_ENRICHMENT","Enrichment completed",{countryName:s,countryCode:i}),c}catch(a){return h.error("COUNTRY_HEALTH_ENRICHMENT","Enrichment failed",{countryName:s,error:a instanceof Error?a.message:"Unknown error"}),this.getStaticCountryData(s)}}async getCachedCountryData(s){try{const{data:a,error:i}=await W.from("country_health_data").select("*").eq("country_name",s).maybeSingle();return i?i.code==="PGRST205"||i.message?.includes("does not exist")?(h.warn("COUNTRY_HEALTH_CACHE","Table does not exist yet",{countryName:s}),null):(h.error("COUNTRY_HEALTH_CACHE","Cache read error",{error:i.message}),null):a}catch(a){return h.error("COUNTRY_HEALTH_CACHE","Cache read exception",{error:a instanceof Error?a.message:"Unknown"}),null}}isCacheValid(s){const a=new Date(s);return(new Date().getTime()-a.getTime())/(1e3*60*60*24)<xs}async getCountryCode(s){return{France:"FR",Belgique:"BE",Suisse:"CH",Canada:"CA",Maroc:"MA",Tunisie:"TN",Algérie:"DZ",Sénégal:"SN","Côte d'Ivoire":"CI",Mali:"ML","Burkina Faso":"BF",Niger:"NE",Tchad:"TD",Cameroun:"CM",Congo:"CG","Congo (RDC)":"CD",Gabon:"GA",Madagascar:"MG",Maurice:"MU",Réunion:"RE",Luxembourg:"LU",Monaco:"MC",Haïti:"HT","États-Unis":"US","Royaume-Uni":"GB",Australie:"AU","Nouvelle-Zélande":"NZ","Afrique du Sud":"ZA",Inde:"IN",Singapour:"SG",Martinique:"MQ",Guadeloupe:"GP",Guyane:"GF","Guyane française":"GF",Mayotte:"YT","Saint-Martin":"MF","Saint-Barthélemy":"BL","Saint-Pierre-et-Miquelon":"PM","Wallis-et-Futuna":"WF","Polynésie française":"PF","Nouvelle-Calédonie":"NC",Bénin:"BJ",Togo:"TG",Guinée:"GN",Centrafrique:"CF","République centrafricaine":"CF",Rwanda:"RW",Burundi:"BI",Djibouti:"DJ",Comores:"KM",Seychelles:"SC",Vanuatu:"VU",Liban:"LB",Mauritanie:"MR","Guinée équatoriale":"GQ"}[s]||null}async fetchRestCountriesData(s){try{const a=await fetch(`${us}/name/${encodeURIComponent(s)}?fullText=false`);return a.ok?(await a.json())[0]||null:(h.warn("REST_COUNTRIES_API","API request failed",{status:a.status,countryName:s}),null)}catch(a){return h.error("REST_COUNTRIES_API","Fetch failed",{error:a instanceof Error?a.message:"Unknown",countryName:s}),null}}getEndemicDiseasesByRegion(s){return{Africa:["Malaria","Yellow Fever","Dengue","Ebola (specific regions)","Tuberculosis","HIV/AIDS","Schistosomiasis","Trypanosomiasis"],Asia:["Dengue","Japanese Encephalitis","Malaria (specific regions)","Tuberculosis","Hepatitis B","Typhoid"],Europe:["Lyme Disease","Tick-borne Encephalitis","Influenza (seasonal)"],Americas:["Dengue","Zika","Chikungunya","Chagas Disease (Latin America)","Lyme Disease (North America)"],Oceania:["Dengue","Ross River Virus","Influenza (seasonal)"]}[s]||[]}getVaccinationRequirements(s){const a=["SN","CI","ML","BF","NE","TD","CM","CG","CD","GA","MG"];return{required:[],recommended:["Hepatitis A","Hepatitis B","Tetanus-Diphtheria","Measles-Mumps-Rubella (MMR)",...["SN","CI","ML","BF","NE","TD","CM","CG","CD","GA"].includes(s)?["Yellow Fever"]:[],...a.includes(s)?["Typhoid","Meningococcal"]:[]],seasonal:[]}}getHealthRisksByRegion(s,a){const i=["Africa"],r=["Western Africa","Middle Africa","Eastern Africa","South-Eastern Asia"];return{vector_borne_diseases:i.includes(s)||r.includes(a)?["Malaria","Dengue","Yellow Fever","Chikungunya"]:["Lyme Disease","Tick-borne Encephalitis"],waterborne_diseases:i.includes(s)?["Cholera","Typhoid","Hepatitis A","Schistosomiasis"]:["Giardiasis","Cryptosporidiosis"],foodborne_risks:["Traveler's Diarrhea","Food Poisoning","Hepatitis A"],environmental_hazards:[]}}getCommonDeficiencies(s){return{Africa:["Iron","Vitamin A","Iodine","Zinc","Vitamin D"],Asia:["Iron","Vitamin A","Iodine","Vitamin D"],Europe:["Vitamin D","Iodine (specific regions)","Iron (women)"],Americas:["Vitamin D","Iron","Calcium"],Oceania:["Vitamin D","Iron","Iodine"]}[s]||["Vitamin D","Iron"]}getStaticCountryData(s){return h.info("COUNTRY_HEALTH_ENRICHMENT","Using static fallback data",{countryName:s}),{country_code:"UNKNOWN",country_name:s,endemic_diseases:[],vaccination_requirements:{required:[],recommended:["Hepatitis A","Hepatitis B","Tetanus-Diphtheria"],seasonal:[]},health_risks:{vector_borne_diseases:[],waterborne_diseases:[],foodborne_risks:["Traveler's Diarrhea","Food Poisoning"],environmental_hazards:[]},common_deficiencies:["Vitamin D","Iron"],climate_data:{},last_updated:new Date().toISOString(),data_source:"static_fallback"}}inferClimateData(s){if(!s)return{};const[a]=s;return Math.abs(a)<23.5?{climate_zones:["Tropical"],avg_temperature_celsius:27,avg_humidity_percent:75}:Math.abs(a)<35?{climate_zones:["Subtropical"],avg_temperature_celsius:20,avg_humidity_percent:65}:Math.abs(a)<60?{climate_zones:["Temperate"],avg_temperature_celsius:12,avg_humidity_percent:70}:{climate_zones:["Cold"],avg_temperature_celsius:2,avg_humidity_percent:75}}async saveCountryData(s){try{const{error:a}=await W.from("country_health_data").upsert({country_code:s.country_code,country_name:s.country_name,climate_data:s.climate_data||{},endemic_diseases:s.endemic_diseases||[],vaccination_requirements:s.vaccination_requirements||{},health_risks:s.health_risks||{},common_deficiencies:s.common_deficiencies||[],last_updated:s.last_updated,data_source:s.data_source},{onConflict:"country_code"});if(a){if(a.code==="PGRST205"||a.message?.includes("does not exist")){h.warn("COUNTRY_HEALTH_SAVE","Table does not exist, skipping global save",{country:s.country_name});return}if(a.code==="42501"||a.message?.includes("policy")){h.info("COUNTRY_HEALTH_SAVE","RLS prevented global save, data cached in user profile",{country:s.country_name,code:a.code});return}h.warn("COUNTRY_HEALTH_SAVE","Global save failed, continuing with user cache",{error:a.message,country:s.country_name})}else h.info("COUNTRY_HEALTH_SAVE","Successfully saved to global cache",{country:s.country_name})}catch(a){h.warn("COUNTRY_HEALTH_SAVE","Save exception, continuing with user cache",{error:a instanceof Error?a.message:"Unknown"})}}async updateUserCountryCache(s,a){try{const i=await this.enrichCountryData(a);if(!i)return;const{error:r}=await W.from("user_profile").update({country_health_cache:i,health_enriched_at:new Date().toISOString()}).eq("user_id",s);r&&h.error("USER_COUNTRY_CACHE","Update failed",{error:r.message,userId:s})}catch(i){h.error("USER_COUNTRY_CACHE","Update exception",{error:i instanceof Error?i.message:"Unknown",userId:s})}}async getUserCountryHealthData(s){try{const{data:a,error:i}=await W.from("user_profile").select("country, country_health_cache, health_enriched_at").eq("user_id",s).maybeSingle();return i||!a?null:a.country_health_cache&&a.health_enriched_at&&this.isCacheValid(a.health_enriched_at)?a.country_health_cache:a.country?await this.enrichCountryData(a.country):null}catch(a){return h.error("USER_COUNTRY_DATA","Fetch failed",{error:a instanceof Error?a.message:"Unknown",userId:s}),null}}};Z(Q,"instance");let ve=Q;const pe=ve.getInstance();function hs(){const{profile:t}=G(),[s,a]=R.useState(null),[i,r]=R.useState(!1),[c,l]=R.useState(null),d=async()=>{if(!t?.userId){h.warn("COUNTRY_HEALTH_HOOK","No user ID available");return}if(!t.country){h.info("COUNTRY_HEALTH_HOOK","No country selected",{userId:t.userId}),a(null);return}try{r(!0),l(null),h.info("COUNTRY_HEALTH_HOOK","Fetching country health data",{userId:t.userId,country:t.country});const u=await pe.getUserCountryHealthData(t.userId);u?(a(u),h.info("COUNTRY_HEALTH_HOOK","Country data loaded",{country:u.country_name,lastUpdated:u.last_updated,source:u.data_source})):(a(null),h.info("COUNTRY_HEALTH_HOOK","No country data available",{country:t.country}))}catch(u){const b=u instanceof Error?u:new Error("Unknown error");l(b),h.error("COUNTRY_HEALTH_HOOK","Failed to fetch country data",{error:b.message,userId:t.userId,country:t.country}),a(null)}finally{r(!1)}},x=async()=>{if(!(!t?.userId||!t.country))try{r(!0),l(null),h.info("COUNTRY_HEALTH_HOOK","Refreshing country health data",{userId:t.userId,country:t.country}),await pe.updateUserCountryCache(t.userId,t.country);const u=await pe.getUserCountryHealthData(t.userId);a(u)}catch(u){const b=u instanceof Error?u:new Error("Unknown error");l(b),h.error("COUNTRY_HEALTH_HOOK","Failed to refresh country data",{error:b.message})}finally{r(!1)}};return R.useEffect(()=>{d()},[t?.userId,t?.country]),{countryData:s,loading:i,error:c,refresh:x}}const gs={good:{bg:"rgba(16, 185, 129, 0.08)",border:"rgba(16, 185, 129, 0.3)",text:"#10B981",label:"Bonne"},moderate:{bg:"rgba(245, 158, 11, 0.08)",border:"rgba(245, 158, 11, 0.3)",text:"#F59E0B",label:"Moyenne"},unhealthy_sensitive:{bg:"rgba(251, 146, 60, 0.08)",border:"rgba(251, 146, 60, 0.3)",text:"#FB923C",label:"Sensible"},unhealthy:{bg:"rgba(239, 68, 68, 0.08)",border:"rgba(239, 68, 68, 0.3)",text:"#EF4444",label:"Malsaine"},very_unhealthy:{bg:"rgba(190, 18, 60, 0.08)",border:"rgba(190, 18, 60, 0.3)",text:"#BE123C",label:"Très Malsaine"},hazardous:{bg:"rgba(127, 29, 29, 0.08)",border:"rgba(127, 29, 29, 0.3)",text:"#7F1D1D",label:"Dangereuse"}},ps=({airQuality:t})=>{const s=gs[t.level];return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(F,{className:"p-6",style:{background:`radial-gradient(circle at 30% 20%, ${s.bg} 0%, transparent 60%), var(--glass-opacity)`,borderColor:s.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, ${s.text}66, ${s.text}33)
                `,border:`2px solid ${s.text}80`,boxShadow:`0 0 30px ${s.text}66`},children:e.jsx(o,{Icon:n.Wind,size:24,style:{color:s.text},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Qualité de l'Air"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Indice AQI en temps réel"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",style:{color:s.text},children:t.aqi}),e.jsx("div",{className:"text-sm font-medium",style:{color:s.text},children:s.label})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx(P.div,{className:"h-3 rounded-full",style:{background:`linear-gradient(90deg, ${s.text}, ${s.text}cc)`,boxShadow:`0 0 12px ${s.text}99`},initial:{width:0},animate:{width:`${Math.min(t.aqi/300*100,100)}%`},transition:{duration:1,ease:"easeOut"}})})}),t.dominant_pollutant&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(o,{Icon:n.AlertCircle,size:14,style:{color:s.text}}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Polluant dominant"})]}),e.jsx("p",{className:"text-white/70 text-sm ml-6",children:t.dominant_pollutant})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4",children:[t.pm2_5!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"PM2.5"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.pm2_5.toFixed(1)," µg/m³"]})]}),t.pm10!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"PM10"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.pm10.toFixed(1)," µg/m³"]})]}),t.no2!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"NO₂"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.no2.toFixed(1)," µg/m³"]})]}),t.o3!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"O₃"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.o3.toFixed(1)," µg/m³"]})]}),t.co!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"CO"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.co.toFixed(0)," µg/m³"]})]}),t.so2!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"SO₂"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.so2.toFixed(1)," µg/m³"]})]})]}),t.health_recommendations&&t.health_recommendations.length>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Shield,size:16,className:"text-white/80"}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Recommandations santé"})]}),e.jsx("div",{className:"space-y-2",children:t.health_recommendations.map((a,i)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full mt-1.5 flex-shrink-0",style:{background:s.text}}),e.jsx("span",{className:"text-white/70 text-sm",children:a})]},i))})]})]})})},fs=({weather:t,city:s})=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:e.jsxs(F,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(59, 130, 246, 0.2)"},children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(59, 130, 246, 0.4), rgba(59, 130, 246, 0.2))
                `,border:"2px solid rgba(59, 130, 246, 0.5)",boxShadow:"0 0 30px rgba(59, 130, 246, 0.4)"},children:e.jsx(o,{Icon:n.Cloud,size:24,style:{color:"#3B82F6"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Météo"}),s&&e.jsx("p",{className:"text-white/70 text-sm",children:s})]})]})}),e.jsxs("div",{className:"flex items-end gap-4 mb-6",children:[e.jsxs("div",{className:"text-6xl font-bold text-white",children:[Math.round(t.temperature_celsius),"°"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-white/90 text-lg mb-1",children:t.weather_condition}),t.feels_like_celsius!==void 0&&e.jsxs("div",{className:"text-white/60 text-sm",children:["Ressenti: ",Math.round(t.feels_like_celsius),"°C"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(o,{Icon:n.Droplet,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Humidité"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.humidity_percent,"%"]})]})]}),t.wind_speed_ms!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(o,{Icon:n.Wind,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Vent"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.wind_speed_ms.toFixed(1)," m/s"]})]})]}),t.precipitation_mm!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(o,{Icon:n.CloudRain,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Précipitations"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.precipitation_mm.toFixed(1)," mm"]})]})]}),t.cloud_cover_percent!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(o,{Icon:n.Cloud,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Nuages"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.cloud_cover_percent,"%"]})]})]}),t.pressure_hpa!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(o,{Icon:n.Gauge,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Pression"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.pressure_hpa," hPa"]})]})]}),t.visibility_km!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 flex items-center gap-3",children:[e.jsx(o,{Icon:n.Eye,size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white/60 text-xs mb-1",children:"Visibilité"}),e.jsxs("div",{className:"text-white font-semibold",children:[t.visibility_km.toFixed(1)," km"]})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between text-white/50 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{Icon:n.Clock,size:12}),e.jsxs("span",{children:["Mis à jour: ",new Date(t.last_updated).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}),t.provider&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full bg-white/5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-white/60",children:t.provider})]})]})})]})}),bs=({hydration:t})=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:e.jsxs(F,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(6, 182, 212, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(6, 182, 212, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(6, 182, 212, 0.4), rgba(6, 182, 212, 0.2))
                `,border:"2px solid rgba(6, 182, 212, 0.5)",boxShadow:"0 0 30px rgba(6, 182, 212, 0.4)"},children:e.jsx(o,{Icon:n.Droplet,size:24,style:{color:"#06B6D4"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Hydratation"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Recommandations personnalisées"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-3xl font-bold text-cyan-400",children:[t.total_recommended_liters,"L"]}),e.jsx("div",{className:"text-white/60 text-sm",children:"par jour"})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{Icon:n.User,size:14,className:"text-cyan-400"}),e.jsx("span",{className:"text-white/80 text-sm",children:"Base (poids)"})]}),e.jsxs("span",{className:"text-white font-semibold",children:[t.base_amount_liters,"L"]})]}),t.weather_adjustment_liters>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{Icon:n.Sun,size:14,className:"text-orange-400"}),e.jsx("span",{className:"text-white/80 text-sm",children:"Ajustement météo"})]}),e.jsxs("span",{className:"text-orange-400 font-semibold",children:["+",t.weather_adjustment_liters,"L"]})]}),t.activity_adjustment_liters>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{Icon:n.Dumbbell,size:14,className:"text-green-400"}),e.jsx("span",{className:"text-white/80 text-sm",children:"Ajustement activité"})]}),e.jsxs("span",{className:"text-green-400 font-semibold",children:["+",t.activity_adjustment_liters,"L"]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Info,size:14,className:"text-white/80"}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Facteurs considérés"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Température:"}),e.jsxs("span",{className:"text-white ml-2 font-medium",children:[t.factors.temperature,"°C"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Humidité:"}),e.jsxs("span",{className:"text-white ml-2 font-medium",children:[t.factors.humidity,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Activité:"}),e.jsx("span",{className:"text-white ml-2 font-medium capitalize",children:t.factors.physical_activity_level})]}),t.factors.user_weight_kg&&e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Poids:"}),e.jsxs("span",{className:"text-white ml-2 font-medium",children:[t.factors.user_weight_kg," kg"]})]})]})]}),t.recommendations&&t.recommendations.length>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-cyan-500/10 border border-cyan-400/20 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Lightbulb,size:16,className:"text-cyan-400"}),e.jsx("span",{className:"text-cyan-200 text-sm font-medium",children:"Conseils d'hydratation"})]}),e.jsx("div",{className:"space-y-2",children:t.recommendations.map((s,a)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-white/80 text-sm",children:s})]},a))})]}),t.alerts&&t.alerts.length>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-orange-500/10 border border-orange-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.AlertTriangle,size:16,className:"text-orange-400"}),e.jsx("span",{className:"text-orange-200 text-sm font-medium",children:"Alertes"})]}),e.jsx("div",{className:"space-y-2",children:t.alerts.map((s,a)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-400 mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-white/80 text-sm",children:s})]},a))})]})]})}),vs={low:{bg:"rgba(16, 185, 129, 0.08)",border:"rgba(16, 185, 129, 0.3)",text:"#10B981",label:"Faible"},moderate:{bg:"rgba(245, 158, 11, 0.08)",border:"rgba(245, 158, 11, 0.3)",text:"#F59E0B",label:"Modérée"},high:{bg:"rgba(239, 68, 68, 0.08)",border:"rgba(239, 68, 68, 0.3)",text:"#EF4444",label:"Élevée"},severe:{bg:"rgba(127, 29, 29, 0.08)",border:"rgba(127, 29, 29, 0.3)",text:"#7F1D1D",label:"Sévère"}},js=({exposure:t})=>{const s=vs[t.exposure_level];return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:e.jsxs(F,{className:"p-6",style:{background:`radial-gradient(circle at 30% 20%, ${s.bg} 0%, transparent 60%), var(--glass-opacity)`,borderColor:s.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, ${s.text}66, ${s.text}33)
                `,border:`2px solid ${s.text}80`,boxShadow:`0 0 30px ${s.text}66`},children:e.jsx(o,{Icon:n.Shield,size:24,style:{color:s.text},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-xl",children:"Exposition Environnementale"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Risques et protections"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium mb-1",style:{color:s.text},children:["Niveau ",s.label]}),e.jsx("div",{className:"text-xs text-white/60",children:"d'exposition"})]})]}),t.pollution_sources&&t.pollution_sources.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.AlertCircle,size:16,className:"text-white/80"}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Sources de pollution"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.pollution_sources.map((a,i)=>e.jsx("span",{className:"px-3 py-1.5 rounded-full text-xs font-medium",style:{background:`${s.text}22`,color:s.text,border:`1px solid ${s.text}44`},children:a},i))})]}),t.environmental_hazards&&t.environmental_hazards.length>0&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.AlertTriangle,size:16,className:"text-orange-400"}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:"Dangers environnementaux"})]}),e.jsx("div",{className:"space-y-2",children:t.environmental_hazards.map((a,i)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-400 mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-white/70 text-sm",children:a})]},i))})]}),t.protective_measures&&t.protective_measures.length>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-green-500/10 border border-green-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Shield,size:16,className:"text-green-400"}),e.jsx("span",{className:"text-green-200 text-sm font-medium",children:"Mesures de protection"})]}),e.jsx("div",{className:"space-y-2",children:t.protective_measures.map((a,i)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(o,{Icon:n.Check,size:14,className:"text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-white/80 text-sm",children:a})]},i))})]}),t.time_outdoors_recommended&&e.jsxs("div",{className:"mt-4 p-4 rounded-lg bg-blue-500/10 border border-blue-400/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(o,{Icon:n.Clock,size:16,className:"text-blue-400"}),e.jsx("span",{className:"text-blue-200 text-sm font-medium",children:"Heures recommandées en extérieur"})]}),t.time_outdoors_recommended.safe_hours.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-green-400 text-xs font-medium",children:"Heures sûres: "}),e.jsx("span",{className:"text-white/70 text-xs",children:t.time_outdoors_recommended.safe_hours.join(", ")})]}),t.time_outdoors_recommended.avoid_hours.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-red-400 text-xs font-medium",children:"Heures à éviter: "}),e.jsx("span",{className:"text-white/70 text-xs",children:t.time_outdoors_recommended.avoid_hours.join(", ")})]})]})]})})},Ls=()=>{const{profile:t}=G(),{data:s,loading:a,error:i,refresh:r}=ds(),{countryData:c,loading:l,error:d,refresh:x}=hs(),u=!!t?.country,b=i?.message?.includes("pas encore supporté");return u?e.jsxs(P.div,{className:"space-y-6",variants:fe,initial:"hidden",animate:"visible",children:[e.jsx(P.div,{variants:ee,children:e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(236, 72, 153, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(236, 72, 153, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #EC4899 35%, transparent), color-mix(in srgb, #EC4899 25%, transparent))
                  `,border:"2px solid color-mix(in srgb, #EC4899 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EC4899 30%, transparent)"},children:e.jsx(o,{Icon:n.MapPin,size:20,style:{color:"#EC4899"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Environnement Géographique"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:s?.city&&s?.country_code?`${s.city}, ${s.country_code}`:t?.country||"Non configuré"})]})]}),u&&s&&e.jsx("button",{onClick:r,disabled:a,className:"btn-glass px-4 py-2",title:"Rafraîchir les données",children:e.jsx(o,{Icon:n.RefreshCw,size:16,className:a?"animate-spin":""})})]}),u&&i&&b&&e.jsx("div",{className:"p-4 rounded-xl bg-amber-500/10 border border-amber-400/20 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.AlertTriangle,size:20,className:"text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-amber-300 font-semibold mb-2",children:"Pays non encore supporté"}),e.jsxs("p",{className:"text-amber-200 text-sm mb-3",children:["Les données géographiques ne sont pas encore disponibles pour ",e.jsx("strong",{children:t?.country}),". Nous couvrons actuellement plus de 130 pays, incluant la France métropolitaine, tous les DOM-TOM, et les pays majeurs."]}),e.jsx("p",{className:"text-amber-200 text-sm mb-4",children:"Le contexte sanitaire local reste disponible ci-dessous. Les données météo et qualité de l'air seront ajoutées prochainement."}),e.jsx("button",{onClick:()=>window.location.href="/profile?tab=identity",className:"btn-glass text-sm px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{Icon:n.MapPin,size:14}),e.jsx("span",{children:"Changer de pays"})]})})]})]})}),u&&i&&!b&&e.jsx("div",{className:"p-4 rounded-xl bg-red-500/10 border border-red-400/20 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.AlertCircle,size:20,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-red-300 font-semibold mb-1",children:"Erreur de chargement"}),e.jsx("p",{className:"text-red-200 text-sm mb-3",children:i.message}),e.jsx("button",{onClick:r,className:"btn-glass text-sm px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{Icon:n.RefreshCw,size:14}),e.jsx("span",{children:"Réessayer"})]})})]})]})}),u&&a&&!s&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(o,{Icon:n.Loader2,size:32,className:"animate-spin text-pink-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white/70",children:"Chargement des données environnementales..."})]}),u&&s&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(fs,{weather:s.weather,city:s.city}),e.jsx(ps,{airQuality:s.air_quality}),e.jsx(bs,{hydration:s.hydration_recommendation}),e.jsx(js,{exposure:s.environmental_exposure})]})]})}),u&&e.jsx(P.div,{variants:ee,children:e.jsxs(F,{className:"p-6",style:{background:`
              radial-gradient(circle at 30% 20%, rgba(236, 72, 153, 0.08) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"rgba(236, 72, 153, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                      linear-gradient(135deg, color-mix(in srgb, #EC4899 35%, transparent), color-mix(in srgb, #EC4899 25%, transparent))
                    `,border:"2px solid color-mix(in srgb, #EC4899 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #EC4899 30%, transparent)"},children:e.jsx(o,{Icon:n.Globe,size:20,style:{color:"#EC4899"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Contexte Sanitaire Local"}),e.jsxs("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:["Risques et recommandations pour ",t?.country]})]})]}),c&&e.jsx("button",{onClick:x,disabled:l,className:"btn-glass px-3 py-2 text-sm",title:"Rafraîchir les données sanitaires",children:e.jsx(o,{Icon:n.RefreshCw,size:16,className:l?"animate-spin":""})})]}),d&&e.jsx("div",{className:"p-4 rounded-xl bg-red-500/10 border border-red-400/20 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.AlertCircle,size:18,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-300 text-sm font-medium mb-1",children:"Erreur de chargement"}),e.jsx("p",{className:"text-red-200 text-xs",children:d.message})]})]})}),e.jsx(ms,{countryData:c,loading:l})]})}),u&&s&&e.jsx(P.div,{variants:ee,children:e.jsx(F,{className:"p-4",style:{background:"rgba(236, 72, 153, 0.05)",borderColor:"rgba(236, 72, 153, 0.2)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.Info,size:16,className:"text-pink-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{children:e.jsxs("p",{className:"text-pink-300 text-sm leading-relaxed",children:[e.jsx("strong",{children:"Sources de données:"})," Les informations météorologiques et de qualité de l'air proviennent d'Open-Meteo, un service open source fournissant des données en temps réel. Les données sont mises à jour toutes les heures automatiquement."]})})]})})})]}):e.jsx(P.div,{className:"space-y-6",variants:fe,initial:"hidden",animate:"visible",children:e.jsx(P.div,{variants:ee,children:e.jsxs(F,{className:"p-8 text-center",style:{background:`
              radial-gradient(circle at 30% 20%, rgba(236, 72, 153, 0.12) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"rgba(236, 72, 153, 0.3)"},children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(236, 72, 153, 0.4), rgba(236, 72, 153, 0.2))
                `,border:"2px solid rgba(236, 72, 153, 0.5)",boxShadow:"0 0 30px rgba(236, 72, 153, 0.4)"},children:e.jsx(o,{Icon:n.MapPin,size:32,style:{color:"#EC4899"},variant:"pure"})}),e.jsx("h2",{className:"text-white font-bold text-2xl mb-3",children:"Pays non renseigné"}),e.jsx("p",{className:"text-white/70 text-base leading-relaxed mb-6",children:"Pour accéder aux données géographiques, météorologiques et de qualité de l'air, veuillez d'abord renseigner votre pays dans l'onglet Identité."}),e.jsx("button",{onClick:()=>{window.location.href="/profile?tab=identity"},className:"btn-glass--primary px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{Icon:n.User,size:18}),e.jsx("span",{children:"Aller à l'onglet Identité"})]})})]})})})};function ys(){const{user:t}=G(),[s,a]=R.useState({hasBodyScan:!1,hasFaceScan:!1,latestBodyScan:null,latestFaceScan:null,bodyScanCount:0,faceScanCount:0,lastScanDate:null,completionPercentage:0}),[i,r]=R.useState(!0),[c,l]=R.useState(null);return R.useEffect(()=>{if(!t?.id){r(!1);return}async function x(){try{r(!0),l(null),h.info("AVATAR_DATA","Fetching latest body scan",{userId:t.id,philosophy:"avatar_data_fetch_start"});const{data:u,error:b}=await W.from("body_scans").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(1);if(b)throw h.error("AVATAR_DATA","Error fetching body scan",{userId:t.id,error:b.message,philosophy:"body_scan_fetch_error"}),b;let w=null,y=0;const{data:S,error:m}=await W.from("face_scans").select("id, created_at, photo_url, final_face_params, skin_tone_v2").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(1);if(m)h.warn("AVATAR_DATA","face_scans table not accessible (may not exist yet)",{userId:t.id,error:m.message,errorCode:m.code,philosophy:"face_scans_optional"});else{w=S;const{count:I,error:p}=await W.from("face_scans").select("*",{count:"exact",head:!0}).eq("user_id",t.id);p||(y=I||0)}const{count:g,error:N}=await W.from("body_scans").select("*",{count:"exact",head:!0}).eq("user_id",t.id);if(N)throw N;let C=null;if(u&&u.length>0){const I=u[0],p=I.metrics||{},T=I.morph_values||I.morph3d||p.final_shape_params||null,E=I.limb_masses||p.final_limb_masses||null,A=I.skin_tone_map_v2||p.skin_tone||I.skin_tone||null,k=I.resolved_gender||p.resolved_gender||null,D=p.estimate_result?.extracted_data||{},M=I.raw_measurements||D.raw_measurements||{},H=I.weight||M.weight_kg||D.weight_kg||null,L=I.body_fat_percentage||D.estimated_body_fat_perc||null,q=I.bmi||D.estimated_bmi||null,te=I.waist_circumference||M.waist_cm||null;C={id:I.id,created_at:I.created_at,timestamp:I.timestamp,user_id:I.user_id,morph_values:T,limb_masses:E,skin_tone:A,skin_tone_map_v2:I.skin_tone_map_v2,resolved_gender:k,weight:H,body_fat_percentage:L,bmi:q,waist_circumference:te,raw_measurements:M,avatar_version:I.avatar_version||p.avatar_version||null,gltf_model_id:I.gltf_model_id||p.gltf_model_id||null,material_config_version:I.material_config_version||null,mapping_version:I.mapping_version||null,metrics:I.metrics},h.info("AVATAR_DATA","Body scan data extracted and enriched",{userId:t.id,scanId:I.id,hasMorphValues:!!T&&Object.keys(T).length>0,morphValuesCount:T?Object.keys(T).length:0,morphValuesSource:I.morph_values?"direct_column":p.final_shape_params?"metrics_jsonb":"none",hasLimbMasses:!!E&&Object.keys(E).length>0,limbMassesCount:E?Object.keys(E).length:0,limbMassesSource:I.limb_masses?"direct_column":p.final_limb_masses?"metrics_jsonb":"none",hasSkinTone:!!A,skinToneSource:I.skin_tone_map_v2?"v2_direct_column":p.skin_tone?"metrics_jsonb":I.skin_tone?"legacy_column":"none",hasResolvedGender:!!k,resolvedGenderValue:k,hasWeight:!!H,weight:H,hasBMI:!!q,bmi:q,avatarVersion:C.avatar_version,philosophy:"body_scan_enriched"})}const j=w?.[0]||null;let f=null;if(C&&j){const I=new Date(C.created_at),p=new Date(j.created_at);f=I>p?I:p}else C?f=new Date(C.created_at):j&&(f=new Date(j.created_at));let v=0;C&&(v+=50),j&&(v+=50),a({hasBodyScan:!!C,hasFaceScan:!!j,latestBodyScan:C,latestFaceScan:j,bodyScanCount:g||0,faceScanCount:y||0,lastScanDate:f,completionPercentage:v}),h.info("AVATAR_DATA","Avatar data fetch completed successfully",{userId:t.id,hasBodyScan:!!C,hasFaceScan:!!j,bodyScanCount:g,faceScanCount:y,lastScanDate:f?.toISOString(),completionPercentage:v,philosophy:"avatar_data_fetch_complete"})}catch(u){const b=u instanceof Error?u:new Error("Failed to fetch avatar data");l(b),h.error("AVATAR_DATA","Error fetching avatar data",{userId:t?.id,error:b.message,errorStack:b.stack,philosophy:"avatar_data_fetch_error"})}finally{r(!1)}}x()},[t?.id]),{data:s,loading:i,error:c,refresh:()=>{t?.id&&(r(!0),l(null),a({hasBodyScan:!1,hasFaceScan:!1,latestBodyScan:null,latestFaceScan:null,bodyScanCount:0,faceScanCount:0,lastScanDate:null,completionPercentage:0}))}}}const Ns=({data:t})=>{const s=me();return e.jsxs(F,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(168, 85, 247, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(168, 85, 247, 0.2)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-white font-semibold flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #A855F7 35%, transparent), color-mix(in srgb, #A855F7 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #A855F7 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #A855F7 30%, transparent)"},children:e.jsx(o,{Icon:n.Eye,size:20,style:{color:"#A855F7"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl",children:"Statut Avatar"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"État de votre reflet numérique 3D"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.completionPercentage===100?"bg-green-400":t.completionPercentage>0?"bg-purple-400":"bg-gray-400"}`}),e.jsx("span",{className:`text-sm font-medium ${t.completionPercentage===100?"text-green-300":t.completionPercentage>0?"text-purple-300":"text-gray-400"}`,children:t.completionPercentage===100?"Complet":t.completionPercentage>0?"Partiel":"Vide"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P.div,{className:`w-12 h-12 rounded-full flex items-center justify-center border-2 ${t.completionPercentage===100?"bg-green-500/20 border-green-400/40":t.completionPercentage>0?"bg-purple-500/20 border-purple-400/40":"bg-gray-500/20 border-gray-400/40"}`,initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300,damping:25},children:e.jsx(o,{Icon:t.completionPercentage===100?n.CheckCircle:t.completionPercentage>0?n.Circle:n.XCircle,size:24,className:t.completionPercentage===100?"text-green-400":t.completionPercentage>0?"text-purple-400":"text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold",children:t.completionPercentage===100?"Avatar Complet":t.completionPercentage>0?"Avatar Partiel":"Aucun Avatar"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[t.hasBodyScan&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-300",children:[e.jsx(o,{Icon:n.User,size:12}),e.jsx("span",{children:"Corps 3D"})]}),!t.hasBodyScan&&e.jsx("span",{className:"text-xs text-gray-400",children:"Aucun scan disponible"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:[t.completionPercentage,"%"]}),e.jsx("div",{className:"text-purple-300 text-xs",children:"Complété"})]})]}),t.completionPercentage<100&&e.jsx("button",{onClick:()=>s("/body-scan"),className:"btn-glass--primary mt-6 w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(o,{Icon:n.Scan,size:16}),e.jsx("span",{children:"Scanner mon corps"})]})})]})},ws=({data:t})=>{const s=me();if(!t.lastScanDate)return e.jsxs(F,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, rgba(168, 85, 247, 0.08) 0%, transparent 60%),
            var(--glass-opacity)
          `,borderColor:"rgba(168, 85, 247, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, #A855F7 35%, transparent), color-mix(in srgb, #A855F7 25%, transparent))
              `,border:"2px solid color-mix(in srgb, #A855F7 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #A855F7 30%, transparent)"},children:e.jsx(o,{Icon:n.Clock,size:20,style:{color:"#A855F7"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl text-white font-semibold",children:"Dernier Scan"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Aucun scan disponible"})]})]}),e.jsx("div",{className:"p-4 rounded-xl bg-purple-500/10 border border-purple-400/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.Info,size:16,className:"text-purple-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-purple-200 text-sm leading-relaxed",children:"Vous n'avez pas encore effectué de scan corporel. Commencez par scanner votre corps pour créer votre avatar numérique 3D."})})]})}),e.jsx("button",{onClick:()=>s("/body-scan"),className:"btn-glass--primary mt-4 w-full",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(o,{Icon:n.Scan,size:16}),e.jsx("span",{children:"Commencer un scan"})]})})]});const a=qe(t.lastScanDate,{locale:Ge,addSuffix:!0});return e.jsxs(F,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(168, 85, 247, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(168, 85, 247, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #A855F7 35%, transparent), color-mix(in srgb, #A855F7 25%, transparent))
            `,border:"2px solid color-mix(in srgb, #A855F7 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #A855F7 30%, transparent)"},children:e.jsx(o,{Icon:n.Clock,size:20,style:{color:"#A855F7"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl text-white font-semibold",children:"Dernier Scan"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:a})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{Icon:n.User,size:14,className:"text-purple-400"}),e.jsx("span",{className:"text-white font-medium text-sm",children:"Scans Corporels"})]}),e.jsx("div",{className:"text-white/60 text-xs",children:t.hasBodyScan?`${t.bodyScanCount} scan${t.bodyScanCount>1?"s":""}`:"Aucun scan"})]})]})},_s=({data:t})=>{const s=me();return e.jsxs(F,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, rgba(168, 85, 247, 0.08) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"rgba(168, 85, 247, 0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #A855F7 35%, transparent), color-mix(in srgb, #A855F7 25%, transparent))
            `,border:"2px solid color-mix(in srgb, #A855F7 50%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #A855F7 30%, transparent)"},children:e.jsx(o,{Icon:n.Zap,size:20,style:{color:"#A855F7"},variant:"pure"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl text-white font-semibold",children:"Actions Rapides"}),e.jsx("div",{className:"text-white/60 text-sm font-normal mt-0.5",children:"Gérez votre avatar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>s("/body-scan"),className:"btn-glass p-4 text-left hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.Scan,size:18,className:"text-purple-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-sm mb-1",children:"Scanner mon corps"}),e.jsx("div",{className:"text-white/60 text-xs",children:"Créer ou mettre à jour votre scan corporel"})]})]})}),t.hasBodyScan&&e.jsx("button",{onClick:()=>s("/avatar"),className:"btn-glass p-4 text-left hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.Eye,size:18,className:"text-purple-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-sm mb-1",children:"Voir mon avatar"}),e.jsx("div",{className:"text-white/60 text-xs",children:"Visualiser votre reflet numérique 3D"})]})]})}),t.hasBodyScan&&e.jsx("button",{onClick:()=>s("/avatar?tab=projection"),className:"btn-glass p-4 text-left hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.TrendingUp,size:18,className:"text-purple-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-sm mb-1",children:"Projections"}),e.jsx("div",{className:"text-white/60 text-xs",children:"Visualiser l'évolution possible"})]})]})})]})]})},zs=()=>{const{data:t,loading:s,error:a}=ys();return s?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs(F,{className:"p-8 text-center",children:[e.jsx(o,{Icon:n.Loader2,size:32,className:"animate-spin text-purple-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white/70",children:"Chargement des données avatar..."})]})}):a?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(F,{className:"p-6",style:{background:"rgba(239, 68, 68, 0.1)",borderColor:"rgba(239, 68, 68, 0.3)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{Icon:n.AlertCircle,size:20,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-300 font-semibold mb-1",children:"Erreur de chargement"}),e.jsx("p",{className:"text-red-200 text-sm",children:a.message})]})]})})}):e.jsxs(P.div,{className:"space-y-6",variants:fe,initial:"hidden",animate:"visible",children:[e.jsx(P.div,{variants:ee,children:e.jsx(Ns,{data:t})}),e.jsx(P.div,{variants:ee,children:e.jsx(ws,{data:t})}),e.jsx(P.div,{variants:ee,children:e.jsx(_s,{data:t})})]})};export{be as F,st as P,Fs as a,Rs as b,Os as c,Ms as d,Ls as e,zs as f,Vt as g};
