import{u as L,R as M,j as e,r as x,e as te}from"./vendor-BefW7Bxj.js";import{u as q,l as f,s as K}from"./page-fridge-Cp-W9isk.js";import{u as W,S as c,I as o,G as z,s as ae}from"./ui-components-lrK_WhZu.js";import{a as X}from"./stores-Dp3vmZ5-.js";import{u as ee,a as re}from"./page-fridge-scan-C62RDC3k.js";import{u as O,C as Z,b as B,e as ie,h as ne,v as le,i as H}from"./ActivityUtils-BQw4lb66.js";import{m as P,A as Q}from"./motion-BQvLDPOm.js";import"./utils-CUtLAp28.js";import"./supabase-pyFrrmXL.js";import"./date-utils-BlBdbPk_.js";const G=[{id:"capture",title:"Capture de Mouvement",subtitle:"Enregistrez votre session énergétique",icon:"Activity",color:"#3B82F6"},{id:"analysis",title:"Analyse de Forge",subtitle:"Traitement de votre empreinte énergétique",icon:"Zap",color:"#06B6D4"},{id:"review",title:"Revue Énergétique",subtitle:"Validation et ajustement de vos données",icon:"Target",color:"#1D4ED8"},{id:"insights_generation",title:"Génération d'Insights",subtitle:"Analyse avancée de vos patterns d'activité",icon:"Lightbulb",color:"#8B5CF6"}];function oe(){const t=L(),{success:a,error:i}=q(),{showToast:s}=W(),[r,n]=M.useState({currentStep:"capture",overallProgress:0,message:"Prêt à forger votre énergie",subMessage:"Commencez par enregistrer votre session d'activité",isActive:!1,steps:G}),l=M.useCallback((u="capture")=>{f.info("ACTIVITY_PIPELINE","Starting activity pipeline",{initialStep:u,timestamp:new Date().toISOString()});const w={capture:{message:"Forge Énergétique Activée",subMessage:"Décrivez votre session d'activité physique"},analysis:{message:"Analyse de Forge",subMessage:"Traitement de votre empreinte énergétique"},review:{message:"Revue Énergétique",subMessage:"Validation et ajustement de vos données"},insights_generation:{message:"Génération d'Insights Énergétiques",subMessage:"Analyse avancée de vos patterns d'activité"}}[u];n(A=>({...A,isActive:!0,currentStep:u,overallProgress:0,message:w.message,subMessage:w.subMessage}))},[]),g=M.useCallback((u,j,w,A)=>{n(y=>({...y,currentStep:u,overallProgress:j,message:w,subMessage:A||""}))},[]),m=M.useCallback(u=>{n(j=>({...j,audioData:u}))},[]),C=M.useCallback(u=>{n(j=>({...j,transcriptionResult:u}))},[]),h=M.useCallback(u=>{n(j=>({...j,analysisResult:u}))},[]),v=M.useCallback(()=>{f.info("ACTIVITY_PIPELINE","Pipeline completed successfully",{activitiesCount:r.analysisResult?.activities?.length||0,totalCalories:r.analysisResult?.totalCalories||0,timestamp:new Date().toISOString()}),n(u=>({...u,isActive:!1,currentStep:"capture",overallProgress:0,message:"Prêt à forger votre énergie",subMessage:"Commencez par enregistrer votre session d'activité",audioData:void 0,transcriptionResult:void 0,analysisResult:void 0})),a(),s({type:"success",title:"Forge Énergétique Complétée",message:"Vos activités ont été enregistrées avec succès",duration:4e3}),setTimeout(()=>{t("/activity#daily")},1e3)},[r.analysisResult,a,s,t]),I=M.useCallback(()=>{f.info("ACTIVITY_PIPELINE","Pipeline cancelled by user",{currentStep:r.currentStep,progress:r.overallProgress,timestamp:new Date().toISOString()}),n(u=>({...u,isActive:!1,currentStep:"capture",overallProgress:0,message:"Prêt à forger votre énergie",subMessage:"Commencez par enregistrer votre session d'activité",audioData:void 0,transcriptionResult:void 0,analysisResult:void 0})),t("/activity")},[r.currentStep,r.overallProgress,t]),_=M.useCallback((u,j)=>{f.error("ACTIVITY_PIPELINE","Pipeline error occurred",{error:u,step:j,timestamp:new Date().toISOString()}),i(),s({type:"error",title:"Erreur de la Forge",message:u,duration:5e3});const w=G.findIndex(y=>y.id===j),A=w>0?G[w-1].id:"capture";n(y=>({...y,currentStep:A,overallProgress:Math.max(0,y.overallProgress-33),message:"Erreur de Forge - Réessayez",subMessage:"Une erreur est survenue, veuillez réessayer"}))},[i,s]);return{state:r,actions:{startPipeline:l,setStep:g,setAudioData:m,setTranscriptionResult:C,setAnalysisResult:h,completePipeline:v,cancelPipeline:I,handleError:_}}}const ce=({hasConnectedWearable:t,connectedDevicesCount:a,selectedInputMode:i,onModeChange:s,loading:r=!1})=>{const n=L(),{click:l}=q(),g=()=>{l(),t?s("wearable"):n("/settings")},m=i==="wearable";return r?e.jsx("div",{className:"capture-mode-button-3d opacity-50",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-success",children:e.jsx(c,{Icon:o.Loader2,size:32,className:"text-white/60 animate-spin",variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Chargement..."})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"Vérification de vos appareils"})]})}):t?e.jsx("button",{onClick:g,className:`capture-mode-button-3d ${m?"capture-mode-button-3d-active capture-mode-button-3d-active-success":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-success relative",children:[e.jsx(c,{Icon:o.Watch,size:32,style:{color:m?"#22C55E":"rgba(255, 255, 255, 0.6)"},variant:"pure"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full bg-green-400 border-2 border-white/20",style:{boxShadow:"0 0 12px rgba(34, 197, 94, 0.6)"}})]}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Montre Connectée"})]}),e.jsxs("p",{className:"text-white/70 text-sm text-left",children:[a," appareil",a>1?"s":""," connecté",a>1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),e.jsx("span",{className:"text-green-300",children:"Synchronisation active"})]})]})}):e.jsx("button",{onClick:g,className:`capture-mode-button-3d ${m?"capture-mode-button-3d-active capture-mode-button-3d-active-info":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-info",children:e.jsx(c,{Icon:o.Watch,size:32,style:{color:m?"#0EA5E9":"rgba(255, 255, 255, 0.6)"},variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Montre Connectée"}),e.jsx("div",{className:"flex-1"}),e.jsx(c,{Icon:o.ChevronRight,size:24,className:"text-white/40"})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"Connectez votre montre pour un tracking automatique"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-sky-400"}),e.jsx("span",{className:"text-sky-300",children:"Tracking automatique et précis"})]})]})})},de=({selectedInputMode:t,onInputModeChange:a})=>{const{click:i}=q(),{hasConnectedWearable:s,connectedDevicesCount:r,loading:n}=ee(),l=m=>{i(),a(m),setTimeout(()=>{const C=document.querySelector(".capture-input-interface");C&&C.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},g=()=>t==="wearable"?"Vos activités sont automatiquement synchronisées depuis votre montre connectée":t==="audio"?"Votre enregistrement sera analysé par notre Forge IA pour extraire automatiquement les activités, durées et calories brûlées":t==="text"?"Votre description sera analysée par notre Forge IA pour extraire automatiquement les activités, durées et calories brûlées":"Choisissez votre méthode préférée pour enregistrer vos activités";return e.jsx(e.Fragment,{children:e.jsxs(z,{className:"p-6 capture-stage-card",children:[e.jsxs("div",{className:"capture-mode-selector",children:[e.jsx(ce,{hasConnectedWearable:s,connectedDevicesCount:r,selectedInputMode:t,onModeChange:l,loading:n}),e.jsx("button",{onClick:()=>l("audio"),className:`capture-mode-button-3d ${t==="audio"?"capture-mode-button-3d-active":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-primary",children:e.jsx(c,{Icon:o.Mic,size:32,style:{color:t==="audio"?"#3B82F6":"rgba(255, 255, 255, 0.6)"},variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Enregistrement Vocal"})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"Décrivez votre activité à voix haute"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-green-300",children:"Rapide et naturel"})]})]})}),e.jsx("button",{onClick:()=>l("text"),className:`capture-mode-button-3d ${t==="text"?"capture-mode-button-3d-active capture-mode-button-3d-active-accent":""}`,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"capture-mode-icon-3d capture-mode-icon-3d-accent",children:e.jsx(c,{Icon:o.FileText,size:32,style:{color:t==="text"?"#8B5CF6":"rgba(255, 255, 255, 0.6)"},variant:"pure"})}),e.jsx("h4",{className:"text-white font-bold text-lg",children:"Saisie Manuelle"})]}),e.jsx("p",{className:"text-white/70 text-sm text-left",children:"Écrivez votre description d'activité"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-left",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-400"}),e.jsx("span",{className:"text-purple-300",children:"Précis et détaillé"})]})]})})]}),e.jsx("div",{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)"},children:e.jsx(c,{Icon:o.Zap,size:16,style:{color:"var(--color-plasma-cyan)"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-cyan-300 font-semibold text-sm",children:"Forge IA Intelligente"}),e.jsx("p",{className:"text-cyan-200 text-xs",children:g()})]})]})})]})})},me=({isRecording:t,recordingDuration:a,audioBlob:i,onStartRecording:s,onStopRecording:r,onProcessAudio:n,isProcessing:l})=>{const{click:g}=q(),m=O(),C=x.useRef(null);x.useEffect(()=>{if(C.current){const I=`activity-perf-${m.mode}`;return C.current.classList.add(I),()=>{C.current?.classList.remove(I)}}},[m.mode]);const h=I=>{const _=Math.floor(I/60),u=I%60;return`${_}:${u.toString().padStart(2,"0")}`},v=()=>{g(),t?r():i||s()};return e.jsx("div",{ref:C,children:e.jsx(z,{className:"capture-audio-container capture-stage-card capture-input-interface",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("button",{className:`capture-audio-visualizer-3d ${t?"capture-audio-visualizer-recording-3d":"capture-audio-visualizer-idle-3d"}`,onClick:v,"aria-label":t?"Arrêter l'enregistrement":"Démarrer l'enregistrement",children:e.jsx("div",{className:"capture-audio-icon-wrapper",children:e.jsx(c,{Icon:t?o.Square:o.Mic,size:56,style:{color:t?"#EF4444":"#3B82F6"},variant:"pure"})})}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"capture-audio-ring-1"}),e.jsx("div",{className:"capture-audio-ring-2"}),e.jsx("div",{className:"capture-audio-ring-3"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:t?"Enregistrement en cours...":"Parlez dans le Micro"}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-md mx-auto",children:t?"Décrivez votre session d'activité physique en cours...":"Cliquez sur le microphone pour commencer à décrire votre activité"})]}),t&&e.jsx(Z,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:m.transitionDuration},className:"text-center",fallback:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"capture-audio-status",children:[e.jsx("div",{className:"capture-audio-status-indicator"}),e.jsx("span",{className:"capture-audio-timer",children:h(a)})]})}),children:e.jsxs("div",{className:"capture-audio-status",children:[e.jsx("div",{className:"capture-audio-status-indicator"}),e.jsx("span",{className:"capture-audio-timer",children:h(a)})]})}),e.jsxs("div",{className:"flex justify-center gap-4",children:[t&&e.jsx("button",{onClick:r,className:"capture-action-button-3d capture-action-button-3d-danger",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{Icon:o.Square,size:24,className:"text-white"}),e.jsx("span",{children:"Terminer l'Enregistrement"})]})}),i&&!t&&!l&&e.jsx("button",{onClick:n,className:"capture-action-button-3d capture-action-button-3d-success",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{Icon:o.Zap,size:24,className:"text-white"}),e.jsx("span",{children:"Processer ma Forge"})]})})]}),!t&&!i&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 8%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #3B82F6 15%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 25%, transparent)"},children:e.jsx(c,{Icon:o.Mic,size:16,style:{color:"#3B82F6"}})}),e.jsx("h4",{className:"text-blue-300 font-semibold text-sm",children:"Cliquez sur le microphone pour commencer"})]}),e.jsxs("div",{className:"text-blue-200 text-sm space-y-1 text-left",children:[e.jsx("p",{children:"• Cliquez une fois pour démarrer l'enregistrement"}),e.jsx("p",{children:"• Parlez clairement en décrivant vos activités"}),e.jsx("p",{children:"• Cliquez à nouveau pour arrêter l'enregistrement"}),e.jsx("p",{children:"• Puis traitez votre enregistrement avec le bouton vert"})]})]})]})})})},ue=({textInput:t,onTextInputChange:a,onProcessText:i,isProcessing:s})=>{const{showToast:r}=W(),n=()=>{if(!t.trim()){r({type:"error",title:"Texte requis",message:"Veuillez décrire votre activité avant de continuer",duration:3e3});return}if(t.trim().length<10){r({type:"warning",title:"Description trop courte",message:"Ajoutez plus de détails sur votre activité pour une analyse précise",duration:3e3});return}i(t.trim())};return e.jsx(z,{className:"capture-text-container capture-stage-card capture-input-interface",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"capture-text-icon-3d",children:e.jsx("div",{className:"capture-text-icon-inner",children:e.jsx(c,{Icon:o.FileText,size:40,style:{color:"#8B5CF6"},variant:"pure"})})})}),e.jsx("h2",{className:"text-3xl font-bold text-white",children:"Saisie Manuelle"}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-md mx-auto",children:"Décrivez votre session d'activité physique en détail"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"activity-description",className:"block text-white/90 text-sm font-medium text-left",children:"Description de votre activité"}),e.jsx("textarea",{id:"activity-description",value:t,onChange:l=>a(l.target.value),className:"capture-text-input",placeholder:"Ex: J'ai fait 30 minutes de course à pied ce matin à intensité modérée, puis 10 minutes d'étirements pour récupérer..."}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-white/60 text-left",children:t.length<10?"Ajoutez plus de détails pour une analyse précise":"Description complète"}),e.jsxs("span",{className:`font-medium ${t.length<10?"text-orange-400":t.length<50?"text-yellow-400":"text-green-400"}`,children:[t.length," caractères"]})]})]}),t.trim()&&!s&&e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-center",children:e.jsx("button",{onClick:n,className:"capture-action-button-3d capture-action-button-3d-primary",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{Icon:o.Zap,size:24,className:"text-white"}),e.jsx("span",{children:"Processer ma Forge"})]})})}),e.jsxs("div",{className:"capture-text-hint",children:[e.jsxs("h4",{className:"text-purple-300 font-semibold mb-2 flex items-center gap-2",children:[e.jsx(c,{Icon:o.Info,size:16,style:{color:"#8B5CF6"}}),"Conseils pour une Description Optimale"]}),e.jsxs("div",{className:"text-purple-200 text-sm space-y-1 text-left",children:[e.jsx("p",{children:"• Décrivez clairement chaque activité et sa durée"}),e.jsx("p",{children:"• Précisez l'intensité (facile, modéré, intense, très intense)"}),e.jsx("p",{children:"• Ajoutez des détails sur le contexte (matin, soir, etc.)"}),e.jsx("p",{children:'• Exemple : "Course 45min intense + étirements 10min"'})]})]})]})})},xe=({connectedDevicesCount:t})=>{const a=L(),{click:i}=q(),{session:s}=X(),{devices:r,loading:n,syncing:l,syncDevice:g}=re(s?.user?.id||null),m=()=>{i(),a("/settings")},C=async()=>{if(i(),r.length>0)try{await g(r[0].id)}catch(h){console.error("Sync failed:",h)}};return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4,ease:[.4,0,.2,1]},className:"space-y-4 capture-input-interface",children:e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("div",{className:"w-24 h-24 mx-auto rounded-full flex items-center justify-center relative",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(34, 197, 94, 0.25) 0%, transparent 60%),
                  linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05))
                `,border:"2px solid rgba(34, 197, 94, 0.3)",boxShadow:"0 0 40px rgba(34, 197, 94, 0.2)"},children:[e.jsx(c,{Icon:o.Watch,size:48,style:{color:"#22C55E"}}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-green-400 border-2 border-white/20 flex items-center justify-center",style:{boxShadow:"0 0 16px rgba(34, 197, 94, 0.6)"},children:e.jsx("span",{className:"text-white text-xs font-bold",children:t})})]}),[...Array(3)].map((h,v)=>{const I=v*120-90,_=50,u=Math.cos(I*Math.PI/180)*_,j=Math.sin(I*Math.PI/180)*_;return e.jsx(P.div,{className:"absolute w-2 h-2 rounded-full bg-green-400",style:{left:"50%",top:"50%",marginLeft:"-4px",marginTop:"-4px",boxShadow:"0 0 12px rgba(34, 197, 94, 0.8)"},animate:{x:[0,u,0],y:[0,j,0],opacity:[.8,0,.8]},transition:{duration:2,repeat:1/0,delay:v*.66,ease:"easeInOut"}},v)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Synchronisation Active"}),e.jsx("p",{className:"text-white/70 text-base",children:"Vos activités sont automatiquement trackées par votre montre connectée"})]}),!n&&r.length>0&&e.jsx("div",{className:"space-y-3",children:r.slice(0,3).map(h=>e.jsx("div",{className:"p-4 rounded-xl text-left",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1))",border:"1px solid rgba(34, 197, 94, 0.3)"},children:e.jsx(c,{Icon:o.Watch,size:20,style:{color:"#22C55E"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:h.displayName||h.provider.toUpperCase()}),e.jsx("p",{className:"text-white/50 text-xs",children:h.lastSyncAt?`Dernière synchro: ${new Date(h.lastSyncAt).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}`:"Pas encore synchronisé"})]}),e.jsxs("div",{className:"px-2 py-1 rounded-full text-xs",style:{background:"rgba(34, 197, 94, 0.15)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#22C55E"},children:[h.status==="connected"&&"Connecté",h.status==="syncing"&&"Synchro...",h.status==="error"&&"Erreur"]})]})},h.id))}),e.jsx("div",{className:"p-4 rounded-xl",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 20%, transparent)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:"color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-plasma-cyan) 25%, transparent)"},children:e.jsx(c,{Icon:o.Info,size:16,style:{color:"var(--color-plasma-cyan)"}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-cyan-300 font-semibold text-sm mb-1",children:"Tracking Automatique"}),e.jsx("p",{className:"text-cyan-200/80 text-xs leading-relaxed",children:"Vos activités sont automatiquement enregistrées. Pas besoin de saisie manuelle ! Les données sont synchronisées en temps réel depuis votre montre."})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:C,disabled:l||n,className:"flex-1 px-6 py-3 rounded-xl font-semibold text-white transition-all duration-300",style:{background:l?"rgba(255, 255, 255, 0.1)":"linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(34, 197, 94, 0.2))",border:"1px solid rgba(34, 197, 94, 0.4)",boxShadow:l?"none":"0 4px 16px rgba(34, 197, 94, 0.2)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(c,{Icon:o.RefreshCw,size:20,className:l?"animate-spin":""}),e.jsx("span",{children:l?"Synchronisation...":"Synchroniser maintenant"})]})}),e.jsx("button",{onClick:m,className:"px-6 py-3 rounded-xl font-semibold text-white transition-all duration-300",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.15)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(c,{Icon:o.Settings,size:20}),e.jsx("span",{children:"Gérer"})]})})]})]})})},"wearable-interface")},pe=({isRecording:t,recordingDuration:a,audioBlob:i,onStartRecording:s,onStopRecording:r,onProcessAudio:n,onProcessText:l,isProcessing:g,selectedInputMode:m,onInputModeChange:C})=>{const[h,v]=x.useState(""),{hasConnectedWearable:I,connectedDevicesCount:_,loading:u}=ee();x.useEffect(()=>{!u&&I&&m===null&&C("wearable")},[I,u,m,C]);const j=y=>{v(y)},w=y=>{l(y)},A=[{id:"wearable",icon:"Watch",color:"#22C55E",title:"Objet Connecté",description:"Synchronisation automatique recommandée"},{id:"daily",icon:"Calendar",color:"#3B82F6",title:"Saisie Quotidienne",description:"Recommandé si pas d'objet connecté"},{id:"insights",icon:"Zap",color:"#8B5CF6",title:"Insights IA",description:"Analyse et recommandations personnalisées"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(de,{selectedInputMode:m,onInputModeChange:C}),e.jsxs(Q,{mode:"wait",children:[m==="wearable"&&e.jsx(xe,{connectedDevicesCount:_},"wearable-interface"),m==="audio"&&e.jsx(me,{isRecording:t,recordingDuration:a,audioBlob:i,onStartRecording:s,onStopRecording:r,onProcessAudio:n,isProcessing:g},"audio-interface"),m==="text"&&e.jsx(ue,{textInput:h,onTextInputChange:j,onProcessText:w,isProcessing:g},"text-interface")]}),e.jsx(ae,{benefits:A,themeColor:"#3B82F6",title:"Pourquoi tracker mes activités ?"})]})},ge=({progress:t})=>{const a=O(),i=x.useRef(null);x.useEffect(()=>{if(i.current){const r=`activity-perf-${a.mode}`;return i.current.classList.add(r),()=>{i.current?.classList.remove(r)}}},[a.mode]);const s={primary:"#3B82F6",secondary:"#06B6D4"};return e.jsxs("div",{className:"analysis-icon-container",ref:i,children:[e.jsx("div",{className:`analysis-icon-ring ${a.enablePulseEffects?"analysis-icon-pulse":""}`}),e.jsx("div",{className:"analysis-icon-inner",children:e.jsx(c,{Icon:o.Zap,size:48,style:{color:s.primary,filter:a.enableGlows?`
              drop-shadow(0 0 12px color-mix(in srgb, ${s.primary} 90%, transparent))
              drop-shadow(0 0 24px color-mix(in srgb, ${s.primary} 70%, transparent))
              drop-shadow(0 0 36px color-mix(in srgb, ${s.secondary} 50%, transparent))
            `:"none"},variant:"pure"})})]})},he=({progress:t})=>{const a=O(),i=x.useRef(null);x.useEffect(()=>{if(i.current){const r=`activity-perf-${a.mode}`;return i.current.classList.add(r),()=>{i.current?.classList.remove(r)}}},[a.mode]);const s=Math.min(100,Math.max(0,t));return e.jsxs("div",{className:"analysis-progress-container",ref:i,children:[e.jsx("div",{className:"analysis-progress-bar",children:e.jsx(Z,{className:"analysis-progress-fill",style:{width:`${s}%`},initial:{width:0},animate:{width:`${s}%`},transition:{duration:a.transitionDuration*1.5,ease:"easeOut"},fallback:e.jsx("div",{className:"analysis-progress-fill",style:{width:`${s}%`,transition:`width ${a.transitionDuration*1.5}s ease-out`},children:a.enableShimmers&&e.jsx("div",{className:"analysis-progress-shimmer"})}),children:a.enableShimmers&&e.jsx("div",{className:"analysis-progress-shimmer"})})}),e.jsxs("span",{className:"analysis-progress-percentage",children:[Math.round(s),"%"]})]})},ve=({progress:t})=>{const a=O(),i=x.useRef(null);x.useEffect(()=>{if(i.current){const r=`activity-perf-${a.mode}`;return i.current.classList.add(r),()=>{i.current?.classList.remove(r)}}},[a.mode]);const s=[{icon:"Volume2",label:"Décodage Énergétique",sublabel:"Extraction des données vocales",color:"#3B82F6",active:t>=10},{icon:"Target",label:"Analyse de Mouvement",sublabel:"Identification des activités",color:"#06B6D4",active:t>=40},{icon:"Zap",label:"Calcul Énergétique",sublabel:"Optimisation des métriques",color:"#10B981",active:t>=70}];return e.jsx("div",{className:"analysis-modules-container",ref:i,children:s.map((r,n)=>{const l=`analysis-module ${r.active?"analysis-module-active":""}`;return e.jsxs(Z,{className:l,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:a.transitionDuration,delay:n*a.staggerDelay},fallback:e.jsxs("div",{className:l,children:[e.jsx("div",{className:"analysis-module-icon",children:e.jsx(c,{Icon:o[r.icon],size:20,style:{color:r.color},variant:"pure"})}),e.jsx("div",{className:"analysis-module-title",children:r.label}),e.jsx("div",{className:"analysis-module-status",children:r.sublabel})]}),children:[e.jsx("div",{className:"analysis-module-icon",children:e.jsx(c,{Icon:o[r.icon],size:20,style:{color:r.color},variant:"pure"})}),e.jsx("div",{className:"analysis-module-title",children:r.label}),e.jsx("div",{className:"analysis-module-status",children:r.sublabel})]},r.label)})})},ye=()=>{const t=O(),a=x.useRef(null);return x.useEffect(()=>{if(a.current){const i=`activity-perf-${t.mode}`;return a.current.classList.add(i),()=>{a.current?.classList.remove(i)}}},[t.mode]),t.enableComplexEffects?e.jsx("div",{className:"analysis-effects-container",ref:a,children:t.enableParticles&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"analysis-particle",style:{left:"10%",top:"20%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"30%",top:"60%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"50%",top:"30%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"70%",top:"70%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"85%",top:"40%"}}),e.jsx("div",{className:"analysis-particle",style:{left:"20%",top:"80%"}})]})}):null},be=({isProcessing:t,progress:a,currentMessage:i,subMessage:s})=>{const r=O(),n=x.useRef(null);return x.useEffect(()=>{if(n.current){const l=`activity-perf-${r.mode}`;return n.current.classList.add(l),()=>{n.current?.classList.remove(l)}}},[r.mode]),e.jsx("div",{className:"space-y-6 relative overflow-hidden analysis-stage-container",ref:n,children:e.jsxs(z,{className:"p-8 text-center relative overflow-hidden analysis-stage-card",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, #3B82F6 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #06B6D4 12%, transparent) 0%, transparent 50%),
            linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08)),
            var(--glass-opacity)
          `,borderColor:"color-mix(in srgb, #3B82F6 30%, transparent)",boxShadow:`
            0 20px 60px rgba(0, 0, 0, 0.4),
            0 0 40px color-mix(in srgb, #3B82F6 20%, transparent),
            0 0 80px color-mix(in srgb, #06B6D4 18%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.25),
            inset 0 -2px 0 rgba(0, 0, 0, 0.15)
          `,backdropFilter:"blur(28px) saturate(170%)",WebkitBackdropFilter:"blur(28px) saturate(170%)"},children:[e.jsx(ye,{}),e.jsxs("div",{className:"space-y-6 relative z-10",children:[e.jsx(ge,{progress:a}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:i||"Analyse de Forge en Cours"}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed max-w-lg mx-auto",children:s||"Votre empreinte énergétique est en cours de traitement par la Forge Spatiale"}),e.jsx(he,{progress:a})]}),e.jsx(ve,{progress:a})]})]})})},fe=()=>e.jsxs(z,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, #06B6D4 20%, transparent)",backdropFilter:"blur(16px) saturate(140%)"},children:[e.jsxs("h4",{className:"text-cyan-300 font-semibold mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #06B6D4 15%, transparent)",border:"1px solid color-mix(in srgb, #06B6D4 25%, transparent)"},children:e.jsx(c,{Icon:o.Info,size:14,style:{color:"#06B6D4"}})}),"Processus de la Forge Spatiale"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-300 font-medium",children:"Décodage Énergétique"}),e.jsx("div",{className:"text-blue-200 text-xs",children:"Transformation de votre voix en données structurées"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-cyan-300 font-medium",children:"Analyse de Mouvement"}),e.jsx("div",{className:"text-cyan-200 text-xs",children:"Identification précise de vos activités physiques"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-green-300 font-medium",children:"Calcul Énergétique"}),e.jsx("div",{className:"text-green-200 text-xs",children:"Estimation des calories et métriques de performance"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-400 mt-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-purple-300 font-medium",children:"Optimisation Forge"}),e.jsx("div",{className:"text-purple-200 text-xs",children:"Personnalisation selon votre profil énergétique"})]})]})]})]})]}),je=({progress:t,currentMessage:a,subMessage:i})=>{const s={primary:"#3B82F6"},r=()=>t<20?"Initialisation de la Forge Énergétique...":t<40?"Décodage de votre empreinte énergétique...":t<60?"Analyse des patterns de mouvement...":t<80?"Calcul des métriques énergétiques...":"Finalisation de l'analyse de Forge...",n=Math.min(100,Math.max(0,t));return e.jsx("div",{className:"mt-8 p-6 rounded-xl",style:{background:`
        radial-gradient(circle at center, color-mix(in srgb, ${s.primary} 8%, transparent) 0%, transparent 70%),
        rgba(255,255,255,0.04)
      `,border:`1px solid color-mix(in srgb, ${s.primary} 20%, transparent)`,backdropFilter:"blur(8px) saturate(120%)"},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{background:`color-mix(in srgb, ${s.primary} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${s.primary} 30%, transparent)`},children:e.jsx(c,{Icon:o.Zap,size:12,style:{color:s.primary}})}),"Forge Énergétique Active"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:r().includes("Initialisation")?"🔄":r().includes("Décodage")?"🎤":r().includes("Analyse")?"⚡":r().includes("Calcul")?"🔥":"✨"}),e.jsx("div",{className:"text-xs text-white/60",children:"Phase Active"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold",style:{color:s.primary},children:[Math.round(n),"%"]}),e.jsx("div",{className:"text-xs text-white/60",children:"Progression"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-white mb-1",children:t<50?"⏳":t<80?"⚡":"🎯"}),e.jsx("div",{className:"text-xs text-white/60",children:"Statut"})]})]})]})})},Ne=({isProcessing:t,progress:a,currentMessage:i,subMessage:s})=>e.jsxs("div",{className:"space-y-6 relative overflow-hidden",children:[e.jsx(be,{isProcessing:t,progress:a,currentMessage:i,subMessage:s}),e.jsx(je,{progress:a,currentMessage:i,subMessage:s}),e.jsx(fe,{}),e.jsx("style",{children:`
        @keyframes energyScanVertical {
          0%, 100% { transform: translateY(-100%); opacity: 0; }
          10%, 90% { opacity: 0.6; }
          50% { transform: translateY(0); opacity: 1; }
        }

        @keyframes energyParticleFloat {
          0%, 100% { transform: translateY(0) scale(1); opacity: 0.6; }
          25% { transform: translateY(-8px) scale(1.2); opacity: 1; }
          50% { transform: translateY(-4px) scale(0.9); opacity: 0.8; }
          75% { transform: translateY(-12px) scale(1.1); opacity: 1; }
        }

        @keyframes energyGridPulse {
          0%, 100% { opacity: 0.2; }
          50% { opacity: 0.4; }
        }

        @keyframes energyPulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.7; transform: scale(1.2); }
        }

        @keyframes energyShimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(200%); }
        }

        @keyframes energyFlow {
          0% { transform: translateX(-100%); opacity: 0; }
          50% { opacity: 1; }
          100% { transform: translateX(100%); opacity: 0; }
        }
      `})]}),Ie=({activities:t,totalCalories:a,totalDuration:i})=>e.jsxs(z,{className:"p-8 text-center",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--color-ember-copper) 15%, transparent) 0%, transparent 60%),
          radial-gradient(circle at 70% 80%, color-mix(in srgb, #F59E0B 12%, transparent) 0%, transparent 50%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, var(--color-ember-copper) 30%, transparent)",boxShadow:`
          0 12px 40px rgba(0, 0, 0, 0.25),
          0 0 30px color-mix(in srgb, var(--color-ember-copper) 20%, transparent),
          0 0 60px color-mix(in srgb, #F59E0B 15%, transparent),
          inset 0 2px 0 rgba(255, 255, 255, 0.15)
        `},children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center breathing-icon",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
              radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--color-ember-copper) 20%, transparent) 0%, transparent 50%),
              linear-gradient(135deg, color-mix(in srgb, var(--color-ember-copper) 45%, transparent), color-mix(in srgb, #F59E0B 35%, transparent))
            `,border:"3px solid color-mix(in srgb, var(--color-ember-copper) 70%, transparent)",boxShadow:`
              0 0 40px color-mix(in srgb, var(--color-ember-copper) 70%, transparent),
              0 0 80px color-mix(in srgb, var(--color-ember-copper) 50%, transparent),
              0 0 120px color-mix(in srgb, #F59E0B 40%, transparent),
              inset 0 4px 0 rgba(255,255,255,0.5),
              inset 0 -2px 0 rgba(0,0,0,0.2)
            `,backdropFilter:"blur(20px) saturate(170%)",WebkitBackdropFilter:"blur(20px) saturate(170%)"},children:e.jsx(c,{Icon:o.Fire,size:48,style:{color:"var(--color-ember-copper)",filter:`
                drop-shadow(0 0 12px color-mix(in srgb, var(--color-ember-copper) 90%, transparent))
                drop-shadow(0 0 24px color-mix(in srgb, var(--color-ember-copper) 70%, transparent))
                drop-shadow(0 0 36px color-mix(in srgb, #F59E0B 50%, transparent))
              `},variant:"pure"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline justify-center gap-2",children:[e.jsx("span",{className:"text-6xl md:text-7xl font-black leading-none",style:{color:"var(--color-ember-copper)",textShadow:`
                  0 0 20px color-mix(in srgb, var(--color-ember-copper) 60%, transparent),
                  0 0 40px color-mix(in srgb, var(--color-ember-copper) 40%, transparent),
                  0 0 60px color-mix(in srgb, #F59E0B 30%, transparent)
                `,letterSpacing:"-0.02em"},children:a}),e.jsx("span",{className:"text-2xl font-bold mb-2",style:{color:"color-mix(in srgb, var(--color-ember-copper) 80%, white)",textShadow:"0 0 12px color-mix(in srgb, var(--color-ember-copper) 40%, transparent)"},children:"kcal"})]}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Énergie Forgée"}),e.jsx("p",{className:"text-white/80 text-lg",children:"Votre session énergétique a été analysée avec succès"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center p-6 rounded-xl",style:{background:"color-mix(in srgb, #22C55E 10%, transparent)",border:"1px solid color-mix(in srgb, #22C55E 20%, transparent)",backdropFilter:"blur(12px) saturate(130%)"},children:[e.jsx("div",{className:"text-3xl font-bold text-green-400 mb-2",children:t.length}),e.jsx("div",{className:"text-green-300 text-sm font-medium",children:"Activités"}),e.jsx("div",{className:"text-white/60 text-xs mt-1",children:"Forgées"})]}),e.jsxs("div",{className:"text-center p-6 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 10%, transparent)",border:"1px solid color-mix(in srgb, #3B82F6 20%, transparent)",backdropFilter:"blur(12px) saturate(130%)"},children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400 mb-2",children:i}),e.jsx("div",{className:"text-blue-300 text-sm font-medium",children:"Minutes"}),e.jsx("div",{className:"text-white/60 text-xs mt-1",children:"Actives"})]})]})]}),we=({activities:t,updateActivity:a,removeActivity:i})=>e.jsx("div",{className:"space-y-4",children:t.map((s,r)=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:r*.1},children:e.jsxs(z,{className:"p-6",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${B(s.intensity)} 8%, transparent) 0%, transparent 60%),
                var(--glass-opacity)
              `,borderColor:`color-mix(in srgb, ${B(s.intensity)} 20%, transparent)`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                      linear-gradient(135deg, color-mix(in srgb, ${B(s.intensity)} 30%, transparent), color-mix(in srgb, ${B(s.intensity)} 20%, transparent))
                    `,border:`2px solid color-mix(in srgb, ${B(s.intensity)} 40%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${B(s.intensity)} 30%, transparent)`},children:e.jsx(c,{Icon:o[ie(s.type)],size:20,style:{color:B(s.intensity)}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:s.type}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Intensité ",ne(s.intensity)]})]})]}),e.jsx("button",{onClick:()=>i(r),className:"p-2 rounded-full transition-all duration-200",style:{background:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)"},title:"Supprimer cette activité",children:e.jsx(c,{Icon:o.Trash2,size:16,className:"text-red-400"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white/80 text-sm font-medium",children:"Durée (minutes)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a(r,{duration_min:Math.max(5,s.duration_min-5)}),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx(c,{Icon:o.Minus,size:14,className:"text-white"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-white font-bold text-lg",children:s.duration_min}),e.jsx("div",{className:"text-white/60 text-xs",children:"min"})]}),e.jsx("button",{onClick:()=>a(r,{duration_min:Math.min(300,s.duration_min+5)}),className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsx(c,{Icon:o.Plus,size:14,className:"text-white"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white/80 text-sm font-medium",children:"Intensité"}),e.jsxs("select",{value:s.intensity,onChange:n=>a(r,{intensity:n.target.value}),className:"glass-input w-full",children:[e.jsx("option",{value:"low",children:"Faible"}),e.jsx("option",{value:"medium",children:"Modérée"}),e.jsx("option",{value:"high",children:"Intense"}),e.jsx("option",{value:"very_high",children:"Très Intense"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white/80 text-sm font-medium",children:"Calories"}),e.jsxs("div",{className:"text-center",children:[e.jsx(P.div,{initial:{scale:1.2,opacity:.8},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"},className:"text-2xl font-bold text-white",children:s.calories_est},s.calories_est),e.jsx("div",{className:"text-white/60 text-xs",children:"kcal brûlées"})]})]})]}),s.notes&&e.jsx("div",{className:"mt-4 p-3 rounded-xl",style:{background:`color-mix(in srgb, ${B(s.intensity)} 6%, transparent)`,border:`1px solid color-mix(in srgb, ${B(s.intensity)} 15%, transparent)`},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(c,{Icon:o.FileText,size:14,style:{color:B(s.intensity)},className:"mt-0.5"}),e.jsx("p",{className:"text-white/80 text-sm",children:s.notes})]})})]})},r))}),Ce=({showAddForm:t,setShowAddForm:a,newActivity:i,setNewActivity:s,addNewActivity:r,profile:n})=>e.jsx(Q,{children:t?e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsxs(z,{className:"p-6",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, #8B5CF6 8%, transparent) 0%, transparent 60%),
                var(--glass-opacity)
              `,borderColor:"color-mix(in srgb, #8B5CF6 25%, transparent)"},children:[e.jsxs("h4",{className:"text-white font-bold text-lg mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, #8B5CF6 30%, transparent), color-mix(in srgb, #8B5CF6 20%, transparent))
                  `,border:"2px solid color-mix(in srgb, #8B5CF6 40%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #8B5CF6 30%, transparent)"},children:e.jsx(c,{Icon:o.Plus,size:16,style:{color:"#8B5CF6"}})}),"Nouveau Mouvement"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Type d'activité"}),e.jsx("input",{type:"text",value:i.type||"",onChange:l=>s(g=>({...g,type:l.target.value})),className:"glass-input w-full",placeholder:"Ex: Course à pied, Musculation..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Durée (minutes)"}),e.jsx("input",{type:"number",value:i.duration_min||30,onChange:l=>s(g=>({...g,duration_min:parseInt(l.target.value)||30})),className:"glass-input w-full",min:"5",max:"300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Intensité"}),e.jsxs("select",{value:i.intensity||"medium",onChange:l=>s(g=>({...g,intensity:l.target.value})),className:"glass-input w-full",children:[e.jsx("option",{value:"low",children:"Faible"}),e.jsx("option",{value:"medium",children:"Modérée"}),e.jsx("option",{value:"high",children:"Intense"}),e.jsx("option",{value:"very_high",children:"Très Intense"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Notes (optionnel)"}),e.jsx("input",{type:"text",value:i.notes||"",onChange:l=>s(g=>({...g,notes:l.target.value})),className:"glass-input w-full",placeholder:"Détails supplémentaires..."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:r,className:"flex-1 add-form-submit-button-3d",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(c,{Icon:o.Check,size:16,className:"text-white"}),e.jsx("span",{children:"Ajouter"})]})}),e.jsx("button",{onClick:()=>{a(!1),s({type:"",duration_min:30,intensity:"medium",calories_est:0})},className:"add-form-cancel-button-3d",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{Icon:o.X,size:16}),e.jsx("span",{children:"Annuler"})]})})]})]})}):e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:e.jsx("button",{onClick:()=>a(!0),className:"add-activity-cta-3d",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"add-activity-icon-3d",children:e.jsx(c,{Icon:o.Plus,size:20,style:{color:"#8B5CF6"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold text-lg",children:"Ajouter un Mouvement"}),e.jsx("div",{className:"text-white/60 text-sm",children:"Enrichissez votre forge énergétique"})]})]})})})}),Se=({forgeInsights:t})=>!t||t.length===0?null:e.jsxs(z,{className:"p-6",style:{background:`
          radial-gradient(circle at 30% 20%, color-mix(in srgb, #F59E0B 8%, transparent) 0%, transparent 60%),
          var(--glass-opacity)
        `,borderColor:"color-mix(in srgb, #F59E0B 20%, transparent)"},children:[e.jsxs("h4",{className:"text-white font-bold text-lg mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, #F59E0B 30%, transparent), color-mix(in srgb, #F59E0B 20%, transparent))
            `,border:"2px solid color-mix(in srgb, #F59E0B 40%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, #F59E0B 30%, transparent)"},children:e.jsx(c,{Icon:o.Lightbulb,size:16,style:{color:"#F59E0B"}})}),"Insights de la Forge"]}),e.jsx("div",{className:"space-y-3",children:t.map((a,i)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 6%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 15%, transparent)"},children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center mt-0.5",style:{background:"color-mix(in srgb, #F59E0B 15%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 25%, transparent)"},children:e.jsx(c,{Icon:o.Zap,size:12,style:{color:"#F59E0B"}})}),e.jsx("p",{className:"text-white/80 text-sm flex-1",children:a})]},i))})]}),_e=({onCancel:t,handleSave:a,isSaving:i,isEditing:s})=>e.jsxs(e.Fragment,{children:[s&&e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center gap-3 p-4 rounded-xl",style:{background:"color-mix(in srgb, #F59E0B 8%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 20%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, #F59E0B 15%, transparent)",border:"1px solid color-mix(in srgb, #F59E0B 25%, transparent)"},children:e.jsx(c,{Icon:o.Edit,size:14,style:{color:"#F59E0B"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-orange-300 font-semibold",children:"Modifications détectées"}),e.jsx("div",{className:"text-orange-200 text-sm",children:"Vos ajustements seront sauvegardés"})]})]})}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:t,disabled:i,className:"px-6 py-3 text-lg font-semibold rounded-full",style:{background:"color-mix(in srgb, #6B7280 15%, transparent)",border:"1px solid color-mix(in srgb, #6B7280 25%, transparent)",color:"#9CA3AF",backdropFilter:"blur(12px) saturate(130%)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{Icon:o.X,size:18}),e.jsx("span",{children:"Annuler"})]})}),e.jsx("button",{onClick:a,disabled:i,className:"px-8 py-3 text-lg font-bold rounded-full relative overflow-hidden",style:{background:`linear-gradient(135deg, 
              color-mix(in srgb, #22C55E 80%, transparent), 
              color-mix(in srgb, #10B981 60%, transparent)
            )`,border:"2px solid color-mix(in srgb, #22C55E 60%, transparent)",boxShadow:`
              0 12px 40px color-mix(in srgb, #22C55E 40%, transparent),
              0 0 60px color-mix(in srgb, #22C55E 30%, transparent),
              inset 0 3px 0 rgba(255,255,255,0.4)
            `,backdropFilter:"blur(20px) saturate(160%)",color:"#fff",transition:"all 0.2s ease",opacity:i?.7:1},children:e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsx(c,{Icon:o.Loader2,size:20,className:"text-white animate-spin"}):e.jsx(c,{Icon:o.Save,size:20,className:"text-white"}),e.jsx("span",{children:i?"Sauvegarde...":"Enregistrer ma Forge"})]})})]})]}),ke=({analysisResult:t,onComplete:a,onCancel:i})=>{const[s,r]=x.useState(t?.activities||[]),[n,l]=x.useState(!1),[g,m]=x.useState(!1),[C,h]=x.useState(!1),[v,I]=x.useState({type:"",duration_min:30,intensity:"medium",calories_est:0}),{success:_,click:u,error:j}=q(),{showToast:w}=W(),{profile:A,session:y}=X(),V=te(),Y=s.reduce((d,p)=>d+p.calories_est,0),U=s.reduce((d,p)=>d+p.duration_min,0),J=d=>{const p=A?.weight_kg||70;return H(d.type,d.intensity,d.duration_min,p)},N=(d,p)=>{r(k=>{const S=[...k];return S[d]={...S[d],...p},(p.duration_min!==void 0||p.intensity!==void 0)&&(S[d].calories_est=J(S[d])),S}),l(!0)},F=d=>{r(p=>p.filter((k,S)=>S!==d)),l(!0)},R=()=>{if(!v.type||!v.duration_min){w({type:"error",title:"Informations manquantes",message:"Veuillez renseigner le type et la durée de l'activité",duration:3e3});return}const d=le({type:v.type,duration_min:v.duration_min,intensity:v.intensity});if(!d.isValid){w({type:"error",title:"Données invalides",message:d.errors.join(", "),duration:4e3});return}const p=A?.weight_kg||70,k=H(v.type,v.intensity,v.duration_min,p),S={type:v.type,duration_min:v.duration_min,intensity:v.intensity,calories_est:k,notes:v.notes};r(b=>[...b,S]),I({type:"",duration_min:30,intensity:"medium",calories_est:0}),h(!1),l(!0),_(),w({type:"success",title:"Activité ajoutée",message:"Nouvelle activité ajoutée à votre forge énergétique",duration:3e3})},E=async()=>{if(!y?.user?.id){j(),w({type:"error",title:"Erreur d'authentification",message:"Vous devez être connecté pour sauvegarder",duration:4e3});return}if(s.length===0){j(),w({type:"error",title:"Aucune activité à sauvegarder",message:"Ajoutez au moins une activité avant de sauvegarder",duration:3e3});return}m(!0);try{f.info("ACTIVITY_REVIEW","Saving activities to database",{userId:y.user.id,activitiesCount:s.length,totalCalories:Y,totalDuration:U,activitiesData:s.map(b=>({type:b.type,duration_min:b.duration_min,intensity:b.intensity,calories_est:b.calories_est})),timestamp:new Date().toISOString()});const d=new Date().toISOString(),p=s.map(b=>({user_id:y.user.id,type:b.type,duration_min:b.duration_min,intensity:b.intensity,calories_est:b.calories_est,notes:b.notes||null,timestamp:d,created_at:d}));f.info("ACTIVITY_REVIEW","Prepared activities for database insertion",{userId:y.user.id,activitiesToSave:p,totalActivities:p.length,timestamp:new Date().toISOString()});const{data:k,error:S}=await K.from("activities").insert(p).select();if(S)throw f.error("ACTIVITY_REVIEW","Supabase insertion failed",{error:S.message,errorDetails:S,errorCode:S.code,errorHint:S.hint,userId:y.user.id,activitiesCount:s.length,timestamp:new Date().toISOString()}),S;if(f.info("ACTIVITY_REVIEW","Activities saved successfully",{userId:y.user.id,savedCount:k?.length||0,savedActivities:k?.map(b=>({id:b.id,type:b.type,duration_min:b.duration_min,calories_est:b.calories_est,timestamp:b.timestamp})),timestamp:new Date().toISOString()}),k&&k.length>0){f.info("ACTIVITY_REVIEW","Syncing wearable goals",{userId:y.user.id,activitiesCount:k.length,timestamp:new Date().toISOString()});for(const b of k)try{const{data:D,error:$}=await K.functions.invoke("sync-wearable-goals",{body:{activity_id:b.id,user_id:y.user.id}});$?f.error("ACTIVITY_REVIEW","Failed to sync wearable goals",{activityId:b.id,error:$.message,timestamp:new Date().toISOString()}):f.info("ACTIVITY_REVIEW","Wearable goals synced successfully",{activityId:b.id,goalsUpdated:D?.goals_updated||0,timestamp:new Date().toISOString()})}catch(D){f.error("ACTIVITY_REVIEW","Exception during wearable goal sync",{activityId:b.id,error:D instanceof Error?D.message:"Unknown error",timestamp:new Date().toISOString()})}}await V.invalidateQueries({queryKey:["activities","daily",y.user.id]}),await V.invalidateQueries({queryKey:["activities","stats",y.user.id]}),await V.invalidateQueries({queryKey:["activities","recent",y.user.id]}),await V.invalidateQueries({queryKey:["training-goals",y.user.id]}),_(),w({type:"success",title:"Forge Énergétique Sauvegardée",message:`${s.length} activité${s.length>1?"s":""} enregistrée${s.length>1?"s":""} avec succès`,duration:4e3}),setTimeout(()=>{a()},1e3)}catch(d){f.error("ACTIVITY_REVIEW","Failed to save activities",{error:d instanceof Error?d.message:"Unknown error",errorStack:d instanceof Error?d.stack:void 0,userId:y.user.id,activitiesCount:s.length,activitiesData:s.map(p=>({type:p.type,duration_min:p.duration_min,intensity:p.intensity,calories_est:p.calories_est})),timestamp:new Date().toISOString()}),j(),w({type:"error",title:"Erreur de Sauvegarde",message:d instanceof Error?`Erreur: ${d.message}. Vérifiez votre connexion et réessayez.`:"Impossible de sauvegarder vos activités. Réessayez.",duration:4e3})}finally{m(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ie,{activities:s,totalCalories:Y,totalDuration:U}),e.jsx(we,{activities:s,updateActivity:N,removeActivity:F}),e.jsx(Ce,{showAddForm:C,setShowAddForm:h,newActivity:v,setNewActivity:I,addNewActivity:R,profile:A}),e.jsx(Se,{forgeInsights:t?.forgeInsights}),e.jsx(_e,{onCancel:i,handleSave:E,isSaving:g,isEditing:n})]})},Te="_wrap_1mo7s_11",Ae="_card_1mo7s_18",Ee="_grid_1mo7s_32",Fe="_icon_1mo7s_42",Pe="_iconHalo_1mo7s_66",ze="_iconGlyph_1mo7s_77",De="_center_1mo7s_83",Be="_title_1mo7s_91",Me="_subtitle_1mo7s_102",Ve="_rail_1mo7s_112",Re="_seg_1mo7s_119",$e="_segBlue_1mo7s_127",qe="_segCyan_1mo7s_131",Oe="_isCurrent_1mo7s_135",Ye="_isComplete_1mo7s_139",Ue="_fill_1mo7s_143",Le="_fillBlue_1mo7s_151",We="_fillCyan_1mo7s_157",Je="_step_1mo7s_164",Ge="_percent_1mo7s_173",T={wrap:Te,card:Ae,grid:Ee,icon:Fe,iconHalo:Pe,iconGlyph:ze,center:De,title:Be,subtitle:Me,rail:Ve,seg:Re,segBlue:$e,segCyan:qe,isCurrent:Oe,isComplete:Ye,fill:Ue,fillBlue:Le,fillCyan:We,step:Je,percent:Ge},Xe={capture:"Camera",analysis:"Scan",review:"Eye",complete:"Check"},Ze=({steps:t,currentStepId:a,progress:i,message:s,subMessage:r,className:n=""})=>{const l=Number.isFinite(i)?Math.min(100,Math.max(0,i)):0,g=100/t.length,m=Math.max(0,t.findIndex(_=>_.id===a)),C=m*g,h=Math.max(0,Math.min(1,(l-C)/g)),v=Xe[a]||"Activity",I={gridTemplateColumns:`repeat(${t.length}, 1fr)`};return e.jsx("div",{className:`${T.wrap} ${n}`,children:e.jsx(z,{className:T.card,children:e.jsxs("div",{className:T.grid,"data-energy-forge":!0,children:[e.jsxs("div",{className:T.icon,children:[e.jsx("div",{className:T.iconHalo}),e.jsx(c,{Icon:o[v],size:26,className:T.iconGlyph})]}),e.jsxs("div",{className:T.center,children:[e.jsx("h2",{className:T.title,children:s||"Forge Énergétique"}),r&&e.jsx("p",{className:T.subtitle,children:r}),e.jsx("div",{className:T.rail,style:I,role:"progressbar","aria-valuenow":Math.round(l),"aria-valuemin":0,"aria-valuemax":100,children:t.map((_,u)=>{const j=u<m,w=u===m,A=j?"100%":w?`${h*100}%`:"0%",y=u%2===0?T.segBlue:T.segCyan,V=u%2===0?T.fillBlue:T.fillCyan;return e.jsx("div",{className:`${T.seg} ${y} ${j?T.isComplete:""} ${w?T.isCurrent:""}`,children:(j||w)&&e.jsx(P.span,{className:`${T.fill} ${V}`,initial:{width:0},animate:{width:A},transition:{duration:.45,ease:"easeOut"}})},_.id)})}),e.jsxs("div",{className:T.step,children:["Forge ",m+1," / ",t.length]})]}),e.jsxs("div",{className:T.percent,"aria-hidden":"true",children:[Math.round(l),"%"]})]})})})},ls=()=>{L();const{state:t,actions:a}=oe(),{profile:i,session:s}=X(),{showToast:r}=W(),{error:n}=q(),[l,g]=x.useState(!1),[m,C]=x.useState(0),[h,v]=x.useState(null),I=x.useRef(null),_=x.useRef(null),[u,j]=x.useState(null),[w,A]=x.useState(!1),y=x.useCallback(async()=>{try{const N=await navigator.mediaDevices.getUserMedia({audio:!0}),F=new MediaRecorder(N),R=[];F.ondataavailable=E=>{E.data.size>0&&R.push(E.data)},F.onstop=()=>{const E=new Blob(R,{type:"audio/webm;codecs=opus"});v(E),N.getTracks().forEach(d=>d.stop())},F.start(),I.current=F,g(!0),C(0),_.current=setInterval(()=>{C(E=>E+1)},1e3),f.info("ACTIVITY_INPUT","Audio recording started",{userId:s?.user?.id,timestamp:new Date().toISOString()})}catch(N){f.error("ACTIVITY_INPUT","Failed to start recording",{error:N instanceof Error?N.message:"Unknown error"}),n(),r({type:"error",title:"Erreur Microphone",message:"Impossible d'accéder au microphone. Vérifiez les permissions.",duration:4e3})}},[s,n,r]),V=x.useCallback(()=>{I.current&&l&&(I.current.stop(),g(!1),_.current&&(clearInterval(_.current),_.current=null),f.info("ACTIVITY_INPUT","Audio recording stopped",{duration:m,userId:s?.user?.id,timestamp:new Date().toISOString()}))},[l,m,s]),Y=x.useCallback(async()=>{if(!h){n(),r({type:"error",title:"Aucun Audio",message:"Veuillez d'abord enregistrer un audio",duration:3e3});return}if(!s?.user?.id){n(),r({type:"error",title:"Authentification requise",message:"Vous devez être connecté pour continuer",duration:4e3});return}A(!0),a.setStep("analysis",25,"Transcription Audio","Conversion de votre voix en texte...");try{const N=new FileReader,R=await new Promise((D,$)=>{N.onloadend=()=>{const se=N.result.split(",")[1];D(se)},N.onerror=$,N.readAsDataURL(h)});a.setAudioData(R),f.info("ACTIVITY_INPUT","Calling activity-transcriber",{userId:s.user.id,audioSize:h.size,timestamp:new Date().toISOString()});const E="https://kwipydbtjagypocpvbwn.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U",p=await fetch(`${E}/functions/v1/activity-transcriber`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({audioBase64:R,userId:s.user.id,clientTraceId:`activity_transcription_${Date.now()}`})});if(!p.ok)throw new Error(`Transcription failed: ${p.statusText}`);const k=await p.json();a.setTranscriptionResult(k),f.info("ACTIVITY_INPUT","Transcription completed",{cleanText:k.cleanText,confidence:k.confidence,timestamp:new Date().toISOString()}),a.setStep("analysis",60,"Analyse Énergétique","Extraction et calcul des activités...");const S=await fetch(`${E}/functions/v1/activity-analyzer`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({text:k.cleanText,userId:s.user.id,userProfile:{weight_kg:i?.weight_kg||70,height_cm:i?.height_cm,sex:i?.sex,age:i?.birthdate?new Date().getFullYear()-new Date(i.birthdate).getFullYear():void 0},clientTraceId:`activity_analysis_${Date.now()}`})});if(!S.ok){let D=`Analysis failed: ${S.statusText}`;try{const $=await S.json();D=$.message||$.error||D,f.error("ACTIVITY_INPUT","API Error Details (Audio Path)",{status:S.status,statusText:S.statusText,errorData:$,timestamp:new Date().toISOString()})}catch{}throw new Error(D)}const b=await S.json();a.setAnalysisResult(b),f.info("ACTIVITY_INPUT","Analysis completed",{activitiesCount:b.activities.length,totalCalories:b.totalCalories,totalDuration:b.totalDuration,timestamp:new Date().toISOString()}),a.setStep("review",100,"Revue Énergétique","Validez vos activités avant sauvegarde")}catch(N){f.error("ACTIVITY_INPUT","Processing failed",{error:N instanceof Error?N.message:"Unknown error",userId:s.user.id,timestamp:new Date().toISOString()}),a.handleError(N instanceof Error?N.message:"Erreur lors du traitement de l'audio","analysis")}finally{A(!1)}},[h,s,i,a,n,r]),U=x.useCallback(async N=>{if(!N||N.trim().length<10){n(),r({type:"error",title:"Texte trop court",message:"Veuillez saisir au moins 10 caractères",duration:3e3});return}if(!s?.user?.id){n(),r({type:"error",title:"Authentification requise",message:"Vous devez être connecté pour continuer",duration:4e3});return}A(!0),a.setStep("analysis",40,"Analyse Énergétique","Extraction et calcul des activités...");try{f.info("ACTIVITY_INPUT","Processing text input",{textLength:N.length,userId:s.user.id,timestamp:new Date().toISOString()});const E=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/activity-analyzer",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U","Content-Type":"application/json"},body:JSON.stringify({cleanText:N,userId:s.user.id,userProfile:{weight_kg:i?.weight_kg||70,height_cm:i?.height_cm,sex:i?.sex,age:i?.birthdate?new Date().getFullYear()-new Date(i.birthdate).getFullYear():void 0},clientTraceId:`activity_analysis_text_${Date.now()}`})});if(!E.ok){let p=`Analysis failed: ${E.statusText}`;try{const k=await E.json();p=k.message||k.error||p,f.error("ACTIVITY_INPUT","API Error Details (Text Path)",{status:E.status,statusText:E.statusText,errorData:k,timestamp:new Date().toISOString()})}catch{}throw new Error(p)}const d=await E.json();a.setAnalysisResult(d),f.info("ACTIVITY_INPUT","Text analysis completed",{activitiesCount:d.activities.length,totalCalories:d.totalCalories,totalDuration:d.totalDuration,timestamp:new Date().toISOString()}),a.setStep("review",100,"Revue Énergétique","Validez vos activités avant sauvegarde")}catch(F){f.error("ACTIVITY_INPUT","Text processing failed",{error:F instanceof Error?F.message:"Unknown error",userId:s.user.id,timestamp:new Date().toISOString()}),a.handleError(F instanceof Error?F.message:"Erreur lors de l'analyse du texte","analysis")}finally{A(!1)}},[s,i,a,n,r]),J=x.useCallback(N=>{j(N),v(null),C(0),f.info("ACTIVITY_INPUT","Input mode changed",{mode:N})},[]);return M.useEffect(()=>(a.startPipeline("capture"),()=>{_.current&&clearInterval(_.current),I.current&&l&&I.current.stop()}),[]),e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"max-w-4xl mx-auto mt-4 space-y-6",children:[e.jsx(Ze,{steps:t.steps,currentStepId:t.currentStep,progress:t.progress,message:t.message,subMessage:t.subMessage}),e.jsxs(Q,{mode:"wait",children:[t.currentStep==="capture"&&e.jsx(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(pe,{isRecording:l,recordingDuration:m,audioBlob:h,onStartRecording:y,onStopRecording:V,onProcessAudio:Y,onProcessText:U,isProcessing:w,selectedInputMode:u,onInputModeChange:J})},"capture"),t.currentStep==="analysis"&&e.jsx(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(Ne,{isProcessing:w,progress:t.overallProgress,currentMessage:t.message,subMessage:t.subMessage})},"analysis"),t.currentStep==="review"&&e.jsx(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(ke,{analysisResult:t.analysisResult,onComplete:a.completePipeline,onCancel:a.cancelPipeline})},"review")]})]})};export{ls as default};
