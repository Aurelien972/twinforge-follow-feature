const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/voiceConnectionDiagnostics-BNW5zCZG.js","assets/page-fridge-Cp-W9isk.js","assets/vendor-BefW7Bxj.js","assets/utils-CUtLAp28.js","assets/supabase-pyFrrmXL.js","assets/page-fridge-scan-C62RDC3k.js","assets/stores-Dp3vmZ5-.js","assets/motion-BQvLDPOm.js","assets/page-fridge-scan-DAz6gEg3.css","assets/date-utils-BlBdbPk_.js"])))=>i.map(i=>d[i]);
var tt=Object.defineProperty;var at=(s,t,a)=>t in s?tt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var B=(s,t,a)=>at(s,typeof t!="symbol"?t+"":t,a);import{R as k,r as C,j as e,h as rt,B as it,A as st,D as nt,i as ot,S as lt,W as ct,F as dt,k as Re,l as pt,H as ut,T as mt,m as ht,L as gt,G as xt,n as Ne,o as bt,Z as ke,p as ft,q as yt,t as vt,v as wt,w as Ct,C as Et,N as St,M as jt,x as It,y as Tt,z as At,E as Rt,I as Nt,J as kt,K as _t,O as Mt,P as Ot,Q as Ft,U as Bt,V as Dt,Y as $t,_ as Pt,$ as Lt,a0 as Ht,a1 as Wt,a2 as zt,a3 as Ut,a4 as Vt,a5 as qt,a6 as Gt,a7 as Jt,a8 as Xt,a9 as Kt,aa as Yt,ab as Zt,ac as Qt,ad as _e,ae as ea,af as ta,ag as aa,ah as ra,ai as ia,aj as sa,ak as na,al as oa,am as la,an as ca,ao as da,ap as pa,aq as ua,ar as ma,as as ha,at as ga,au as xa,av as ba,aw as fa,ax as ya,ay as va,az as wa,aA as Ca,aB as Ea,aC as Sa,aD as ja,aE as Ia,aF as Ta,aG as Aa,aH as Ra,aI as Na,aJ as ka,aK as _a,aL as Ma,aM as Oa,aN as Fa,aO as Ba,aP as Da,aQ as $a,aR as Pa,aS as La,aT as Ha,aU as Wa,aV as za,aW as Ua,aX as Me,aY as Va,aZ as qa,a_ as Ga,a$ as Ja,b0 as Xa,b1 as Ka,b2 as Ya,b3 as Za,b4 as Qa,b5 as er,b6 as tr,b7 as ar,b8 as rr,b9 as ir,ba as sr,bb as nr,bc as or,bd as lr,be as cr,bf as dr,bg as pr,bh as ur,bi as mr,bj as hr,bk as gr,bl as xr,bm as br,bn as fr,bo as yr,bp as vr,bq as wr,br as Cr,bs as Er,bt as Sr,bu as jr,bv as Ir,bw as Tr,bx as Ar,by as Rr,bz as Nr,bA as kr,bB as _r,bC as Mr,bD as Or,bE as Fr,bF as Br,bG as Dr,bH as $r,bI as Pr,bJ as Lr,bK as Hr,bL as Wr,bM as zr,bN as Ur,bO as Vr,bP as qr,bQ as Gr,bR as Jr,bS as Xr,bT as Kr,bU as Yr,bV as Zr,bW as Qr,bX as we,bY as Ve,bZ as Ce,b_ as ei,b$ as qe,c0 as Ge,c1 as ti,c2 as ai,c3 as ri,c4 as ii,c5 as si,c6 as ni,c7 as oi,c8 as li,c9 as ci,ca as di,cb as pi,cc as ui,cd as mi,ce as hi,cf as gi,cg as xi,ch as Oe,ci as bi,cj as fi,ck as yi,cl as vi,cm as Fe,cn as wi,co as Ci,cp as Ei,cq as Si,cr as ji,cs as Ii,ct as Ti,cu as Ai,X as Ri,cv as Ni,cw as ki,cx as _i,cy as Mi,cz as Oi,cA as Fi,cB as Bi,cC as Di,cD as $i,cE as Pi,cF as Li,cG as Hi,cH as Wi,cI as zi,cJ as Ui,cK as Vi,cL as qi,e as Gi,u as oe,cM as Ji,cN as ue,b as be}from"./vendor-BefW7Bxj.js";import{l as n,a as J,u as G,s as L,H as Q}from"./page-fridge-Cp-W9isk.js";import{m as y,u as Xi,A as H}from"./motion-BQvLDPOm.js";import{a as ne,i as ge,Z as xe,c as Ki,j as pe,k as W}from"./stores-Dp3vmZ5-.js";import{_ as Yi,a as Zi}from"./page-fridge-scan-C62RDC3k.js";import{a as Qi,n as es}from"./utils-CUtLAp28.js";function ts(){const s=navigator.userAgent.toLowerCase();return/android/.test(s)?"android":/iphone|ipad|ipod/.test(s)?"ios":window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0?"desktop":"unknown"}function Be(){return!!(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||window.matchMedia("(display-mode: minimal-ui)").matches)}function as(){const[s,t]=k.useState(null),[a,r]=k.useState(!1),[i,o]=k.useState(!1),[l,c]=k.useState("unknown");C.useEffect(()=>{const p=ts(),u=Be();c(p),o(u),n.info("PWA_INSTALL","PWA state initialized",{platform:p,isInstalled:u,userAgent:navigator.userAgent.substring(0,100),displayMode:window.matchMedia("(display-mode: standalone)").matches?"standalone":"browser",timestamp:new Date().toISOString()})},[]),C.useEffect(()=>{const p=f=>{const h=f;f.preventDefault(),t(h),r(!0),n.info("PWA_INSTALL","beforeinstallprompt event captured",{platforms:h.platforms,canPrompt:!0,timestamp:new Date().toISOString()})},u=()=>{o(!0),r(!1),t(null),n.info("PWA_INSTALL","PWA installed successfully",{platform:l,timestamp:new Date().toISOString()})};return window.addEventListener("beforeinstallprompt",p),window.addEventListener("appinstalled",u),()=>{window.removeEventListener("beforeinstallprompt",p),window.removeEventListener("appinstalled",u)}},[l]),C.useEffect(()=>{const p=window.matchMedia("(display-mode: standalone)"),u=f=>{const h=f.matches||window.navigator.standalone===!0;o(h),n.info("PWA_INSTALL","Display mode changed",{isStandalone:f.matches,isInstalled:h,timestamp:new Date().toISOString()})};return p.addEventListener("change",u),()=>{p.removeEventListener("change",u)}},[]);const m=async()=>{if(!s)return n.warn("PWA_INSTALL","No install prompt event available",{platform:l,isInstallable:a,timestamp:new Date().toISOString()}),!1;try{n.info("PWA_INSTALL","Showing install prompt",{platform:l,timestamp:new Date().toISOString()}),await s.prompt();const p=await s.userChoice;return n.info("PWA_INSTALL","User install choice",{outcome:p.outcome,platform:p.platform,timestamp:new Date().toISOString()}),p.outcome==="accepted"?(r(!1),t(null),!0):!1}catch(p){return n.error("PWA_INSTALL","Install prompt failed",{error:p instanceof Error?p.message:"Unknown error",platform:l,timestamp:new Date().toISOString()}),!1}},d=()=>{r(!1),t(null),n.info("PWA_INSTALL","Install prompt dismissed by user",{platform:l,timestamp:new Date().toISOString()})},g=()=>{const p=Be();o(p),n.debug("PWA_INSTALL","Install status checked",{isInstalled:p,platform:l,timestamp:new Date().toISOString()})};return{isInstallable:a,isInstalled:i,isStandalone:window.matchMedia("(display-mode: standalone)").matches,platform:l,canShowPrompt:!!s,installPromptEvent:s,showInstallPrompt:m,dismissInstallPrompt:d,checkInstallStatus:g}}function rs(s,t,a=250){C.useEffect(()=>{const r=s.current;if(!r||t.length===0)return;r.style.willChange=t.join(", ");const i=setTimeout(()=>{r&&(r.style.willChange="auto")},a);return()=>{clearTimeout(i),r&&(r.style.willChange="auto")}},[s,t,a])}const Ie=C.createContext({preferredMotion:"full",hasTouch:!1,isMobile:!1}),is=()=>C.useContext(Ie).preferredMotion,ss=()=>C.useContext(Ie).hasTouch,xn=({children:s})=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)").matches?"reduced":"full",a="ontouchstart"in window||navigator.maxTouchPoints>0,r=window.innerWidth<768||a,i={preferredMotion:t,hasTouch:a,isMobile:r};return e.jsx(Ie.Provider,{value:i,children:s})},De={gentle:[.25,.1,.25,1],smooth:[.16,1,.3,1]};function ns(s){return s<=24?2:s>=24?2.5:2}function os(s){return s<=20?8:s<=32?10:s<=48?12:14}const j=({Icon:s,size:t=24,className:a="",animate:r=!0,color:i,glowColor:o,variant:l="default",shape:c="round",style:m,animate:d,transition:g,"aria-label":p,"aria-hidden":u,"aria-describedby":f,role:h,tabIndex:x,onClick:b,onKeyDown:w})=>{const S=is(),E=ss(),{isPerformanceMode:I}=J(),T=C.useRef(null),A=!S&&r&&window.innerWidth>768&&!I,N=i??"var(--text-icon-idle)",D="var(--text-icon-active)",$=ns(t),R=os(t);rs(T,A&&r?["transform"]:[],100);const X={initial:{scale:1,transition:{duration:0}},hover:A&&!E?{scale:1.03,transition:{duration:.1,ease:De.gentle}}:{},tap:A?{scale:.98,transition:{duration:.08,ease:De.smooth}}:{}},K=()=>{if(!(!A||E||l==="pure"||I)&&T.current){const ee=getComputedStyle(document.documentElement).getPropertyValue("--color-plasma-cyan").trim()||"#18E3FF";T.current.style.filter=`drop-shadow(0 0 ${R}px ${ee}15)`,T.current.style.color=D}},Z=()=>{!A||E||l==="pure"||I||T.current&&(T.current.style.filter="",T.current.style.color=N)},F=ee=>{w?.(ee),b&&(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),b())},O=!!b,M=O?x!==void 0?x:0:void 0,V=u!==void 0?u:!O&&!p&&!h,P=l==="pure"?`inline-flex items-center justify-center spatial-icon icon-container ${O?"cursor-pointer focus-ring":""} ${window.innerWidth<=768?"mobile-static-icon":""} ${A?"will-change-transform-important":"will-change-auto-important"} ${a}`:`inline-flex items-center justify-center spatial-icon icon-container gpu-only-transform ${O?"cursor-pointer focus-ring":""} ${window.innerWidth<=768?"mobile-static-icon":""} ${A?"will-change-transform-important":"will-change-auto-important"} ${a}`,z=()=>c==="square"?`${Math.max(4,t*.15)}px`:"50%",ae=l==="pure"?{transform:"translateZ(0)",alignItems:"center",justifyContent:"center",position:"relative"}:{transform:"translateZ(0)",alignItems:"center",justifyContent:"center",position:"relative",background:O?"color-mix(in srgb, var(--brand-primary) 8%, transparent)":"transparent",borderRadius:z(),padding:`${Math.max(4,t*.15)}px`,border:O?"1px solid color-mix(in srgb, var(--color-plasma-cyan) 10%, transparent)":"none"},le=e.jsxs(e.Fragment,{children:[!I&&(l==="default"||l==="pure"&&o)&&e.jsx("div",{className:"absolute inset-0 pointer-events-none transition-opacity duration-200",style:{background:`radial-gradient(circle, color-mix(in srgb, ${o||"var(--color-plasma-cyan)"} 6%, transparent) 0%, transparent 70%)`,opacity:o?1:0,transform:`scale(${1+R/t})`,filter:`blur(${Math.max(2,R/4)}px)`,borderRadius:z(),zIndex:-1},ref:ee=>{ee&&T.current&&(T.current._haloNode=ee)}}),s?e.jsx(s,{size:t,color:N,strokeWidth:$,style:{filter:I?o?`drop-shadow(0 0 8px ${o}60)`:`drop-shadow(0 0 4px ${N}40)`:o?`drop-shadow(0 0 12px ${o}80) drop-shadow(0 0 24px ${o}60) drop-shadow(0 0 36px color-mix(in srgb, ${o} 40%, transparent))`:l==="pure"?`drop-shadow(0 0 6px ${N}40)`:"drop-shadow(0 1px 2px rgba(0,0,0,0.2))",transition:I?"none":"color 200ms ease, filter 200ms ease",transform:"translateZ(0)",strokeLinecap:"round",strokeLinejoin:"round",...m}}):e.jsx("span",{style:{fontSize:t,color:N,transform:"none"},children:"⚠️"})]});return I?e.jsx("div",{ref:T,className:P,style:{...ae,...m},onClick:b,onKeyDown:O?F:void 0,role:h||(O?"button":void 0),tabIndex:M,"aria-label":p,"aria-hidden":V,"aria-describedby":f,"data-performance-mode":"static",children:le}):e.jsx(y.div,{ref:T,className:P,style:ae,variants:X,initial:"initial",whileHover:"hover",whileTap:O?A?{scale:.98,transition:{duration:.08,ease:[.16,1,.3,1]}}:{}:{},animate:d,transition:g,onMouseEnter:K,onMouseLeave:Z,onClick:b,onKeyDown:O?F:void 0,role:h||(O?"button":void 0),tabIndex:M,"aria-label":p,"aria-hidden":V,"aria-describedby":f,children:le})},v={Home:qi,Target:Vi,Timer:Ui,Utensils:zi,Activity:Ne,Smile:Wi,Scan:Hi,ScanLine:Li,ScanFace:Pi,ScanBarcode:$i,Barcode:Di,Refrigerator:Bi,Users:Fi,ChefHat:Oi,Archive:Mi,LayoutDashboard:_i,Phone:ki,Menu:Ni,X:Ri,Plus:Ai,PlusCircle:Ti,Minus:Ii,MinusCircle:ji,Edit:Si,Triangle:Ei,Minimize2:Ci,Circle:wi,BarChart3:Fe,BarChart:Fe,List:vi,ListChecks:yi,GitCompare:fi,LineChart:bi,History:Oe,Timeline:Oe,Trash2:xi,Save:gi,Settings:hi,Sliders:mi,Palette:ui,RotateCcw:pi,Dumbbell:di,Mic:ci,MicOff:li,Square:oi,Wrench:ni,User:si,LogIn:ii,LogOut:ri,UserPlus:ai,Check:ti,CheckCircle:Ge,AlertCircle:qe,AlertTriangle:Ce,AlertOctagon:ei,TriangleAlert:Ce,Info:Ve,Loader:we,Loader2:we,ChevronLeft:Qr,ChevronRight:Zr,ChevronDown:Yr,ChevronUp:Kr,ArrowLeft:Xr,ArrowRight:Jr,ArrowDown:Gr,ArrowUp:qr,Heart:Vr,HeartPulse:Ur,Moon:zr,Zap:ke,TrendingUp:Wr,Calendar:Hr,CalendarDays:Lr,CalendarRange:Pr,Clock:$r,Bookmark:Dr,MessageCircle:Br,MessageSquare:Fr,Bell:Or,Mail:Mr,Volume2:_r,Send:kr,Camera:Nr,Image:Rr,ShoppingCart:Ar,Flag:Tr,FileText:Ir,Download:jr,Upload:Sr,PlayCircle:Er,Clapperboard:Cr,PlaySquare:wr,Coffee:vr,Droplet:yr,CookingPot:fr,Wifi:br,WifiOff:xr,Smartphone:gr,Monitor:hr,HelpCircle:mr,Shield:ur,Lock:pr,Globe:dr,Eye:cr,EyeOff:lr,Lightbulb:or,Construction:nr,Search:sr,Star:ir,Copy:rr,RefreshCw:ar,Package:tr,Tag:er,Sparkles:Qa,Filter:Za,Database:Ya,Server:Ka,Ruler:Xa,Scale:Ja,Maximize2:Ga,Calculator:qa,Hammer:Va,Fire:Me,Flame:Me,Wind:Ua,Cloud:za,Sun:Wa,TreePine:Ha,Ban:La,Droplets:Pa,Waves:$a,Radio:Da,PhoneCall:Ba,Apple:Fa,Milk:Oa,Grid3X3:Ma,DollarSign:_a,CreditCard:ka,Coins:Na,Syringe:Ra,Bug:Aa,Stethoscope:Ta,Microscope:Ia,Biohazard:ja,Cigarette:Sa,Wine:Ea,Pill:Ca,Baby:wa,TestTube:va,TestTubes:ya,Play:fa,MapPin:ba,Map:xa,MapPinOff:ga,Building:ha,Box:ma,GripHorizontal:ua,TrendingDown:pa,Watch:da,Bike:ca,Link:la,Link2:oa,Unlink:na,CloudOff:sa,Bluetooth:ia,RectangleHorizontal:ra,Cylinder:aa,Cable:ta,Mountain:ea,TreePalm:_e,Palmtree:_e,TreeDeciduous:Qt,Footprints:Zt,LayoutGrid:Yt,CircleDot:Kt,Weight:Xt,Flower2:Jt,BoxSelect:Gt,Skull:qt,Shuffle:Vt,CheckCircle2:Ut,Armchair:zt,Sprout:Wt,Trophy:Ht,Medal:Lt,Crown:Pt,Award:$t,ThumbsUp:Dt,ThumbsDown:Bt,Pause:Ft,StopCircle:Ot,SkipForward:Mt,Repeat:_t,Hash:kt,Sunrise:Nt,Sunset:Rt,Brain:At,Route:Tt,Gauge:It,Move:jt,Navigation:St,Compass:Et,Radar:Ct,Webhook:wt,FastForward:vt,Rewind:yt,Rocket:ft,Zap2:ke,BarChart2:bt,Activity2:Ne,GitBranch:xt,Layers:gt,Disc:ht,Type:mt,Hourglass:ut,BadgeCheck:pt,Beef:Re,Drumstick:Re,Fish:dt,Wheat:ct,Salad:lt,BatteryCharging:ot,Dna:nt,Atom:st,Bolt:it,XCircle:rt};function ls(){const s=navigator.deviceMemory||4,t=navigator.hardwareConcurrency||4,a=window.innerWidth<768||"ontouchstart"in window,r=window.matchMedia("(hover: hover)").matches;let i="medium";return s>=8&&t>=8?i="ultra":s>=6&&t>=6?i="high":s>=4&&t>=4?i="medium":i="low",{performanceLevel:i,supportsHover:r,isMobile:a,memoryGB:s,cores:t}}function cs(s){const t=s.getBoundingClientRect(),a=Math.max(t.width,t.height);return a<200?"small":a<400?"medium":"large"}function ds(){switch(ls().performanceLevel){case"low":return"low";case"high":case"ultra":return"high";default:return"medium"}}function Je(){const s=window.matchMedia("(hover: hover)").matches,t=window.matchMedia("(pointer: fine)").matches;return s&&t}const se=class se{constructor(){B(this,"performanceLevel");B(this,"supportsHover");B(this,"isMobile");this.performanceLevel=ds(),this.supportsHover=Je(),this.isMobile=window.innerWidth<768||"ontouchstart"in window}static getInstance(){return se.instance||(se.instance=new se),se.instance}getEffectClass(t){if(!this.supportsHover||this.isMobile)return null;const a=cs(t);return`${this.performanceLevel}-${a}`}shouldEnableEffect(){return this.supportsHover&&!this.isMobile}getPerformanceLevel(){return this.performanceLevel}};B(se,"instance");let Ee=se;const ps=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],us="0px 0px -10% 0px",ms=()=>typeof window>"u"?!1:window.matchMedia("(prefers-reduced-motion: reduce)").matches,hs=()=>{if(typeof navigator>"u")return!1;const s=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return s&&s.saveData?!0:(navigator.hardwareConcurrency||4)<4},gs=(s={})=>{const{threshold:t=ps,rootMargin:a=us,enabled:r=!0,intensity:i="medium"}=s,o=C.useRef(null),[l,c]=C.useState({isVisible:!1,scrollProgress:0,centerProximity:0}),m=C.useRef(null),d=C.useRef(0),g=ms(),p=hs(),u=C.useCallback(x=>{const b=x.boundingClientRect,w=window.innerHeight,S=b.top+b.height/2,E=w/2,I=Math.abs(S-E),T=w/2;return Math.max(0,1-I/T)},[]),f=C.useCallback(x=>{const b=performance.now();b-d.current<16||(d.current=b,m.current&&cancelAnimationFrame(m.current),m.current=requestAnimationFrame(()=>{const w=x.isIntersecting,S=x.intersectionRatio,E=u(x);if(c({isVisible:w,scrollProgress:S,centerProximity:E}),o.current){const I=o.current;I.style.setProperty("--scroll-progress",String(S)),I.style.setProperty("--scroll-proximity",String(E));const T=E*S;if(I.style.setProperty("--scroll-tint-intensity",String(T)),!p&&!g){const A=20-E*4;I.style.setProperty("--scroll-blur-amount",`${A}px`);const N=E*.3;I.style.setProperty("--scroll-glow-opacity",String(N))}}}))},[u,p,g]);C.useEffect(()=>{if(!r||g||!o.current)return;const x=o.current,b=new IntersectionObserver(w=>{w.forEach(S=>{f(S)})},{threshold:t,rootMargin:a});return b.observe(x),()=>{m.current&&cancelAnimationFrame(m.current),b.disconnect()}},[r,t,a,f,g]);const h=C.useCallback(()=>{switch(i){case"subtle":return .5;case"intense":return 1.5;default:return 1}},[i]);return{ref:o,state:l,isLowEnd:p,reduceMotion:g,intensityModifier:h()}},fe=()=>typeof window<"u"&&window.matchMedia("(hover: hover) and (pointer: fine)").matches,q=C.forwardRef(({className:s,as:t="div",interactive:a=!0,elevation:r="md",children:i,disabled:o=!1,size:l="base",spotlight:c=!1,sheen:m=!0,scrollReveal:d=!0,scrollRevealIntensity:g="medium",onPointerDown:p,style:u,...f},h)=>{const x=y[t]??y.div,b=Xi(),{glassClick:w}=G(),{isPerformanceMode:S}=J(),E=gs({enabled:d&&!b,intensity:g}),I=C.useRef(null),T=E.ref;C.useEffect(()=>{h&&typeof h=="function"?h(I.current):h&&"current"in h&&(h.current=I.current),T&&(T.current=I.current)},[h,T]);const[A,N]=C.useState(null);C.useEffect(()=>{if(I.current&&Je()){const M=Ee.getInstance().getEffectClass(I.current);N(M)}},[]);const D=M=>{!o&&a&&w(),p?.(M)},$=typeof window<"u"&&window.innerWidth<=768,R=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0),_=!b&&!$&&!R&&!S,X=C.useCallback(M=>{if(!a||!fe()||o||!m||$||R||S)return;const V=M.currentTarget,P=V.getBoundingClientRect(),z=(M.clientX-P.left)/P.width,ae=(M.clientY-P.top)/P.height;V.style.setProperty("--mx",String(z)),V.style.setProperty("--my",String(ae)),V.style.setProperty("--sheen-size","var(--glass-sheen-size)")},[a,o,m,$,R,S]),K=C.useCallback(M=>{if(!a||!fe()||o||!m||$||R||S)return;M.currentTarget.style.setProperty("--sheen-visible","1")},[a,o,m,$,R,S]),Z=C.useCallback(M=>{if(!a||o||!m||$||R||S)return;const V=M.currentTarget;V.style.removeProperty("--sheen-visible"),V.style.removeProperty("--mx"),V.style.removeProperty("--my")},[a,o,m,$,R,S]);a&&fe();const F={sm:"p-3",base:"p-4",lg:"p-6"},O={sm:"glass-elev-sm",md:"glass-elev-md",lg:"glass-elev-lg"};return e.jsxs(x,{ref:I,onMouseMove:X,onMouseEnter:K,onMouseLeave:Z,onPointerDown:D,"data-hover-effect":A,"data-scroll-visible":d?E.state.isVisible:void 0,"data-scroll-active":d?E.state.isVisible:void 0,"data-intensity":d?g:void 0,"data-low-end":d?E.isLowEnd:void 0,whileTap:!o&&!b&&!$&&!R&&!S?{scale:.98,opacity:.95,transition:{duration:.08,ease:"easeOut"}}:{},className:Qi("glass-base glass-card relative will-transform group","rounded-3xl",d&&"glass-card-scroll-reveal",F[l],O[r],a&&"transform-gpu preserve-3d",a&&!o&&"cursor-pointer glass-focus",o&&"opacity-50 cursor-not-allowed","z-0",s),style:{"--spotlight-opacity":c&&!$&&!R?.6:0,"--glass-sheen-size":$||R?"0px":"420px",position:"relative",isolation:"isolate",...u},...t==="button"?{disabled:o}:{},...f,children:[m&&!$&&!R&&!S&&e.jsx("div",{"aria-hidden":!0,className:"glass-sheen pointer-events-none absolute rounded-[inherit] overflow-hidden",style:{inset:"-1px"}}),e.jsx("div",{className:"relative z-10 pointer-events-auto",children:i})]})});q.displayName="GlassCard";const xs=({toast:s,onDismiss:t})=>{const{id:a,type:r,title:i,message:o,duration:l=4e3}=s;k.useEffect(()=>{if(l<=0)return;const d=setTimeout(()=>{t(a)},l);return()=>clearTimeout(d)},[a,l,t]);const c=()=>{switch(r){case"success":return v.Check;case"error":return v.AlertCircle;case"warning":return v.AlertCircle;default:return v.Info}},m=()=>{switch(r){case"success":return"text-green-400 border-green-500/20 bg-green-500/10";case"error":return"text-red-400 border-red-500/20 bg-red-500/10";case"warning":return"text-yellow-400 border-yellow-500/20 bg-yellow-500/10";default:return"text-blue-400 border-blue-500/20 bg-blue-500/10"}};return e.jsx(y.div,{initial:{opacity:0,y:50,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{type:"spring",stiffness:300,damping:30},className:"pointer-events-auto",children:e.jsx(q,{className:`p-4 ${m()} border`,children:e.jsxs("div",{className:"flex items-start gap-3 visionos-grid-sm",children:[e.jsx(j,{Icon:c(),size:20,className:"mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-white text-visionos-body",children:i}),o&&e.jsx("p",{className:"text-white/70 text-sm mt-1 text-visionos-body",children:o})]}),e.jsx("button",{onClick:()=>t(a),className:"p-1 rounded-glass hover:bg-white/10 transition-colors","aria-label":"Fermer la notification",children:e.jsx(j,{Icon:v.X,size:14,className:"text-white/60"})})]})})})},Xe=C.createContext(void 0),Ke=()=>{const s=C.useContext(Xe);if(!s)throw new Error("useToast must be used within ToastProvider");return s},bn=({children:s})=>{const[t,a]=C.useState([]),{success:r,error:i,notif:o}=G(),l=C.useCallback(g=>{try{const p=es(),u={...g,id:p,duration:g.duration??4e3};try{g.type==="success"?r():g.type==="error"?i():o()}catch(f){n.error("TOAST_FEEDBACK_ERROR","Toast feedback audio failed",{toastType:g.type,error:f instanceof Error?f.message:"Unknown error",timestamp:new Date().toISOString()})}a(f=>{try{return[...f.slice(-3),u]}catch(h){return n.error("TOAST_STATE_ERROR","Failed to update toast state",{error:h instanceof Error?h.message:"Unknown error",toastId:p,timestamp:new Date().toISOString()}),f}})}catch(p){n.error("TOAST_PROVIDER_ERROR","Complete toast creation failed",{toastType:g.type,toastTitle:g.title,error:p instanceof Error?p.message:"Unknown error",timestamp:new Date().toISOString()})}},[r,i,o]),c=C.useCallback(g=>{a(p=>p.filter(u=>u.id!==g))},[]),m=C.useCallback(()=>{a([])},[]),d={showToast:l,dismissToast:c,clearAll:m};return e.jsxs(Xe.Provider,{value:d,children:[s,e.jsx("div",{className:"fixed top-4 right-4 space-y-2",style:{zIndex:9999},children:e.jsx(H,{children:t.map(g=>e.jsx(xs,{toast:g,onDismiss:c},g.id))})})]})};function bs(s){switch(s){case"ios":return{title:"Installer TwinForge sur iOS",instructions:["Appuyez sur l'icône Partager en bas de l'écran",`Faites défiler et sélectionnez "Sur l'écran d'accueil"`,'Appuyez sur "Ajouter" pour confirmer'],icon:"Smartphone"};case"android":return{title:"Installer TwinForge sur Android",instructions:['Appuyez sur "Installer" dans la bannière',`Ou utilisez le menu ⋮ > "Installer l'application"`,"Confirmez l'installation"],icon:"Smartphone"};case"desktop":return{title:"Installer TwinForge sur Desktop",instructions:["Cliquez sur l'icône d'installation dans la barre d'adresse",'Ou utilisez le menu ⋮ > "Installer TwinForge"',"Confirmez l'installation"],icon:"Monitor"};default:return{title:"Installer TwinForge",instructions:[`Recherchez l'option "Installer" dans votre navigateur`,"Suivez les instructions de votre appareil","Profitez de l'expérience native"],icon:"Download"}}}const fn=({className:s="",variant:t="card",autoShow:a=!0,onInstallSuccess:r,onDismiss:i})=>{const{isInstallable:o,isInstalled:l,platform:c,canShowPrompt:m,showInstallPrompt:d,dismissInstallPrompt:g}=as(),{success:p,click:u}=G(),{showToast:f}=Ke(),[h,x]=C.useState(!1),[b,w]=C.useState(!1),[S,E]=C.useState(!1);if(l||!o||S&&!a)return null;const I=bs(c),T=async()=>{if(!m){w(!0);return}x(!0);try{n.info("PWA_INSTALL_PROMPT","User initiated installation",{platform:c,variant:t,timestamp:new Date().toISOString()}),await d()?(p(),f({type:"success",title:"Installation réussie !",message:"TwinForge a été ajouté à votre écran d'accueil",duration:4e3}),r?.(),n.info("PWA_INSTALL_PROMPT","Installation completed successfully",{platform:c,timestamp:new Date().toISOString()})):f({type:"info",title:"Installation annulée",message:"Vous pouvez installer TwinForge plus tard depuis le menu du navigateur",duration:3e3})}catch(D){n.error("PWA_INSTALL_PROMPT","Installation failed",{error:D instanceof Error?D.message:"Unknown error",platform:c,timestamp:new Date().toISOString()}),f({type:"error",title:"Erreur d'installation",message:"Impossible d'installer l'application. Réessayez plus tard.",duration:4e3})}finally{x(!1)}},A=()=>{u(),E(!0),g(),i?.(),n.info("PWA_INSTALL_PROMPT","Install prompt dismissed",{platform:c,variant:t,timestamp:new Date().toISOString()})},N=()=>{w(!1)};return t==="banner"?e.jsx(y.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-20 left-4 right-4 z-50 ${s}`,children:e.jsx(q,{className:"p-4",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-primary) 12%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, var(--brand-primary) 25%, transparent)",backdropFilter:"blur(16px) saturate(150%)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"color-mix(in srgb, var(--brand-primary) 20%, transparent)",border:"1px solid color-mix(in srgb, var(--brand-primary) 30%, transparent)"},children:e.jsx(j,{Icon:v.Download,size:18,style:{color:"var(--brand-primary)"}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:"Installer TwinForge"}),e.jsx("p",{className:"text-white/70 text-xs",children:"Accès rapide depuis votre écran d'accueil"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:T,disabled:h,className:"btn-glass--primary px-4 py-2 text-sm",children:h?"Installation...":"Installer"}),e.jsx("button",{onClick:A,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(j,{Icon:v.X,size:14,className:"text-white/60"})})]})]})})}):t==="floating"?e.jsx(y.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:`fixed bottom-24 right-4 z-40 ${s}`,children:e.jsx("button",{onClick:T,disabled:h,className:"w-14 h-14 rounded-full flex items-center justify-center",style:{background:`
              radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
              linear-gradient(135deg, color-mix(in srgb, var(--brand-primary) 80%, transparent), color-mix(in srgb, var(--brand-accent) 60%, transparent))
            `,border:"2px solid color-mix(in srgb, var(--brand-primary) 60%, transparent)",backdropFilter:"blur(16px) saturate(150%)",boxShadow:`
              0 8px 32px rgba(0, 0, 0, 0.25),
              0 0 20px color-mix(in srgb, var(--brand-primary) 20%, transparent)
            `},title:"Installer TwinForge",children:e.jsx(j,{Icon:h?v.Loader2:v.Download,size:20,className:`text-white ${h?"animate-spin":""}`})})}):e.jsxs(e.Fragment,{children:[e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:s,children:e.jsx(q,{className:"p-6",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-primary) 12%, transparent) 0%, transparent 60%),
              radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--brand-accent) 8%, transparent) 0%, transparent 50%),
              var(--glass-opacity)
            `,borderColor:"color-mix(in srgb, var(--brand-primary) 25%, transparent)",boxShadow:`
              0 12px 40px rgba(0, 0, 0, 0.25),
              0 0 30px color-mix(in srgb, var(--brand-primary) 15%, transparent),
              inset 0 2px 0 rgba(255, 255, 255, 0.15)
            `},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                  linear-gradient(135deg, color-mix(in srgb, var(--brand-primary) 30%, transparent), color-mix(in srgb, var(--brand-accent) 25%, transparent))
                `,border:"2px solid color-mix(in srgb, var(--brand-primary) 40%, transparent)",boxShadow:"0 0 20px color-mix(in srgb, var(--brand-primary) 30%, transparent)"},children:e.jsx(j,{Icon:v[I.icon],size:20,style:{color:"var(--brand-primary)"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-bold text-lg mb-2",children:"Installer TwinForge"}),e.jsx("p",{className:"text-white/70 text-sm mb-4 leading-relaxed",children:"Installez TwinForge sur votre appareil pour un accès rapide et une expérience optimisée."}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:T,disabled:h,className:"btn-glass--primary px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[h?e.jsx(j,{Icon:v.Loader2,size:16,className:"animate-spin"}):e.jsx(j,{Icon:v.Download,size:16}),e.jsx("span",{children:h?"Installation...":"Installer"})]})}),e.jsx("button",{onClick:()=>w(!0),className:"btn-glass--secondary-nav px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{Icon:v.Info,size:16}),e.jsx("span",{children:"Instructions"})]})}),e.jsx("button",{onClick:A,className:"btn-glass--secondary-nav px-3 py-2",title:"Fermer",children:e.jsx(j,{Icon:v.X,size:16})})]})]})]})})}),e.jsx(H,{children:b&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)"},onClick:D=>{D.target===D.currentTarget&&N()},children:e.jsx(y.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30},className:"w-full max-w-md",onClick:D=>D.stopPropagation(),children:e.jsxs(q,{className:"p-6",style:{background:`
                    radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-accent) 12%, transparent) 0%, transparent 60%),
                    var(--glass-opacity)
                  `,borderColor:"color-mix(in srgb, var(--brand-accent) 30%, transparent)",backdropFilter:"blur(24px) saturate(160%)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center",style:{background:`
                        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                        linear-gradient(135deg, color-mix(in srgb, var(--brand-accent) 35%, transparent), color-mix(in srgb, var(--brand-accent) 25%, transparent))
                      `,border:"2px solid color-mix(in srgb, var(--brand-accent) 50%, transparent)",boxShadow:"0 0 30px color-mix(in srgb, var(--brand-accent) 40%, transparent)"},children:e.jsx(j,{Icon:v[I.icon],size:28,style:{color:"var(--brand-accent)"}})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-3",children:I.title}),e.jsxs("p",{className:"text-white/70 text-sm",children:["Suivez ces étapes pour installer TwinForge sur votre ",c==="ios"?"iPhone/iPad":c==="android"?"appareil Android":"ordinateur"]})]}),e.jsx("div",{className:"space-y-4 mb-6",children:I.instructions.map((D,$)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:"color-mix(in srgb, var(--brand-accent) 20%, transparent)",border:"1px solid color-mix(in srgb, var(--brand-accent) 30%, transparent)",color:"var(--brand-accent)",fontSize:"12px",fontWeight:"bold"},children:$+1}),e.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:D})]},$))}),e.jsxs("div",{className:"flex gap-3",children:[m&&e.jsx("button",{onClick:T,disabled:h,className:"flex-1 btn-glass--primary py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[h?e.jsx(j,{Icon:v.Loader2,size:16,className:"animate-spin"}):e.jsx(j,{Icon:v.Download,size:16}),e.jsx("span",{children:h?"Installation...":"Installer Maintenant"})]})}),e.jsx("button",{onClick:N,className:"btn-glass--secondary-nav px-4 py-3",children:e.jsx("span",{children:"Fermer"})})]})]})})})})]})},yn=({isVisible:s,onUpdate:t,onDismiss:a,updateInfo:r})=>{const{success:i,click:o}=G(),[l,c]=C.useState(!1),m=async()=>{c(!0);try{n.info("PWA_UPDATE","User initiated app update",{version:r?.version,isRequired:r?.isRequired,timestamp:new Date().toISOString()}),i(),await t(),n.info("PWA_UPDATE","App update completed",{timestamp:new Date().toISOString()})}catch(g){n.error("PWA_UPDATE","App update failed",{error:g instanceof Error?g.message:"Unknown error",timestamp:new Date().toISOString()})}finally{c(!1)}},d=()=>{o(),a(),n.info("PWA_UPDATE","Update notification dismissed",{version:r?.version,timestamp:new Date().toISOString()})};return e.jsx(H,{children:s&&e.jsx(y.div,{initial:{opacity:0,y:50,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:50,scale:.95},className:"fixed bottom-4 left-4 right-4 z-50 max-w-md mx-auto",children:e.jsx(q,{className:"p-5",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-accent) 15%, transparent) 0%, transparent 60%),
                radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--brand-primary) 10%, transparent) 0%, transparent 50%),
                var(--glass-opacity)
              `,borderColor:"color-mix(in srgb, var(--brand-accent) 35%, transparent)",boxShadow:`
                0 16px 48px rgba(0, 0, 0, 0.3),
                0 0 40px color-mix(in srgb, var(--brand-accent) 25%, transparent),
                inset 0 2px 0 rgba(255, 255, 255, 0.2)
              `,backdropFilter:"blur(24px) saturate(170%)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, var(--brand-accent) 40%, transparent), color-mix(in srgb, var(--brand-accent) 30%, transparent))
                  `,border:"2px solid color-mix(in srgb, var(--brand-accent) 50%, transparent)",boxShadow:"0 0 25px color-mix(in srgb, var(--brand-accent) 40%, transparent)"},children:e.jsx(y.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(j,{Icon:v.Download,size:20,style:{color:"var(--brand-accent)"}})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-bold text-lg mb-2",children:"Nouvelle Version Disponible"}),e.jsx("p",{className:"text-white/80 text-sm mb-3 leading-relaxed",children:"Une mise à jour de TwinForge est disponible avec de nouvelles fonctionnalités et améliorations."}),r?.features&&r.features.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-white/60 text-xs mb-2",children:"Nouveautés :"}),e.jsx("div",{className:"space-y-1",children:r.features.slice(0,3).map((g,p)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-cyan-400"}),e.jsx("span",{className:"text-white/70 text-xs",children:g})]},p))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:m,disabled:l,className:"btn-glass--primary px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(j,{Icon:v.Loader2,size:14,className:"animate-spin"}):e.jsx(j,{Icon:v.Download,size:14}),e.jsx("span",{children:l?"Mise à jour...":"Mettre à jour"})]})}),!r?.isRequired&&e.jsx("button",{onClick:d,className:"btn-glass--secondary-nav px-3 py-2 text-sm",children:"Plus tard"})]})]})]})})})})},fs={inventory:{colors:{primary:"#06B6D4",secondary:"#0891B2",glow:"rgba(6, 182, 212, 0.4)"},icon:"Package",defaultTitle:"Analyse de votre inventaire",defaultSubtitle:"Traitement des données en cours..."},recipes:{colors:{primary:"#EC4899",secondary:"#F472B6",glow:"rgba(236, 72, 153, 0.4)"},icon:"ChefHat",defaultTitle:"Création de recettes",defaultSubtitle:"La Forge Spatiale travaille..."},plan:{colors:{primary:"#8B5CF6",secondary:"#A78BFA",glow:"rgba(139, 92, 246, 0.4)"},icon:"Calendar",defaultTitle:"Génération du plan hebdomadaire",defaultSubtitle:"Optimisation nutritionnelle en cours..."},shopping:{colors:{primary:"#10B981",secondary:"#34D399",glow:"rgba(16, 185, 129, 0.4)"},icon:"ShoppingCart",defaultTitle:"Génération de la liste de courses",defaultSubtitle:"Organisation des achats..."},training:{colors:{primary:"#10B981",secondary:"#34D399",glow:"rgba(16, 185, 129, 0.4)"},icon:"Activity",defaultTitle:"Ton Coach Prépare Ton Plan...",defaultSubtitle:"Analyse de tes capacités et génération d'un programme personnalisé"},default:{colors:{primary:"#60A5FA",secondary:"#93C5FD",glow:"rgba(96, 165, 250, 0.4)"},icon:"Sparkles",defaultTitle:"Chargement",defaultSubtitle:"Traitement en cours..."}},vn=({variant:s="default",title:t,subtitle:a,progress:r,showProgressBar:i=!0,showSteps:o=!1,onCancel:l,showCancelButton:c=!1,elapsedTime:m=0,customColor:d})=>{const g=fs[s],p=v[g.icon],u=d||g.colors.primary,f=d?`color-mix(in srgb, ${d} 80%, white)`:g.colors.secondary,h=d?`color-mix(in srgb, ${d} 40%, transparent)`:g.colors.glow,x=w=>{const S=Math.floor(w/60),E=w%60;return S>0?`${S}m ${E}s`:`${E}s`},b=(()=>{if(r==null)return 0;const w=Number(r);return isNaN(w)?0:Math.max(0,Math.min(100,w))})();return e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},className:"loader-optimized",children:e.jsxs(q,{className:"p-8 text-center relative loader-isolate",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${u} 15%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, ${f} 10%, transparent) 0%, transparent 60%),
            rgba(255, 255, 255, 0.06)
          `,borderColor:`color-mix(in srgb, ${u} 30%, transparent)`,backdropFilter:"blur(24px) saturate(180%)",boxShadow:`
            0 12px 48px rgba(0, 0, 0, 0.3),
            0 0 40px color-mix(in srgb, ${u} 20%, transparent),
            0 0 80px color-mix(in srgb, ${u} 10%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.2),
            inset 0 -2px 0 rgba(0, 0, 0, 0.1)
          `,borderRadius:"1.5rem",overflow:"hidden"},children:[[...Array(12)].map((w,S)=>e.jsx("div",{className:"loader-particle",style:{color:S%3===0?f:u,top:`${15+Math.random()*70}%`,left:`${5+S*8}%`,"--tx":`${(Math.random()-.5)*120}px`,"--ty":`${-60-Math.random()*120}px`,"--duration":`${3.5+Math.random()*2.5}s`,"--delay":`${S*.25}s`,width:S%4===0?"6px":"4px",height:S%4===0?"6px":"4px"}},S)),e.jsxs("div",{className:"space-y-6 relative z-10",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(y.div,{className:"w-32 h-32 rounded-full flex items-center justify-center loader-breathing-border",style:{background:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3) 0%, transparent 60%),
                  radial-gradient(circle at 70% 70%, color-mix(in srgb, ${f} 15%, transparent) 0%, transparent 70%),
                  linear-gradient(135deg, color-mix(in srgb, ${u} 45%, transparent), color-mix(in srgb, ${u} 30%, transparent))
                `,border:`3px solid color-mix(in srgb, ${u} 70%, transparent)`,color:u,boxShadow:`
                  0 0 50px ${h},
                  0 0 25px ${h},
                  0 0 80px color-mix(in srgb, ${u} 20%, transparent),
                  inset 0 0 25px color-mix(in srgb, ${u} 18%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.3)
                `},animate:{scale:[1,1.08,1],rotate:[0,180,360],boxShadow:[`0 0 50px ${h}, 0 0 25px ${h}, 0 0 80px color-mix(in srgb, ${u} 20%, transparent), inset 0 0 25px color-mix(in srgb, ${u} 18%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.3)`,`0 0 70px ${h}, 0 0 35px ${h}, 0 0 100px color-mix(in srgb, ${u} 30%, transparent), inset 0 0 35px color-mix(in srgb, ${u} 28%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.4)`,`0 0 50px ${h}, 0 0 25px ${h}, 0 0 80px color-mix(in srgb, ${u} 20%, transparent), inset 0 0 25px color-mix(in srgb, ${u} 18%, transparent), inset 0 2px 0 rgba(255, 255, 255, 0.3)`]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},children:e.jsx(j,{Icon:p,size:64,className:"text-white loader-icon-pulse",motionAnimate:{scale:[1,1.1,1]},motionTransition:{repeat:1/0,duration:2,ease:"easeInOut"},style:{filter:`drop-shadow(0 0 16px ${h}) drop-shadow(0 0 8px white)`}})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y.h3,{className:"text-2xl font-bold text-white",style:{textShadow:`0 0 24px ${h}, 0 0 48px color-mix(in srgb, ${u} 35%, transparent), 0 2px 4px rgba(0, 0, 0, 0.3)`},animate:{opacity:[.95,1,.95]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},children:t||g.defaultTitle}),e.jsx(y.p,{className:"text-white/85 text-lg",style:{textShadow:`0 0 12px color-mix(in srgb, ${f} 35%, transparent), 0 1px 2px rgba(0, 0, 0, 0.2)`},animate:{opacity:[.9,1,.9]},transition:{duration:2,repeat:1/0,ease:"easeInOut",delay:.3},children:a||g.defaultSubtitle})]}),e.jsx("div",{className:"flex justify-center gap-2",children:[0,1,2].map(w=>e.jsx("div",{className:"w-3 h-3 bg-white/80 rounded-full loader-dot",style:{"--delay":`${w*.2}s`}},w))}),i&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-4xl font-bold text-white",style:{textShadow:`0 0 20px ${h}`},children:[Math.round(b),"%"]})}),e.jsx("div",{className:"w-full max-w-xs mx-auto h-2 bg-white/10 rounded-full overflow-hidden relative",children:e.jsx(y.div,{className:"h-full rounded-full relative",style:{background:`linear-gradient(90deg, ${u}, ${f})`,width:`${b}%`,boxShadow:`0 0 12px ${h}`},initial:{width:0},animate:{width:`${b}%`},transition:{duration:.4,ease:"easeOut"},children:b<95&&e.jsx("div",{className:"loader-progress-shimmer"})})})]}),m>0&&e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-white/60 text-sm",children:["Temps écoulé: ",x(m)]}),c&&l&&e.jsx(y.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},onClick:l,className:"mt-4 px-6 py-2.5 rounded-xl text-white/80 text-sm font-medium transition-all",style:{background:"rgba(255, 255, 255, 0.08)",border:"2px solid rgba(255, 255, 255, 0.15)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)"},whileHover:{background:"rgba(255, 255, 255, 0.12)",scale:1.02,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)"},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx(j,{Icon:v.X,size:16}),e.jsx("span",{children:"Annuler"})]})})]})]})})},de=({to:s,children:t,prefetch:a=!0,className:r="",onMouseEnter:i,onPointerDown:o,...l})=>{k.useEffect(()=>{n.trace("LINK","Component rendered for route",{to:s,prefetch:a})},[s,a]),Gi();const{session:c}=ne(),{click:m}=G();oe();const d=async u=>{i?.(u)},g=u=>{if(n.trace("LINK","PointerDown captured for route",{to:s,eventType:u.type}),n.trace("LINK","PointerDown event triggered",{to:s,isSidebarLink:!!u.currentTarget.closest(".sidebar-item")}),u.currentTarget.closest(".sidebar.item")){const{sidebarClick:h}=G();n.trace("LINK","Triggering sidebar click sound"),h()}else n.trace("LINK","Triggering regular click sound"),m();o?.(u)},p=u=>{if(n.trace("LINK","Click captured",{to:s,eventType:u.type}),n.trace("LINK","Click event triggered",{to:s,currentPath:window.location.pathname,defaultPrevented:u.defaultPrevented}),u.defaultPrevented){n.debug("🔍 [Link] Navigation blocked by router guard, respecting block");return}n.trace("LINK","Proceeding with navigation to",{to:s})};return k.useEffect(()=>(n.trace("LINK","Component mounted for route",{to:s}),()=>{n.trace("LINK","Component unmounted for route",{to:s})}),[s]),e.jsx(Ji,{to:s,className:`${r} inline-flex items-center`,onMouseEnter:d,onPointerDown:g,onClick:p,onMouseDown:u=>{n.trace("LINK","MouseDown captured",{to:s,button:u.button})},onTouchStart:u=>{n.trace("LINK","TouchStart captured",{to:s,touches:u.touches.length})},...l,children:t})};function ys(){return[{title:"",type:"primary",items:[{to:"/",icon:"Home",label:"Coeur de la Forge",subtitle:"Tableau de Bord",isPrimary:!0,circuitColor:"#FDC830",actionLabel:void 0}]},{title:"",type:"twin",items:[{to:"/avatar",icon:"User",label:"Mon Twin",subtitle:"Avatar 3D",isTwin:!0,circuitColor:"#A855F7",tabs:["Scanner","Avatar","Projection","Insights","Historique"]}]},{title:"Alimentation",type:"forge-category",items:[{to:"/meals",icon:"Utensils",label:"Forge Nutritionnelle",subtitle:"Scanner de Repas",isForge:!0,circuitColor:"#10B981",tabs:["Scanner","Insights","Progression","Historique"],subItems:[{to:"/meals#daily",icon:"ScanLine",label:"Scanner de Repas & Code",isPrimarySubMenu:!0},{to:"/meals#insights",icon:"TrendingUp",label:"Insights"},{to:"/meals#progression",icon:"BarChart3",label:"Progression"},{to:"/meals#history",icon:"History",label:"Historique"}]},{to:"/fridge",icon:"ChefHat",label:"Forge Culinaire",subtitle:"Scanner de Frigo",isForge:!0,circuitColor:"#EC4899",tabs:["Scanner","Inventaire","Recettes","Plan","Courses"],subItems:[{to:"/fridge#scanner",icon:"ScanLine",label:"Scanner de Frigo",isPrimarySubMenu:!0},{to:"/fridge#inventaire",icon:"Refrigerator",label:"Inventaire"},{to:"/fridge#recipes",icon:"ChefHat",label:"Recettes"},{to:"/fridge#plan",icon:"Calendar",label:"Plan"},{to:"/fridge#courses",icon:"ShoppingCart",label:"Courses"}]}]},{title:"Activité",type:"forge-category",items:[{to:"/activity",icon:"Activity",label:"Forge Énergétique",subtitle:"Tracker d'Activités",isForge:!0,circuitColor:"#3B82F6",tabs:["Tracker","Insights","Progression","Historique"],subItems:[{to:"/activity#daily",icon:"Activity",label:"Tracker d'Activités",isPrimarySubMenu:!0},{to:"/activity#insights",icon:"BarChart3",label:"Insights",color:"#10B981"},{to:"/activity#progression",icon:"TrendingUp",label:"Progression",color:"#10B981"},{to:"/activity#history",icon:"History",label:"Historique"}]},{to:"/training",icon:"Dumbbell",label:"Forge Corporelle",subtitle:"Coaching live",isForge:!0,circuitColor:"#18E3FF",tabs:["Coaching","Conseils","Progression","Records","Historique"],subItems:[{to:"/training#aujourd hui",icon:"Home",label:"Coaching Live",isPrimarySubMenu:!0},{to:"/training#conseils",icon:"Lightbulb",label:"Conseils"},{to:"/training#progression",icon:"TrendingUp",label:"Progression"},{to:"/training#records",icon:"Trophy",label:"Records"},{to:"/training#historique",icon:"History",label:"Historique"}]}]},{title:"Santé",type:"forge-category",items:[{to:"/fasting",icon:"Timer",label:"Forge du Temps",subtitle:"Jeûne Intermittent",isForge:!0,circuitColor:"#F59E0B",tabs:["Tracker","Insights","Progression","Historique"],subItems:[{to:"/fasting#daily",icon:"Timer",label:"Tracker de Jeûne",isPrimarySubMenu:!0},{to:"/fasting#insights",icon:"TrendingUp",label:"Insights",color:"#10B981"},{to:"/fasting#progression",icon:"BarChart3",label:"Progression"},{to:"/fasting#history",icon:"History",label:"Historique"}]},{to:"/vital",icon:"HeartPulse",label:"Forge Vitale",subtitle:"Médecine Préventive",isForge:!0,circuitColor:"#EF4444",tabs:["Dossier","Analyses","Suivi","Prévention"],subItems:[{to:"/vital#dossier",icon:"FileText",label:"Dossier",isPrimarySubMenu:!0},{to:"/vital#analyses",icon:"Activity",label:"Analyses"},{to:"/vital#suivi",icon:"TrendingUp",label:"Suivi"},{to:"/vital#prevention",icon:"Shield",label:"Prévention"}]}]}]}const vs=({size:s=32,variant:t="normal",className:a="",withGlow:r=!0,customColor:i})=>{const l=(()=>{if(i){const p=(u=>{const f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(u);return f?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)}:{r:255,g:107,b:53}})(i);return{gradientStart:i,gradientMid:i,gradientEnd:i,borderColor:`rgba(${p.r}, ${p.g}, ${p.b}, 0.5)`,glowColor:`rgba(${p.r}, ${p.g}, ${p.b}, 0.4)`}}switch(t){case"critical":return{gradientStart:"#EF4444",gradientMid:"#F87171",gradientEnd:"#FCA5A5",borderColor:"rgba(239, 68, 68, 0.5)",glowColor:"rgba(239, 68, 68, 0.4)"};case"warning":return{gradientStart:"#F59E0B",gradientMid:"#FBBF24",gradientEnd:"#FCD34D",borderColor:"rgba(245, 158, 11, 0.5)",glowColor:"rgba(245, 158, 11, 0.4)"};case"success":return{gradientStart:"#10B981",gradientMid:"#34D399",gradientEnd:"#6EE7B7",borderColor:"rgba(16, 185, 129, 0.5)",glowColor:"rgba(16, 185, 129, 0.4)"};default:return{gradientStart:"#FF6B35",gradientMid:"#F7931E",gradientEnd:"#FDC830",borderColor:"rgba(247, 147, 30, 0.5)",glowColor:"rgba(253, 200, 48, 0.4)"}}})(),c=100,m=c/2,d=42;return e.jsxs("svg",{width:s,height:s,viewBox:`0 0 ${c} ${c}`,xmlns:"http://www.w3.org/2000/svg",className:a,style:{filter:r?`drop-shadow(0 0 ${s/4}px ${l.glowColor})`:"none"},children:[e.jsxs("defs",{children:[e.jsx("style",{children:`
            @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@800&display=swap');
            .token-text {
              font-family: 'Montserrat', sans-serif;
              font-weight: 800;
              font-style: normal;
              text-anchor: middle;
              dominant-baseline: central;
            }
          `}),e.jsxs("linearGradient",{id:`tokenGradient-${t}-${i||"default"}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:l.gradientStart}),e.jsx("stop",{offset:"50%",stopColor:l.gradientMid}),e.jsx("stop",{offset:"100%",stopColor:l.gradientEnd})]}),e.jsxs("linearGradient",{id:`borderGradient-${t}-${i||"default"}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:l.gradientStart,stopOpacity:"0.8"}),e.jsx("stop",{offset:"50%",stopColor:l.gradientMid,stopOpacity:"0.9"}),e.jsx("stop",{offset:"100%",stopColor:l.gradientEnd,stopOpacity:"0.8"})]}),e.jsxs("filter",{id:`innerGlow-${t}-${i||"default"}`,children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("radialGradient",{id:`shine-${t}-${i||"default"}`,cx:"30%",cy:"30%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(255, 255, 255, 0.3)"}),e.jsx("stop",{offset:"60%",stopColor:"rgba(255, 255, 255, 0.1)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(255, 255, 255, 0)"})]})]}),e.jsx("circle",{cx:m,cy:m,r:d,fill:`url(#shine-${t}-${i||"default"})`,opacity:"0.6"}),e.jsx("circle",{cx:m,cy:m,r:d,fill:"rgba(0, 0, 0, 0.25)",stroke:`url(#borderGradient-${t}-${i||"default"})`,strokeWidth:"3",filter:`url(#innerGlow-${t}-${i||"default"})`}),e.jsx("text",{x:m,y:m+2,className:"token-text",fontSize:"48",fill:`url(#tokenGradient-${t}-${i||"default"})`,filter:`url(#innerGlow-${t}-${i||"default"})`,children:"T"})]})};class ye{static async getTokenBalance(){try{const{data:{user:t}}=await L.auth.getUser();if(!t)return null;const{data:a,error:r}=await L.from("user_token_balance").select("available_tokens, last_monthly_reset").eq("user_id",t.id).single();return r?(console.error("Error fetching token balance:",r),null):{balance:a.available_tokens,lastResetAt:a.last_monthly_reset}}catch(t){return console.error("Unexpected error fetching token balance:",t),null}}static async getTokenTransactions(t=50){try{const{data:{user:a}}=await L.auth.getUser();if(!a)return[];const{data:r,error:i}=await L.from("token_transactions").select("*").eq("user_id",a.id).order("created_at",{ascending:!1}).limit(t);return i?(console.error("Error fetching token transactions:",i),[]):r.map(o=>({id:o.id,userId:o.user_id,transactionType:o.transaction_type,amount:o.token_amount,balanceAfter:o.balance_after,source:o.metadata?.source||null,edgeFunctionName:o.edge_function_name,operationType:o.operation_type,openaiModel:o.openai_model_used,openaiInputTokens:o.openai_tokens_input,openaiOutputTokens:o.openai_tokens_output,openaiCostUsd:o.openai_cost_usd,metadata:o.metadata,createdAt:o.created_at}))}catch(a){return console.error("Unexpected error fetching token transactions:",a),[]}}static async getPricingConfig(){try{const{data:t,error:a}=await L.from("token_pricing_config").select("subscription_plans, token_packs").eq("is_active",!0).single();return a?(console.error("Error fetching pricing config:",a),null):{subscriptionPlans:t.subscription_plans,tokenPacks:t.token_packs}}catch(t){return console.error("Unexpected error fetching pricing config:",t),null}}static async getUserSubscription(){try{const{data:{user:t}}=await L.auth.getUser();if(!t)return null;const{data:a,error:r}=await L.from("user_subscriptions").select("*").eq("user_id",t.id).single();return r?(r.code==="PGRST116"||console.error("Error fetching user subscription:",r),null):{id:a.id,userId:a.user_id,status:a.status,planType:a.plan_type,stripeCustomerId:a.stripe_customer_id,stripeSubscriptionId:a.stripe_subscription_id,currentPeriodStart:a.current_period_start,currentPeriodEnd:a.current_period_end,cancelAtPeriodEnd:a.cancel_at_period_end,createdAt:a.created_at,updatedAt:a.updated_at}}catch(t){return console.error("Unexpected error fetching user subscription:",t),null}}static async createCheckoutSession(t,a,r){try{const{data:{session:i}}=await L.auth.getSession();if(!i)throw new Error("Not authenticated");const o=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/create-checkout-session",{method:"POST",headers:{Authorization:`Bearer ${i.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({mode:t,plan_type:a,token_pack_id:r,success_url:`${window.location.origin}/settings?tab=subscription&success=true`,cancel_url:`${window.location.origin}/settings?tab=subscription&canceled=true`})});if(!o.ok){const c=await o.json();return console.error("Error creating checkout session:",c),null}return{url:(await o.json()).url}}catch(i){return console.error("Unexpected error creating checkout session:",i),null}}static async createPortalSession(){try{const{data:{session:t}}=await L.auth.getSession();if(!t)throw new Error("Not authenticated");const a=await fetch("https://kwipydbtjagypocpvbwn.supabase.co/functions/v1/create-portal-session",{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({return_url:`${window.location.origin}/settings?tab=subscription`})});if(!a.ok){const i=await a.json();return console.error("Error creating portal session:",i),null}return{url:(await a.json()).url}}catch(t){return console.error("Unexpected error creating portal session:",t),null}}static formatTokenAmount(t){return t==null||isNaN(t)?"0":t>=1e3?`${(t/1e3).toFixed(1)}k`:t.toString()}static formatCurrency(t){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(t)}static getOperationTypeLabel(t){return{"chat-completion":"Assistant conversationnel","image-generation":"Génération d'illustration","audio-transcription":"Transcription audio","voice-realtime":"Coach vocal en temps réel","body-scan-analysis":"Analyse corporelle","meal-analysis":"Analyse nutritionnelle","training-analysis":"Analyse d'entraînement","recipe-generation":"Génération de recette","insight-generation":"Génération d'insights"}[t]||t}static subscribeToPricingConfig(t){const a=L.channel("pricing-config-changes").on("postgres_changes",{event:"*",schema:"public",table:"token_pricing_config"},async()=>{const r=await this.getPricingConfig();t(r)}).subscribe();return()=>{L.removeChannel(a)}}static subscribeToTokenBalance(t,a){const r=L.channel(`token-balance-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"user_token_balance",filter:`user_id=eq.${t}`},async()=>{const i=await this.getTokenBalance();a(i)}).subscribe();return()=>{L.removeChannel(r)}}}const ws=()=>{const[s,t]=C.useState(null),[a,r]=C.useState(!0),i=oe(),{sidebarClick:o}=G(),{close:l}=ge();C.useEffect(()=>{c();const h=ye.subscribeToTokenBalance("",x=>{t(x)});return()=>{h()}},[]);const c=async()=>{try{const h=await ye.getTokenBalance();t(h)}catch(h){console.error("Error loading token balance:",h)}finally{r(!1)}},m=()=>{o(),l(),i("/settings?tab=account")};if(a||!s)return null;const g=s.balance<50?"critical":s.balance<200?"warning":"success",p=s.balance<200,u=s.balance<50,f=()=>{const h="sidebar-token-widget";return u?`${h} sidebar-token-widget--critical`:p?`${h} sidebar-token-widget--low`:h};return e.jsx("button",{onClick:m,className:f(),children:e.jsxs("div",{className:"sidebar-token-widget-content",children:[e.jsx("div",{className:"sidebar-token-widget-icon",children:e.jsx(vs,{size:24,variant:g,withGlow:p})}),e.jsxs("div",{className:"sidebar-token-widget-info",children:[e.jsx("div",{className:"sidebar-token-widget-balance",children:ye.formatTokenAmount(s.balance)}),e.jsx("div",{className:"sidebar-token-widget-label",children:p?"Recharger mes tokens":"Tokens disponibles"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[p&&e.jsx("div",{className:"sidebar-token-widget-alert",children:e.jsx(j,{Icon:v.AlertCircle,size:12,className:"opacity-70",style:{color:u?"#EF4444":"#F59E0B"}})}),e.jsx("div",{className:"sidebar-token-widget-arrow",children:e.jsx(j,{Icon:v.ChevronRight,size:12,className:"opacity-40"})})]})]})})},Ye=k.memo(({title:s,children:t,type:a})=>{const r=a==="forge-category",i=s==="Alimentation"||s==="Activité"||s==="Santé";return e.jsxs("div",{className:r?"mt-4":"",children:[s&&e.jsxs(e.Fragment,{children:[i&&e.jsx("div",{className:"sidebar-category-separator"}),e.jsx("h3",{className:"sidebar-section-title text-white/50 text-xs uppercase tracking-wider font-semibold mb-1 px-1",children:s})]}),e.jsx("div",{className:"space-y-0.5",children:t})]})});Ye.displayName="Section";const Cs=k.memo(()=>{const{isOpen:s,close:t}=ge(),a=s("mobileDrawer"),r=ue(),i=oe(),o=k.useRef(null),{profile:l}=ne(),[c,m]=k.useState({}),d=C.useCallback(f=>r.pathname===f,[r.pathname]);C.useEffect(()=>{if(a){const f=document.body.style.overflow,h=document.body.style.position;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",()=>{document.body.style.overflow=f,document.body.style.position=h,document.body.style.width="",document.body.style.height=""}}},[a]);const g=C.useMemo(()=>ys(),[]);k.useEffect(()=>{const f=r.pathname,h={};g.forEach(x=>{x.items.forEach(b=>{b.subItems&&b.subItems.length>0&&(b.subItems.some(S=>{const E=S.to.split("#")[0];return f===E})?h[b.to]=!0:h[b.to]=!1)})}),m(h)},[r.pathname,g]);const p=C.useCallback(f=>{m(h=>{if(h[f])return{...h,[f]:!1};const b={};return Object.keys(h).forEach(w=>{b[w]=!1}),b[f]=!0,b})},[]),u=C.useCallback(async()=>{try{await L.auth.signOut(),ne.getState().setSession(null),ne.getState().setProfile(null),t(),i("/",{replace:!0})}catch(f){console.error("Logout error:",f),t(),i("/",{replace:!0})}},[i,t]);return e.jsx(H,{children:a&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",style:{zIndex:xe.BACKDROP},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:()=>{n.debug("MOBILE_DRAWER","Backdrop clicked - closing drawer"),t()}}),e.jsx(y.nav,{ref:o,className:"mobile-drawer fixed top-0 left-0 h-full w-[85vw] max-w-[340px] overflow-y-auto",style:{zIndex:xe.MOBILE_DRAWER,scrollbarWidth:"none",msOverflowStyle:"none"},initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:300,damping:30},role:"navigation","aria-label":"Navigation mobile",children:e.jsxs("div",{className:"py-3 pl-3 pr-2.5 space-y-2",children:[g.map((f,h)=>e.jsxs(k.Fragment,{children:[e.jsx(Ye,{title:f.title,type:f.type,children:f.items.map(x=>{const b=x.subItems&&x.subItems.length>0,w=b&&x.subItems.some(E=>{const I=E.to.split("#")[0],T=E.to.split("#")[1],A=r.pathname,N=r.hash.replace("#","")||"daily";return A===I&&(!T||N===T)}),S=E=>{b?(E.preventDefault(),p(x.to)):t()};return e.jsxs("div",{className:"relative sidebar-nav-item-container",children:[e.jsxs(de,{to:x.to,className:`
                            sidebar-item
                            ${x.isPrimary?"sidebar-item--primary":""}
                            ${x.isTwin?"sidebar-item--twin":""}
                            ${x.isForge?"sidebar-item--forge":""}
                            ${b?"sidebar-item--with-submenu":""}
                            group focus-ring
                            ${d(x.to)||w?"text-white shadow-sm":"text-white/70 hover:text-white"}
                          `,onClick:S,style:{"--item-circuit-color":x.circuitColor},children:[e.jsx("div",{className:`sidebar-item-icon-container ${d(x.to)||w?"sidebar-item-icon-container--active":""}`,children:e.jsx(j,{Icon:v[x.icon],size:16,className:`sidebar-item-icon ${d(x.to)||w?"":"opacity-80 group-hover:opacity-100"}`,color:d(x.to)||w?x.circuitColor:void 0,style:d(x.to)||w?{color:x.circuitColor,filter:`drop-shadow(0 0 8px ${x.circuitColor}60)`}:void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`sidebar-item-label font-medium text-xs truncate ${d(x.to)||w?"text-white":"text-white/82"}`,children:x.label}),e.jsx("div",{className:`sidebar-item-subtitle text-xxs truncate mt-0 ${d(x.to)||w?"text-white/70":"text-white/50"}`,children:x.subtitle})]})]}),b&&e.jsx("div",{className:`sidebar-submenu ${c[x.to]?"sidebar-submenu--expanded":""}`,role:"group","aria-label":`Sous-menu ${x.label}`,children:e.jsx("div",{className:"sidebar-submenu-inner",children:x.subItems.map(E=>{const I=v[E.icon],T=E.to.split("#")[0],A=E.to.split("#")[1],N=r.pathname,D=r.hash.replace("#","")||"daily",$=N===T&&(!A||D===A),R=E.isPrimarySubMenu&&N===T;return e.jsxs(de,{to:E.to,className:`
                                      sidebar-submenu-item
                                      ${E.isPrimarySubMenu?"sidebar-submenu-item--primary":"sidebar-submenu-item--secondary"}
                                      ${$||R?"sidebar-submenu-item--active":""}
                                      focus-ring
                                    `,onClick:()=>t(),"aria-current":$?"page":void 0,style:{"--item-circuit-color":E.color||x.circuitColor},children:[e.jsx("div",{className:`sidebar-submenu-item-icon-container ${$||R?"sidebar-submenu-item-icon-container--active":""}`,children:e.jsx(j,{Icon:I,size:E.isPrimarySubMenu?16:14,className:"sidebar-submenu-item-icon"})}),e.jsx("span",{className:"sidebar-submenu-item-label",children:E.label})]},E.to)})})})]},x.to)})}),f.type==="primary"&&e.jsx("div",{className:"sidebar-primary-separator","aria-hidden":"true"})]},h)),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"sidebar-category-separator mb-3"}),e.jsx("div",{className:"px-1.5 mb-1.5",children:e.jsx("h3",{className:"text-white/50 text-xs uppercase tracking-wider font-semibold",children:"Compte"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"mb-2 px-0.5",children:e.jsx(ws,{})}),e.jsxs(de,{to:"/profile",className:`
                      sidebar-item group focus-ring
                      ${d("/profile")?"text-white shadow-sm":"text-white/70 hover:text-white"}
                    `,onClick:()=>t(),style:{"--item-circuit-color":"#FDC830"},children:[e.jsx("div",{className:`sidebar-item-icon-container ${d("/profile")?"sidebar-item-icon-container--active":""}`,children:e.jsx(j,{Icon:v.User,size:16,className:`sidebar-item-icon ${d("/profile")?"":"opacity-80 group-hover:opacity-100"}`,style:d("/profile")?{color:"#FDC830",filter:"drop-shadow(0 0 8px rgba(253, 200, 48, 0.6))"}:void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`sidebar-item-label font-medium text-xs truncate ${d("/profile")?"text-white":"text-white/82"}`,children:"Mon Profil"}),e.jsx("div",{className:`sidebar-item-subtitle text-xxs truncate mt-0 ${d("/profile")?"text-white/70":"text-white/50"}`,children:"Infos personnelles"})]})]}),e.jsxs(de,{to:"/settings",className:`
                      sidebar-item group focus-ring
                      ${d("/settings")?"text-white shadow-sm":"text-white/70 hover:text-white"}
                    `,onClick:()=>t(),style:{"--item-circuit-color":"#FDC830"},children:[e.jsx("div",{className:`sidebar-item-icon-container ${d("/settings")?"sidebar-item-icon-container--active":""}`,children:e.jsx(j,{Icon:v.Settings,size:16,className:`sidebar-item-icon ${d("/settings")?"":"opacity-80 group-hover:opacity-100"}`,style:d("/settings")?{color:"#FDC830",filter:"drop-shadow(0 0 8px rgba(253, 200, 48, 0.6))"}:void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`sidebar-item-label font-medium text-xs truncate ${d("/settings")?"text-white":"text-white/82"}`,children:"Paramètres"}),e.jsx("div",{className:`sidebar-item-subtitle text-xxs truncate mt-0 ${d("/settings")?"text-white/70":"text-white/50"}`,children:"Configuration"})]})]})]}),e.jsx("div",{className:"sidebar-category-separator my-2"}),e.jsxs("button",{onClick:u,className:"sidebar-item group focus-ring text-white/70 hover:text-white w-full",style:{"--item-circuit-color":"#FF6B35",textAlign:"left"},children:[e.jsx("div",{className:"sidebar-item-icon-container",style:{background:"linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(247, 147, 30, 0.15))",border:"1.5px solid rgba(255, 107, 53, 0.35)",boxShadow:"0 0 16px rgba(255, 107, 53, 0.18), inset 0 1px 0 rgba(255, 255, 255, 0.15)"},children:e.jsx(j,{Icon:v.LogOut,size:16,className:"sidebar-item-icon opacity-80 group-hover:opacity-100",style:{color:"#FF6B35",filter:"drop-shadow(0 0 6px rgba(255, 107, 53, 0.4))"}})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"sidebar-item-label font-medium text-xs truncate text-white/82 text-left",children:"Déconnexion"}),e.jsx("div",{className:"sidebar-item-subtitle text-xxs truncate mt-0 text-white/50 text-left",children:"Se déconnecter"})]})]})]})]})})]})})});Cs.displayName="MobileDrawer";const Es=({width:s=85,height:t=70,className:a="",isHovered:r=!1})=>{const{isPerformanceMode:i}=J(),o=k.useId(),l=`forgeGrad-${o}`,c=`forgeGradHover-${o}`,m=`hammerGlow-${o}`;return e.jsxs("svg",{viewBox:"0 0 85 70",width:s,height:t,className:a,xmlns:"http://www.w3.org/2000/svg",style:{filter:i?"none":r?"drop-shadow(0 0 12px rgba(253, 200, 48, 0.5))":"drop-shadow(0 0 6px rgba(247, 147, 30, 0.3))"},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:l,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",style:{stopColor:"#FF6B35",stopOpacity:1}}),e.jsx("stop",{offset:"50%",style:{stopColor:"#F7931E",stopOpacity:1}}),e.jsx("stop",{offset:"100%",style:{stopColor:"#FDC830",stopOpacity:1}})]}),e.jsxs("linearGradient",{id:c,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",style:{stopColor:"#FF8C00",stopOpacity:1}}),e.jsx("stop",{offset:"50%",style:{stopColor:"#FFA500",stopOpacity:1}}),e.jsx("stop",{offset:"100%",style:{stopColor:"#FFD700",stopOpacity:1}})]}),e.jsxs("filter",{id:m,children:[e.jsx("feGaussianBlur",{stdDeviation:"2.5",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsx("path",{d:"M 20 10 L 85 10 L 85 28 L 65 28 L 65 70 L 40 70 L 40 28 L 20 28 Z",fill:i?`url(#${l})`:r?`url(#${c})`:`url(#${l})`,filter:i?"none":`url(#${m})`,stroke:"rgba(15, 23, 42, 0.8)",strokeWidth:"2.5"}),e.jsx("path",{d:"M 23 13 L 82 13 L 82 25 L 65 25 L 65 67 L 40 67 L 40 25 L 23 25 Z",fill:"none",stroke:"rgba(255, 255, 255, 0.3)",strokeWidth:"1.5",opacity:"0.6"}),!i&&e.jsxs(e.Fragment,{children:[e.jsxs("circle",{cx:"80",cy:"18",r:"3",fill:"#FDC830",opacity:r?1:.9,children:[e.jsx("animate",{attributeName:"opacity",values:"0.4;1;0.4",dur:"1.5s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"r",values:"2.5;3.5;2.5",dur:"1.5s",repeatCount:"indefinite"})]}),e.jsx("circle",{cx:"25",cy:"16",r:"2.5",fill:"#FF6B35",opacity:r?.9:.8,children:e.jsx("animate",{attributeName:"opacity",values:"0.3;0.9;0.3",dur:"2s",repeatCount:"indefinite"})}),e.jsx("circle",{cx:"75",cy:"24",r:"2",fill:"#FDC830",opacity:r?.8:.7,children:e.jsx("animate",{attributeName:"opacity",values:"0.3;0.8;0.3",dur:"1.8s",repeatCount:"indefinite"})}),e.jsx("circle",{cx:"52",cy:"12",r:"2.5",fill:"#F7931E",opacity:r?.9:.75,children:e.jsx("animate",{attributeName:"opacity",values:"0.4;0.9;0.4",dur:"2.2s",repeatCount:"indefinite"})})]})]})},wn=({variant:s="desktop",isHovered:t=!1,className:a=""})=>{const r=s==="desktop",{isPerformanceMode:i,mode:o}=J();return r?e.jsx("div",{className:`flex items-center ${a}`,style:{transition:o==="quality"?"all 300ms ease-out":"none",height:"100%"},children:e.jsxs("div",{style:{display:"inline-flex",alignItems:"baseline",gap:"0"},children:[e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"25px",fontWeight:800,letterSpacing:"1.2px",color:"#E5E7EB",lineHeight:1,textTransform:"uppercase",filter:o==="quality"?t?"drop-shadow(0 0 8px rgba(255, 255, 255, 0.3))":"drop-shadow(0 0 4px rgba(255, 255, 255, 0.15))":"none",transition:o==="quality"?"filter 300ms ease":"none"},children:"TWIN"}),o==="high-performance"?e.jsxs("span",{style:{display:"inline-flex",gap:"0"},children:[e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"25px",fontWeight:800,letterSpacing:"1.2px",color:"#FF6B35",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"F"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"25px",fontWeight:800,letterSpacing:"1.2px",color:"#F89442",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"Ø"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"25px",fontWeight:800,letterSpacing:"1.2px",color:"#F7931E",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"R"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"25px",fontWeight:800,letterSpacing:"1.2px",color:"#FCBB45",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"G"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"25px",fontWeight:800,letterSpacing:"1.2px",color:"#FDC830",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"E"})]}):e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"25px",fontWeight:800,letterSpacing:"1.2px",background:"linear-gradient(135deg, #FF6B35 0%, #F7931E 50%, #FDC830 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",lineHeight:1,textTransform:"uppercase",filter:o==="quality"?t?"drop-shadow(0 0 12px rgba(253, 200, 48, 0.5))":"drop-shadow(0 0 6px rgba(247, 147, 30, 0.3))":"none",transition:o==="quality"?"filter 300ms ease":"none"},children:"FØRGE"})]})}):e.jsxs("div",{className:`flex items-center ${a}`,style:{transition:o==="quality"?"all 300ms ease-out":"none",gap:"8px",position:"relative"},children:[e.jsx("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:e.jsx(Es,{width:42,height:50,isHovered:t})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px",alignItems:"flex-start",justifyContent:"center",transform:"translateY(2px)"},children:[e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"15px",fontWeight:800,letterSpacing:"0.8px",color:"#E5E7EB",lineHeight:1,textTransform:"uppercase",filter:o==="quality"?t?"drop-shadow(0 0 6px rgba(255, 255, 255, 0.3))":"drop-shadow(0 0 3px rgba(255, 255, 255, 0.15))":"none",transition:o==="quality"?"filter 300ms ease":"none"},children:"TWIN"}),o==="high-performance"?e.jsxs("span",{style:{display:"inline-flex",gap:"0"},children:[e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"15px",fontWeight:800,letterSpacing:"0.8px",color:"#FF6B35",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"F"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"15px",fontWeight:800,letterSpacing:"0.8px",color:"#F89442",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"Ø"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"15px",fontWeight:800,letterSpacing:"0.8px",color:"#F7931E",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"R"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"15px",fontWeight:800,letterSpacing:"0.8px",color:"#FCBB45",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"G"}),e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"15px",fontWeight:800,letterSpacing:"0.8px",color:"#FDC830",lineHeight:1,textTransform:"uppercase",filter:"none",transition:"none"},children:"E"})]}):e.jsx("span",{style:{fontFamily:"'Montserrat', sans-serif",fontSize:"15px",fontWeight:800,letterSpacing:"0.8px",background:"linear-gradient(135deg, #FF6B35 0%, #F7931E 50%, #FDC830 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",lineHeight:1,textTransform:"uppercase",filter:o==="quality"?t?"drop-shadow(0 0 10px rgba(253, 200, 48, 0.4))":"drop-shadow(0 0 5px rgba(247, 147, 30, 0.25))":"none",transition:o==="quality"?"filter 300ms ease":"none"},children:"FØRGE"})]})]})},Cn=({className:s="",showOnHome:t=!1})=>{const a=oe(),r=ue(),{click:i}=G(),o=k.useMemo(()=>r.pathname==="/"&&!t?!1:r.pathname!=="/",[r.pathname,t]),l=k.useCallback(()=>{try{i(),n.debug("BACK_BUTTON","Back navigation triggered",{currentPath:r.pathname,timestamp:new Date().toISOString()}),a(-1)}catch(c){n.warn("BACK_BUTTON","Back navigation failed, redirecting to home",{error:c instanceof Error?c.message:"Unknown error",currentPath:r.pathname}),a("/")}},[a,r.pathname,i]);return o?e.jsx(y.button,{onClick:l,className:s,style:{width:"48px",height:"48px",borderRadius:"50%",position:"relative",overflow:"visible",padding:0,display:"flex",alignItems:"center",justifyContent:"center",background:`
          radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18) 0%, transparent 50%),
          rgba(255, 255, 255, 0.10)
        `,border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(16px) saturate(140%)",WebkitBackdropFilter:"blur(16px) saturate(140%)",boxShadow:`
          0 8px 24px rgba(0, 0, 0, 0.25),
          0 2px 12px rgba(0, 0, 0, 0.18),
          inset 0 1px 0 rgba(255, 255, 255, 0.12)
        `,transition:"transform 280ms cubic-bezier(0.25, 0.1, 0.25, 1), background 180ms cubic-bezier(0.16, 1, 0.3, 1), box-shadow 180ms cubic-bezier(0.16, 1, 0.3, 1), border-color 180ms cubic-bezier(0.16, 1, 0.3, 1)",transform:"translateZ(0)",willChange:"transform, filter",cursor:"pointer"},onMouseEnter:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.background=`
            radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 60%),
            rgba(255, 255, 255, 0.10)
          `,c.currentTarget.style.borderColor="rgba(255,255,255,0.3)",c.currentTarget.style.boxShadow=`
            0 8px 24px rgba(0, 0, 0, 0.25),
            0 2px 12px rgba(0, 0, 0, 0.18),
            inset 0 1px 0 rgba(255, 255, 255, 0.12),
            0 0 20px rgba(255,255,255,0.15),
            0 4px 16px rgba(0,0,0,0.2)
          `)},onMouseLeave:c=>{window.matchMedia("(hover: hover)").matches&&(c.currentTarget.style.background=`
            radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18) 0%, transparent 50%),
            rgba(255, 255, 255, 0.10)
          `,c.currentTarget.style.borderColor="rgba(255,255,255,0.2)",c.currentTarget.style.boxShadow=`
            0 8px 24px rgba(0, 0, 0, 0.25),
            0 2px 12px rgba(0, 0, 0, 0.18),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `)},whileHover:{scale:1.08},whileTap:{scale:.95},initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.3,ease:[.25,.1,.25,1]},"aria-label":"Retour à la page précédente",title:"Retour",children:e.jsx(j,{Icon:v.ArrowLeft,size:18,style:{color:"rgba(255,255,255,0.9)",filter:"drop-shadow(0 0 8px rgba(24, 227, 255, 0.3))"},"aria-hidden":"true"})}):null},re={home:"var(--color-plasma-cyan)",track:"var(--color-plasma-cyan)",fasting:"var(--circuit-fasting)",activity:"var(--circuit-activity)",training:"var(--circuit-training)",emotions:"var(--circuit-emotions)",videos:"var(--circuit-videos)",health:"var(--circuit-health)",preferences:"var(--circuit-fridge)","coach-videos":"var(--circuit-videos)","coach-clients":"var(--brand-accent)","coach-branding":"var(--brand-accent)"};function Ss(s){return s.replace(/^\//,"").replace(/\/.*$/,"")}function En(s){if(s==="/")return re.home;if(s.startsWith("/coach/")){const a=s.replace("/coach/","");return re[`coach-${a}`]||re["coach-clients"]}const t=Ss(s);return s.includes("coach-")?re[t]||re["coach-clients"]:re[t]||re.home}const Sn=()=>{const{isOpen:s,title:t,message:a,processName:r,dirtyFields:i,confirmExit:o,cancelExit:l,saveAndExit:c,onSaveAndExit:m}=Ki(),{click:d,error:g,success:p}=G(),[u,f]=k.useState(!1);k.useEffect(()=>{s&&console.log("🚨 GLOBAL_EXIT_MODAL: Rendering modal immediately",{isOpen:s,title:t,processName:r,timestamp:new Date().toISOString(),bodyExists:!!document.body,modalRootExists:!!document.getElementById("modal-root")})},[s,t,r]);const h=()=>{console.log("🚨 GLOBAL_EXIT_MODAL: Confirm clicked",{timestamp:new Date().toISOString()}),g(),o()},x=()=>{console.log("🚨 GLOBAL_EXIT_MODAL: Cancel clicked",{timestamp:new Date().toISOString()}),d(),l()},b=async()=>{console.log("🚨 GLOBAL_EXIT_MODAL: Save and exit clicked",{timestamp:new Date().toISOString()}),f(!0);try{await c(),p()}catch(w){console.error("🚨 GLOBAL_EXIT_MODAL: Save failed",w),g()}finally{f(!1)}};return k.useEffect(()=>{if(!s)return;const w=S=>{S.key==="Escape"&&x()};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[s]),be.createPortal(e.jsx(H,{children:s&&e.jsx("div",{className:"global-exit-modal",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999999,background:"rgba(0, 0, 0, 0.9)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},onClick:w=>{w.target===w.currentTarget&&x()},role:"dialog","aria-modal":"true","aria-labelledby":"global-exit-modal-title",children:e.jsx(y.div,{initial:{opacity:0,scale:.8,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:50},transition:{type:"spring",stiffness:400,damping:25,mass:.8},className:"p-4 md:p-8 text-center",style:{width:"100%",maxWidth:"28rem",position:"relative",zIndex:1e6},onClick:w=>w.stopPropagation(),children:e.jsxs(q,{className:"p-8 text-center",style:{background:`
                  radial-gradient(circle at 30% 20%, color-mix(in srgb, #EF4444 20%, transparent) 0%, transparent 60%),
                  radial-gradient(circle at 70% 80%, color-mix(in srgb, #F59E0B 15%, transparent) 0%, transparent 50%),
                  linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.10)),
                  rgba(11, 14, 23, 0.95)
                `,borderColor:"color-mix(in srgb, #EF4444 40%, transparent)",boxShadow:`
                  0 25px 80px rgba(0, 0, 0, 0.6),
                  0 0 60px color-mix(in srgb, #EF4444 30%, transparent),
                  0 0 120px color-mix(in srgb, #F59E0B 20%, transparent),
                  inset 0 3px 0 rgba(255, 255, 255, 0.3),
                  inset 0 -3px 0 rgba(0, 0, 0, 0.2)
                `,backdropFilter:"blur(32px) saturate(180%)",WebkitBackdropFilter:"blur(32px) saturate(180%)",position:"relative",zIndex:1000001},children:[e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx("div",{className:"w-28 h-28 md:w-32 md:h-32 mx-auto rounded-full flex items-center justify-center breathing-icon",style:{background:`
                      radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3) 0%, transparent 60%),
                      radial-gradient(circle at 70% 70%, color-mix(in srgb, #EF4444 25%, transparent) 0%, transparent 50%),
                      linear-gradient(135deg, color-mix(in srgb, #EF4444 50%, transparent), color-mix(in srgb, #F59E0B 40%, transparent))
                    `,border:"4px solid color-mix(in srgb, #EF4444 80%, transparent)",boxShadow:`
                      0 0 50px color-mix(in srgb, #EF4444 80%, transparent),
                      0 0 100px color-mix(in srgb, #EF4444 60%, transparent),
                      0 0 150px color-mix(in srgb, #F59E0B 50%, transparent),
                      inset 0 4px 0 rgba(255,255,255,0.6),
                      inset 0 -3px 0 rgba(0,0,0,0.3)
                    `,backdropFilter:"blur(24px) saturate(180%)",WebkitBackdropFilter:"blur(24px) saturate(180%)"},children:e.jsx(j,{Icon:v.AlertTriangle,size:window.innerWidth<768?64:72,style:{color:"#EF4444",filter:`
                        drop-shadow(0 0 16px color-mix(in srgb, #EF4444 100%, transparent))
                        drop-shadow(0 0 32px color-mix(in srgb, #EF4444 80%, transparent))
                        drop-shadow(0 0 48px color-mix(in srgb, #F59E0B 60%, transparent))
                      `},variant:"pure"})})}),e.jsxs("div",{className:"space-y-3 md:space-y-4 mb-6 md:mb-8",children:[e.jsx("h2",{id:"global-exit-modal-title",className:"text-xl md:text-3xl font-bold text-white leading-tight",children:t}),e.jsx("p",{className:"text-white/90 text-sm md:text-lg leading-relaxed max-w-sm mx-auto px-2",children:a}),e.jsxs("div",{className:"inline-flex items-center gap-2 md:gap-3 px-4 md:px-6 py-2 md:py-3 rounded-full",style:{background:"color-mix(in srgb, #F59E0B 20%, transparent)",border:"2px solid color-mix(in srgb, #F59E0B 40%, transparent)",backdropFilter:"blur(16px) saturate(140%)"},children:[e.jsx("div",{className:"w-2 h-2 md:w-3 md:h-3 rounded-full bg-orange-400 animate-pulse"}),e.jsxs("span",{className:"text-orange-300 text-sm md:text-base font-bold",children:[r," Actif"]})]}),i&&i.length>0&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl",style:{background:"color-mix(in srgb, #3B82F6 15%, transparent)",border:"2px solid color-mix(in srgb, #3B82F6 30%, transparent)",backdropFilter:"blur(16px)"},children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(j,{Icon:v.AlertCircle,size:16,className:"text-blue-400 mt-0.5"}),e.jsx("h4",{className:"text-blue-300 font-semibold text-sm",children:"Champs non sauvegardés :"})]}),e.jsx("div",{className:"space-y-2 text-left",children:i.map((w,S)=>e.jsxs("div",{className:"text-blue-200 text-sm",children:[e.jsx("span",{className:"font-medium text-blue-300",children:w.section}),w.fields&&w.fields.length>0&&e.jsxs("span",{className:"text-blue-200/80",children:[" : ",w.fields.join(", ")]})]},S))})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:gap-4 justify-center",children:[m&&e.jsx("button",{onClick:b,disabled:u,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-4 text-base md:text-xl font-bold rounded-full relative overflow-hidden",style:{background:`linear-gradient(135deg,
                        color-mix(in srgb, #3B82F6 85%, transparent),
                        color-mix(in srgb, #60A5FA 70%, transparent)
                      )`,border:"3px solid color-mix(in srgb, #3B82F6 70%, transparent)",boxShadow:`
                        0 16px 50px color-mix(in srgb, #3B82F6 50%, transparent),
                        0 0 80px color-mix(in srgb, #3B82F6 40%, transparent),
                        inset 0 4px 0 rgba(255,255,255,0.5)
                      `,backdropFilter:"blur(24px) saturate(170%)",color:"#fff",transition:"all 0.2s ease",opacity:u?.6:1,cursor:u?"not-allowed":"pointer"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(j,{Icon:u?v.Loader2:v.Save,size:window.innerWidth<768?18:24,className:u?"text-white animate-spin":"text-white"}),e.jsx("span",{children:u?"Sauvegarde...":"Sauvegarder et Quitter"})]})}),e.jsx("button",{onClick:h,disabled:u,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-4 text-base md:text-xl font-bold rounded-full relative overflow-hidden",style:{background:`linear-gradient(135deg, 
                      color-mix(in srgb, #EF4444 85%, transparent), 
                      color-mix(in srgb, #F59E0B 70%, transparent)
                    )`,border:"3px solid color-mix(in srgb, #EF4444 70%, transparent)",boxShadow:`
                      0 16px 50px color-mix(in srgb, #EF4444 50%, transparent),
                      0 0 80px color-mix(in srgb, #EF4444 40%, transparent),
                      inset 0 4px 0 rgba(255,255,255,0.5)
                    `,backdropFilter:"blur(24px) saturate(170%)",color:"#fff",transition:"all 0.2s ease",opacity:u?.5:1,cursor:u?"not-allowed":"pointer"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(j,{Icon:v.LogOut,size:window.innerWidth<768?18:24,className:"text-white"}),e.jsx("span",{children:"Quitter"})]})}),e.jsx("button",{onClick:x,disabled:u,className:"w-full md:w-auto px-6 md:px-8 py-3 md:py-4 text-base md:text-xl font-bold rounded-full",style:{background:`linear-gradient(135deg, 
                      color-mix(in srgb, #22C55E 80%, transparent), 
                      color-mix(in srgb, #10B981 60%, transparent)
                    )`,border:"3px solid color-mix(in srgb, #22C55E 70%, transparent)",boxShadow:`
                      0 16px 50px color-mix(in srgb, #22C55E 50%, transparent),
                      0 0 80px color-mix(in srgb, #22C55E 40%, transparent),
                      inset 0 4px 0 rgba(255,255,255,0.5)
                    `,backdropFilter:"blur(24px) saturate(170%)",color:"#fff",opacity:u?.5:1,cursor:u?"not-allowed":"pointer"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(j,{Icon:v.ArrowLeft,size:window.innerWidth<768?18:24,className:"text-white"}),e.jsx("span",{children:"Continuer"})]})})]})]})})})}),document.body)},js=({content:s,title:t,examples:a=[],learnMoreUrl:r,placement:i="top",children:o,delay:l=300,maxWidth:c=320})=>{const[m,d]=C.useState(!1),[g,p]=C.useState({top:0,left:0}),u=C.useRef(null),f=C.useRef(null),h=C.useRef(),x=()=>{h.current=setTimeout(()=>{d(!0)},l)},b=()=>{h.current&&clearTimeout(h.current),d(!1)};C.useEffect(()=>{if(m&&u.current&&f.current){const S=u.current.getBoundingClientRect(),E=f.current.getBoundingClientRect();let I=0,T=0;switch(i){case"top":I=S.top-E.height-8,T=S.left+(S.width-E.width)/2;break;case"bottom":I=S.bottom+8,T=S.left+(S.width-E.width)/2;break;case"left":I=S.top+(S.height-E.height)/2,T=S.left-E.width-8;break;case"right":I=S.top+(S.height-E.height)/2,T=S.right+8;break}const A=8;I=Math.max(A,Math.min(I,window.innerHeight-E.height-A)),T=Math.max(A,Math.min(T,window.innerWidth-E.width-A)),p({top:I,left:T})}},[m,i]);const w=e.jsx(H,{children:m&&e.jsx(y.div,{ref:f,initial:{opacity:0,scale:.95,y:i==="top"?10:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:i==="top"?10:-10},transition:{duration:.2,ease:"easeOut"},style:{position:"fixed",top:g.top,left:g.left,zIndex:9999,maxWidth:c,pointerEvents:"none"},children:e.jsxs(q,{className:"p-4 shadow-2xl",style:{background:"rgba(20, 20, 30, 0.95)",borderColor:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(20px) saturate(180%)",boxShadow:`
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 0 30px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1)
              `},children:[t&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{Icon:v.Info,size:16,className:"text-blue-400"}),e.jsx("h4",{className:"text-white font-semibold text-sm",children:t})]}),e.jsx("div",{className:"text-white/80 text-sm leading-relaxed mb-3",children:s}),a.length>0&&e.jsxs("div",{className:"mt-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(j,{Icon:v.Lightbulb,size:14,className:"text-yellow-400"}),e.jsx("span",{className:"text-yellow-300 text-xs font-medium",children:"Exemples"})]}),e.jsx("ul",{className:"space-y-1",children:a.map((S,E)=>e.jsxs("li",{className:"text-white/70 text-xs flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-400 mt-0.5",children:"•"}),e.jsx("span",{children:S})]},E))})]}),r&&e.jsxs("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 mt-3 text-blue-400 hover:text-blue-300 text-xs font-medium transition-colors pointer-events-auto",children:[e.jsx("span",{children:"En savoir plus"}),e.jsx(j,{Icon:v.ExternalLink,size:12})]}),e.jsx("div",{className:"absolute w-3 h-3 bg-inherit border-inherit",style:{[i==="top"?"bottom":i==="bottom"?"top":i==="left"?"right":"left"]:-6,[i==="top"||i==="bottom"?"left":"top"]:"50%",transform:"translate(-50%, 0) rotate(45deg)",borderWidth:i==="top"?"0 1px 1px 0":i==="bottom"?"1px 0 0 1px":i==="left"?"1px 1px 0 0":"0 0 1px 1px"}})]})})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:u,onMouseEnter:x,onMouseLeave:b,onFocus:x,onBlur:b,style:{display:"inline-block"},children:o}),typeof document<"u"&&be.createPortal(w,document.body)]})},$e="twinforge-unified-notifications",Is=3,Ts=30,me={"step1-welcome":{type:"contextual",message:"Salut ! Je suis là si tu as besoin 👋",mode:"general",priority:2,addToHistory:!1,autoHideDelay:3e3},"step2-adjust":{type:"step2-alert",message:"Ton coach t'attend pour ajuster ta séance !",mode:"training",priority:10,addToHistory:!1,autoHideDelay:5e3},"training-intro":{type:"contextual",message:"Prêt pour ta séance ? Clique pour commencer !",mode:"training",priority:3,addToHistory:!1,autoHideDelay:3e3},"nutrition-intro":{type:"contextual",message:"Un conseil nutrition ? Je suis disponible !",mode:"nutrition",priority:3,addToHistory:!1,autoHideDelay:3e3},"fasting-intro":{type:"contextual",message:"Ton coach jeûne est là pour t'accompagner !",mode:"fasting",priority:3,addToHistory:!1,autoHideDelay:3e3}},Pe={appearance:2e3,step2Appearance:1e3};class As{constructor(){B(this,"persistence",{});B(this,"activeNotificationId",null);B(this,"scheduledTimeout",null);B(this,"hideTimeout",null);B(this,"notificationQueue",[]);this.loadPersistence()}loadPersistence(){try{const t=localStorage.getItem($e);t&&(this.persistence=JSON.parse(t))}catch(t){n.warn("UNIFIED_NOTIFICATION","Failed to load persistence",{error:t}),this.persistence={}}}savePersistence(){try{localStorage.setItem($e,JSON.stringify(this.persistence))}catch(t){n.warn("UNIFIED_NOTIFICATION","Failed to save persistence",{error:t})}}isInCooldown(t){const a=this.persistence[t];if(!a?.cooldownUntil)return!1;const r=new Date(a.cooldownUntil);return new Date<r}hasReachedMaxViews(t){return(this.persistence[t]?.viewCount||0)>=Is}shouldShow(t){const{isOpen:a}=pe.getState();return a?(n.debug("UNIFIED_NOTIFICATION","Chat is open, skipping notification",{notificationId:t}),!1):this.activeNotificationId===t?(n.debug("UNIFIED_NOTIFICATION","Notification already active",{notificationId:t}),!1):this.isInCooldown(t)?(n.debug("UNIFIED_NOTIFICATION","Notification in cooldown",{notificationId:t}),!1):this.hasReachedMaxViews(t)?(n.debug("UNIFIED_NOTIFICATION","Notification reached max views",{notificationId:t,viewCount:this.persistence[t]?.viewCount}),!1):!0}markAsViewed(t){const a=new Date,r=new Date(a.getTime()+Ts*60*1e3);this.persistence[t]?(this.persistence[t].viewCount+=1,this.persistence[t].lastSeenAt=a.toISOString(),this.persistence[t].cooldownUntil=r.toISOString()):this.persistence[t]={viewCount:1,firstSeenAt:a.toISOString(),lastSeenAt:a.toISOString(),cooldownUntil:r.toISOString()},this.savePersistence(),n.debug("UNIFIED_NOTIFICATION","Notification marked as viewed",{notificationId:t,viewCount:this.persistence[t].viewCount,cooldownUntil:r.toISOString()})}clearTimeouts(){this.scheduledTimeout&&(clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}showNotification(t){const a=me[t];if(!a){n.error("UNIFIED_NOTIFICATION","Unknown notification ID",{notificationId:t});return}({...a});const{showNotification:r,addMessage:i}=pe.getState();r({id:t,message:a.message,mode:a.mode,autoHideDelay:a.autoHideDelay}),this.activeNotificationId=t,a.addToHistory&&i({role:"coach",type:"text",content:a.message}),this.markAsViewed(t),n.info("UNIFIED_NOTIFICATION","Notification shown",{notificationId:t,type:a.type,priority:a.priority,addedToHistory:a.addToHistory}),a.autoHideDelay&&(this.hideTimeout=setTimeout(()=>{this.hideNotification(t)},a.autoHideDelay))}scheduleNotification(t,a=!1){if(!this.shouldShow(t))return;this.clearTimeouts();const r=me[t],i=a||r.type==="step2-alert"?Pe.step2Appearance:Pe.appearance;this.scheduledTimeout=setTimeout(()=>{this.showNotification(t)},i),n.debug("UNIFIED_NOTIFICATION","Notification scheduled",{notificationId:t,delayMs:i,immediate:a})}hideNotification(t){const{currentNotification:a,hideNotification:r}=pe.getState();if(a){if(t&&a.id!==t){n.debug("UNIFIED_NOTIFICATION","Notification ID mismatch, skipping hide",{requested:t,current:a.id});return}r(),this.activeNotificationId=null,this.clearTimeouts(),n.debug("UNIFIED_NOTIFICATION","Notification hidden",{notificationId:a.id}),this.processQueue()}}processQueue(){if(this.notificationQueue.length===0||this.activeNotificationId!==null)return;const t=this.notificationQueue.shift();t&&this.scheduleNotification(t,!0)}queueNotification(t){this.shouldShow(t)&&(this.notificationQueue.includes(t)||(this.notificationQueue.push(t),this.notificationQueue.sort((a,r)=>{const i=me[a].priority;return me[r].priority-i}),n.debug("UNIFIED_NOTIFICATION","Notification queued",{notificationId:t,queueLength:this.notificationQueue.length})),this.activeNotificationId===null&&this.processQueue())}cancelScheduled(){this.clearTimeouts(),n.debug("UNIFIED_NOTIFICATION","Scheduled notification cancelled")}clearQueue(){this.notificationQueue=[],this.clearTimeouts(),n.debug("UNIFIED_NOTIFICATION","Notification queue cleared")}resetNotification(t){t?delete this.persistence[t]:this.persistence={},this.savePersistence(),n.info("UNIFIED_NOTIFICATION","Notification reset",{notificationId:t||"all"})}getNotificationState(t){return this.persistence[t]||null}cleanup(){this.clearTimeouts(),this.notificationQueue=[],this.activeNotificationId=null,n.debug("UNIFIED_NOTIFICATION","Service cleaned up")}}const ie=new As,Le=({buttonRef:s})=>{const{currentNotification:t,open:a,hideNotification:r}=pe(),{click:i}=G(),o=C.useRef(null),l=()=>{i(),Q.press(),t&&ie.hideNotification(t.id),a(t?.mode)};C.useEffect(()=>{if(!t?.isVisible)return;const p=u=>{const f=u.target,h=o.current?.contains(f),x=s?.current?.contains(f);!h&&!x&&t&&ie.hideNotification(t.id)};return document.addEventListener("mousedown",p),document.addEventListener("touchstart",p),()=>{document.removeEventListener("mousedown",p),document.removeEventListener("touchstart",p)}},[t?.isVisible,r]);const[c,m]=C.useState(typeof window<"u"?window.innerWidth>=1025:!1);C.useEffect(()=>{const p=()=>{m(window.innerWidth>=1025)};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]);const[d,g]=C.useState({position:"fixed"});return C.useEffect(()=>{if(!c||!t?.isVisible)return;const p=()=>{if(s?.current&&o?.current){const u=s.current.getBoundingClientRect(),f=o.current.getBoundingClientRect(),h=320,x=8;u.width;const b=u.height,w=f.height||56,S=window.innerWidth-u.left+x,I=u.top+b/2-w/2;g({position:"fixed",right:`${S}px`,top:`${I}px`,transform:"none",width:`${h}px`,maxWidth:`${h}px`})}else g({position:"fixed",bottom:"24px",right:"92px",transform:"none",width:"320px",maxWidth:"320px"})};return setTimeout(p,0),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[c,t?.isVisible,s]),C.useEffect(()=>{c||g({position:"fixed"})},[c]),e.jsx(H,{children:t?.isVisible&&e.jsx(y.div,{ref:o,className:`chat-notification-bubble ${c?"chat-notification-bubble--desktop":"chat-notification-bubble--mobile"}`,style:d,initial:c?{x:-40,opacity:0,scale:.85}:{y:40,opacity:0,scale:.95},animate:c?{x:0,opacity:1,scale:1}:{y:0,opacity:1,scale:1},exit:c?{x:-40,opacity:0,scale:.85}:{y:40,opacity:0,scale:.95},transition:{type:"spring",stiffness:320,damping:28,mass:.8},onClick:l,role:"button",tabIndex:0,"aria-label":t.message,onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),l())},children:e.jsxs("div",{className:"chat-notification-bubble__message",children:[e.jsx("div",{className:"chat-notification-bubble__icon",children:e.jsx(j,{Icon:v.MessageSquare,size:c?16:18,style:{color:"#18E3FF",filter:"drop-shadow(0 0 8px rgba(24, 227, 255, 0.4))"}})}),e.jsx("span",{children:t.message})]})})})},Rs=k.forwardRef(({className:s=""},t)=>{const a=ue(),{isPanelOpen:r,togglePanel:i,currentMode:o,modeConfigs:l,hasUnreadMessages:c,unreadCount:m,isInStep2:d,voiceState:g,isVoiceOnlyMode:p,exitVoiceOnlyMode:u}=W(),{click:f}=G(),{mode:h}=J(),[x,b]=C.useState(typeof window<"u"?window.innerWidth>=1025:!1),w=C.useRef(null),S=t||w,E=h==="high-performance",I=d||a.pathname.includes("/pipeline/step-2");C.useEffect(()=>{const R=()=>{b(window.innerWidth>=1025)};return window.addEventListener("resize",R),()=>window.removeEventListener("resize",R)},[]),C.useEffect(()=>{if(!r)return a.pathname.includes("/pipeline/step-2")?ie.scheduleNotification("step2-adjust"):a.pathname.includes("/training")?ie.scheduleNotification("training-intro"):a.pathname.includes("/meals")||a.pathname.includes("/fridge")?ie.scheduleNotification("nutrition-intro"):a.pathname.includes("/fasting")?ie.scheduleNotification("fasting-intro"):ie.scheduleNotification("step1-welcome"),()=>{ie.cancelScheduled()}},[a.pathname,r,o]);const A=l[o].color,N=g==="listening"||g==="speaking",D=()=>{f(),Q.press(),p?(n.info("FLOATING_CHAT_BUTTON","Exiting voice-only mode to view conversation"),u()):i()},$=e.jsxs(y.button,{ref:R=>{typeof t=="function"?t(R):t&&(t.current=R),w&&(w.current=R)},onClick:D,className:`floating-chat-button ${I?"floating-chat-button--step2":""} ${s}`,style:{position:"fixed",right:r&&!x?"-100px":x?"24px":"8px",bottom:x?"24px":"calc(var(--new-bottom-bar-height) + var(--new-bottom-bar-bottom-offset) + 8px)",zIndex:xe.FLOATING_CHAT_BUTTON,borderRadius:"50%",overflow:"visible",display:"flex",alignItems:"center",justifyContent:"center",padding:"0",isolation:"isolate",width:x?"60px":"56px",height:x?"60px":"56px",background:E?N&&!r?"linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.4))":c?`linear-gradient(135deg, color-mix(in srgb, ${A} 15%, rgba(11, 14, 23, 0.95)), rgba(11, 14, 23, 0.95))`:"rgba(11, 14, 23, 0.95)":c?`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${A} 30%, transparent) 0%, transparent 50%),
                  radial-gradient(circle at 70% 70%, rgba(255,255,255,0.25) 0%, transparent 60%),
                  var(--liquid-pill-bg)
                `:`
                  radial-gradient(circle at 30% 30%, rgba(255,255,255,0.20) 0%, transparent 50%),
                  var(--liquid-pill-bg)
                `,border:c?`1.5px solid color-mix(in srgb, ${A} 40%, transparent)`:"1.5px solid rgba(255,255,255,0.22)",backdropFilter:"blur(var(--liquid-pill-blur)) saturate(var(--liquid-pill-saturate))",WebkitBackdropFilter:"blur(var(--liquid-pill-blur)) saturate(var(--liquid-pill-saturate))",boxShadow:E?"0 2px 8px rgba(0, 0, 0, 0.3)":c?`
                  var(--liquid-pill-shadow),
                  0 0 40px color-mix(in srgb, ${A} 30%, transparent),
                  0 0 60px color-mix(in srgb, ${A} 15%, transparent)
                `:`
                  var(--liquid-pill-shadow),
                  0 0 32px color-mix(in srgb, ${A} 15%, transparent)
                `,cursor:"pointer",transition:"right 400ms cubic-bezier(0.25, 0.1, 0.25, 1), transform var(--liquid-transition-medium), background var(--liquid-transition-fast), box-shadow var(--liquid-transition-fast), border-color var(--liquid-transition-fast)",willChange:"right, transform, filter",transform:"translateZ(0)"},initial:!1,whileHover:{scale:1.08,boxShadow:`
          var(--liquid-pill-shadow),
          0 0 48px color-mix(in srgb, ${A} 25%, transparent),
          0 4px 20px rgba(0, 0, 0, 0.3)
        `,transition:{duration:.25,ease:[.16,1,.3,1]}},whileTap:{scale:.92,transition:{duration:.15}},"aria-label":r?"Fermer le chat":"Ouvrir le chat","aria-expanded":r,children:[!E&&e.jsx("div",{style:{position:"absolute",top:"2px",left:"2px",right:"50%",bottom:"50%",borderRadius:"inherit",background:"radial-gradient(circle at 20% 20%, rgba(255,255,255,0.4) 0%, transparent 60%)",opacity:.6,pointerEvents:"none"}}),e.jsx(y.div,{animate:{rotate:r?180:0},transition:{duration:.3},className:"button-icon",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(H,{mode:"wait",children:(N||p)&&!r?e.jsx(y.div,{initial:{scale:.8,opacity:0,rotate:-10},animate:{scale:1,opacity:1,rotate:0},exit:{scale:.8,opacity:0,rotate:10},transition:{duration:.2},children:e.jsx(j,{Icon:v.Radio,size:x?28:24,style:{color:"rgba(239, 68, 68, 0.95)",filter:"drop-shadow(0 0 16px rgba(239, 68, 68, 0.8))"}})},"voice-active-icon"):e.jsx(y.div,{initial:{scale:.8,opacity:0,rotate:-10},animate:{scale:1,opacity:1,rotate:0},exit:{scale:.8,opacity:0,rotate:10},transition:{duration:.2},children:e.jsx(j,{Icon:v.MessageSquare,size:x?28:24,style:{color:A,filter:I?"drop-shadow(0 0 16px rgba(59, 130, 246, 0.8))":`drop-shadow(0 0 14px color-mix(in srgb, ${A} 60%, transparent))`}})},"default-icon")})}),e.jsx(H,{children:!r&&c&&m>0&&!I&&e.jsx(y.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:"floating-chat-badge",style:{position:"absolute",top:"-4px",right:"-4px",minWidth:"20px",height:"20px",padding:"0 6px",borderRadius:"10px",background:`
                radial-gradient(circle at 30% 30%, ${A} 0%, color-mix(in srgb, ${A} 80%, #000) 100%)
              `,border:"2px solid rgba(11, 14, 23, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:"bold",color:"white",boxShadow:`
                0 0 16px color-mix(in srgb, ${A} 60%, transparent),
                0 2px 8px rgba(0, 0, 0, 0.4)
              `},children:m>9?"9+":m})}),e.jsx(H,{children:!r&&I&&e.jsx(y.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:"floating-chat-button--step2-notification",title:"Ton coach t'attend pour ajuster ta séance !",children:"!"})})]});return I&&!r?e.jsxs(e.Fragment,{children:[e.jsx(js,{content:"Ton coach t'attend pour ajuster ta séance ! Clique pour ouvrir le chat.",title:"Ajuste ton programme",placement:"left",delay:500,maxWidth:280,children:$}),e.jsx(Le,{buttonRef:S})]}):e.jsxs(e.Fragment,{children:[$,e.jsx(Le,{buttonRef:S})]})});Rs.displayName="FloatingChatButton";class Ns{constructor(){B(this,"peerConnection",null);B(this,"dataChannel",null);B(this,"config",null);B(this,"isConnected",!1);B(this,"messageHandlers",new Set);B(this,"errorHandlers",new Set);B(this,"connectHandlers",new Set);B(this,"disconnectHandlers",new Set);B(this,"audioElement",null);B(this,"localStream",null);B(this,"audioPlaybackStarted",!1);B(this,"audioAutoplayBlocked",!1);B(this,"sessionConfigured",!1);B(this,"sessionConfiguredResolve",null);B(this,"audioInputActive",!1);B(this,"healthCheckInterval",null);B(this,"lastSpeechDetectedAt",null)}async connect(t){if(this.isConnected&&this.peerConnection){n.info("REALTIME_WEBRTC","✅ Already connected, skipping");return}this.config=t;try{n.info("REALTIME_WEBRTC","🚀 STARTING WEBRTC CONNECTION TO REALTIME API",{model:t.model,voice:t.voice,temperature:t.temperature,maxTokens:t.maxTokens,timestamp:new Date().toISOString()});const a="https://kwipydbtjagypocpvbwn.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U";if(n.info("REALTIME_WEBRTC","🔍 Environment variables check",{hasSupabaseUrl:!!a,supabaseUrlLength:a?.length||0,hasSupabaseAnonKey:!!r,supabaseAnonKeyLength:r?.length||0}),typeof RTCPeerConnection>"u")throw n.error("REALTIME_WEBRTC","❌ WebRTC not available in this environment"),new Error("WebRTC API is not available in this browser/environment");n.info("REALTIME_WEBRTC","✅ WebRTC API is available"),n.info("REALTIME_WEBRTC","🔌 Creating RTCPeerConnection..."),this.peerConnection=new RTCPeerConnection,n.info("REALTIME_WEBRTC","✅ RTCPeerConnection created",{connectionState:this.peerConnection.connectionState,iceConnectionState:this.peerConnection.iceConnectionState}),this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.audioElement.volume=1,this.audioElement.style.display="none",document.body.appendChild(this.audioElement),this.setupAudioEventHandlers(),n.info("REALTIME_WEBRTC","🔊 Audio element created, configured and added to DOM",{autoplay:this.audioElement.autoplay,volume:this.audioElement.volume,muted:this.audioElement.muted}),this.peerConnection.ontrack=async d=>{n.info("REALTIME_WEBRTC","📥 Received remote audio track",{streamId:d.streams[0]?.id,trackKind:d.track.kind,trackId:d.track.id,trackEnabled:d.track.enabled,trackMuted:d.track.muted,trackReadyState:d.track.readyState}),this.audioElement&&d.streams[0]&&(this.audioElement.srcObject=d.streams[0],n.info("REALTIME_WEBRTC","✅ Audio stream connected to audio element",{streamActive:d.streams[0].active,audioTracks:d.streams[0].getAudioTracks().length}),await this.ensureAudioPlayback())},n.info("REALTIME_WEBRTC","🎤 Requesting microphone access...");try{this.localStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:24e3,channelCount:1}}),n.info("REALTIME_WEBRTC","✅ Microphone access granted",{trackCount:this.localStream.getTracks().length,tracks:this.localStream.getTracks().map(d=>({kind:d.kind,label:d.label,enabled:d.enabled}))}),this.localStream.getTracks().forEach(d=>{this.peerConnection&&this.localStream&&(this.peerConnection.addTrack(d,this.localStream),n.info("REALTIME_WEBRTC","✅ Local audio track added to peer connection",{trackKind:d.kind,trackId:d.id}))})}catch(d){throw n.error("REALTIME_WEBRTC","❌ Failed to get microphone access",{error:d instanceof Error?d.message:String(d)}),new Error("Microphone access required for voice sessions")}n.info("REALTIME_WEBRTC","📡 Creating data channel for events..."),this.dataChannel=this.peerConnection.createDataChannel("oai-events"),this.setupDataChannelHandlers(),this.setupConnectionHandlers(),n.info("REALTIME_WEBRTC","📝 Creating SDP offer...");const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),n.info("REALTIME_WEBRTC","✅ SDP offer created and set as local description",{sdpType:i.type,sdpLength:i.sdp?.length||0});const o=`${a}/functions/v1/voice-coach-realtime/session`;n.info("REALTIME_WEBRTC","🌐 Sending SDP offer to backend",{url:o});const l=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,apikey:r},body:JSON.stringify({sdp:i.sdp,model:t.model,voice:t.voice,instructions:t.instructions})});if(!l.ok){const d=await l.text();throw n.error("REALTIME_WEBRTC","❌ Backend returned error",{status:l.status,statusText:l.statusText,error:d}),new Error(`Failed to create session: ${l.status} - ${d}`)}const c=await l.text();n.info("REALTIME_WEBRTC","✅ Received SDP answer from backend",{sdpAnswerLength:c.length});const m={type:"answer",sdp:c};await this.peerConnection.setRemoteDescription(m),n.info("REALTIME_WEBRTC","✅ SDP answer set as remote description"),n.info("REALTIME_WEBRTC","⏳ Waiting for connection to establish..."),await this.waitForConnection(),n.info("REALTIME_WEBRTC","⏳ Waiting for data channel to be ready..."),await this.waitForDataChannel(),n.info("REALTIME_WEBRTC","✅✅✅ SUCCESSFULLY CONNECTED TO REALTIME API VIA WEBRTC ✅✅✅"),n.info("REALTIME_WEBRTC","✅ Data channel is ready for sending messages"),n.info("REALTIME_WEBRTC","🔍 Verifying audio input configuration..."),this.verifyAudioInput(),setTimeout(()=>{n.info("REALTIME_WEBRTC","🔍 Re-verifying audio input after connection stabilization..."),this.verifyAudioInput()},1e3),this.startHealthCheck()}catch(a){const r=a instanceof Error?a.message:String(a),i=a instanceof Error?a.stack:void 0;throw n.error("REALTIME_WEBRTC","❌❌❌ CONNECTION FAILED ❌❌❌",{errorMessage:r,errorStack:i,connectionState:this.peerConnection?.connectionState,iceConnectionState:this.peerConnection?.iceConnectionState}),this.cleanup(),a}}async waitForConnection(){return new Promise((t,a)=>{const r=Date.now(),i=15e3,o=()=>{if(!this.peerConnection){a(new Error("Peer connection lost"));return}const l=this.peerConnection.connectionState,c=this.peerConnection.iceConnectionState;if(n.debug("REALTIME_WEBRTC","Checking connection state",{connectionState:l,iceConnectionState:c,elapsed:Date.now()-r}),l==="connected"||c==="connected"||c==="completed"){n.info("REALTIME_WEBRTC","✅ Connection established",{connectionState:l,iceConnectionState:c,duration:Date.now()-r}),this.isConnected=!0,this.connectHandlers.forEach(m=>{try{m()}catch(d){n.error("REALTIME_WEBRTC","Error in connection handler",{error:d})}}),t();return}if(l==="failed"||c==="failed"){n.error("REALTIME_WEBRTC","❌ Connection failed",{connectionState:l,iceConnectionState:c}),a(new Error("WebRTC connection failed"));return}if(Date.now()-r>i){n.error("REALTIME_WEBRTC","❌ Connection timeout",{connectionState:l,iceConnectionState:c,duration:Date.now()-r}),a(new Error("Connection timeout"));return}setTimeout(o,100)};o()})}async waitForDataChannel(){return new Promise((t,a)=>{const r=Date.now(),i=1e4;if(!this.dataChannel){n.error("REALTIME_WEBRTC_DC","❌ No data channel to wait for"),a(new Error("Data channel not created"));return}if(this.dataChannel.readyState==="open"){n.info("REALTIME_WEBRTC_DC","✅ Data channel already open"),t();return}n.info("REALTIME_WEBRTC_DC","⏳ Waiting for data channel to open...",{currentState:this.dataChannel.readyState});const o=()=>{const g=Date.now()-r;n.info("REALTIME_WEBRTC_DC","✅ Data channel opened",{duration:g,readyState:this.dataChannel?.readyState}),d(),t()},l=g=>{n.error("REALTIME_WEBRTC_DC","❌ Data channel error while waiting",{error:g}),d(),a(new Error("Data channel error"))},c=()=>{n.error("REALTIME_WEBRTC_DC","❌ Data channel closed while waiting"),d(),a(new Error("Data channel closed before opening"))},m=setTimeout(()=>{const g=Date.now()-r;n.error("REALTIME_WEBRTC_DC","❌ Data channel open timeout",{duration:g,currentState:this.dataChannel?.readyState}),d(),a(new Error("Data channel open timeout"))},i),d=()=>{clearTimeout(m),this.dataChannel&&(this.dataChannel.removeEventListener("open",o),this.dataChannel.removeEventListener("error",l),this.dataChannel.removeEventListener("close",c))};this.dataChannel.addEventListener("open",o),this.dataChannel.addEventListener("error",l),this.dataChannel.addEventListener("close",c)})}setupDataChannelHandlers(){this.dataChannel&&(n.info("REALTIME_WEBRTC_DC","📡 Data channel created",{readyState:this.dataChannel.readyState,label:this.dataChannel.label}),this.dataChannel.onopen=()=>{n.info("REALTIME_WEBRTC_DC","✅ Data channel opened",{readyState:this.dataChannel?.readyState,label:this.dataChannel?.label})},this.dataChannel.onclose=()=>{n.info("REALTIME_WEBRTC_DC","🔌 Data channel closed",{readyState:this.dataChannel?.readyState})},this.dataChannel.onerror=t=>{n.error("REALTIME_WEBRTC_DC","❌ Data channel error",{error:t,readyState:this.dataChannel?.readyState})},this.dataChannel.onmessage=t=>{try{const a=JSON.parse(t.data);["session.updated","conversation.item.input_audio_transcription.delta","conversation.item.input_audio_transcription.completed","response.audio_transcript.delta","response.audio_transcript.done","response.done","error","input_audio_buffer.speech_started","input_audio_buffer.speech_stopped","conversation.item.created"].includes(a.type)&&n.info("REALTIME_WEBRTC",`📨 Important message: ${a.type}`,{type:a.type,hasContent:!!a.delta||!!a.transcript}),a.type==="session.updated"&&this.sessionConfiguredResolve&&(n.info("REALTIME_WEBRTC","✅ Session configuration confirmed by server"),this.sessionConfigured=!0,this.sessionConfiguredResolve(),this.sessionConfiguredResolve=null),a.type==="input_audio_buffer.speech_started"&&(this.lastSpeechDetectedAt=Date.now(),n.info("REALTIME_WEBRTC","🎤 Speech detection active - VAD working correctly")),this.messageHandlers.forEach(i=>{try{i(a)}catch(o){n.error("REALTIME_WEBRTC","Error in message handler",{error:o instanceof Error?o.message:String(o),messageType:a.type})}})}catch(a){n.error("REALTIME_WEBRTC","Error parsing data channel message",{error:a instanceof Error?a.message:String(a),data:t.data})}})}setupConnectionHandlers(){this.peerConnection&&(this.peerConnection.onconnectionstatechange=()=>{const t=this.peerConnection?.connectionState;if(n.info("REALTIME_WEBRTC",`Connection state changed: ${t}`),(t==="failed"||t==="closed"||t==="disconnected")&&(this.isConnected=!1,this.disconnectHandlers.forEach(a=>{try{a()}catch(r){n.error("REALTIME_WEBRTC","Error in disconnect handler",{error:r})}}),t==="failed")){const a=new Error("WebRTC connection failed");this.errorHandlers.forEach(r=>{try{r(a)}catch(i){n.error("REALTIME_WEBRTC","Error in error handler",{handlerError:i})}})}},this.peerConnection.oniceconnectionstatechange=()=>{const t=this.peerConnection?.iceConnectionState;n.info("REALTIME_WEBRTC",`ICE connection state changed: ${t}`)},this.peerConnection.onicegatheringstatechange=()=>{const t=this.peerConnection?.iceGatheringState;n.debug("REALTIME_WEBRTC",`ICE gathering state changed: ${t}`)})}disconnect(){n.info("REALTIME_WEBRTC","Disconnecting..."),this.cleanup()}cleanup(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.localStream&&(this.localStream.getTracks().forEach(t=>t.stop()),this.localStream=null),this.audioElement&&(this.audioElement.pause(),this.audioElement.srcObject=null,this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement=null),this.audioPlaybackStarted=!1,this.audioAutoplayBlocked=!1,this.sessionConfigured=!1,this.sessionConfiguredResolve=null,this.audioInputActive=!1,this.lastSpeechDetectedAt=null,this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null),this.isConnected=!1,n.info("REALTIME_WEBRTC","Cleanup complete")}startHealthCheck(){this.healthCheckInterval=window.setInterval(()=>{const t=this.getConnectionDiagnostics();n.debug("REALTIME_WEBRTC_HEALTH","💓 Health check",{...t,timeSinceLastSpeech:this.lastSpeechDetectedAt?Date.now()-this.lastSpeechDetectedAt:null}),t.isConnected&&!t.audioInputActive&&n.warn("REALTIME_WEBRTC_HEALTH","⚠️ Audio input not active despite connection"),t.isConnected&&t.dataChannelState!=="open"&&n.error("REALTIME_WEBRTC_HEALTH","❌ Data channel not open - messages cannot be sent")},3e4)}verifyAudioInput(){if(!this.localStream){n.warn("REALTIME_WEBRTC_INPUT","⚠️ No local audio stream");return}const t=this.localStream.getAudioTracks();if(t.length===0){n.error("REALTIME_WEBRTC_INPUT","❌ No audio tracks in local stream");return}this.audioInputActive=!1,t.forEach((a,r)=>{n.info("REALTIME_WEBRTC_INPUT",`🎤 Audio track ${r} status:`,{label:a.label,kind:a.kind,enabled:a.enabled,muted:a.muted,readyState:a.readyState,settings:a.getSettings()}),a.readyState==="live"&&a.enabled?(this.audioInputActive=!0,n.info("REALTIME_WEBRTC_INPUT","✅ Audio input is active and ready",{trackId:a.id,label:a.label,muted:a.muted})):n.warn("REALTIME_WEBRTC_INPUT","⚠️ Audio input may not be working correctly",{readyState:a.readyState,enabled:a.enabled,muted:a.muted})}),this.audioInputActive?n.info("REALTIME_WEBRTC_INPUT","✅✅✅ Audio input verification PASSED - Ready for speech detection"):n.error("REALTIME_WEBRTC_INPUT","❌❌❌ Audio input verification FAILED - Speech may not be detected")}getConnectionDiagnostics(){return{isConnected:this.isConnected,sessionConfigured:this.sessionConfigured,audioInputActive:this.audioInputActive,peerConnectionState:this.peerConnection?.connectionState||"none",iceConnectionState:this.peerConnection?.iceConnectionState||"none",dataChannelState:this.dataChannel?.readyState||"none",localStreamActive:this.localStream?.active||!1,audioTracksCount:this.localStream?.getAudioTracks().length||0}}sendMessage(t){if(!this.dataChannel||this.dataChannel.readyState!=="open"){n.error("REALTIME_WEBRTC_SEND","❌ Cannot send message: data channel not open",{hasDataChannel:!!this.dataChannel,readyState:this.dataChannel?.readyState,messageType:t.type,timestamp:new Date().toISOString()});return}try{const a=JSON.stringify(t);this.dataChannel.send(a),n.info("REALTIME_WEBRTC_SEND",`✅ Message sent: ${t.type}`,{type:t.type,size:a.length,readyState:this.dataChannel.readyState})}catch(a){n.error("REALTIME_WEBRTC_SEND","❌ Error sending message",{error:a instanceof Error?a.message:String(a),messageType:t.type,readyState:this.dataChannel?.readyState})}}async configureSession(t,a){if(this.sessionConfigured){n.warn("REALTIME_WEBRTC","⚠️ Session already configured, skipping");return}return n.info("REALTIME_WEBRTC","⚙️ Configuring session with turn detection and transcription",{mode:a,promptLength:t.length}),this.sendMessage({type:"session.update",session:{instructions:t,modalities:["text","audio"],voice:this.config?.voice||"alloy",input_audio_format:"pcm16",output_audio_format:"pcm16",input_audio_transcription:{model:"whisper-1"},turn_detection:{type:"server_vad",threshold:.5,prefix_padding_ms:300,silence_duration_ms:700,create_response:!0},temperature:this.config?.temperature||.8,max_response_output_tokens:this.config?.maxTokens||4096}}),n.info("REALTIME_WEBRTC","✅ Session configuration sent - VAD and transcription enabled"),new Promise(r=>{this.sessionConfiguredResolve=r,setTimeout(()=>{!this.sessionConfigured&&this.sessionConfiguredResolve&&(n.warn("REALTIME_WEBRTC","⚠️ Session configuration confirmation timeout, continuing anyway"),this.sessionConfigured=!0,this.sessionConfiguredResolve=null,r())},3e3)})}sendAudio(t){n.debug("REALTIME_WEBRTC","Audio is handled automatically by WebRTC, ignoring manual send")}commitAudioBuffer(){n.debug("REALTIME_WEBRTC","Audio buffer commit not needed with WebRTC")}cancelResponse(){this.sendMessage({type:"response.cancel"}),n.debug("REALTIME_WEBRTC","Response cancellation requested")}sendTextMessage(t){this.sendMessage({type:"conversation.item.create",item:{type:"message",role:"user",content:[{type:"input_text",text:t}]}}),this.sendMessage({type:"response.create"}),n.debug("REALTIME_WEBRTC","Text message sent",{text:t})}onMessage(t){return this.messageHandlers.add(t),()=>this.messageHandlers.delete(t)}onError(t){return this.errorHandlers.add(t),()=>this.errorHandlers.delete(t)}onConnect(t){return this.connectHandlers.add(t),()=>this.connectHandlers.delete(t)}onDisconnect(t){return this.disconnectHandlers.add(t),()=>this.disconnectHandlers.delete(t)}get connected(){return this.isConnected}get readyState(){if(!this.peerConnection)return 3;switch(this.peerConnection.connectionState){case"new":case"connecting":return 0;case"connected":return 1;case"disconnected":case"failed":case"closed":return 3;default:return 3}}setupAudioEventHandlers(){this.audioElement&&(this.audioElement.onplay=()=>{n.info("REALTIME_WEBRTC_AUDIO","▶️ Audio playback started successfully",{volume:this.audioElement?.volume,muted:this.audioElement?.muted,duration:this.audioElement?.duration}),this.audioPlaybackStarted=!0,this.audioAutoplayBlocked=!1},this.audioElement.onplaying=()=>{n.info("REALTIME_WEBRTC_AUDIO","🔊 Audio is playing",{currentTime:this.audioElement?.currentTime,volume:this.audioElement?.volume})},this.audioElement.onpause=()=>{n.warn("REALTIME_WEBRTC_AUDIO","⏸️ Audio playback paused (unexpected for streaming)",{currentTime:this.audioElement?.currentTime})},this.audioElement.onerror=t=>{n.error("REALTIME_WEBRTC_AUDIO","❌ Audio playback error",{error:this.audioElement?.error?.message,code:this.audioElement?.error?.code,networkState:this.audioElement?.networkState,readyState:this.audioElement?.readyState})},this.audioElement.onloadeddata=()=>{n.info("REALTIME_WEBRTC_AUDIO","📦 Audio data loaded",{duration:this.audioElement?.duration,readyState:this.audioElement?.readyState})},this.audioElement.onloadedmetadata=()=>{n.info("REALTIME_WEBRTC_AUDIO","📋 Audio metadata loaded")},this.audioElement.onvolumechange=()=>{n.debug("REALTIME_WEBRTC_AUDIO","🔊 Volume changed",{volume:this.audioElement?.volume,muted:this.audioElement?.muted})})}async ensureAudioPlayback(){if(!(!this.audioElement||this.audioPlaybackStarted))try{n.info("REALTIME_WEBRTC_AUDIO","🎵 Attempting to start audio playback...");const t=this.audioElement.play();t!==void 0&&(await t,n.info("REALTIME_WEBRTC_AUDIO","✅ Audio playback started automatically"),this.audioPlaybackStarted=!0,this.audioAutoplayBlocked=!1)}catch(t){t instanceof Error&&t.name==="NotAllowedError"?(n.warn("REALTIME_WEBRTC_AUDIO","⚠️ Autoplay blocked by browser",{error:t.message,solution:"User interaction required to start audio"}),this.audioAutoplayBlocked=!0,this.notifyAutoplayBlocked()):n.error("REALTIME_WEBRTC_AUDIO","❌ Failed to start audio playback",{error:t instanceof Error?t.message:String(t)})}}notifyAutoplayBlocked(){n.warn("REALTIME_WEBRTC_AUDIO","🚨 AUTOPLAY BLOCKED - User action required",{message:"The browser blocked audio autoplay. User must click to enable audio.",action:"Call enableAudioPlayback() after user interaction"});const t=new CustomEvent("voiceCoachAutoplayBlocked",{detail:{message:"Cliquez pour activer l'audio du coach",action:"enableAudioPlayback"}});window.dispatchEvent(t)}async enableAudioPlayback(){if(!this.audioElement)return n.error("REALTIME_WEBRTC_AUDIO","❌ No audio element available"),!1;if(this.audioPlaybackStarted)return n.info("REALTIME_WEBRTC_AUDIO","✅ Audio playback already started"),!0;try{return n.info("REALTIME_WEBRTC_AUDIO","👆 User interaction - enabling audio playback..."),await this.audioElement.play(),this.audioPlaybackStarted=!0,this.audioAutoplayBlocked=!1,n.info("REALTIME_WEBRTC_AUDIO","✅ Audio playback enabled by user interaction"),!0}catch(t){return n.error("REALTIME_WEBRTC_AUDIO","❌ Failed to enable audio playback",{error:t instanceof Error?t.message:String(t)}),!1}}getAudioDiagnostics(){return{hasAudioElement:!!this.audioElement,isPlaybackStarted:this.audioPlaybackStarted,isAutoplayBlocked:this.audioAutoplayBlocked,volume:this.audioElement?.volume??0,muted:this.audioElement?.muted??!1,readyState:this.audioElement?.readyState??0,networkState:this.audioElement?.networkState??0,paused:this.audioElement?.paused??!0,hasStream:!!this.audioElement?.srcObject,streamActive:this.audioElement?.srcObject?.active??!1,audioTracks:this.audioElement?.srcObject?.getAudioTracks().length??0}}logAudioDiagnostics(){const t=this.getAudioDiagnostics();n.info("REALTIME_WEBRTC_AUDIO","🔍 AUDIO DIAGNOSTICS",t)}}const te=new Ns;class ks{constructor(){B(this,"isInitialized",!1);B(this,"currentCoachMessage","")}async initialize(){if(this.isInitialized){n.debug("VOICE_ORCHESTRATOR","Already initialized");return}try{n.info("VOICE_ORCHESTRATOR","Initializing voice coach orchestrator (WebRTC mode)"),n.debug("VOICE_ORCHESTRATOR","Checking Supabase configuration");const t="https://kwipydbtjagypocpvbwn.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U";n.debug("VOICE_ORCHESTRATOR","Supabase configuration OK, setting up handlers"),n.debug("VOICE_ORCHESTRATOR","Setting up Realtime handlers"),this.setupRealtimeHandlers(),this.isInitialized=!0,n.info("VOICE_ORCHESTRATOR","Voice coach orchestrator initialized successfully (WebRTC mode)")}catch(t){throw n.error("VOICE_ORCHESTRATOR","Initialization failed",{error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),t}}async startVoiceSession(t){const a=W.getState();try{if(n.info("VOICE_ORCHESTRATOR","🚀 Starting voice session (WebRTC)",{mode:t}),a.voiceState==="listening"||a.voiceState==="speaking"){n.warn("VOICE_ORCHESTRATOR","Session already active");return}n.info("VOICE_ORCHESTRATOR","📡 Setting voice state to connecting"),a.setVoiceState("connecting"),n.info("VOICE_ORCHESTRATOR","🔬 Running pre-connection diagnostics");const{VoiceConnectionDiagnostics:r}=await Yi(async()=>{const{VoiceConnectionDiagnostics:h}=await import("./voiceConnectionDiagnostics-BNW5zCZG.js");return{VoiceConnectionDiagnostics:h}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),l=(await new r().runAllTests()).filter(h=>!h.passed);if(l.length>0){n.error("VOICE_ORCHESTRATOR","❌ Diagnostics failed",{failedTests:l.map(x=>({test:x.test,message:x.message}))});const h=l.map(x=>`• ${x.test}: ${x.message}`).join(`
`);throw new Error(`Voice connection prerequisites failed:

${h}

Please check the console for detailed diagnostics.`)}n.info("VOICE_ORCHESTRATOR","✅ All diagnostics passed");const m=ne.getState().profile?.displayName||"champion",d=a.modeConfigs[t];if(!d)throw new Error(`Invalid mode: ${t}`);const g=`${d.systemPrompt}

IMPORTANT: L'utilisateur s'appelle ${m}. Adresse-toi à lui par son prénom pour créer une relation plus chaleureuse et personnelle.`;n.info("VOICE_ORCHESTRATOR","👤 Personalized system prompt",{firstName:m,mode:t}),n.info("VOICE_ORCHESTRATOR","🌐 Connecting to Realtime API via WebRTC"),await te.connect({model:"gpt-realtime-mini",voice:"alloy",temperature:.8,maxTokens:4096,instructions:g}),n.info("VOICE_ORCHESTRATOR","✅ Realtime API WebRTC connected successfully"),n.info("VOICE_ORCHESTRATOR","⚙️ Configuring session with VAD and transcription"),await te.configureSession(g,t),n.info("VOICE_ORCHESTRATOR","✅ Session configuration confirmed by server");const p=te.getConnectionDiagnostics();n.info("VOICE_ORCHESTRATOR","🔍 Connection diagnostics after configuration:",p),p.audioInputActive||n.warn("VOICE_ORCHESTRATOR","⚠️ Audio input may not be active - user speech detection might not work"),n.info("VOICE_ORCHESTRATOR","💬 Starting conversation in store"),a.startConversation(t),n.info("VOICE_ORCHESTRATOR","🎙️ Setting communication mode to voice (realtime)"),a.setCommunicationMode("voice"),a.setInputMode("realtime");const f={training:`Salut ${m}! Je suis ton coach sportif personnel. Prêt à donner le meilleur de toi-même aujourd'hui?`,nutrition:`Salut ${m}! Nous voilà prêts à optimiser notre alimentation. Qu'est-ce que nous allons travailler aujourd'hui?`,fasting:`Salut ${m}! Nous commençons une nouvelle session de jeûne ensemble. Comment nous sentons-nous?`,general:`Salut ${m}! Nous sommes TwinCoach, ton compagnon de progression. Qu'est-ce que nous allons accomplir aujourd'hui?`,"body-scan":`Salut ${m}! Regardons ensemble notre évolution corporelle. Prêt à découvrir nos progrès?`}[t]||`Bonjour ${m}! Nous sommes là pour t'accompagner. Que souhaitons-nous faire aujourd'hui?`;n.info("VOICE_ORCHESTRATOR","👋 Triggering personalized welcome message from coach",{firstName:m,mode:t}),te.sendTextMessage(f),n.info("VOICE_ORCHESTRATOR","👂 Setting voice state to listening"),a.setVoiceState("listening"),n.info("VOICE_ORCHESTRATOR","✅✅✅ Voice session started successfully - STATE = LISTENING ✅✅✅")}catch(r){n.error("VOICE_ORCHESTRATOR","Failed to start voice session",{error:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0}),n.error("VOICE_ORCHESTRATOR","❌ CRITICAL: Voice session failed to start"),a.setVoiceState("error");let i="Failed to start voice session";throw r instanceof Error&&(r.message.includes("permission")?i="Microphone permission required":r.message.includes("connect")||r.message.includes("WebRTC")?i="Unable to connect to voice service":i=r.message),n.error("VOICE_ORCHESTRATOR","💥 Error message for user",{errorMessage:i}),a.setError(i),r}}async stopVoiceSession(){try{n.info("VOICE_ORCHESTRATOR","Stopping voice session"),te.disconnect();const t=W.getState();t.endConversation(),t.setVoiceState("idle"),n.info("VOICE_ORCHESTRATOR","Voice session stopped")}catch(t){n.error("VOICE_ORCHESTRATOR","Error stopping voice session",{error:t})}}setupRealtimeHandlers(){te.onMessage(t=>{this.handleRealtimeMessage(t)}),te.onError(t=>{n.error("VOICE_ORCHESTRATOR","❌ Realtime API error",{error:t.message,stack:t.stack});const a=W.getState();a.setVoiceState("error"),a.setError(t.message)}),te.onConnect(()=>{n.info("VOICE_ORCHESTRATOR","✅ Realtime API WebRTC connected successfully")}),te.onDisconnect(()=>{n.info("VOICE_ORCHESTRATOR","🔌 Realtime API disconnected")})}handleRealtimeMessage(t){const a=W.getState();switch(n.info("VOICE_ORCHESTRATOR",`📨 Received Realtime message: ${t.type}`,{type:t.type,hasContent:!!t.delta||!!t.transcript,hasDelta:!!t.delta,hasTranscript:!!t.transcript,hasAudio:!!t.audio,fullMessage:t}),t.type){case"input_audio_buffer.speech_started":n.info("VOICE_ORCHESTRATOR","🎤 User started speaking - VAD detected speech"),a.setVoiceState("processing"),a.setProcessing(!0);break;case"input_audio_buffer.speech_stopped":n.info("VOICE_ORCHESTRATOR","🔇 User stopped speaking - VAD detected silence");break;case"conversation.item.input_audio_transcription.delta":t.delta&&(n.info("VOICE_ORCHESTRATOR","📝 User transcription delta",{delta:t.delta}),a.setCurrentTranscription(a.currentTranscription+t.delta));break;case"conversation.item.input_audio_transcription.completed":t.transcript&&(n.info("VOICE_ORCHESTRATOR","✅ User transcription completed",{transcript:t.transcript}),a.setCurrentTranscription(t.transcript),a.addMessage({role:"user",content:t.transcript}),a.setCurrentTranscription(""));break;case"conversation.item.created":n.info("VOICE_ORCHESTRATOR","📋 Conversation item created",{itemId:t.item?.id,itemType:t.item?.type,itemRole:t.item?.role});break;case"response.audio.delta":a.voiceState!=="speaking"&&(n.info("VOICE_ORCHESTRATOR","🔊 Coach speaking via WebRTC, setting state to speaking"),a.setVoiceState("speaking"),a.setSpeaking(!0));break;case"response.audio_transcript.delta":if(t.delta){n.info("VOICE_ORCHESTRATOR","💬 Coach transcript delta",{delta:t.delta.substring(0,50)}),this.currentCoachMessage+=t.delta;const r=a.messages,i=r[r.length-1];if(i&&i.role==="coach"){n.debug("VOICE_ORCHESTRATOR","🔄 Updating existing coach message");const o=r.slice(0,-1);a.clearMessages(),o.forEach(l=>a.addMessage(l)),a.addMessage({role:"coach",content:this.currentCoachMessage})}else n.info("VOICE_ORCHESTRATOR","➕ Creating new coach message"),a.addMessage({role:"coach",content:this.currentCoachMessage})}break;case"response.audio_transcript.done":this.currentCoachMessage&&(n.info("VOICE_ORCHESTRATOR","✅ Coach transcript completed",{fullMessage:this.currentCoachMessage.substring(0,100)+"..."}),this.currentCoachMessage="");break;case"response.audio.done":n.info("VOICE_ORCHESTRATOR","✅ Audio response completed"),a.setSpeaking(!1);break;case"response.done":n.info("VOICE_ORCHESTRATOR","✅ Response done, setting state back to listening"),a.setVoiceState("listening"),a.setProcessing(!1),a.setSpeaking(!1);break;case"error":n.error("VOICE_ORCHESTRATOR","❌ Realtime API error from server",{errorMessage:t.error?.message,errorType:t.error?.type,fullMessage:t}),a.setVoiceState("error"),a.setError(t.error?.message||"Unknown error");break;case"session.updated":n.info("VOICE_ORCHESTRATOR","⚙️ Session configuration updated");break;case"response.created":n.info("VOICE_ORCHESTRATOR","🎯 Response creation started by server"),a.setVoiceState("processing"),a.setProcessing(!0);break;default:n.debug("VOICE_ORCHESTRATOR","❓ Unhandled message type",{type:t.type})}}cleanup(){this.currentCoachMessage="",this.isInitialized=!1}get initialized(){return this.isInitialized}}const he=new ks,Se=({message:s,stepColor:t,showCTA:a=!1,ctaButtons:r=[],onCTAClick:i})=>{const{currentMode:o}=pe(),l=o==="training",c=s.role==="coach";return s.role==="system"?e.jsx(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"flex justify-center my-4",children:e.jsxs("div",{className:"system-message px-4 py-2 rounded-full bg-white/5 border border-white/10 text-xs text-white/60 flex items-center gap-2",children:[e.jsx(j,{Icon:v.Info,size:12}),s.content]})}):e.jsx(y.div,{initial:{opacity:0,y:10,x:c?-10:10},animate:{opacity:1,y:0,x:0},transition:{duration:.3,ease:"easeOut"},className:`flex ${c?"justify-start":"justify-end"} mb-4`,children:e.jsxs("div",{className:`flex flex-col gap-2 ${c?"items-start":"items-end"} max-w-[85%]`,children:[e.jsxs("div",{className:`flex ${c?"flex-row":"flex-row-reverse"} items-end gap-2`,children:[c&&e.jsx("div",{className:"message-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${t} 40%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.1)
                `,border:`1.5px solid color-mix(in srgb, ${t} 50%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${t} 30%, transparent)`},children:e.jsx(j,{Icon:v.Zap,size:16,style:{color:t,filter:`drop-shadow(0 0 8px color-mix(in srgb, ${t} 60%, transparent))`}})}),e.jsxs("div",{className:`coach-message-bubble ${c?"coach-message-bubble--coach":"coach-message-bubble--user"} ${c?"px-4":"px-5"} py-3 rounded-2xl relative`,style:{background:c?`
                    radial-gradient(circle at 30% 30%, color-mix(in srgb, ${t} 15%, transparent) 0%, transparent 70%),
                    rgba(255, 255, 255, 0.08)
                  `:"rgba(255, 255, 255, 0.12)",border:c?`1px solid color-mix(in srgb, ${t} 25%, transparent)`:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:c?`
                    0 2px 8px rgba(0, 0, 0, 0.2),
                    0 0 16px color-mix(in srgb, ${t} 15%, transparent),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1)
                  `:`
                    0 2px 8px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15)
                  `,backdropFilter:"blur(12px) saturate(140%)",WebkitBackdropFilter:"blur(12px) saturate(140%)",borderRadius:c?"4px 16px 16px 16px":"16px 4px 16px 16px"},children:[e.jsx("p",{className:"message-content-text text-sm text-white leading-relaxed",style:{wordBreak:"normal",overflowWrap:"break-word",whiteSpace:"pre-wrap",hyphens:"none",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none"},children:s.content}),s.type==="audio"&&e.jsxs("div",{className:"audio-message-indicator flex items-center gap-2 mt-2 pt-2 border-t border-white/10",children:[e.jsx(j,{Icon:v.Volume2,size:12,style:{color:"rgba(255,255,255,0.6)"}}),e.jsx("span",{className:"text-xs text-white/60",children:"Message vocal"})]}),e.jsx("div",{className:`message-timestamp text-[10px] text-white/40 mt-1 ${c?"text-left":"text-right"}`,children:new Date(s.timestamp).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]})]}),c&&a&&l&&r.length>0&&e.jsx("div",{className:"flex flex-col gap-2 pl-10 self-stretch",children:r.map((d,g)=>{const p=d.icon?v[d.icon]:null,u=d.variant==="primary";return e.jsxs(y.button,{onClick:()=>i?.(d.id),className:"flex items-center justify-center gap-2 py-2.5 px-4 rounded-xl font-medium text-sm",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:g*.1,type:"spring",stiffness:400,damping:17},whileHover:{scale:1.02,x:2},whileTap:{scale:.98},style:{background:u?`
                          radial-gradient(circle at 30% 30%, color-mix(in srgb, ${t} 25%, transparent) 0%, transparent 70%),
                          color-mix(in srgb, ${t} 18%, rgba(255, 255, 255, 0.08))
                        `:`
                          radial-gradient(circle at 50% 0%, rgba(255, 255, 255, 0.08) 0%, transparent 70%),
                          rgba(255, 255, 255, 0.05)
                        `,border:u?`1.5px solid color-mix(in srgb, ${t} 35%, transparent)`:"1px solid rgba(255, 255, 255, 0.12)",backdropFilter:"blur(10px)",boxShadow:u?`
                          0 2px 12px color-mix(in srgb, ${t} 20%, transparent),
                          inset 0 1px 0 rgba(255, 255, 255, 0.12)
                        `:"inset 0 1px 0 rgba(255, 255, 255, 0.08)",color:u?t:"rgba(255, 255, 255, 0.9)"},children:[p&&e.jsx(j,{Icon:p,size:14,style:{color:u?t:"rgba(255, 255, 255, 0.8)",filter:u?`drop-shadow(0 0 8px color-mix(in srgb, ${t} 50%, transparent))`:"none"}}),e.jsx("span",{children:d.label})]},d.id)})})]})})},_s=({exercises:s,programType:t,introText:a,onExerciseClick:r,stepColor:i})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-white/90 text-[15px] leading-relaxed",children:a||"Parfait ! Voici les exercices de ta séance. Lequel souhaites-tu ajuster ?"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map((o,l)=>e.jsxs(y.button,{onClick:()=>r(o.id,o.name),className:"exercise-chip",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:l*.05},whileHover:{scale:1.02},whileTap:{scale:.98},style:{padding:"12px 20px",background:"rgba(255, 255, 255, 0.08)",border:"1.5px solid rgba(255, 255, 255, 0.15)",borderRadius:"16px",backdropFilter:"blur(12px)",color:"white",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},children:[o.orderIndex,". ",o.name]},o.id))})]}),Ms=[{id:"increase-sets",label:"+1 Série",icon:"Plus",color:"#10B981",category:"volume",action:"increase",description:"Ajouter une série supplémentaire",shortMessage:"J'aimerais ajouter une série supplémentaire"},{id:"decrease-sets",label:"-1 Série",icon:"Minus",color:"#F59E0B",category:"volume",action:"decrease",description:"Retirer une série",shortMessage:"J'aimerais retirer une série"},{id:"increase-reps",label:"+2 Reps",icon:"TrendingUp",color:"#22C55E",category:"volume",action:"increase",description:"Augmenter le nombre de répétitions",shortMessage:"J'aimerais faire plus de répétitions"},{id:"decrease-reps",label:"-2 Reps",icon:"TrendingDown",color:"#EF4444",category:"volume",action:"decrease",description:"Diminuer le nombre de répétitions",shortMessage:"J'aimerais faire moins de répétitions"},{id:"increase-load",label:"Charge +",icon:"ChevronUp",color:"#8B5CF6",category:"intensity",action:"increase",description:"Augmenter la charge",shortMessage:"C'est trop léger, je peux mettre plus lourd"},{id:"decrease-load",label:"Charge -",icon:"ChevronDown",color:"#EC4899",category:"intensity",action:"decrease",description:"Diminuer la charge",shortMessage:"C'est trop lourd, je dois alléger"},{id:"adjust-tempo",label:"Tempo",icon:"Timer",color:"#06B6D4",category:"technique",action:"modify",description:"Modifier le tempo d'exécution",shortMessage:"Je veux ajuster le tempo de cet exercice"},{id:"adjust-rest",label:"Repos",icon:"Clock",color:"#3B82F6",category:"timing",action:"modify",description:"Modifier le temps de repos",shortMessage:"Je voudrais ajuster le temps de repos"},{id:"increase-rest",label:"Repos +30s",icon:"PlusCircle",color:"#14B8A6",category:"timing",action:"increase",description:"Augmenter le temps de repos de 30 secondes",shortMessage:"J'ai besoin de plus de repos entre les séries"},{id:"decrease-rest",label:"Repos -30s",icon:"MinusCircle",color:"#F97316",category:"timing",action:"decrease",description:"Diminuer le temps de repos de 30 secondes",shortMessage:"Je peux réduire le temps de repos"},{id:"easier-variant",label:"Variante Facile",icon:"ArrowDown",color:"#84CC16",category:"substitution",action:"substitute",description:"Proposer une variante plus facile",shortMessage:"Cet exercice est trop difficile, tu as une variante plus facile ?"},{id:"harder-variant",label:"Variante Difficile",icon:"ArrowUp",color:"#DC2626",category:"substitution",action:"substitute",description:"Proposer une variante plus difficile",shortMessage:"Cet exercice est trop facile, tu as une variante plus difficile ?"},{id:"change-equipment",label:"Changer Équipement",icon:"Settings",color:"#6366F1",category:"equipment",action:"substitute",description:"Utiliser un autre équipement",shortMessage:"Je n'ai pas cet équipement, on peut adapter ?"},{id:"bodyweight-variant",label:"Poids Corps",icon:"User",color:"#A855F7",category:"equipment",action:"substitute",description:"Version au poids du corps",shortMessage:"Je préférerais une version au poids du corps"},{id:"technique-help",label:"Aide Technique",icon:"HelpCircle",color:"#0EA5E9",category:"technique",action:"info",description:"Obtenir des conseils techniques",shortMessage:"Je voudrais des conseils sur la technique de cet exercice"},{id:"substitute-exercise",label:"Autre Exercice",icon:"RefreshCw",color:"#F59E0B",category:"substitution",action:"substitute",description:"Remplacer complètement l'exercice",shortMessage:"Je voudrais remplacer cet exercice par un autre"}],Os=[{id:"volume",label:"Volume",icon:"BarChart3",color:"#10B981",description:"Séries et répétitions"},{id:"intensity",label:"Intensité",icon:"Zap",color:"#8B5CF6",description:"Charge et difficulté"},{id:"technique",label:"Technique",icon:"Target",color:"#06B6D4",description:"Exécution et tempo"},{id:"equipment",label:"Équipement",icon:"Wrench",color:"#6366F1",description:"Matériel utilisé"},{id:"substitution",label:"Substitution",icon:"Repeat",color:"#F59E0B",description:"Variantes et alternatives"},{id:"timing",label:"Timing",icon:"Clock",color:"#3B82F6",description:"Temps de repos"}],Fs=({exerciseName:s,onCategorySelect:t,stepColor:a})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-white/90 text-[15px] leading-relaxed",children:["Super ! Qu'est-ce que tu veux ajuster sur ",e.jsx("strong",{className:"text-white font-semibold",children:s})," ?"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Os.map((r,i)=>{const o=v[r.icon];return e.jsxs(y.button,{onClick:()=>t(r.id),className:"category-card",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:i*.06},whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},style:{padding:"16px",background:`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${r.color} 12%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.06)
                `,border:`1.5px solid color-mix(in srgb, ${r.color} 30%, transparent)`,borderRadius:"16px",backdropFilter:"blur(12px)",boxShadow:`
                  0 2px 8px rgba(0, 0, 0, 0.15),
                  0 0 16px color-mix(in srgb, ${r.color} 10%, transparent)
                `,cursor:"pointer",position:"relative",overflow:"hidden"},children:[e.jsx("div",{className:"absolute inset-0 opacity-0 hover:opacity-100 transition-opacity",style:{background:`radial-gradient(circle at center, color-mix(in srgb, ${r.color} 20%, transparent) 0%, transparent 70%)`}}),e.jsxs("div",{className:"relative flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl flex-shrink-0",style:{background:`color-mix(in srgb, ${r.color} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${r.color} 35%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${r.color} 15%, transparent)`},children:o&&e.jsx(j,{Icon:o,size:20,style:{color:r.color,filter:`drop-shadow(0 0 6px color-mix(in srgb, ${r.color} 40%, transparent))`}})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-semibold text-[14px] mb-1",style:{color:r.color,textShadow:`0 0 8px color-mix(in srgb, ${r.color} 25%, transparent)`},children:r.label}),e.jsx("div",{className:"text-white/60 text-[12px] leading-tight",children:r.description})]})]})]},r.id)})})]}),Bs=({exerciseName:s,category:t,onOptionSelect:a,onBack:r,stepColor:i})=>{const o=Ms.filter(l=>l.category===t);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y.button,{onClick:r,className:"back-button p-2 rounded-full",whileHover:{scale:1.1},whileTap:{scale:.9},style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(255, 255, 255, 0.15)",backdropFilter:"blur(12px)"},children:e.jsx(j,{Icon:v.ArrowLeft,size:16,style:{color:"rgba(255,255,255,0.8)"}})}),e.jsxs("p",{className:"text-white/90 text-[15px] leading-relaxed flex-1",children:["Comment veux-tu ajuster ",e.jsx("strong",{className:"text-white font-semibold",children:s})," ?"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:o.map((l,c)=>{const m=v[l.icon];return e.jsxs(y.button,{onClick:()=>a(l.id),className:"option-card",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:c*.05},whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},style:{padding:"14px",background:`
                  radial-gradient(circle at 30% 20%, color-mix(in srgb, ${l.color} 10%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.06)
                `,border:`1.5px solid color-mix(in srgb, ${l.color} 25%, transparent)`,borderRadius:"14px",backdropFilter:"blur(12px)",boxShadow:`
                  0 2px 8px rgba(0, 0, 0, 0.12),
                  0 0 12px color-mix(in srgb, ${l.color} 8%, transparent)
                `,cursor:"pointer",textAlign:"left"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[m&&e.jsx("div",{className:"icon-container w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                        radial-gradient(circle at 30% 30%, color-mix(in srgb, ${l.color} 25%, transparent) 0%, transparent 70%),
                        color-mix(in srgb, ${l.color} 15%, rgba(255, 255, 255, 0.08))
                      `,border:`1px solid color-mix(in srgb, ${l.color} 35%, transparent)`,boxShadow:`0 0 10px color-mix(in srgb, ${l.color} 20%, transparent)`},children:e.jsx(j,{Icon:m,size:14,style:{color:l.color,filter:`drop-shadow(0 0 6px color-mix(in srgb, ${l.color} 45%, transparent))`}})}),e.jsx("span",{className:"font-bold text-[13px]",style:{color:l.color,textShadow:`0 0 8px color-mix(in srgb, ${l.color} 25%, transparent)`},children:l.label})]}),e.jsx("p",{className:"text-[11px] text-white/70 leading-tight line-clamp-2 ml-9",children:l.description})]},l.id)})}),e.jsx("style",{children:`
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]})},Ds=({exerciseName:s,adjustmentLabel:t,summary:a,onValidate:r,onModify:i,stepColor:o})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-white/90 text-[15px] leading-relaxed",children:["Voici ce que je vais appliquer à ",e.jsx("strong",{className:"text-white font-semibold",children:s})," :"]}),e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"preview-box",style:{padding:"18px",background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${o} 12%, transparent) 0%, transparent 70%),
            rgba(255, 255, 255, 0.08)
          `,border:`1.5px solid color-mix(in srgb, ${o} 30%, transparent)`,borderRadius:"16px",backdropFilter:"blur(14px)",boxShadow:`
            0 2px 12px rgba(0, 0, 0, 0.2),
            0 0 20px color-mix(in srgb, ${o} 12%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.12)
          `},children:[e.jsx("div",{className:"text-[13px] mb-2 uppercase tracking-wide font-bold",style:{color:o,textShadow:`0 0 8px color-mix(in srgb, ${o} 30%, transparent)`},children:t}),e.jsx("div",{className:"text-white text-[15px] font-medium leading-relaxed",children:a})]}),e.jsx("p",{className:"text-white/80 text-[14px]",children:"Est-ce que ça te convient ? 💪"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(y.button,{onClick:r,whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},className:"flex-1 flex items-center justify-center gap-2",style:{padding:"14px 24px",background:`
              linear-gradient(135deg, #10B981 0%, #059669 100%)
            `,border:"1.5px solid rgba(255, 255, 255, 0.25)",borderRadius:"14px",color:"white",fontSize:"15px",fontWeight:"700",cursor:"pointer",boxShadow:`
              0 4px 12px rgba(16, 185, 129, 0.25),
              0 0 20px rgba(16, 185, 129, 0.15),
              inset 0 1px 0 rgba(255, 255, 255, 0.2)
            `},children:[e.jsx(j,{Icon:v.Check,size:18,style:{filter:"drop-shadow(0 0 6px rgba(255,255,255,0.4))"}}),"Valider"]}),e.jsxs(y.button,{onClick:i,whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},className:"flex-1 flex items-center justify-center gap-2",style:{padding:"14px 24px",background:`
              radial-gradient(circle at 30% 30%, rgba(251, 146, 60, 0.15) 0%, transparent 70%),
              rgba(255, 255, 255, 0.08)
            `,border:"1.5px solid rgba(251, 146, 60, 0.3)",borderRadius:"14px",color:"#FB923C",fontSize:"15px",fontWeight:"700",cursor:"pointer",boxShadow:`
              0 2px 8px rgba(0, 0, 0, 0.15),
              0 0 16px rgba(251, 146, 60, 0.12)
            `,backdropFilter:"blur(12px)"},children:[e.jsx(j,{Icon:v.RefreshCw,size:18,style:{color:"#FB923C",filter:"drop-shadow(0 0 6px rgba(251, 146, 60, 0.4))"}}),"Modifier"]})]})]}),$s=({exerciseName:s,newParameters:t,onViewExercise:a,onContinue:r,stepColor:i})=>{const o=()=>{const l=[];return t.sets&&l.push(`${t.sets} séries`),t.reps&&l.push(`${t.reps} reps`),t.load&&l.push(t.load),t.rest&&l.push(`${t.rest} repos`),t.tempo&&l.push(`tempo ${t.tempo}`),l.length>0?l.join(" • "):"Paramètres mis à jour"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(y.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:15},className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-full flex-shrink-0",style:{background:`
              linear-gradient(135deg, #10B981 0%, #059669 100%)
            `,boxShadow:`
              0 4px 12px rgba(16, 185, 129, 0.3),
              0 0 20px rgba(16, 185, 129, 0.2),
              inset 0 1px 0 rgba(255, 255, 255, 0.25)
            `},children:e.jsx(j,{Icon:v.CheckCircle2,size:24,style:{color:"white",filter:"drop-shadow(0 0 8px rgba(255,255,255,0.5))"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-bold text-[16px] mb-1",children:"Modification appliquée ! ✓"}),e.jsxs("div",{className:"text-white/70 text-[14px] leading-relaxed",children:[e.jsx("strong",{className:"text-white",children:s})," a été mis à jour"]})]})]}),e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"parameters-preview",style:{padding:"14px 16px",background:`
            radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.12) 0%, transparent 70%),
            rgba(255, 255, 255, 0.06)
          `,border:"1.5px solid rgba(16, 185, 129, 0.25)",borderRadius:"12px",backdropFilter:"blur(12px)",boxShadow:`
            0 2px 8px rgba(0, 0, 0, 0.15),
            0 0 16px rgba(16, 185, 129, 0.1)
          `},children:[e.jsx("div",{className:"text-[12px] text-emerald-400 font-bold uppercase tracking-wide mb-1",children:"Nouveaux paramètres"}),e.jsx("div",{className:"text-white text-[13px] font-medium",children:o()})]}),e.jsx("p",{className:"text-white/80 text-[14px] leading-relaxed",children:"Regarde la carte mise à jour ou continue tes ajustements ! 💪"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(y.button,{onClick:a,whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},className:"flex-1 flex items-center justify-center gap-2",style:{padding:"14px 20px",background:`
              radial-gradient(circle at 30% 30%, color-mix(in srgb, ${i} 18%, transparent) 0%, transparent 70%),
              rgba(255, 255, 255, 0.1)
            `,border:`1.5px solid color-mix(in srgb, ${i} 35%, transparent)`,borderRadius:"14px",fontSize:"15px",fontWeight:"700",cursor:"pointer",boxShadow:`
              0 2px 10px rgba(0, 0, 0, 0.15),
              0 0 18px color-mix(in srgb, ${i} 15%, transparent)
            `,backdropFilter:"blur(12px)"},children:[e.jsx(j,{Icon:v.Eye,size:18,style:{color:i,filter:`drop-shadow(0 0 6px color-mix(in srgb, ${i} 45%, transparent))`}}),e.jsx("span",{style:{color:i,textShadow:`0 0 8px color-mix(in srgb, ${i} 30%, transparent)`},children:"Voir l'exercice"})]}),e.jsxs(y.button,{onClick:r,whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},className:"flex-1 flex items-center justify-center gap-2",style:{padding:"14px 20px",background:"rgba(255, 255, 255, 0.08)",border:"1.5px solid rgba(255, 255, 255, 0.18)",borderRadius:"14px",color:"white",fontSize:"15px",fontWeight:"700",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",backdropFilter:"blur(12px)"},children:[e.jsx(j,{Icon:v.ArrowRight,size:18,style:{filter:"drop-shadow(0 0 4px rgba(255,255,255,0.3))"}}),"Continuer"]})]})]})},Ps=({message:s,stepColor:t,onExerciseClick:a,onCategorySelect:r,onOptionSelect:i,onValidate:o,onModify:l,onViewExercise:c,onContinue:m,onBack:d})=>{switch(s.type){case"exercise-list-intro":if(s.metadata?.exerciseListData&&a){const{exercises:g,programType:p,introText:u}=s.metadata.exerciseListData;return e.jsx(_s,{exercises:g,programType:p,introText:u,onExerciseClick:a,stepColor:t})}break;case"category-selection":if(s.metadata?.exerciseName&&r)return e.jsx(Fs,{exerciseName:s.metadata.exerciseName,onCategorySelect:r,stepColor:t});break;case"option-selection":if(s.metadata?.exerciseName&&s.metadata?.category&&i&&d)return e.jsx(Bs,{exerciseName:s.metadata.exerciseName,category:s.metadata.category,onOptionSelect:i,onBack:d,stepColor:t});break;case"validation":if(s.metadata?.validationData&&o&&l){const{exerciseName:g,adjustmentLabel:p,summary:u}=s.metadata.validationData;return e.jsx(Ds,{exerciseName:g,adjustmentLabel:p,summary:u,onValidate:o,onModify:l,stepColor:t})}break;case"update-complete":if(s.metadata?.updateCompleteData&&c&&m){const{exerciseName:g,newParameters:p}=s.metadata.updateCompleteData;return e.jsx($s,{exerciseName:g,newParameters:p,onViewExercise:c,onContinue:m,stepColor:t})}break;default:return e.jsx(Se,{message:s,stepColor:t})}return e.jsx(Se,{message:s,stepColor:t})},Ls=({stepColor:s})=>e.jsx(y.div,{initial:{opacity:0,y:10,x:-10},animate:{opacity:1,y:0,x:0},exit:{opacity:0,y:-10},className:"flex justify-start mb-4",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"message-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
              radial-gradient(circle at 30% 30%, color-mix(in srgb, ${s} 40%, transparent) 0%, transparent 70%),
              rgba(255, 255, 255, 0.1)
            `,border:`1.5px solid color-mix(in srgb, ${s} 50%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${s} 30%, transparent)`},children:e.jsx(j,{Icon:v.Zap,size:16,style:{color:s,filter:`drop-shadow(0 0 8px color-mix(in srgb, ${s} 60%, transparent))`}})}),e.jsx("div",{className:"typing-indicator px-5 py-3 rounded-2xl",style:{background:`
              radial-gradient(circle at 30% 30%, color-mix(in srgb, ${s} 15%, transparent) 0%, transparent 70%),
              rgba(255, 255, 255, 0.08)
            `,border:`1px solid color-mix(in srgb, ${s} 25%, transparent)`,boxShadow:`
              0 2px 8px rgba(0, 0, 0, 0.2),
              0 0 16px color-mix(in srgb, ${s} 15%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.1)
            `,backdropFilter:"blur(12px) saturate(140%)",WebkitBackdropFilter:"blur(12px) saturate(140%)",borderRadius:"4px 16px 16px 16px"},children:e.jsx("div",{className:"flex items-center gap-1.5",children:[0,1,2].map(t=>e.jsx("div",{className:"typing-dot",style:{background:`color-mix(in srgb, ${s} 60%, white)`}},t))})})]})}),Hs=({frequencies:s,color:t,isActive:a,height:r=80,barCount:i=32,className:o=""})=>{const l=C.useRef(null),c=C.useRef();return C.useEffect(()=>{const m=l.current;if(!m)return;const d=m.getContext("2d");if(!d)return;const g=window.devicePixelRatio||1,p=m.getBoundingClientRect();m.width=p.width*g,m.height=p.height*g,d.scale(g,g);const u=p.width/i,f=2,h=()=>{d.clearRect(0,0,p.width,p.height);for(let x=0;x<i;x++){const b=Math.floor(x/i*s.length),w=s[b]||0,S=Math.min(w/255,1),E=S*r*.8,I=x*u,T=r-E,A=d.createLinearGradient(I,T,I,r);A.addColorStop(0,t),A.addColorStop(1,`${t}40`),d.fillStyle=A,d.fillRect(I,T,u-f,E),a&&S>.1&&(d.shadowBlur=8,d.shadowColor=t,d.fillRect(I,T,u-f,E),d.shadowBlur=0)}c.current=requestAnimationFrame(h)};return h(),()=>{c.current&&cancelAnimationFrame(c.current)}},[s,t,a,r,i]),e.jsxs("div",{className:`audio-waveform-container ${o}`,style:{width:"100%",height:r},children:[e.jsx("canvas",{ref:l,style:{width:"100%",height:"100%",display:"block",transform:"translateZ(0)",willChange:"transform"}}),!a&&e.jsx(y.div,{className:"waveform-overlay",style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:e.jsx(y.div,{animate:{scale:[1,1.05,1],opacity:[.5,.8,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},style:{fontSize:"0.75rem",color:"rgba(255, 255, 255, 0.5)",textAlign:"center"},children:"En attente..."})})]})},Ws=s=>{const t=[];return(s.toLowerCase().includes("prêt")||s.toLowerCase().includes("commencer"))&&(t.push({label:"Oui, allons-y !",action:"confirm"}),t.push({label:"Pas encore",action:"wait"})),(s.toLowerCase().includes("ajuster")||s.toLowerCase().includes("modifier"))&&(t.push({label:"Modifier",action:"modify"}),t.push({label:"C'est bon",action:"keep"})),t},zs=({stepColor:s,isTyping:t=!1,className:a="",messagesContainerRef:r,onScrollChange:i,onExerciseClick:o,onCategorySelect:l,onOptionSelect:c,onValidate:m,onModify:d,onViewExercise:g,onContinue:p,onBack:u,onSendMessage:f})=>{const h=C.useRef(null),x=C.useRef(null),b=r||x,w=W(R=>R.messages),S=W(R=>R.currentMode),E=W(R=>R.voiceState),I=W(R=>R.currentTranscription),T=W(R=>R.isSpeaking),A=W(R=>R.visualization),N=E==="listening"||E==="speaking"||E==="processing",D=(R=!0)=>{h.current?.scrollIntoView({behavior:R?"smooth":"auto",block:"end"})};C.useEffect(()=>{D(!0)},[w,t]);const $=()=>{if(!b.current)return;const{scrollTop:R,scrollHeight:_,clientHeight:X}=b.current,Z=!(_-R-X<100);i&&i(Z)};return e.jsxs("div",{ref:b,onScroll:$,className:`messages-container flex-1 overflow-y-auto px-2.5 pt-1.5 pb-0 ${a}`,style:{overscrollBehavior:"contain",minHeight:0},children:[e.jsx(H,{children:N&&e.jsxs(y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:{position:"sticky",top:0,zIndex:10,marginBottom:"12px",padding:"12px 16px",borderRadius:"16px",background:`
                linear-gradient(180deg,
                  rgba(239, 68, 68, 0.25) 0%,
                  rgba(220, 38, 38, 0.15) 100%
                )
              `,backdropFilter:"blur(20px)",border:"1.5px solid rgba(239, 68, 68, 0.4)",boxShadow:"0 4px 24px rgba(239, 68, 68, 0.2), 0 0 32px rgba(239, 68, 68, 0.15)",display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(y.div,{animate:{scale:T?[1,1.2,1]:1,opacity:T?[.6,1,.6]:1},transition:{duration:1.5,repeat:1/0},style:{width:"10px",height:"10px",borderRadius:"50%",background:T?"#10B981":"#EF4444",boxShadow:T?"0 0 12px rgba(16, 185, 129, 0.8)":"0 0 12px rgba(239, 68, 68, 0.8)"}}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:600,color:"#FFF"},children:[E==="listening"&&"En écoute...",E==="speaking"&&"Coach parle...",E==="processing"&&"Traitement..."]})]})}),A.frequencies&&A.frequencies.length>0&&e.jsx(Hs,{frequencies:A.frequencies,color:T?"#10B981":"#EF4444",isActive:N,height:40}),I&&e.jsxs(y.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.8)",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid rgba(255, 255, 255, 0.1)"},children:["Vous: ",I,"..."]})]})}),w.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center py-4",children:e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-md",children:[e.jsx("div",{className:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center",style:{background:`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${s} 35%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.1)
                `,border:`2px solid color-mix(in srgb, ${s} 40%, transparent)`,boxShadow:`0 0 24px color-mix(in srgb, ${s} 25%, transparent)`},children:e.jsx(y.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx("span",{className:"text-3xl",children:"💪"})})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Ton Coach est Prêt !"}),e.jsx("p",{className:"text-sm text-white/60 leading-relaxed",children:"Utilise le chat ci-dessous pour échanger avec ton coach IA"})]})}):e.jsxs(e.Fragment,{children:[w.map(R=>{const _=R;if(["exercise-list-intro","category-selection","option-selection","validation","update-complete"].includes(_.type)&&S==="training")return e.jsx(Ps,{message:_,stepColor:s,onExerciseClick:o,onCategorySelect:l,onOptionSelect:c,onValidate:m,onModify:d,onViewExercise:g,onContinue:p,onBack:u},R.id);const F=R.role==="coach"&&S==="training"&&R.type==="text",O=F?Ws(R.content):[],M=V=>{if(!f)return;const z={"reduce-intensity":"Je voudrais réduire la difficulté","increase-intensity":"J'aimerais augmenter l'intensité","adjust-sets":"Je veux ajuster le nombre de séries","adjust-reps":"Je veux modifier les répétitions","show-alternatives":"Montre-moi les alternatives","keep-exercise":"Je garde cet exercice","keep-as-is":"C'est parfait comme ça","yes-perfect":"Oui, c'est parfait !","need-changes":"J'aimerais faire quelques ajustements",understood:"Compris"}[V]||"OK";f(z)};return e.jsx(Se,{message:R,stepColor:s,showCTA:F,ctaButtons:O,onCTAClick:M},R.id)}),t&&e.jsx(Ls,{stepColor:s}),e.jsx("div",{ref:h})]}),e.jsx("style",{children:`
        .messages-container {
          scrollbar-width: thin;
          scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        .messages-container::-webkit-scrollbar {
          width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
          background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 3px;
        }

        .messages-container::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.3);
        }
      `})]})};class Us{constructor(){B(this,"mediaRecorder",null);B(this,"audioChunks",[]);B(this,"isRecording",!1);B(this,"stream",null)}async startRecording(){try{n.info("WHISPER_SERVICE","Starting audio recording"),this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3,channelCount:1}}),n.info("WHISPER_SERVICE","Microphone access granted");const t=this.getSupportedMimeType();this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:t,audioBitsPerSecond:128e3}),this.audioChunks=[],this.mediaRecorder.ondataavailable=a=>{a.data.size>0&&(this.audioChunks.push(a.data),n.debug("WHISPER_SERVICE",`Audio chunk captured: ${a.data.size} bytes`))},this.mediaRecorder.start(100),this.isRecording=!0,n.info("WHISPER_SERVICE","Recording started successfully",{mimeType:t,audioBitsPerSecond:128e3})}catch(t){throw n.error("WHISPER_SERVICE","Failed to start recording",{error:t}),new Error("Impossible d'accéder au microphone")}}async stopRecording(){return new Promise((t,a)=>{if(!this.mediaRecorder||!this.isRecording){a(new Error("Aucun enregistrement en cours"));return}n.info("WHISPER_SERVICE","Stopping recording"),this.mediaRecorder.onstop=()=>{const r=this.getSupportedMimeType(),i=new Blob(this.audioChunks,{type:r});n.info("WHISPER_SERVICE","Recording stopped",{size:i.size,type:i.type,chunks:this.audioChunks.length}),this.cleanup(),t(i)},this.mediaRecorder.onerror=r=>{n.error("WHISPER_SERVICE","MediaRecorder error",{event:r}),this.cleanup(),a(new Error("Erreur lors de l'enregistrement"))},this.mediaRecorder.stop(),this.isRecording=!1})}async transcribe(t){try{if(n.info("WHISPER_SERVICE","Starting transcription",{size:t.size,type:t.type}),t.size<1024)throw new Error("L'enregistrement est trop court");if(t.size>25*1024*1024)throw new Error("L'enregistrement est trop long");const a=new FormData;a.append("audio",t,"recording.webm");const r="https://kwipydbtjagypocpvbwn.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U",o=await fetch(`${r}/functions/v1/audio-transcribe`,{method:"POST",headers:{Authorization:`Bearer ${i}`,apikey:i},body:a});if(!o.ok){const c=await o.json();throw n.error("WHISPER_SERVICE","Transcription failed",{status:o.status,error:c}),new Error(c.error||"Erreur lors de la transcription")}const l=await o.json();return n.info("WHISPER_SERVICE","Transcription successful",{textLength:l.text.length,language:l.language,duration:l.duration}),l}catch(a){throw n.error("WHISPER_SERVICE","Transcription error",{error:a}),a}}async recordAndTranscribe(){try{n.info("WHISPER_SERVICE","Starting record and transcribe flow"),await this.startRecording();const t=await this.stopRecording();return(await this.transcribe(t)).text}catch(t){throw n.error("WHISPER_SERVICE","Record and transcribe error",{error:t}),t}}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.audioChunks=[],this.isRecording=!1,n.debug("WHISPER_SERVICE","Resources cleaned up")}getSupportedMimeType(){const t=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4","audio/mpeg"];for(const a of t)if(MediaRecorder.isTypeSupported(a))return a;return"audio/webm"}get recording(){return this.isRecording}cancelRecording(){this.mediaRecorder&&this.isRecording&&(n.info("WHISPER_SERVICE","Cancelling recording"),this.mediaRecorder.stop(),this.cleanup())}}const ve=new Us,He=({mode:s,message:t,onMessageChange:a,onSubmit:r,onKeyDown:i,placeholder:o,isFocused:l,onFocus:c,onBlur:m,textareaRef:d,disabled:g,isRecording:p,isTranscribing:u,onStopRecording:f,transcribedText:h,voiceState:x,onStopRealtime:b,stepColor:w})=>{if(s==="text")return e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{ref:d,value:t,onChange:S=>a(S.target.value),onKeyDown:i,onFocus:c,onBlur:m,placeholder:o,disabled:g,rows:1,className:"chat-textarea w-full resize-none bg-transparent border-none outline-none text-white placeholder-white/40 text-sm leading-relaxed py-1.5 px-1.5",style:{maxHeight:"90px",minHeight:"32px"}})});if(s==="voice-to-text")return e.jsxs(y.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px",padding:"24px 16px",minHeight:"200px"},children:[e.jsxs(y.div,{animate:{scale:p?[1,1.02,1]:1},transition:{duration:1.2,repeat:p?1/0:0,ease:"easeInOut"},style:{position:"relative",width:"120px",height:"120px",borderRadius:"50%",background:p?"linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.4))":"rgba(11, 14, 23, 0.95)",border:p?`3px solid ${w}80`:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:p?`0 0 40px ${w}40, 0 8px 24px rgba(0, 0, 0, 0.6)`:"0 4px 20px rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(j,{Icon:u?v.Loader:v.Mic,size:48,style:{color:w,filter:`drop-shadow(0 0 12px ${w}80)`},className:u?"animate-spin":""}),p&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{style:{position:"absolute",inset:-8,borderRadius:"50%",border:`2px solid ${w}40`,pointerEvents:"none"},animate:{scale:[1,1.15,1],opacity:[.5,0,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsx(y.div,{style:{position:"absolute",inset:-16,borderRadius:"50%",border:`2px solid ${w}30`,pointerEvents:"none"},animate:{scale:[1,1.2,1],opacity:[.3,0,.3]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.25}})]})]}),e.jsxs("div",{style:{textAlign:"center",width:"100%",maxWidth:"300px"},children:[e.jsx("div",{style:{fontSize:"15px",fontWeight:600,color:u?"rgba(255, 255, 255, 0.7)":w},children:u?"Transcription...":"Enregistrement en cours"}),e.jsx("div",{style:{fontSize:"13px",color:"rgba(255, 255, 255, 0.5)",marginTop:"6px"},children:u?"Analyse de votre message":"Appuyez pour terminer"}),h&&!u&&e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},style:{marginTop:"16px",padding:"12px 16px",borderRadius:"12px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",backdropFilter:"blur(8px)",fontSize:"14px",color:"rgba(255, 255, 255, 0.9)",lineHeight:"1.5",textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"11px",color:"rgba(255, 255, 255, 0.5)",marginBottom:"6px"},children:"Transcription:"}),h]})]}),p&&!u&&e.jsxs(y.button,{onClick:f,whileHover:{scale:1.05},whileTap:{scale:.95},style:{padding:"12px 24px",borderRadius:"20px",background:`linear-gradient(135deg, ${w}E6, ${w}CC)`,border:`2px solid ${w}`,boxShadow:`0 4px 16px ${w}30, 0 0 32px ${w}20`,display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[e.jsx(j,{Icon:v.Square,size:16,style:{color:"#fff"}}),e.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:"#fff"},children:"Terminer"})]})]});if(s==="realtime"){const S=x==="connecting",E=x==="listening",I=x==="speaking",T=x==="processing",A=x==="error",N=E||I;return e.jsxs(y.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px",padding:"24px 16px",minHeight:"200px"},children:[e.jsxs(y.div,{animate:{scale:I?[1,1.02,1]:1},transition:{duration:1.2,repeat:I?1/0:0,ease:"easeInOut"},style:{position:"relative",width:"120px",height:"120px",borderRadius:"50%",background:N?"linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.4))":"rgba(11, 14, 23, 0.95)",border:N?"3px solid rgba(239, 68, 68, 0.6)":"2px solid rgba(255, 255, 255, 0.2)",boxShadow:N?"0 0 40px rgba(239, 68, 68, 0.4), 0 8px 24px rgba(0, 0, 0, 0.6)":"0 4px 20px rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(H,{mode:"wait",children:I?e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(j,{Icon:v.Radio,size:48,style:{color:"rgba(239, 68, 68, 0.95)",filter:"drop-shadow(0 0 12px rgba(239, 68, 68, 0.8))"}})},"speaking"):E?e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(j,{Icon:v.Mic,size:48,style:{color:"rgba(239, 68, 68, 0.95)",filter:"drop-shadow(0 0 12px rgba(239, 68, 68, 0.8))"}})},"listening"):e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(j,{Icon:v.Loader,size:48,style:{color:"rgba(255, 255, 255, 0.5)"},className:S?"animate-spin":""})},"idle")}),E&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{style:{position:"absolute",inset:-8,borderRadius:"50%",border:"2px solid rgba(239, 68, 68, 0.4)",pointerEvents:"none"},animate:{scale:[1,1.15,1],opacity:[.5,0,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsx(y.div,{style:{position:"absolute",inset:-16,borderRadius:"50%",border:"2px solid rgba(239, 68, 68, 0.3)",pointerEvents:"none"},animate:{scale:[1,1.2,1],opacity:[.3,0,.3]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.25}})]})]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsxs(H,{mode:"wait",children:[S&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"#fff"},children:"Connexion..."},"connecting"),E&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"#EF4444"},children:"Je t'écoute"},"listening"),I&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"#EF4444"},children:"Coach parle..."},"speaking"),T&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"rgba(255, 255, 255, 0.7)"},children:"Traitement..."},"processing"),A&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},style:{fontSize:"15px",fontWeight:600,color:"#EF4444"},children:"Erreur"},"error")]})}),e.jsxs(y.button,{onClick:b,whileHover:{scale:1.05},whileTap:{scale:.95},style:{padding:"12px 24px",borderRadius:"20px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9))",border:"2px solid rgba(239, 68, 68, 0.6)",boxShadow:"0 4px 16px rgba(239, 68, 68, 0.3), 0 0 32px rgba(239, 68, 68, 0.2)",display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[e.jsx(j,{Icon:v.Square,size:16,style:{color:"#fff"}}),e.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:"#fff"},children:"Terminer"})]})]})}return null},Vs=({onSendMessage:s,onStartVoiceRecording:t,onStopVoiceRecording:a,onStartRealtimeSession:r,onStopRealtimeSession:i,isRecording:o,isProcessing:l,isSpeaking:c,realtimeState:m,realtimeError:d,voiceEnabled:g,stepColor:p,placeholder:u="Parle à ton coach...",disabled:f=!1})=>{const[h,x]=C.useState(""),[b,w]=C.useState(!1),[S,E]=C.useState(!1),[I,T]=C.useState(void 0),[A,N]=C.useState(""),D=C.useRef(null),{click:$}=G(),R=W(P=>P.setInputMode),[_,X]=C.useState("text");C.useEffect(()=>{let P="text";o||S?P="voice-to-text":m!=="idle"&&m!=="error"&&(P="realtime"),X(P),R(P),n.debug("CHAT_INPUT_BAR","Input mode changed",{mode:P,isRecording:o,isTranscribing:S,realtimeState:m})},[o,S,m,R]),C.useEffect(()=>{D.current&&(D.current.style.height="auto",D.current.style.height=`${Math.min(D.current.scrollHeight,120)}px`)},[h]);const K=()=>{h.trim()&&!f&&(s(h.trim()),x(""),$(),Q.tap(),D.current&&(D.current.style.height="auto"))},Z=P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),K())},F=async()=>{if($(),Q.press(),o){n.info("CHAT_INPUT_BAR","Stopping voice recording and starting transcription"),a();try{T(void 0),N("");const P=await ve.stopRecording();n.info("CHAT_INPUT_BAR","Audio blob captured",{size:P.size}),E(!0);const z=await ve.transcribe(P);E(!1),n.info("CHAT_INPUT_BAR","Transcription completed",{textLength:z.text.length,text:z.text}),z.text.trim()?(N(z.text.trim()),setTimeout(()=>{s(z.text.trim()),N(""),Q.impact(),n.info("CHAT_INPUT_BAR","Returning to text mode after voice-to-text message sent")},500)):(T("Aucun texte détecté dans l'enregistrement"),n.info("CHAT_INPUT_BAR","Returning to text mode after transcription error"))}catch(P){E(!1);const z=P instanceof Error?P.message:"Erreur de transcription";T(z),n.error("CHAT_INPUT_BAR","Transcription error",{error:z}),n.info("CHAT_INPUT_BAR","Returning to text mode after transcription exception")}}else{n.info("CHAT_INPUT_BAR","Starting voice recording");try{T(void 0),N(""),await ve.startRecording(),t()}catch(P){const z=P instanceof Error?P.message:"Erreur microphone";T(z),n.error("CHAT_INPUT_BAR","Recording start error",{error:z})}}},O=async()=>{$(),Q.press(),m==="idle"||m==="error"?await r():i()},M=m!=="idle"&&m!=="error",V=M||o||S;return e.jsxs("div",{className:"chat-input-bar-container",style:{position:"relative",width:"100%",zIndex:1,pointerEvents:f?"none":"auto",opacity:f?.6:1,margin:"0",padding:"0"},children:[e.jsxs(H,{children:[d&&e.jsx(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"8px 16px",marginBottom:"8px",borderRadius:"12px",background:"linear-gradient(180deg, rgba(220, 38, 38, 0.2) 0%, rgba(153, 27, 27, 0.15) 100%)",backdropFilter:"blur(16px)",border:"1px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(j,{Icon:v.AlertTriangle,size:14,style:{color:"#EF4444"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.9)"},children:d})]})}),I&&e.jsx(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"8px 16px",marginBottom:"8px",borderRadius:"12px",background:"linear-gradient(180deg, rgba(220, 38, 38, 0.2) 0%, rgba(153, 27, 27, 0.15) 100%)",backdropFilter:"blur(16px)",border:"1px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(j,{Icon:v.AlertTriangle,size:14,style:{color:"#EF4444"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.9)"},children:I})]})})]}),e.jsx(H,{children:m==="connecting"&&e.jsxs(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"6px 16px",marginBottom:"8px",borderRadius:"12px",background:"linear-gradient(180deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.1) 100%)",backdropFilter:"blur(16px)",border:"1px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(y.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},style:{width:"12px",height:"12px",border:"2px solid #EF4444",borderTopColor:"transparent",borderRadius:"50%"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.9)"},children:"Connexion au coach vocal..."})]})}),e.jsxs(H,{children:[l&&e.jsxs(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"6px 16px",marginBottom:"8px",borderRadius:"12px",background:`
                linear-gradient(180deg,
                  rgba(11, 14, 23, 0.8) 0%,
                  rgba(11, 14, 23, 0.6) 100%
                )
              `,backdropFilter:"blur(16px)",border:`1px solid color-mix(in srgb, ${p} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(y.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},style:{width:"12px",height:"12px",border:`2px solid ${p}`,borderTopColor:"transparent",borderRadius:"50%"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.7)"},children:"Traitement en cours..."})]}),S&&e.jsxs(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{padding:"6px 16px",marginBottom:"8px",borderRadius:"12px",background:`
                linear-gradient(180deg,
                  rgba(11, 14, 23, 0.8) 0%,
                  rgba(11, 14, 23, 0.6) 100%
                )
              `,backdropFilter:"blur(16px)",border:`1px solid color-mix(in srgb, ${p} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(y.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},style:{width:"12px",height:"12px",border:`2px solid ${p}`,borderTopColor:"transparent",borderRadius:"50%"}}),e.jsx("span",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.7)"},children:"Transcription en cours..."})]})]}),e.jsx(H,{mode:"wait",children:V?e.jsx(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.3,ease:"easeOut"},className:"chat-input-bar",style:{background:`
                radial-gradient(ellipse at 50% 100%, color-mix(in srgb, ${p} 20%, transparent) 0%, transparent 60%),
                var(--liquid-reflections-multi),
                var(--liquid-highlight-ambient),
                var(--liquid-glass-bg-elevated)
              `,backdropFilter:"blur(var(--liquid-bottombar-blur)) saturate(var(--liquid-bottombar-saturate))",WebkitBackdropFilter:"blur(var(--liquid-bottombar-blur)) saturate(var(--liquid-bottombar-saturate))",border:`1.5px solid color-mix(in srgb, ${p} 40%, transparent)`,boxShadow:`
                0 4px 24px rgba(0, 0, 0, 0.25),
                0 0 32px color-mix(in srgb, ${p} 20%, transparent),
                inset 0 1px 0 rgba(255, 255, 255, 0.15)
              `,borderRadius:"18px",padding:"0",minHeight:"240px",transition:"all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)",overflow:"hidden"},children:e.jsx(He,{mode:_,message:h,onMessageChange:x,onSubmit:K,onKeyDown:Z,placeholder:u,isFocused:b,onFocus:()=>w(!0),onBlur:()=>w(!1),textareaRef:D,disabled:f,isRecording:o,isTranscribing:S,onStopRecording:F,transcribedText:A,voiceState:m,onStopRealtime:O,stepColor:p})},"voice-mode"):e.jsx(y.div,{initial:{opacity:.8,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:.8,scale:.98},transition:{duration:.2,ease:"easeInOut"},className:`chat-input-bar ${b?"chat-input-bar--focused":""}`,style:{background:`
                radial-gradient(ellipse at 50% 100%, color-mix(in srgb, ${p} 12%, transparent) 0%, transparent 60%),
                var(--liquid-reflections-multi),
                var(--liquid-highlight-ambient),
                var(--liquid-glass-bg-base)
              `,backdropFilter:"blur(var(--liquid-bottombar-blur)) saturate(var(--liquid-bottombar-saturate))",WebkitBackdropFilter:"blur(var(--liquid-bottombar-blur)) saturate(var(--liquid-bottombar-saturate))",border:b?`1.5px solid color-mix(in srgb, ${p} 40%, transparent)`:"1.5px solid rgba(255, 255, 255, 0.15)",boxShadow:b?`
                    0 4px 24px rgba(0, 0, 0, 0.25),
                    0 0 32px color-mix(in srgb, ${p} 20%, transparent),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15)
                  `:`
                    0 4px 20px rgba(0, 0, 0, 0.2),
                    0 0 24px rgba(255, 255, 255, 0.05),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1)
                  `,borderRadius:"18px",padding:"6px 8px",minHeight:"auto",transition:"all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)",overflow:"hidden",willChange:"transform, opacity"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsxs(y.button,{onClick:F,className:`chat-input-button flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center ${o?"chat-input-button--recording":""}`,style:{background:o?`
                      radial-gradient(circle at 30% 30%, rgba(239, 68, 68, 0.3) 0%, transparent 70%),
                      rgba(239, 68, 68, 0.15)
                    `:`
                      radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.18) 0%, transparent 50%),
                      var(--liquid-pill-bg)
                    `,border:o?"1.5px solid rgba(239, 68, 68, 0.5)":"1px solid rgba(255, 255, 255, 0.2)",boxShadow:o?"0 0 20px rgba(239, 68, 68, 0.3), 0 4px 12px rgba(0, 0, 0, 0.2)":"var(--liquid-pill-shadow)"},whileHover:{scale:1.05},whileTap:{scale:.95},disabled:f||l,children:[e.jsx(H,{mode:"wait",children:o?e.jsx(y.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},children:e.jsx(j,{Icon:v.MicOff,size:18,style:{color:"#EF4444"}})},"recording"):e.jsx(y.div,{initial:{scale:0,rotate:180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:-180},children:e.jsx(j,{Icon:v.Mic,size:18,style:{color:"rgba(255, 255, 255, 0.7)"}})},"idle")}),o&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{style:{position:"absolute",inset:-4,borderRadius:"50%",border:"2px solid rgba(239, 68, 68, 0.6)",pointerEvents:"none"},animate:{scale:[1,1.3,1],opacity:[.8,0,.8]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),e.jsx(y.div,{style:{position:"absolute",inset:-8,borderRadius:"50%",border:"2px solid rgba(239, 68, 68, 0.4)",pointerEvents:"none"},animate:{scale:[1,1.5,1],opacity:[.6,0,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.3}})]})]}),e.jsx(He,{mode:"text",message:h,onMessageChange:x,onSubmit:K,onKeyDown:Z,placeholder:u,isFocused:b,onFocus:()=>w(!0),onBlur:()=>w(!1),textareaRef:D,disabled:f,isRecording:!1,isTranscribing:!1,onStopRecording:()=>{},transcribedText:"",voiceState:"idle",onStopRealtime:()=>{},stepColor:p}),g&&!h.trim()?e.jsxs(y.button,{onClick:O,className:"chat-input-button flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center relative",style:{background:M?"linear-gradient(135deg, rgba(239, 68, 68, 1) 0%, rgba(220, 38, 38, 1) 100%)":`
                      radial-gradient(circle at 30% 30%, rgba(239, 68, 68, 0.3) 0%, transparent 70%),
                      linear-gradient(135deg, rgba(239, 68, 68, 0.7), rgba(220, 38, 38, 0.8))
                    `,border:M?"3px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(239, 68, 68, 0.6)",boxShadow:M?`
                      0 0 40px rgba(239, 68, 68, 0.8),
                      0 8px 24px rgba(0, 0, 0, 0.6),
                      inset 0 2px 0 rgba(255, 255, 255, 0.4)
                    `:`
                      0 0 20px rgba(239, 68, 68, 0.4),
                      0 4px 12px rgba(0, 0, 0, 0.3),
                      inset 0 1px 0 rgba(255, 255, 255, 0.2)
                    `},whileHover:{scale:1.08,boxShadow:M?`
                      0 0 50px rgba(239, 68, 68, 0.9),
                      0 10px 28px rgba(0, 0, 0, 0.7),
                      inset 0 2px 0 rgba(255, 255, 255, 0.5)
                    `:`
                      0 0 35px rgba(239, 68, 68, 0.7),
                      0 8px 20px rgba(0, 0, 0, 0.5),
                      inset 0 1px 0 rgba(255, 255, 255, 0.4)
                    `},whileTap:{scale:.92},disabled:f,children:[e.jsx(H,{mode:"wait",children:M?e.jsx(y.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.15},children:e.jsx(j,{Icon:v.Square,size:18,style:{color:"rgba(255, 255, 255, 0.95)",filter:"drop-shadow(0 0 8px rgba(255, 255, 255, 0.6))",zIndex:2,position:"relative"}})},"stop-icon"):e.jsx(y.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.15},children:e.jsx(j,{Icon:v.Radio,size:18,style:{color:"rgba(255, 255, 255, 0.85)",filter:"drop-shadow(0 0 4px rgba(255, 255, 255, 0.4))",zIndex:2,position:"relative"}})},"radio-icon")}),M&&e.jsx(y.div,{style:{position:"absolute",inset:-2,borderRadius:"50%",background:"rgba(239, 68, 68, 0.3)",filter:"blur(8px)",zIndex:-1},animate:{scale:[1,1.2,1],opacity:[.5,.8,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),m==="connecting"&&e.jsx(y.div,{style:{position:"absolute",inset:-3,borderRadius:"50%",border:"2px solid transparent",borderTopColor:"#EF4444",borderRightColor:"#EF4444",pointerEvents:"none"},animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})]}):e.jsx(y.button,{onClick:K,disabled:!h.trim()||f||l,className:`chat-input-button flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center ${h.trim()&&!f?"chat-input-button--send-enabled":""}`,initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},style:{background:h.trim()?`
                      radial-gradient(circle at 30% 30%, color-mix(in srgb, ${p} 35%, transparent) 0%, transparent 70%),
                      linear-gradient(135deg, color-mix(in srgb, ${p} 30%, transparent), color-mix(in srgb, ${p} 18%, transparent))
                    `:"rgba(255, 255, 255, 0.05)",border:h.trim()?`1.5px solid color-mix(in srgb, ${p} 50%, transparent)`:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:h.trim()?`0 0 16px color-mix(in srgb, ${p} 25%, transparent), 0 4px 12px rgba(0, 0, 0, 0.2)`:"none",cursor:h.trim()&&!f?"pointer":"not-allowed",opacity:h.trim()&&!f?1:.5},whileHover:h.trim()&&!f?{scale:1.05}:void 0,whileTap:h.trim()&&!f?{scale:.95}:void 0,children:e.jsx(j,{Icon:v.Send,size:18,style:{color:h.trim()?p:"rgba(255, 255, 255, 0.4)",filter:h.trim()?`drop-shadow(0 0 8px color-mix(in srgb, ${p} 40%, transparent))`:"none"}})})]})},"text-mode")})]})},qs=({stepColor:s,onSendMessage:t,isTyping:a=!1,className:r="",messagesContainerRef:i,onScrollChange:o,onExerciseClick:l,onCategorySelect:c,onOptionSelect:m,onValidate:d,onModify:g,onViewExercise:p,onContinue:u,onBack:f})=>{const h=W(_=>_.isRecording),x=W(_=>_.isProcessing),b=W(_=>_.isSpeaking),w=W(_=>_.voiceState),S=W(_=>_.currentMode),E=W(_=>_.error),[I,T]=C.useState(void 0),A={enabled:!0},N=()=>{n.info("COACH_CHAT_INTERFACE","Voice-to-text recording started via ChatInputBar"),W.getState().setRecording(!0),n.debug("COACH_CHAT_INTERFACE","Store isRecording set to TRUE")},D=()=>{n.info("COACH_CHAT_INTERFACE","Voice-to-text recording stopped via ChatInputBar"),W.getState().setRecording(!1),n.debug("COACH_CHAT_INTERFACE","Store isRecording set to FALSE")},$=async()=>{try{n.info("COACH_CHAT_INTERFACE","Starting Realtime session"),T(void 0),he.initialized||(n.info("COACH_CHAT_INTERFACE","Initializing voice coach orchestrator"),await he.initialize());const _=S||"force";n.info("COACH_CHAT_INTERFACE",`Starting voice session with mode: ${_}`),await he.startVoiceSession(_),n.info("COACH_CHAT_INTERFACE","Realtime session started successfully")}catch(_){n.error("COACH_CHAT_INTERFACE","Failed to start Realtime session",{error:_});const X=_ instanceof Error?_.message:"Failed to start voice session";T(X),E&&T(E)}},R=()=>{try{n.info("COACH_CHAT_INTERFACE","Stopping Realtime session"),T(void 0),he.stopVoiceSession(),n.info("COACH_CHAT_INTERFACE","Realtime session stopped"),W.getState().setInputMode("text"),n.info("COACH_CHAT_INTERFACE","Returned to text mode after stopping Realtime")}catch(_){n.error("COACH_CHAT_INTERFACE","Error stopping Realtime session",{error:_})}};return C.useEffect(()=>{w==="idle"&&T(void 0)},[w]),e.jsxs("div",{className:`coach-chat-interface flex flex-col ${r}`,style:{height:"100%",position:"relative",minHeight:0},children:[e.jsx(zs,{stepColor:s,isTyping:a,messagesContainerRef:i,onScrollChange:o,onExerciseClick:l,onCategorySelect:c,onOptionSelect:m,onValidate:d,onModify:g,onViewExercise:p,onContinue:u,onBack:f,onSendMessage:t}),e.jsx("div",{className:"chat-input-footer flex-shrink-0",style:{borderTop:w!=="idle"||h?"none":"1px solid rgba(255, 255, 255, 0.08)",padding:w!=="idle"||h?"0":"8px 8px 0px 8px",transition:"all 0.3s ease"},children:e.jsx(Vs,{onSendMessage:t,onStartVoiceRecording:N,onStopVoiceRecording:D,onStartRealtimeSession:$,onStopRealtimeSession:R,isRecording:h,isProcessing:x,isSpeaking:b,realtimeState:w,realtimeError:I,voiceEnabled:A.enabled,stepColor:s})})]})};class Gs{constructor(){B(this,"baseUrl");const t="https://kwipydbtjagypocpvbwn.supabase.co";this.baseUrl=`${t}/functions/v1`}async sendMessage(t){const a=`chat-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{n.info("CHAT_AI_SERVICE","🚀 Starting sendMessage request",{requestId:a,mode:t.mode,messageCount:t.messages.length,hasContext:!!t.contextData,baseUrl:this.baseUrl});const{data:{session:r}}=await L.auth.getSession();if(!r)throw n.error("CHAT_AI_SERVICE","❌ User not authenticated",{requestId:a}),new Error("User not authenticated");n.info("CHAT_AI_SERVICE","✅ Session validated, making fetch request",{requestId:a,userId:r.user.id,url:`${this.baseUrl}/chat-ai`});const i=await fetch(`${this.baseUrl}/chat-ai`,{method:"POST",headers:{Authorization:`Bearer ${r.access_token}`,"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U"},body:JSON.stringify(t)});if(n.info("CHAT_AI_SERVICE","📡 Fetch response received",{requestId:a,status:i.status,ok:i.ok,contentType:i.headers.get("Content-Type")}),!i.ok){const l=await i.text();n.error("CHAT_AI_SERVICE","❌ Response not OK",{requestId:a,status:i.status,errorText:l});let c;try{c=JSON.parse(l)}catch{c={error:l||"Unknown error"}}throw new Error(c.error||`API error: ${i.status}`)}const o=await i.json();return n.info("CHAT_AI_SERVICE","✅ Response parsed successfully",{requestId:a,mode:t.mode,tokensUsed:o.usage?.total_tokens,hasMessage:!!o.message,messageLength:o.message?.content?.length||0}),o}catch(r){throw n.error("CHAT_AI_SERVICE","❌ Fatal error in sendMessage",{requestId:a,error:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0}),r}}async sendStreamMessage(t,a){const r=Date.now();let i=0,o="",l="unknown";try{n.info("CHAT_AI_SERVICE","Starting stream request",{mode:t.mode,messageCount:t.messages.length});const{data:{session:c}}=await L.auth.getSession();if(!c)throw n.error("CHAT_AI_SERVICE","User not authenticated for stream"),new Error("User not authenticated");const m=await fetch(`${this.baseUrl}/chat-ai`,{method:"POST",headers:{Authorization:`Bearer ${c.access_token}`,"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3aXB5ZGJ0amFneXBvY3B2YnduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODg0MjIsImV4cCI6MjA3MDI2NDQyMn0.IS5IdKbmnGtgU_AaGYtUgX3ewaNpsiSAui5kbFV31_U"},body:JSON.stringify({...t,stream:!0})});if(l=m.headers.get("X-Request-Id")||"unknown",n.info("CHAT_AI_SERVICE","Stream response received",{requestId:l,status:m.status,ok:m.ok,contentType:m.headers.get("Content-Type")}),!m.ok){const h=await m.text();throw n.error("CHAT_AI_SERVICE","Stream response not ok",{requestId:l,status:m.status,error:h}),new Error(`API error: ${m.status} - ${h}`)}const d=m.body?.getReader(),g=new TextDecoder;if(!d)throw n.error("CHAT_AI_SERVICE","No response body reader",{requestId:l}),new Error("Response body is not readable");n.info("CHAT_AI_SERVICE","Starting to read stream chunks",{requestId:l});let p="",u=0,f=0;for(;;){const{done:h,value:x}=await d.read();if(h){n.info("CHAT_AI_SERVICE","Stream reading completed",{requestId:l,chunkCount:i,totalLength:o.length,totalLinesProcessed:u,dataLinesProcessed:f,durationMs:Date.now()-r});break}p+=g.decode(x,{stream:!0});const b=p.split(`
`);p=b.pop()||"",u<10&&n.debug("CHAT_AI_SERVICE","Stream chunk received",{requestId:l,lineCount:b.length,bufferSize:p.length,firstLinePreview:b[0]?.substring(0,100)});for(const w of b)if(u++,!!w.trim()&&w.startsWith("data: ")){f++;const S=w.slice(6).trim();if(S==="[DONE]"){n.info("CHAT_AI_SERVICE","Stream [DONE] marker received",{requestId:l,totalChunks:i,totalLength:o.length});return}try{const E=JSON.parse(S);i<3&&n.debug("CHAT_AI_SERVICE","Parsed SSE data",{requestId:l,hasChoices:!!E.choices,choicesLength:E.choices?.length,hasDelta:!!E.choices?.[0]?.delta,deltaKeys:E.choices?.[0]?.delta?Object.keys(E.choices[0].delta):[],hasContent:!!E.choices?.[0]?.delta?.content});const I=E.choices?.[0]?.delta?.content;I?(i++,o+=I,n.info("CHAT_AI_SERVICE","🔥 CALLING onChunk with content",{requestId:l,chunkNumber:i,contentLength:I.length,contentPreview:I.substring(0,50)}),a(I),i<=3&&n.debug("CHAT_AI_SERVICE","Content chunk extracted",{requestId:l,chunkNumber:i,contentLength:I.length,contentPreview:I.substring(0,50)})):i<3&&n.warn("CHAT_AI_SERVICE","❌ NO CONTENT in chunk",{requestId:l,parsed:JSON.stringify(E).substring(0,200)})}catch(E){n.warn("CHAT_AI_SERVICE","Failed to parse SSE data",{requestId:l,dataLength:S.length,dataPreview:S.substring(0,200),error:E instanceof Error?E.message:String(E)})}}}i===0&&n.warn("CHAT_AI_SERVICE","No content chunks received in stream",{requestId:l,durationMs:Date.now()-r})}catch(c){throw n.error("CHAT_AI_SERVICE","Error in stream",{requestId:l,error:c instanceof Error?c.message:String(c),stack:c instanceof Error?c.stack:void 0,chunkCount:i,durationMs:Date.now()-r}),c}}convertMessagesToAPI(t){return t.map(a=>({role:a.role==="coach"?"assistant":a.role,content:a.content}))}}const We=new Gs;class Js{async getModeId(t){try{const{data:a,error:r}=await L.from("chat_modes").select("id").eq("name",t).maybeSingle();return r?(n.error("CHAT_CONVERSATION_SERVICE","Error getting mode ID",{error:r}),null):a?.id||null}catch(a){return n.error("CHAT_CONVERSATION_SERVICE","Error in getModeId",{error:a}),null}}async getOrCreateConversation(t,a){try{const{data:{user:r}}=await L.auth.getUser();if(!r)throw new Error("User not authenticated");const i=await this.getModeId(t);if(!i)throw new Error(`Mode ${t} not found in database`);const{data:o,error:l}=await L.from("chat_conversations").select("id").eq("user_id",r.id).eq("mode_id",i).eq("is_active",!0).maybeSingle();if(l)throw n.error("CHAT_CONVERSATION_SERVICE","Error fetching conversation",{fetchError:l}),l;if(o)return n.debug("CHAT_CONVERSATION_SERVICE","Using existing conversation",{conversationId:o.id,mode:t}),o.id;const{data:c,error:m}=await L.from("chat_conversations").insert({user_id:r.id,mode_id:i,context_data:a||{},is_active:!0}).select("id").single();if(m)throw n.error("CHAT_CONVERSATION_SERVICE","Error creating conversation",{createError:m}),m;return n.info("CHAT_CONVERSATION_SERVICE","Created new conversation",{conversationId:c.id,mode:t}),c.id}catch(r){return n.error("CHAT_CONVERSATION_SERVICE","Error in getOrCreateConversation",{error:r}),null}}async saveMessage(t,a){try{const{data:r,error:i}=await L.from("chat_messages").insert({conversation_id:t,role:a.role,type:a.type,content:a.content,metadata:a.metadata||{},audio_url:a.audioUrl||null}).select("id").single();if(i)throw n.error("CHAT_CONVERSATION_SERVICE","Error saving message",{error:i}),i;return n.debug("CHAT_CONVERSATION_SERVICE","Message saved",{messageId:r.id,conversationId:t}),r.id}catch(r){return n.error("CHAT_CONVERSATION_SERVICE","Error in saveMessage",{error:r}),null}}async getConversationMessages(t){try{const{data:a,error:r}=await L.from("chat_messages").select("*").eq("conversation_id",t).order("created_at",{ascending:!0});if(r)throw n.error("CHAT_CONVERSATION_SERVICE","Error fetching messages",{error:r}),r;return(a||[]).map(i=>({id:i.id,role:i.role,type:i.type,content:i.content,timestamp:new Date(i.created_at),...i.metadata&&Object.keys(i.metadata).length>0?{metadata:i.metadata}:{},...i.audio_url?{audioUrl:i.audio_url}:{}}))}catch(a){return n.error("CHAT_CONVERSATION_SERVICE","Error in getConversationMessages",{error:a}),[]}}async endConversation(t){try{const{error:a}=await L.from("chat_conversations").update({is_active:!1,ended_at:new Date().toISOString()}).eq("id",t);return a?(n.error("CHAT_CONVERSATION_SERVICE","Error ending conversation",{error:a}),!1):(n.info("CHAT_CONVERSATION_SERVICE","Conversation ended",{conversationId:t}),!0)}catch(a){return n.error("CHAT_CONVERSATION_SERVICE","Error in endConversation",{error:a}),!1}}async getActiveConversationByMode(t){try{const{data:{user:a}}=await L.auth.getUser();if(!a)return null;const r=await this.getModeId(t);if(!r)return null;const{data:i,error:o}=await L.from("chat_conversations").select("id").eq("user_id",a.id).eq("mode_id",r).eq("is_active",!0).maybeSingle();return o?(n.error("CHAT_CONVERSATION_SERVICE","Error fetching active conversation",{error:o}),null):i?.id||null}catch(a){return n.error("CHAT_CONVERSATION_SERVICE","Error in getActiveConversationByMode",{error:a}),null}}}const ce=new Js,jn=({chatButtonRef:s})=>{const t=ue(),{isPanelOpen:a,closePanel:r,currentMode:i,modeConfigs:o,setMode:l,closeOnNavigation:c,addMessage:m,messages:d,isTyping:g,setTyping:p,conversationId:u,incrementUnread:f,voiceState:h,isVoiceOnlyMode:x}=W(),{navClose:b}=G(),w=C.useRef(t.pathname),[S,E]=C.useState(!1),I=C.useRef(null),{mode:T}=J(),A=o[i],N=A.color,D={width:420},$=C.useMemo(()=>T==="high-performance"?"none":"blur(4px)",[T]),R=C.useMemo(()=>T==="high-performance"?"none":T==="balanced"?"blur(8px)":"blur(16px)",[T]);ge(),C.useEffect(()=>ge.subscribe(O=>O.activeOverlayId,O=>{O!=="chatDrawer"&&O!=="none"&&a&&(n.debug("GLOBAL_CHAT_DRAWER","Another overlay opened - closing chat",{newOverlay:O,currentMode:i,timestamp:new Date().toISOString()}),r())}),[a,i,r]);const _=()=>{const F=d[d.length-1],O=F&&F.role==="coach";(g||O)&&(f(),n.debug("GLOBAL_CHAT_DRAWER","Closing chat with unread messages",{mode:i,isTyping:g,hasUnreadCoachMessage:O,timestamp:new Date().toISOString()})),r()};C.useEffect(()=>{w.current!==t.pathname&&(a&&c&&(n.debug("GLOBAL_CHAT_DRAWER","Closing chat on navigation",{from:w.current,to:t.pathname,timestamp:new Date().toISOString()}),b(),Q.tap(),_()),w.current=t.pathname)},[t.pathname,a,c,b]),C.useEffect(()=>{if(!a)return;let F=i;t.pathname.startsWith("/training")||t.pathname.includes("/pipeline")?F="training":t.pathname.startsWith("/meals")||t.pathname.startsWith("/fridge")?F="nutrition":t.pathname.startsWith("/fasting")?F="fasting":t.pathname.startsWith("/body-scan")||t.pathname.startsWith("/avatar")?F="body-scan":F="general",F!==i&&(n.debug("GLOBAL_CHAT_DRAWER","Auto-switching mode based on route",{route:t.pathname,from:i,to:F,timestamp:new Date().toISOString()}),l(F),m({role:"system",type:"system",content:`Passage en mode ${o[F].displayName}`}))},[t.pathname,a]),C.useEffect(()=>{if(!a)return;(async()=>{try{const O=await ce.getActiveConversationByMode(i);if(O){const M=await ce.getConversationMessages(O);M.length>0&&(W.setState({conversationId:O,messages:M}),n.debug("GLOBAL_CHAT_DRAWER","Loaded conversation history",{conversationId:O,messageCount:M.length,mode:i}))}}catch(O){n.error("GLOBAL_CHAT_DRAWER","Error loading conversation history",{error:O})}})()},[i,a]),C.useEffect(()=>{if(!a)return;const F=O=>{O.key==="Escape"&&(b(),Q.tap(),_())};return document.addEventListener("keydown",F),()=>document.removeEventListener("keydown",F)},[a,b,_]);const X=async F=>{const O={role:"user",type:"text",content:F};n.info("GLOBAL_CHAT_DRAWER","🚀 User sent message",{messageLength:F.length,currentMode:i,messageCount:d.length}),m(O),p(!0);try{n.info("GLOBAL_CHAT_DRAWER","📝 Getting conversation ID",{currentMode:i});const M=u||await ce.getOrCreateConversation(i);if(!M)throw n.error("GLOBAL_CHAT_DRAWER","❌ Failed to get conversation ID"),new Error("Failed to get or create conversation");n.info("GLOBAL_CHAT_DRAWER","✅ Conversation ID obtained",{convId:M}),u||W.setState({conversationId:M}),await ce.saveMessage(M,O),n.info("GLOBAL_CHAT_DRAWER","✅ User message saved to DB");let V=A.systemPrompt;const P=d.slice(-10),z=[{role:"system",content:V},...We.convertMessagesToAPI(P),{role:"user",content:F}];n.info("GLOBAL_CHAT_DRAWER","📤 Calling chatAIService.sendMessage",{apiMessageCount:z.length,mode:i});const ae=await We.sendMessage({messages:z,mode:i});n.info("GLOBAL_CHAT_DRAWER","✅ Received response from AI",{hasContent:!!ae.message?.content,contentLength:ae.message?.content?.length||0});const le={role:"coach",type:"text",content:ae.message.content};m(le),await ce.saveMessage(M,le),n.info("GLOBAL_CHAT_DRAWER","✅ Assistant message saved to DB")}catch(M){n.error("GLOBAL_CHAT_DRAWER","❌ Error in message flow",{error:M instanceof Error?M.message:String(M),stack:M instanceof Error?M.stack:void 0}),m({role:"system",type:"system",content:"Désolé, une erreur est survenue. Veuillez réessayer."})}finally{p(!1)}},K=D.width,Z=(F=!0)=>{I.current&&I.current.scrollTo({top:I.current.scrollHeight,behavior:F?"smooth":"auto"})};return e.jsx(H,{children:a&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:()=>{b(),Q.tap(),_()},className:"lg:hidden",style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.5)",backdropFilter:$,zIndex:9993}},"chat-overlay"),e.jsxs(y.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:300,damping:30,mass:.8},className:"global-chat-drawer",style:{position:"fixed",top:"calc(64px + 12px)",right:"8px",bottom:"calc(var(--new-bottom-bar-height) + var(--new-bottom-bar-bottom-offset) + 12px)",width:`min(${K}px, calc(100vw - 16px))`,zIndex:xe.CHAT_DRAWER,borderRadius:"20px",background:T==="high-performance"?"rgba(11, 14, 23, 0.95)":`
                    var(--liquid-reflections-multi),
                    var(--liquid-highlight-ambient),
                    var(--liquid-glass-bg-elevated)
                  `,backdropFilter:T==="high-performance"?"none":"blur(var(--liquid-panel-blur)) saturate(var(--liquid-panel-saturate))",WebkitBackdropFilter:T==="high-performance"?"none":"blur(var(--liquid-panel-blur)) saturate(var(--liquid-panel-saturate))",boxShadow:"var(--liquid-panel-shadow)",display:"flex",flexDirection:"column",overflow:"hidden",isolation:"isolate",transform:"translateZ(0)",willChange:"transform, filter"},children:[T!=="high-performance"&&e.jsx("div",{style:{position:"absolute",inset:"-2px",borderRadius:"inherit",padding:"2px",background:"var(--liquid-border-gradient-tricolor)",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude",pointerEvents:"none",opacity:1,zIndex:1,animation:"borderPulse 4s ease-in-out infinite"}}),T!=="high-performance"&&e.jsx("div",{style:{position:"absolute",inset:"-8px",borderRadius:"calc(20px + 4px)",background:`radial-gradient(
                    ellipse at 80% 50%,
                    color-mix(in srgb, ${N} 15%, transparent) 0%,
                    rgba(61, 19, 179, 0.1) 40%,
                    transparent 70%
                  )`,opacity:.8,zIndex:-1,pointerEvents:"none",animation:"glowPulse 3s ease-in-out infinite alternate"}}),e.jsxs("div",{className:"drawer-header",style:{padding:"16px 20px",borderBottom:`1px solid color-mix(in srgb, ${N} 20%, transparent)`,background:`
                  linear-gradient(180deg,
                    rgba(11, 14, 23, 0.6) 0%,
                    rgba(11, 14, 23, 0.3) 100%
                  )
                `,backdropFilter:R,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",flexShrink:0},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"mode-icon-container",style:{width:"40px",height:"40px",borderRadius:"50%",background:`
                      radial-gradient(circle at 30% 30%, color-mix(in srgb, ${N} 30%, transparent), transparent 70%),
                      rgba(255, 255, 255, 0.1)
                    `,border:`2px solid color-mix(in srgb, ${N} 40%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${N} 25%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(j,{Icon:v[A.icon]||v.MessageSquare,size:20,style:{color:N}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold text-lg",children:A.displayName}),e.jsx("p",{className:"text-white/60 text-xs",children:i==="general"?"En ligne • Avec toi":"En ligne • Prêt à aider"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{children:S&&e.jsx(y.button,{className:"scroll-to-bottom",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:()=>Z(!0),style:{width:"36px",height:"36px",borderRadius:"50%",background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(255, 255, 255, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},whileHover:{scale:1.05,background:"rgba(255, 255, 255, 0.12)"},whileTap:{scale:.95},children:e.jsx(j,{Icon:v.ArrowDown,size:16,style:{color:N,filter:`drop-shadow(0 0 8px color-mix(in srgb, ${N} 40%, transparent))`}})})}),(h==="listening"||h==="speaking"||h==="connecting")&&e.jsx(y.button,{className:"minimize-button",onClick:()=>{n.info("GLOBAL_CHAT_DRAWER","Minimizing chat with active realtime session"),b(),Q.tap(),_()},style:{width:"36px",height:"36px",borderRadius:"50%",background:"rgba(239, 68, 68, 0.2)",border:"1px solid rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},whileHover:{scale:1.05,background:"rgba(239, 68, 68, 0.3)"},whileTap:{scale:.95},title:"Continuer en arrière-plan",children:e.jsx(j,{Icon:v.Minimize2,size:16,className:"text-red-400"})}),e.jsx(y.button,{className:"header-button",onClick:()=>{b(),Q.tap(),_()},style:{width:"36px",height:"36px",borderRadius:"50%",background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(255, 255, 255, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},whileHover:{scale:1.05,background:"rgba(255, 255, 255, 0.12)"},whileTap:{scale:.95},children:e.jsx(j,{Icon:v.X,size:18,className:"text-white/70"})})]})]}),e.jsx("div",{className:"chat-interface-wrapper",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0},children:e.jsx(qs,{stepColor:N,onSendMessage:X,isTyping:g,className:"flex-1",messagesContainerRef:I,onScrollChange:E})})]},"chat-drawer")]})})},In=()=>{const{isPerformanceMode:s,mode:t}=J(),a=C.useRef(!1);return C.useEffect(()=>{const r=document.body,i=document.documentElement;return r.classList.remove("performance-mode","mobile-performance-mode","mode-quality","mode-balanced","mode-high-performance"),i.classList.remove("performance-mode","mode-high-performance","mode-balanced","mode-quality"),s?(r.classList.add("performance-mode","mobile-performance-mode","mode-high-performance"),r.setAttribute("data-performance-mode","true"),i.classList.add("performance-mode","mode-high-performance")):(r.removeAttribute("data-performance-mode"),t==="quality"?(r.classList.add("mode-quality"),i.classList.add("mode-quality")):t==="balanced"&&(r.classList.add("mode-balanced"),i.classList.add("mode-balanced"))),()=>{r.classList.remove("performance-mode","mobile-performance-mode","mode-quality","mode-balanced","mode-high-performance"),r.removeAttribute("data-performance-mode"),i.classList.remove("performance-mode","mode-high-performance","mode-balanced","mode-quality")}},[s,t]),C.useEffect(()=>{if(!s&&!a.current){const r=setTimeout(()=>{Xs(t),a.current=!0},100);return()=>clearTimeout(r)}if(s&&a.current){const r=document.getElementById("cosmic-forge-particles-container");r&&(r.innerHTML=""),a.current=!1}},[s,t]),s?e.jsx("div",{style:{position:"fixed",inset:0,background:"var(--forge-deep)",zIndex:-1},"aria-hidden":"true"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-twinforge-visionos","aria-hidden":"true"}),e.jsx("div",{className:"cosmic-forge-particles","aria-hidden":"true",id:"cosmic-forge-particles-container"})]})};function Xs(s){const t=document.getElementById("cosmic-forge-particles-container");if(!t)return;t.innerHTML="";const a=window.innerWidth<=768,r=window.innerWidth>768&&window.innerWidth<=1024;let i=12,o=22;s==="balanced"?a?(i=3,o=40):r?(i=4,o=32):(i=6,o=26):a?(i=6,o=35):r&&(i=8,o=28);for(let l=1;l<=i;l++){const c=document.createElement("div");c.className=`forge-particle forge-particle--${l}`;const m=Math.random()*100,d=(Math.random()-.5)*50,g=(Math.random()-.5)*80,p=(Math.random()-.5)*100,u=(Math.random()-.5)*120,f=a?Math.random()*1+2:r?Math.random()*1+2.5:Math.random()*2+2,h=o+(Math.random()-.5)*10,x=Math.random()*h;c.style.setProperty("--x0",`${m}vw`),c.style.setProperty("--x1",`${d}px`),c.style.setProperty("--x2",`${g}px`),c.style.setProperty("--x3",`${p}px`),c.style.setProperty("--x4",`${u}px`),c.style.setProperty("--size",`${f}px`),c.style.setProperty("--duration",`${h}s`),c.style.setProperty("--delay",`${x}s`),t.appendChild(c)}}class Ks{detectDeviceSpecs(){const t=window.innerWidth,a=window.innerHeight,r=window.devicePixelRatio||1,i=t<768,o=t>=768&&t<1024,l=window.matchMedia("(hover: hover) and (pointer: fine)").matches,c=navigator.deviceMemory||this.estimateMemory(),m=navigator.hardwareConcurrency||4,d=navigator.connection;let g="medium";if(d){const h=d.effectiveType;h==="slow-2g"||h==="2g"?g="slow":h==="3g"?g="medium":(h==="4g"||h==="5g")&&(g="fast")}const p=this.detectGPUTier(),{estimatedYear:u,deviceModel:f}=this.detectDeviceModel();return{memoryGB:c,cores:m,isMobile:i,isTablet:o,supportsHover:l,screenWidth:t,screenHeight:a,devicePixelRatio:r,connectionSpeed:g,gpuTier:p,estimatedYear:u,deviceModel:f}}estimateMemory(){const t=navigator.userAgent.toLowerCase();return/mobile|android|iphone|ipad/i.test(t)?/iphone 1[5-9]|iphone 2\d/i.test(t)?8:/iphone 1[2-4]/i.test(t)?6:/iphone [8-9]|iphone 1[0-1]|iphone x/i.test(t)?3:/iphone [5-7]/i.test(t)?2:4:8}detectGPUTier(){try{const t=document.createElement("canvas"),a=t.getContext("webgl")||t.getContext("experimental-webgl");if(!a)return"unknown";const r=a.getExtension("WEBGL_debug_renderer_info");if(!r)return"medium";const i=a.getParameter(r.UNMASKED_RENDERER_WEBGL).toLowerCase();return/apple|nvidia|adreno [6-9]|mali-g[7-9]|immortalis/i.test(i)?"high":/adreno [4-5]|mali-g[5-6]|powervr/i.test(i)?"medium":/adreno [2-3]|mali-[4t]/i.test(i)?"low":"medium"}catch(t){return n.error("DEVICE_DETECTION","Failed to detect GPU",{error:t}),"unknown"}}detectDeviceModel(){const t=navigator.userAgent;let a=new Date().getFullYear(),r="Unknown Device";const i=t.match(/iPhone(\d+),(\d+)/);if(i){const c=parseInt(i[1]);r=`iPhone (Model ${c},${i[2]})`,c>=16?a=2024:c>=14?a=2022:c>=13?a=2021:c>=12?a=2020:c>=11?a=2018:c>=10?a=2017:a=2016}const o=t.match(/iPad(\d+),(\d+)/);if(o){const c=parseInt(o[1]);r=`iPad (Model ${c},${o[2]})`,c>=14?a=2023:c>=13?a=2021:c>=11?a=2020:a=2018}const l=t.match(/Android\s([\d.]+)/);if(l&&!i&&!o){const c=parseFloat(l[1]);r=`Android ${c}`,c>=14?a=2024:c>=13?a=2023:c>=12?a=2022:c>=11?a=2021:a=2020}return{estimatedYear:a,deviceModel:r}}calculatePerformanceScore(t){let a=0;a+=Math.min(t.memoryGB*10,30),a+=Math.min(t.cores*3,20),t.gpuTier==="high"?a+=20:t.gpuTier==="medium"?a+=12:t.gpuTier==="low"?a+=5:a+=8;const r=new Date().getFullYear()-t.estimatedYear;return r<=1?a+=15:r<=2?a+=12:r<=3?a+=8:r<=4&&(a+=4),t.isMobile?t.isTablet&&(a+=5):a+=10,t.connectionSpeed==="fast"?a+=5:t.connectionSpeed==="medium"&&(a+=3),Math.min(Math.max(a,0),100)}categorizeDevice(t,a){const r=new Date().getFullYear()-a.estimatedYear;return t>=80&&r<=2?"flagship":t>=60&&r<=3?"mid-range":t>=40||r<=5?"budget":"legacy"}recommendMode(t,a,r){const i=new Date().getFullYear()-a.estimatedYear;return a.isMobile&&i>=5||r==="legacy"||t<40||r==="budget"||t>=40&&t<60?"high-performance":r==="mid-range"||t>=60&&t<80||a.isMobile&&t>=70?"balanced":"quality"}generateReasons(t,a,r){const i=[],o=new Date().getFullYear()-a.estimatedYear;return t==="high-performance"?(o>=5&&i.push(`Votre appareil a ${o} ans - optimisation recommandée`),a.memoryGB<4&&i.push(`RAM limitée (${a.memoryGB}GB) - fluidité prioritaire`),a.cores<4&&i.push(`Processeur limité (${a.cores} cœurs) - performance maximale`),a.gpuTier==="low"&&i.push("GPU peu puissant - effets visuels désactivés"),a.isMobile&&i.push("Mobile détecté - optimisation batterie et fluidité")):t==="balanced"?(i.push("Configuration équilibrée détectée"),i.push("Bon compromis entre performance et design"),a.isMobile&&i.push("Optimisé pour mobile avec effets essentiels")):(i.push("Appareil performant détecté - expérience premium disponible"),i.push("Tous les effets visuels activés"),a.isMobile||i.push("Desktop - rendu haute qualité optimal")),i}shouldShowAlert(t,a,r){return t==="high-performance"&&(a==="legacy"||a==="budget")||r<50}analyzeDevice(){n.info("DEVICE_DETECTION","Starting device analysis");const t=this.detectDeviceSpecs(),a=this.calculatePerformanceScore(t),r=this.categorizeDevice(a,t),i=this.recommendMode(a,t,r),o=this.shouldShowAlert(i,r,a),l=this.generateReasons(i,t,a),c={recommendedMode:i,deviceCategory:r,deviceSpecs:t,performanceScore:a,shouldShowAlert:o,reasons:l};return n.info("DEVICE_DETECTION","Device analysis complete",{category:r,score:a,recommendedMode:i,shouldShowAlert:o}),c}getCategoryLabel(t){return{flagship:"Haut de gamme","mid-range":"Milieu de gamme",budget:"Entrée de gamme",legacy:"Ancien modèle"}[t]}getModeLabel(t){return{"high-performance":"Performance Maximale",balanced:"Équilibré",quality:"Qualité Premium"}[t]}}const je=new Ks,Tn=({recommendation:s,onDismiss:t,onNavigateToSettings:a})=>{const[r,i]=C.useState(!0),o=oe(),{showToast:l}=Ke(),c=async()=>{i(!1),setTimeout(()=>{t()},300)},m=()=>{i(!1),setTimeout(()=>{o("/settings"),a()},300)},d=()=>{switch(s.recommendedMode){case"high-performance":return v.Zap;case"balanced":return v.Scale;case"quality":return v.Sparkles;default:return v.Settings}},g=()=>{switch(s.recommendedMode){case"high-performance":return"#10B981";case"balanced":return"#3B82F6";case"quality":return"#A855F7";default:return"#94A3B8"}},p=u=>u>=80?"#10B981":u>=60?"#3B82F6":u>=40?"#F59E0B":"#EF4444";return e.jsx(H,{children:r&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.85)",backdropFilter:"blur(12px)"},children:e.jsx(y.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"w-full max-w-2xl rounded-3xl overflow-hidden",style:{background:"linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%)",border:"1px solid rgba(148, 163, 184, 0.2)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(y.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},children:e.jsx(j,{Icon:d(),size:40,color:g(),variant:"pure"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:"Optimisation Détectée"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Configuration de performance recommandée"})]})]}),e.jsx("button",{onClick:c,className:"text-slate-400 hover:text-white transition-colors p-2","aria-label":"Fermer",children:e.jsx(j,{Icon:v.X,size:24,variant:"pure"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-6 rounded-2xl",style:{background:"linear-gradient(135deg, rgba(51, 65, 85, 0.6) 0%, rgba(30, 41, 59, 0.6) 100%)",border:"1px solid rgba(148, 163, 184, 0.15)"},children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx(j,{Icon:v.Smartphone,size:24,color:"#60A5FA",variant:"pure"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Votre Appareil"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Modèle:"}),e.jsx("span",{className:"text-white ml-2",children:s.deviceSpecs.deviceModel})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Catégorie:"}),e.jsx("span",{className:"text-white ml-2",children:je.getCategoryLabel(s.deviceCategory)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"RAM:"}),e.jsxs("span",{className:"text-white ml-2",children:[s.deviceSpecs.memoryGB,"GB"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Processeur:"}),e.jsxs("span",{className:"text-white ml-2",children:[s.deviceSpecs.cores," cœurs"]})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-2",children:[e.jsx("span",{className:"text-slate-400",children:"Score de Performance"}),e.jsxs("span",{className:"font-semibold",style:{color:p(s.performanceScore)},children:[s.performanceScore,"/100"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-slate-700 overflow-hidden",children:e.jsx(y.div,{initial:{width:0},animate:{width:`${s.performanceScore}%`},transition:{delay:.5,duration:1,ease:"easeOut"},className:"h-full rounded-full",style:{background:`linear-gradient(90deg, ${p(s.performanceScore)} 0%, ${p(s.performanceScore)}CC 100%)`}})})]})})]}),e.jsxs("div",{className:"p-6 rounded-2xl",style:{background:`linear-gradient(135deg, ${g()}20 0%, ${g()}10 100%)`,border:`1px solid ${g()}40`},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(j,{Icon:d(),size:28,color:g(),variant:"pure"}),e.jsx("div",{children:e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Mode Recommandé: ",je.getModeLabel(s.recommendedMode)]})})]}),e.jsx("ul",{className:"space-y-2",children:s.reasons.map((u,f)=>e.jsxs(y.li,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.6+f*.1},className:"flex items-start gap-2 text-sm",children:[e.jsx(j,{Icon:v.CheckCircle,size:16,color:g(),variant:"pure",className:"mt-0.5"}),e.jsx("span",{className:"text-slate-300",children:u})]},f))})]}),e.jsx("div",{className:"p-5 rounded-2xl",style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{Icon:v.Info,size:20,color:"#60A5FA",variant:"pure"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:"Nous avons conçu l'application avec soin pour offrir 3 niveaux de qualité visuelle. Vous pouvez choisir le mode qui vous convient et profiter d'une expérience fluide adaptée à votre appareil."})})]})})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsx("button",{onClick:c,className:"flex-1 px-6 py-3 rounded-2xl font-medium transition-all",style:{background:"rgba(71, 85, 105, 0.5)",border:"1px solid rgba(148, 163, 184, 0.3)",color:"#CBD5E1"},children:"Plus tard"}),e.jsx("button",{onClick:m,className:"flex-1 px-6 py-3 rounded-2xl font-medium transition-all",style:{background:`linear-gradient(135deg, ${g()} 0%, ${g()}CC 100%)`,border:`1px solid ${g()}`,color:"white",boxShadow:`0 4px 12px ${g()}40`},children:"Choisir mon mode"})]})]})})})})};function An(){const[s,t]=C.useState(!1),[a,r]=C.useState(null),{profile:i}=ne();return C.useEffect(()=>{(async()=>{if(i?.id)try{const{data:c}=await L.from("user_preferences").select("performance_alert_shown").eq("user_id",i.id).maybeSingle();if(c?.performance_alert_shown){n.debug("PERFORMANCE_ALERT","Alert already shown to user");return}const m=je.analyzeDevice();m.shouldShowAlert&&(r(m),t(!0),await L.from("user_preferences").upsert({user_id:i.id,performance_alert_shown:!0,updated_at:new Date().toISOString()},{onConflict:"user_id"}),n.info("PERFORMANCE_ALERT","Showing performance recommendation alert",{recommendedMode:m.recommendedMode,score:m.performanceScore}))}catch(c){n.error("PERFORMANCE_ALERT","Failed to check alert status",{error:c})}})()},[i?.id]),{showAlert:s,recommendation:a,dismissAlert:()=>{t(!1),r(null)}}}function Rn({icon:s="Home",title:t,subtitle:a,actions:r,className:i="",circuit:o="home",iconColor:l}){const{isPerformanceMode:c}=J(),m=o==="track"?v.Target:v[s],d=l||re[o];return e.jsxs("header",{className:`pt-6 md:pt-8 mb-4 md:mb-6 will-change-transform-important ${i}`,role:"banner","aria-labelledby":"page-title",children:[e.jsxs("div",{className:"flex flex-row items-center gap-6 mb-8",children:[c?e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-2xl flex items-center justify-center relative overflow-hidden",style:{background:`linear-gradient(145deg,
                  color-mix(in srgb, ${d} 25%, #1e293b),
                  color-mix(in srgb, ${d} 12%, #0f172a)
                )`,border:`2px solid color-mix(in srgb, ${d} 50%, transparent)`,boxShadow:`
                  0 8px 24px rgba(0, 0, 0, 0.4),
                  0 2px 8px color-mix(in srgb, ${d} 20%, transparent),
                  0 4px 16px color-mix(in srgb, ${d} 15%, transparent),
                  inset 0 2px 0 rgba(255, 255, 255, 0.15),
                  inset 0 -2px 0 rgba(0, 0, 0, 0.2)
                `},role:"img","aria-label":`Icône de la page ${t}`,children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1",style:{background:`linear-gradient(90deg,
                    transparent,
                    color-mix(in srgb, ${d} 60%, transparent),
                    transparent
                  )`}}),e.jsx(j,{Icon:m,size:48,variant:"pure",className:"text-white relative z-10",style:{color:d,filter:`drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) drop-shadow(0 1px 3px color-mix(in srgb, ${d} 25%, transparent))`,opacity:1},"aria-hidden":"true"})]})}):e.jsx("div",{className:"breathing-icon flex-shrink-0",style:{"--animation-duration-slower":"5s"},children:e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-2xl flex items-center justify-center relative overflow-hidden shadow-lg",style:{"--header-icon-radius":"24px",borderRadius:"var(--header-icon-radius)",WebkitMaskImage:"radial-gradient(white, black)",maskImage:"radial-gradient(white, black)",background:`
                  radial-gradient(circle at 30% 30%, color-mix(in srgb, ${d} 40%, transparent) 0%, transparent 60%),
                  radial-gradient(circle at 70% 70%, color-mix(in srgb, var(--brand-primary) 35%, transparent) 0%, transparent 50%),
                  radial-gradient(circle at 50% 50%, color-mix(in srgb, ${d} 25%, transparent) 0%, transparent 70%),
                  rgba(255, 255, 255, 0.15)
                `,border:`2px solid color-mix(in srgb, ${d} 60%, transparent)`,boxShadow:`
                  0 16px 64px color-mix(in srgb, ${d} 45%, transparent),
                  0 0 100px color-mix(in srgb, ${d} 35%, transparent),
                  0 0 160px color-mix(in srgb, var(--brand-primary) 25%, transparent),
                  inset 0 4px 0 rgba(255, 255, 255, 0.3),
                  inset 0 -3px 0 rgba(0, 0, 0, 0.15)
                `,backdropFilter:"blur(24px) saturate(200%)",WebkitBackdropFilter:"blur(24px) saturate(200%)",willChange:"transform, box-shadow",transform:"translateZ(0)"},role:"img","aria-label":`Icône de la page ${t}`,children:e.jsx(j,{Icon:m,size:48,variant:"pure",className:"text-white relative z-10",style:{color:d,filter:`drop-shadow(0 0 30px color-mix(in srgb, ${d} 90%, transparent)) drop-shadow(0 0 60px color-mix(in srgb, ${d} 60%, transparent))`,textShadow:`0 0 40px color-mix(in srgb, ${d} 80%, transparent), 0 0 80px color-mix(in srgb, var(--brand-primary) 40%, transparent)`},"aria-hidden":"true"})})}),e.jsxs("div",{className:"space-y-2 text-left flex-1 min-w-0",children:[e.jsx("h1",{id:"page-title",className:"text-2xl md:text-3xl lg:text-4xl font-bold text-white page-header-title",style:{color:"var(--text-primary)",fontWeight:700,letterSpacing:"-0.01em",textShadow:c?"0 2px 8px rgba(0, 0, 0, 0.6)":`0 0 40px color-mix(in srgb, ${d} 50%, transparent)`,lineHeight:"1.2"},children:t}),a&&e.jsx("p",{className:"text-gray-300 text-lg md:text-xl max-w-2xl leading-relaxed page-header-subtitle",style:{color:`color-mix(in srgb, #E5E7EB 90%, ${d} 10%)`,textShadow:c?"0 1px 4px rgba(0, 0, 0, 0.5)":"0 0 20px rgba(0, 0, 0, 0.5)",lineHeight:"1.4"},"aria-describedby":"page-title",children:a})]})]}),r&&e.jsx("div",{className:"mt-3 md:mt-4 flex justify-center",role:"group","aria-label":"Actions de la page",children:r})]})}const Ze=C.createContext(void 0),Te=()=>{const s=C.useContext(Ze);if(!s)throw new Error("Tabs components must be used within a Tabs provider");return s},Ys={"profile:identity":"#60A5FA","profile:nutrition":"#10B981","profile:health":"#EF4444","profile:fasting":"#F59E0B","profile:preferences":"#18E3FF","profile:geo":"#EC4899","profile:avatar":"#A855F7",scanner:"#EC4899",inventaire:"#06B6D4",recipes:"#10B981",plan:"#8B5CF6",courses:"#F59E0B","meals:daily":"#10B981","meals:insights":"#F59E0B","meals:progression":"#06B6D4","meals:history":"#8B5CF6",journal:"#10B981",statistiques:"#06B6D4","fasting:daily":"#F59E0B","fasting:insights":"#10B981","fasting:progression":"#06B6D4","fasting:history":"#8B5CF6",timer:"#F59E0B",protocoles:"#06B6D4","activity:daily":"#3B82F6","activity:insights":"#F59E0B","activity:progression":"#10B981","activity:history":"#8B5CF6","activity:input":"#3B82F6","avatar:scanCta":"#8B5CF6","avatar:avatar":"#06B6D4","avatar:projection":"#10B981","avatar:insights":"#F59E0B","avatar:history":"#8B5CF6","avatar:face":"#EC4899","avatar:comparaison":"#A855F7","aujourd hui":"#18E3FF",conseils:"#10B981",progressionTraining:"#F59E0B",records:"#EF4444",historiqueTraining:"#8B5CF6",programmes:"#18E3FF",exercices:"#06B6D4",account:"#10B981",performance:"#F59E0B",preferences:"#8B5CF6",general:"#8B5CF6",notifications:"#EC4899",confidentialite:"#3B82F6",appareils:"#06B6D4",recentes:"#EC4899",parametres:"#8B5CF6","health:overview":"#EF4444","health:basic-info":"#EF4444","health:lifestyle":"#F59E0B","health:intimacy":"#EC4899","health:family-history":"#06B6D4","health:vital-signs":"#8B5CF6","health:geographic":"#3B82F6"};function ze(s){return Ys[s]}const Ae=({defaultValue:s,className:t="",children:a,onValueChange:r,forgeContext:i})=>{const o=ue(),l=oe(),c=k.useMemo(()=>{const d=o.hash.replace("#","");return(d?decodeURIComponent(d):"")||s},[o.hash,s]),m=k.useCallback(d=>{l({hash:d}),r?.(d)},[l,r]);return e.jsx(Ze.Provider,{value:{activeTab:c,setActiveTab:m,forgeContext:i},children:e.jsx("div",{className:`tabs w-full ${t}`,children:a})})},Zs=({role:s="tablist","aria-label":t,className:a="",children:r})=>{const i=k.useRef(null),o=k.useRef(null),[l,c]=k.useState(!1),[m,d]=k.useState(0),{activeTab:g}=Te(),[p,u]=k.useState([]);k.useEffect(()=>{const x=()=>{const w=i.current,S=o.current;if(!w||!S)return;const E=w.scrollWidth>w.clientWidth;c(E),S.classList.toggle("has-overflow",E);const I=Array.from(w.querySelectorAll(".tabs-trigger"));u(I)};x();const b=new ResizeObserver(x);return i.current&&b.observe(i.current),()=>b.disconnect()},[r]),k.useEffect(()=>{const x=p.findIndex(b=>b.getAttribute("aria-selected")==="true"||b.getAttribute("value")===g);x!==-1&&d(x)},[g,p]),k.useEffect(()=>{if(!i.current)return;const x=i.current.querySelector(`button[id="tab-${g}"]`);if(x){const b=i.current,w=x.getBoundingClientRect(),S=b.getBoundingClientRect(),E=w.left<S.left||w.right>S.right;(l||E)&&setTimeout(()=>{x.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},100)}},[g,l]);const f=k.useMemo(()=>!l||p.length===0?[]:p.map((x,b)=>({id:b,active:b===m})),[l,p,m]),h=k.Children.map(r,x=>k.isValidElement(x)&&x.type===Qe?k.cloneElement(x,{listRef:i,hasOverflow:l,...x.props}):x);return e.jsxs("div",{children:[e.jsx("div",{ref:o,className:`tabs-list-container ${a}`,style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--brand-primary) 8%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, var(--color-plasma-cyan) 6%, transparent) 0%, transparent 50%),
            rgba(255, 255, 255, 0.05)
          `,border:"2px solid color-mix(in srgb, var(--color-plasma-cyan) 15%, transparent)",backdropFilter:"blur(16px) saturate(140%)",boxShadow:`
            0 8px 32px rgba(0, 0, 0, 0.25),
            0 0 20px color-mix(in srgb, var(--brand-primary) 10%, transparent),
            inset 0 1px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsx("div",{ref:i,role:s,"aria-label":t,className:"tabs-list",children:h})}),l&&f.length>0&&e.jsx("div",{className:"tabs-scroll-indicators",children:f.map(x=>e.jsx("div",{className:`tabs-scroll-dot ${x.active?"tabs-scroll-dot--active":""}`,title:`Onglet ${x.id+1}`},x.id))})]})},Qe=({value:s,icon:t,children:a,listRef:r,hasOverflow:i})=>{const{activeTab:o,setActiveTab:l,forgeContext:c}=Te(),m=o===s,d=t?v[t]:null,g=k.useRef(null),p=(h,x,b)=>{if(x){if(b){const w=`${b}:${h}`,S=ze(w);if(S)return S}return ze(h)}},u=()=>{l(s),i&&r?.current&&g.current&&g.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},f=p(s,m,c);return e.jsxs("button",{ref:g,role:"tab","aria-selected":m,"aria-controls":`panel-${s}`,id:`tab-${s}`,className:`tabs-trigger ${m?"active":""}`,onClick:u,style:{"--button-color":f||"var(--color-plasma-cyan)"},children:[d&&e.jsx(d,{className:"tab-icon",color:f,style:f?{color:f}:void 0}),a]})},Qs=({value:s,children:t,disableAnimation:a=!1})=>{const{activeTab:r}=Te(),i=r===s,[o,l]=k.useState(i);return k.useEffect(()=>{i&&!o&&l(!0)},[i,o]),o?e.jsx("div",{role:"tabpanel",id:`panel-${s}`,"aria-labelledby":`tab-${s}`,className:"tabs-panel pt-6 md:pt-8",style:{display:i?"block":"none"},children:t}):null};Ae.List=Zs;Ae.Trigger=Qe;Ae.Panel=Qs;const Nn=()=>{C.useEffect(()=>{const s=t=>{if(t.target&&t.target.getAttribute("role")==="tab"){const a=t.target.closest('[role="tablist"]');if(!a)return;const r=Array.from(a.querySelectorAll('[role="tab"]')),i=r.indexOf(t.target);let o=i;t.key==="ArrowRight"?o=(i+1)%r.length:t.key==="ArrowLeft"&&(o=(i-1+r.length)%r.length),o!==i&&(t.preventDefault(),r[o]?.click(),r[o]?.focus())}};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[])},et="twinforge:profile-nudge:dismissed",en=24;function tn(){try{const s=localStorage.getItem(et);if(!s)return!1;const{timestamp:t}=JSON.parse(s),a=new Date(t);return(new Date().getTime()-a.getTime())/(1e3*60*60)<en}catch{return!1}}function an(){try{localStorage.setItem(et,JSON.stringify({timestamp:new Date().toISOString(),completionPercentage:0}))}catch{}}const kn=({completion:s,variant:t="card",className:a="",onDismiss:r,showDismiss:i=!0})=>{const o=oe(),{click:l,success:c}=G(),[m,d]=k.useState(!1);if(k.useEffect(()=>{d(tn())},[]),!s||s.isSufficient||m)return null;const g=()=>{l(),s.nextAction&&(o(s.nextAction.route),c())},p=h=>{h?.stopPropagation(),l(),an(),d(!0),r?.()},u=s.missingHighPriorityFields.length>0?"#EF4444":"#F59E0B",f=s.missingHighPriorityFields.length>0?"Critique":"Recommandé";return t==="banner"?e.jsx(y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`w-full ${a}`,children:e.jsx(q,{className:"p-4",style:{background:`
              radial-gradient(circle at 30% 20%, color-mix(in srgb, ${u} 12%, transparent) 0%, transparent 60%),
              var(--glass-opacity)
            `,borderColor:`color-mix(in srgb, ${u} 25%, transparent)`,boxShadow:`
              0 8px 32px rgba(0, 0, 0, 0.2),
              0 0 20px color-mix(in srgb, ${u} 15%, transparent),
              inset 0 1px 0 rgba(255, 255, 255, 0.15)
            `},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:`color-mix(in srgb, ${u} 20%, transparent)`,border:`2px solid color-mix(in srgb, ${u} 40%, transparent)`},children:e.jsx(j,{Icon:v.User,size:18,style:{color:u}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold text-sm",children:s.suggestedMessage}),e.jsxs("p",{className:"text-white/70 text-xs",children:[s.completionPercentage,"% complété • ",f]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.nextAction&&e.jsx("button",{onClick:g,className:"btn-glass--primary px-4 py-2 text-sm",children:s.nextAction.label}),i&&e.jsx("button",{onClick:p,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(j,{Icon:v.X,size:14,className:"text-white/60"})})]})]})})}):t==="compact"?e.jsx(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:`inline-flex ${a}`,children:e.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-3 py-2 rounded-full text-sm transition-all duration-200",style:{background:`color-mix(in srgb, ${u} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${u} 30%, transparent)`,color:u},children:[e.jsx(j,{Icon:v.AlertCircle,size:14}),e.jsxs("span",{className:"font-medium",children:["Profil ",s.completionPercentage,"%"]})]})}):e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:a,children:e.jsx(q,{className:"p-6",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${u} 12%, transparent) 0%, transparent 60%),
            radial-gradient(circle at 70% 80%, color-mix(in srgb, #06B6D4 8%, transparent) 0%, transparent 50%),
            var(--glass-opacity)
          `,borderColor:`color-mix(in srgb, ${u} 25%, transparent)`,boxShadow:`
            0 12px 40px rgba(0, 0, 0, 0.25),
            0 0 30px color-mix(in srgb, ${u} 15%, transparent),
            inset 0 2px 0 rgba(255, 255, 255, 0.15)
          `},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, ${u} 35%, transparent), color-mix(in srgb, ${u} 25%, transparent))
              `,border:`2px solid color-mix(in srgb, ${u} 50%, transparent)`,boxShadow:`0 0 20px color-mix(in srgb, ${u} 30%, transparent)`},children:e.jsx(j,{Icon:v.User,size:20,style:{color:u}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-white font-bold text-lg",children:"Optimisez vos Recettes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:u}}),e.jsx("span",{className:"text-sm font-medium",style:{color:u},children:f})]})]}),e.jsx("p",{className:"text-white/80 text-sm mb-4 leading-relaxed",children:s.suggestedMessage}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/60 mb-2",children:[e.jsx("span",{children:"Profil complété"}),e.jsxs("span",{children:[s.completionPercentage,"%"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 overflow-hidden",children:e.jsx(y.div,{className:"h-2 rounded-full",style:{background:`linear-gradient(90deg, ${u}, color-mix(in srgb, ${u} 80%, white))`,width:`${s.completionPercentage}%`},initial:{width:0},animate:{width:`${s.completionPercentage}%`},transition:{duration:1,ease:"easeOut"}})})]}),s.missingHighPriorityFields.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-white/90 text-sm font-medium mb-2",children:"Champs essentiels manquants :"}),e.jsxs("div",{className:"space-y-1",children:[s.missingHighPriorityFields.slice(0,3).map((h,x)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),e.jsx("span",{className:"text-red-300 text-xs",children:h.label}),e.jsxs("span",{className:"text-white/50 text-xs",children:["• ",h.description]})]},h.key)),s.missingHighPriorityFields.length>3&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-red-400"}),e.jsxs("span",{className:"text-red-300 text-xs",children:["+",s.missingHighPriorityFields.length-3," autres champs"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[s.nextAction&&e.jsx("button",{onClick:g,className:"btn-glass--primary px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{Icon:v.ArrowRight,size:14}),e.jsx("span",{children:s.nextAction.label})]})}),i&&e.jsx("button",{onClick:p,className:"btn-glass--secondary-nav px-3 py-2",title:"Ignorer pour maintenant",children:e.jsx(j,{Icon:v.X,size:14})})]})]})]})})})},Ue={activity:[{key:"sex",label:"Genre"},{key:"height_cm",label:"Taille"},{key:"weight_kg",label:"Poids"}],meals:[{key:"sex",label:"Genre"},{key:"weight_kg",label:"Poids"},{key:"height_cm",label:"Taille"},{key:"objective",label:"Objectif"}],fasting:[{key:"weight_kg",label:"Poids"},{key:"objective",label:"Objectif"},{key:"activity_level",label:"Niveau d'activité"}],culinary:[{key:"weight_kg",label:"Poids"},{key:"objective",label:"Objectif"}],avatar:[{key:"sex",label:"Genre"},{key:"height_cm",label:"Taille"},{key:"weight_kg",label:"Poids"},{key:"birthdate",label:"Date de naissance"}]},rn={activity:{incomplete:"Profil incomplet pour le tracking d'activité",complete:"Profil optimisé pour le tracking d'activité"},meals:{incomplete:"Profil incomplet - Analyses nutritionnelles limitées",complete:"Profil complet pour l'analyse nutritionnelle"},fasting:{incomplete:"Profil incomplet pour le suivi du jeûne",complete:"Profil complet pour le jeûne intermittent"},culinary:{incomplete:"Profil incomplet pour les recommandations culinaires",complete:"Profil complet pour vos recommandations"},avatar:{incomplete:"Profil incomplet pour le scan corporel",complete:"Profil complet pour le scan 3D"}};function sn(s,t){if(!s){const l=Ue[t].map(c=>c.label);return{percentage:0,missingFields:["Profil non chargé"],missingCritical:l,isComplete:!1,canProvideAccurateAnalysis:!1}}const a=Ue[t],r=a.filter(l=>{const c=s[l.key];return c==null||c===""}).map(l=>l.label),i=a.filter(l=>{const c=s[l.key];return c!=null&&c!==""}),o=a.length>0?Math.round(i.length/a.length*100):100;return{percentage:o,missingFields:r,missingCritical:r,isComplete:o===100,canProvideAccurateAnalysis:r.length===0}}function nn(s,t){const a=rn[t];return s.isComplete||s.canProvideAccurateAnalysis?{title:a.complete,type:"success",actionText:"Voir le profil"}:s.missingCritical.length>0?{title:a.incomplete,type:"error",actionText:"Compléter"}:{title:a.incomplete,type:"warning",actionText:"Compléter"}}const _n=({profile:s,forgeContext:t})=>{const{isPerformanceMode:a}=J(),r=a?"div":y.div,i=k.useMemo(()=>{n.debug("PROFILE_COMPLETENESS_ALERT","Calculating profile completeness",{forgeContext:t,profileExists:!!s,profileId:s?.id,timestamp:new Date().toISOString()});const c=sn(s,t);return n.debug("PROFILE_COMPLETENESS_ALERT","Profile completeness calculated",{forgeContext:t,percentage:c.percentage,canProvideAccurateAnalysis:c.canProvideAccurateAnalysis,missingCriticalCount:c.missingCritical.length,missingCritical:c.missingCritical,timestamp:new Date().toISOString()}),c},[s,t,s?.sex,s?.height_cm,s?.weight_kg,s?.objective,s?.activity_level,s?.birthdate,s?._immutabilityMarker,s?.updated_at]),o=nn(i,t);if(i.canProvideAccurateAnalysis||i.percentage>=100)return null;const l={bg:"rgba(239, 68, 68, 0.08)",border:"rgba(239, 68, 68, 0.25)",text:"#EF4444",icon:"AlertCircle"};return e.jsx(r,{...!a&&{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5}},children:e.jsx(q,{className:"p-4",style:{background:a?`linear-gradient(145deg, ${l.bg}, transparent)`:`radial-gradient(circle at 30% 20%, ${l.bg} 0%, transparent 60%), var(--glass-opacity)`,borderColor:l.border,boxShadow:a?"0 4px 16px rgba(0, 0, 0, 0.5)":`0 0 20px ${l.text}15`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0",style:{background:`${l.text}20`,border:`1px solid ${l.text}40`},children:e.jsx(j,{Icon:v[l.icon],size:12,style:{color:l.text}})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium text-sm",children:o.title}),e.jsx("div",{className:"text-white/60 text-xs mt-1",children:i.missingCritical.length>0?`${i.missingCritical.length} champs critiques manquants`:`${i.percentage}% complété`})]})]}),e.jsx(de,{to:"/profile#identity",className:"btn-glass--secondary-nav px-3 py-1.5 text-xs",style:{background:"rgba(59, 130, 246, 0.15)",borderColor:"rgba(59, 130, 246, 0.3)",color:"#3B82F6"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{Icon:v.User,size:12}),e.jsx("span",{children:o.actionText||"Compléter"})]})})]})})})},Mn=({isOpen:s,onClose:t,onConfirm:a,title:r,message:i,confirmText:o="Confirmer",cancelText:l="Annuler",variant:c="danger"})=>{const m=()=>{a(),t()},g=(()=>{switch(c){case"danger":return{iconColor:"#EF4444",icon:v.AlertTriangle,borderColor:"rgba(239, 68, 68, 0.3)",bgGradient:"radial-gradient(circle at 30% 20%, rgba(239, 68, 68, 0.1) 0%, transparent 60%)"};case"warning":return{iconColor:"#F59E0B",icon:v.AlertCircle,borderColor:"rgba(245, 158, 11, 0.3)",bgGradient:"radial-gradient(circle at 30% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 60%)"};case"info":return{iconColor:"#3B82F6",icon:v.Info,borderColor:"rgba(59, 130, 246, 0.3)",bgGradient:"radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 60%)"}}})(),p=e.jsx(H,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[200000]",onClick:t,style:{position:"fixed",top:0,left:0,right:0,bottom:0}}),e.jsx(y.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-[200001] flex items-center justify-center p-4 pointer-events-none",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:e.jsx(q,{className:"w-full max-w-md pointer-events-auto",style:{background:`${g.bgGradient}, var(--glass-opacity)`,borderColor:g.borderColor},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center",style:{background:`radial-gradient(circle at 30% 30%, color-mix(in srgb, ${g.iconColor} 30%, transparent) 0%, transparent 60%), rgba(255, 255, 255, 0.1)`,border:`2px solid color-mix(in srgb, ${g.iconColor} 40%, transparent)`,boxShadow:`0 4px 16px color-mix(in srgb, ${g.iconColor} 20%, transparent)`},children:e.jsx(j,{Icon:g.icon,size:24,style:{color:g.iconColor,filter:`drop-shadow(0 0 8px color-mix(in srgb, ${g.iconColor} 60%, transparent))`}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-white font-semibold text-lg mb-2",children:r}),e.jsx("p",{className:"text-white/70 text-sm leading-relaxed",children:i})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:t,className:"flex-1 py-2.5 px-4 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-medium transition-all",children:l}),e.jsx("button",{onClick:m,className:"flex-1 py-2.5 px-4 rounded-lg text-white text-sm font-medium transition-all shadow-lg",style:{background:c==="danger"?"linear-gradient(135deg, #EF4444 0%, #DC2626 100%)":c==="warning"?"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)":"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",boxShadow:`0 4px 12px color-mix(in srgb, ${g.iconColor} 30%, transparent)`},children:o})]})]})})})]})});return typeof document<"u"?be.createPortal(p,document.body):p},On=({children:s,containerId:t="portal-root"})=>{const a=C.useRef(null);return C.useEffect(()=>{let r=document.getElementById(t);return r||(r=document.createElement("div"),r.id=t,document.body.appendChild(r)),a.current=r,()=>{a.current&&a.current.childNodes.length===0&&a.current.remove()}},[t]),a.current?be.createPortal(s,a.current):null},Fn=({benefits:s,themeColor:t,title:a="Pourquoi utiliser cette fonctionnalité ?",className:r=""})=>e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},className:r,children:e.jsxs(q,{className:"p-4",style:{background:`
            radial-gradient(circle at 30% 20%, color-mix(in srgb, ${t} 6%, transparent) 0%, transparent 60%),
            var(--glass-opacity-base)
          `,borderColor:`color-mix(in srgb, ${t} 20%, transparent)`,boxShadow:`
            var(--glass-shadow-sm),
            0 0 12px color-mix(in srgb, ${t} 8%, transparent)
          `},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center breathing-icon",style:{background:`
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(135deg, color-mix(in srgb, ${t} 40%, transparent), color-mix(in srgb, ${t} 30%, transparent))
              `,border:`2px solid color-mix(in srgb, ${t} 60%, transparent)`,boxShadow:`
                0 0 20px color-mix(in srgb, ${t} 50%, transparent),
                inset 0 2px 0 rgba(255,255,255,0.3)
              `},children:e.jsx(j,{Icon:v.Info,size:14,style:{color:t},variant:"pure"})}),e.jsx("h4",{className:"text-white/90 font-medium text-sm",children:a})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:s.map((i,o)=>e.jsxs(y.div,{className:"benefit-card",style:{background:`color-mix(in srgb, ${i.color} 6%, transparent)`,border:`1px solid color-mix(in srgb, ${i.color} 15%, transparent)`,borderRadius:"12px",padding:"12px",backdropFilter:"blur(8px)",transition:"all 0.2s ease"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1+o*.1},whileHover:{y:-2,borderColor:`color-mix(in srgb, ${i.color} 30%, transparent)`,background:`color-mix(in srgb, ${i.color} 10%, transparent)`},children:[e.jsx("div",{className:"flex items-center justify-center mb-2",style:{width:"32px",height:"32px",borderRadius:"8px",background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${i.color} 25%, transparent), color-mix(in srgb, ${i.color} 15%, transparent))
                  `,border:`1px solid color-mix(in srgb, ${i.color} 30%, transparent)`,boxShadow:`0 0 12px color-mix(in srgb, ${i.color} 20%, transparent)`},children:e.jsx(j,{Icon:v[i.icon],size:16,style:{color:i.color},variant:"pure"})}),e.jsx("div",{className:"text-white font-semibold text-sm mb-1",children:i.title}),e.jsx("div",{className:"text-white/70 text-xs leading-relaxed",children:i.description})]},i.id))})]})}),Bn=["apple_health","google_fit","strava"],on={strava:{id:"strava",name:"Strava",description:"Course, vélo, natation et autres activités",icon:"Activity",color:"#FC4C02",authUrl:"https://www.strava.com/oauth/authorize",scopes:["read","activity:read_all","activity:read"],dataTypes:["workout","distance","heart_rate","calories","elevation","pace","cadence"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},garmin:{id:"garmin",name:"Garmin Connect",description:"Montres Garmin et données fitness complètes",icon:"Watch",color:"#007CC3",authUrl:"https://connect.garmin.com/oauth/authorize",scopes:["activities","wellness","sleep"],dataTypes:["heart_rate","steps","calories","distance","sleep","workout","hrv","stress_level","body_battery","vo2max"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},fitbit:{id:"fitbit",name:"Fitbit",description:"Trackers Fitbit et montres Versa/Sense",icon:"Activity",color:"#00B0B9",authUrl:"https://www.fitbit.com/oauth2/authorize",scopes:["activity","heartrate","sleep","weight","nutrition"],dataTypes:["heart_rate","resting_heart_rate","steps","calories","distance","sleep","weight","active_minutes","spo2"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},apple_health:{id:"apple_health",name:"Apple Health",description:"Apple Watch et iPhone Health",icon:"Heart",color:"#FF3B30",authUrl:"",scopes:["health_read"],dataTypes:["heart_rate","steps","calories","distance","sleep","workout","weight","blood_pressure","spo2","hrv","vo2max"],supportsWebhooks:!1,requiresApp:!0,platform:"ios"},polar:{id:"polar",name:"Polar Flow",description:"Montres Polar et capteurs",icon:"Heart",color:"#E30613",authUrl:"https://flow.polar.com/oauth2/authorization",scopes:["accesslink.read_all"],dataTypes:["heart_rate","workout","calories","distance","sleep","hrv"],supportsWebhooks:!0,requiresApp:!1,platform:"all"},wahoo:{id:"wahoo",name:"Wahoo",description:"Capteurs Wahoo et compteurs vélo",icon:"Bike",color:"#2E3192",authUrl:"https://api.wahooligan.com/oauth/authorize",scopes:["workouts_read","power_read"],dataTypes:["workout","heart_rate","power","cadence","distance","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},whoop:{id:"whoop",name:"WHOOP",description:"Bracelet WHOOP et métriques de récupération",icon:"Activity",color:"#000000",authUrl:"https://api.prod.whoop.com/oauth/authorize",scopes:["read:recovery","read:workout","read:sleep"],dataTypes:["heart_rate","hrv","sleep","workout","stress_level","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},oura:{id:"oura",name:"Oura Ring",description:"Bague Oura et données de sommeil",icon:"Moon",color:"#5E17EB",authUrl:"https://cloud.ouraring.com/oauth/authorize",scopes:["daily","personal","session"],dataTypes:["heart_rate","hrv","sleep","temperature","steps","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},suunto:{id:"suunto",name:"Suunto",description:"Montres Suunto pour sports outdoor",icon:"Watch",color:"#FF3B3F",authUrl:"https://cloudapi.suunto.com/oauth/authorize",scopes:["workout"],dataTypes:["workout","heart_rate","distance","elevation","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},coros:{id:"coros",name:"COROS",description:"Montres COROS pour endurance",icon:"Watch",color:"#FF6B00",authUrl:"https://open.coros.com/oauth2/authorize",scopes:["workouts:read"],dataTypes:["workout","heart_rate","distance","elevation","pace","calories"],supportsWebhooks:!1,requiresApp:!1,platform:"all"},google_fit:{id:"google_fit",name:"Google Fit",description:"Google Fit et Android Health",icon:"Activity",color:"#4285F4",authUrl:"https://accounts.google.com/o/oauth2/v2/auth",scopes:["https://www.googleapis.com/auth/fitness.activity.read","https://www.googleapis.com/auth/fitness.heart_rate.read"],dataTypes:["heart_rate","steps","calories","distance","workout","weight"],supportsWebhooks:!1,requiresApp:!0,platform:"android"}},Dn=({variant:s="compact",showSyncButton:t=!1,className:a=""})=>{const{user:r}=ne(),{devices:i,loading:o,syncing:l,syncDevice:c,refreshDevices:m}=Zi(r?.id||null),[d,g]=C.useState(null),[p,u]=C.useState("idle");C.useEffect(()=>{r?.id&&m()},[r?.id]),C.useEffect(()=>{if(!r?.id||i.length===0)return;const b=setInterval(()=>{m()},6e4);return()=>clearInterval(b)},[r?.id,i.length]);const f=async b=>{try{u("syncing"),n.info("[WEARABLE_STATUS] Manual sync initiated",{deviceId:b}),await c(b),u("success"),n.info("[WEARABLE_STATUS] Manual sync completed",{deviceId:b}),setTimeout(()=>{u("idle")},3e3)}catch(w){u("error"),n.error("[WEARABLE_STATUS] Manual sync failed",{deviceId:b,error:w instanceof Error?w.message:"Unknown error"}),setTimeout(()=>{u("idle")},3e3)}};if(o)return e.jsxs("div",{className:`wearable-status-loading ${a}`,children:[e.jsx(j,{Icon:v.Loader2,size:20,className:"animate-spin",color:"#60A5FA"}),e.jsx("span",{children:"Vérification des appareils..."})]});if(i.length===0)return e.jsxs("div",{className:`wearable-status-empty ${a}`,children:[e.jsx("div",{className:"wearable-status-icon",children:e.jsx(j,{Icon:v.WatchOff,size:24,color:"#64748B"})}),e.jsxs("div",{className:"wearable-status-text",children:[e.jsx("h4",{children:"Aucun appareil connecté"}),e.jsx("p",{children:"Connectez votre montre pour synchroniser vos données"})]})]});const h=i.filter(b=>b.status==="connected"),x=h.length>0;return s==="compact"?e.jsxs("div",{className:`wearable-status-compact ${a}`,children:[e.jsxs("div",{className:"wearable-status-indicator",children:[e.jsx("div",{className:`status-dot ${x?"connected":"disconnected"}`,title:x?"Connecté":"Déconnecté"}),e.jsx("span",{className:"status-label",children:x?`${h.length} appareil${h.length>1?"s":""} connecté${h.length>1?"s":""}`:"Appareils déconnectés"})]}),x&&h[0].lastSyncAt&&e.jsxs("span",{className:"last-sync-time",children:["Dernière synchro:"," ",new Date(h[0].lastSyncAt).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}):e.jsxs("div",{className:`wearable-status-detailed ${a}`,children:[e.jsxs("div",{className:"wearable-status-header",children:[e.jsxs("div",{className:"status-title",children:[e.jsx(j,{Icon:x?v.Watch:v.WatchOff,size:24,color:x?"#10B981":"#64748B"}),e.jsx("h3",{children:"Appareils Connectés"})]}),t&&x&&e.jsxs(y.button,{onClick:()=>f(h[0].id),disabled:l||p==="syncing",className:"sync-all-button",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(j,{Icon:v.RefreshCw,size:18,className:l||p==="syncing"?"animate-spin":""}),e.jsx("span",{children:"Synchroniser"})]})]}),e.jsxs(H,{children:[p==="success"&&e.jsxs(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"sync-status-message success",children:[e.jsx(j,{Icon:v.CheckCircle,size:18,color:"#10B981"}),e.jsx("span",{children:"Synchronisation réussie"})]}),p==="error"&&e.jsxs(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"sync-status-message error",children:[e.jsx(j,{Icon:v.AlertCircle,size:18,color:"#EF4444"}),e.jsx("span",{children:"Échec de la synchronisation"})]})]}),e.jsx("div",{className:"devices-list",children:i.map(b=>{const w=on[b.provider],S=d===b.id,E=b.status==="connected";return e.jsxs(y.div,{className:`device-item ${E?"connected":"disconnected"}`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"device-main",children:[e.jsx("div",{className:"device-icon-wrapper",style:{background:`${w.color}20`},children:e.jsx(j,{Icon:v[w.icon],size:24,color:w.color})}),e.jsxs("div",{className:"device-info",children:[e.jsx("div",{className:"device-name",children:b.displayName||w.name}),e.jsxs("div",{className:"device-meta",children:[e.jsxs("span",{className:`device-status-badge ${b.status}`,children:[b.status==="connected"&&"Connecté",b.status==="syncing"&&"Synchronisation...",b.status==="error"&&"Erreur",b.status==="disconnected"&&"Déconnecté"]}),b.lastSyncAt&&e.jsx("span",{className:"device-last-sync",children:new Date(b.lastSyncAt).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsx("button",{onClick:()=>g(S?null:b.id),className:"expand-button","aria-label":S?"Réduire":"Développer",children:e.jsx(j,{Icon:S?v.ChevronUp:v.ChevronDown,size:20})})]}),e.jsx(H,{children:S&&e.jsxs(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"device-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Connecté depuis"}),e.jsx("span",{className:"detail-value",children:new Date(b.connectedAt).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]}),b.lastError&&e.jsxs("div",{className:"detail-item error",children:[e.jsx("span",{className:"detail-label",children:"Dernière erreur"}),e.jsx("span",{className:"detail-value",children:b.lastError})]}),e.jsx("div",{className:"detail-actions",children:E&&e.jsxs("button",{onClick:()=>f(b.id),disabled:l,className:"detail-action-button primary",children:[e.jsx(j,{Icon:v.RefreshCw,size:16,className:l?"animate-spin":""}),e.jsx("span",{children:"Synchroniser"})]})})]})})]},b.id)})})]})},$n=({mode:s,isSelected:t,isRecommended:a,onClick:r,disabled:i=!1})=>{const l=(()=>{switch(s){case"high-performance":return{title:"Performance Maximale",subtitle:"Fluidité 60fps garantie",icon:v.Zap,color:"#10B981",gradient:"linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.05) 100%)",features:[{label:"Animations désactivées",enabled:!1},{label:"Effets de verre remplacés",enabled:!1},{label:"Transitions simplifiées",enabled:!1},{label:"Particules désactivées",enabled:!1},{label:"Performance optimale",enabled:!0},{label:"Batterie économisée",enabled:!0},{label:"Fluidité maximale",enabled:!0},{label:"Zéro flickering",enabled:!0}],benefits:["60fps constant","Batterie optimisée","iPhone 8+ compatible"]};case"balanced":return{title:"Équilibré",subtitle:"Compromis idéal",icon:v.Scale,color:"#3B82F6",gradient:"linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.05) 100%)",features:[{label:"Animations désactivées",enabled:!1},{label:"Effets de verre légers",enabled:!0},{label:"Transitions simplifiées",enabled:!0},{label:"Particules désactivées",enabled:!1},{label:"Fond statique",enabled:!0},{label:"Design sobre bleu",enabled:!0},{label:"Bonne performance",enabled:!0},{label:"Batterie économisée",enabled:!0}],benefits:["Design + Performance","Bon compromis","iPhone 11+ recommandé"]};case"quality":return{title:"Qualité Premium",subtitle:"Expérience complète",icon:v.Sparkles,color:"#A855F7",gradient:"linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(168, 85, 247, 0.05) 100%)",features:[{label:"Toutes les animations",enabled:!0},{label:"Effets de verre complets",enabled:!0},{label:"Transitions élaborées",enabled:!0},{label:"Particules et lumière",enabled:!0},{label:"Design immersif",enabled:!0},{label:"Expérience premium",enabled:!0},{label:"Tous les effets visuels",enabled:!0},{label:"Rendu haute qualité",enabled:!0}],benefits:["Design complet","Tous les effets","iPhone 13+ / Desktop"]}}})();return e.jsxs(y.button,{onClick:r,disabled:i,whileHover:i?{}:{scale:1.02},whileTap:i?{}:{scale:.98},className:"w-full text-left relative overflow-hidden rounded-2xl transition-all",style:{background:t?`linear-gradient(135deg, ${l.color}30 0%, ${l.color}15 100%)`:l.gradient,border:t?`2px solid ${l.color}`:"1px solid rgba(148, 163, 184, 0.2)",boxShadow:t?`0 8px 24px ${l.color}40, 0 0 0 1px ${l.color}20`:"0 2px 8px rgba(0, 0, 0, 0.1)",opacity:i?.6:1,cursor:i?"not-allowed":"pointer"},children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{Icon:l.icon,size:32,color:l.color,variant:"pure"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:l.title}),e.jsx("p",{className:"text-sm text-slate-400",children:l.subtitle})]})]}),t&&e.jsx(y.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30},children:e.jsx(j,{Icon:v.CheckCircle,size:24,color:l.color,variant:"pure"})})]}),a&&e.jsxs(y.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full mb-4",style:{background:`${l.color}30`,border:`1px solid ${l.color}60`},children:[e.jsx(j,{Icon:v.Star,size:14,color:l.color,variant:"pure"}),e.jsx("span",{className:"text-xs font-semibold",style:{color:l.color},children:"Recommandé pour votre appareil"})]}),e.jsx("div",{className:"space-y-2 mb-4",children:l.features.map((c,m)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(j,{Icon:c.enabled?v.Check:v.X,size:16,color:c.enabled?l.color:"#64748B",variant:"pure",className:"mt-0.5"}),e.jsx("span",{className:c.enabled?"text-slate-300":"text-slate-500",style:{textDecoration:c.enabled?"none":"line-through"},children:c.label})]},m))}),e.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:l.benefits.map((c,m)=>e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium",style:{background:"rgba(51, 65, 85, 0.6)",color:"#CBD5E1",border:"1px solid rgba(148, 163, 184, 0.2)"},children:c},m))})})]}),t&&s!=="high-performance"&&e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`radial-gradient(circle at 50% 0%, ${l.color}15, transparent 70%)`,zIndex:0}})]})},Y=k.forwardRef(({children:s,as:t="div",className:a="",whileHover:r,whileTap:i,animate:o,initial:l,exit:c,variants:m,transition:d,...g},p)=>{const{mode:u,isPerformanceMode:f}=J();if(f){const x=t,b=[a,r&&"motion-hover-mobile",i&&"motion-tap-mobile",o&&typeof o=="object"&&"animate"in o&&"motion-fade-in-mobile"].filter(Boolean).join(" ");return e.jsx(x,{ref:p,className:b,...g,children:s})}if(u==="balanced"){const x=y[t],b=d?{...d,duration:d.duration?d.duration*.6:.3}:{duration:.3,ease:"easeOut"};return e.jsx(x,{ref:p,className:a,whileHover:r,whileTap:i,animate:o,initial:l,exit:c,variants:m,transition:b,...g,children:s})}const h=y[t];return e.jsx(h,{ref:p,className:a,whileHover:r,whileTap:i,animate:o,initial:l,exit:c,variants:m,transition:d,...g,children:s})});Y.displayName="ConditionalMotion";const Pn=({children:s,mode:t,initial:a=!0,...r})=>{const{mode:i,isPerformanceMode:o}=J();if(o)return e.jsx(e.Fragment,{children:s});const{AnimatePresence:l}=require("framer-motion");return e.jsx(l,{mode:t,initial:a,...r,children:s})},Ln=({label:s,description:t,enabled:a,onChange:r,disabled:i=!1,loading:o=!1})=>{const l=()=>{!i&&!o&&r(!a)};return e.jsxs("div",{className:`settings-toggle-container ${i?"disabled":""} ${o?"loading":""}`,children:[e.jsxs("div",{className:"settings-toggle-labels",children:[e.jsx("label",{className:"settings-toggle-label",children:s}),t&&e.jsx("p",{className:"settings-toggle-description",children:t})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":a,"aria-label":s,onClick:l,disabled:i||o,className:`settings-toggle-switch ${a?"enabled":"disabled"}`,children:e.jsx(Y,{className:"settings-toggle-thumb",animate:{x:a?20:0},transition:{type:"spring",stiffness:700,damping:35}})})]})},ln={info:Ve,warning:Ce,error:qe,success:Ge},Hn=({type:s="info",title:t,message:a,actions:r,className:i=""})=>{const o=ln[s];return e.jsxs("div",{className:`settings-info-card settings-info-card-${s} ${i}`,children:[e.jsx("div",{className:"settings-info-card-icon",children:e.jsx(o,{size:20})}),e.jsxs("div",{className:"settings-info-card-content",children:[t&&e.jsx("h4",{className:"settings-info-card-title",children:t}),e.jsx("div",{className:"settings-info-card-message",children:a}),r&&e.jsx("div",{className:"settings-info-card-actions",children:r})]})]})},Wn=({children:s,onClick:t,variant:a="primary",disabled:r=!1,loading:i=!1,icon:o,fullWidth:l=!1,type:c="button",className:m=""})=>{const d=r||i;return e.jsxs("button",{type:c,onClick:t,disabled:d,className:`
        settings-button
        settings-button-${a}
        ${l?"settings-button-full-width":""}
        ${d?"settings-button-disabled":""}
        ${i?"settings-button-loading":""}
        ${m}
      `,children:[i&&e.jsx(we,{className:"settings-button-loader",size:18}),!i&&o&&e.jsx("span",{className:"settings-button-icon",children:o}),e.jsx("span",{className:"settings-button-label",children:s})]})},U=({width:s="100%",height:t="20px",borderRadius:a="8px",className:r="",style:i={},shimmer:o=!0,pulse:l=!1})=>{const{isPerformanceMode:c}=J(),m={width:s,height:t,borderRadius:a,position:"relative",overflow:"hidden",...i};if(c){const p=["skeleton-performance-base",o&&"skeleton-shimmer-performance",l&&"skeleton-pulse-performance",r].filter(Boolean).join(" ");return e.jsx("div",{className:p,style:{...m,background:"rgba(255, 255, 255, 0.06)"}})}const d=o?{animate:{backgroundPosition:["0% 0%","100% 0%","0% 0%"]},transition:{duration:2,repeat:1/0,ease:"linear"},style:{...m,background:"linear-gradient(90deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.06))",backgroundSize:"200% 100%"}}:{},g=l?{animate:{opacity:[.6,1,.6]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}:{};return e.jsx(Y,{className:r,style:o||l?void 0:{...m,background:"rgba(255, 255, 255, 0.08)"},...o?d:{},...l?g:{}})},zn=({className:s=""})=>{const{isPerformanceMode:t}=J();return e.jsxs("div",{className:`space-y-8 w-full ${s}`,children:[e.jsxs(q,{className:"p-6",children:[e.jsx("div",{className:"flex items-center mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{width:"40px",height:"40px",borderRadius:"50%",shimmer:!0}),e.jsx(U,{width:"150px",height:"24px",shimmer:!0})]})}),e.jsxs("div",{className:"relative h-[400px] sm:h-[500px] lg:h-[600px] rounded-xl overflow-hidden",style:{background:t?"rgba(139, 92, 246, 0.06)":"linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(59, 130, 246, 0.04))",border:"1px solid rgba(139, 92, 246, 0.2)"},children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-full border-4",style:{borderColor:"rgba(139, 92, 246, 0.3)"}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-24 h-24 rounded-full",style:{background:"rgba(139, 92, 246, 0.2)"}})}),e.jsx("div",{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2 whitespace-nowrap",children:e.jsx("span",{className:"text-white/70 text-sm font-medium",children:"Chargement de votre avatar..."})})]}):e.jsxs(Y,{className:"relative",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.6},children:[e.jsx(Y,{className:"w-32 h-32 rounded-full border-4",style:{borderColor:"rgba(139, 92, 246, 0.3)"},animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),e.jsx(Y,{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(Y,{className:"w-24 h-24 rounded-full",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.4), rgba(139, 92, 246, 0.1))",boxShadow:"0 0 40px rgba(139, 92, 246, 0.3)"},animate:{scale:[1,1.1,1]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})}),e.jsx(Y,{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2 whitespace-nowrap",animate:{opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx("span",{className:"text-white/70 text-sm font-medium",children:"Chargement de votre avatar..."})})]})}),!t&&e.jsx(Y,{className:"absolute top-4 right-4 w-20 h-20 rounded-full",style:{background:"radial-gradient(circle, rgba(139, 92, 246, 0.2), transparent)"},animate:{opacity:[.3,.6,.3],scale:[.8,1,.8]},transition:{duration:3,repeat:1/0,ease:"easeInOut",delay:.5}})]})]}),e.jsxs(q,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{width:"40px",height:"40px",borderRadius:"50%",shimmer:!0}),e.jsx(U,{width:"180px",height:"20px",shimmer:!0})]}),e.jsx(U,{width:"100px",height:"24px",borderRadius:"12px",shimmer:!0})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((a,r)=>e.jsxs(Y,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1+r*.1},className:"p-4 rounded-xl",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{width:"32px",height:"32px",borderRadius:"8px",shimmer:!0}),e.jsx(U,{width:"80px",height:"12px",shimmer:!0})]}),e.jsx(U,{width:"60px",height:"24px",shimmer:!0,className:"mb-1"}),e.jsx(U,{width:"50px",height:"14px",shimmer:!0})]},r))})]}),e.jsxs(q,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{width:"40px",height:"40px",borderRadius:"50%",shimmer:!0}),e.jsx(U,{width:"200px",height:"20px",shimmer:!0})]}),e.jsx(U,{width:"120px",height:"24px",borderRadius:"12px",shimmer:!0})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((a,r)=>e.jsxs(Y,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1+r*.1},className:"p-4 rounded-xl text-center",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(U,{width:"48px",height:"48px",borderRadius:"50%",shimmer:!0})}),e.jsx(U,{width:"80%",height:"16px",shimmer:!0,className:"mx-auto mb-2"}),e.jsx(U,{width:"60%",height:"14px",shimmer:!0,className:"mx-auto"})]},r))}),e.jsxs(Y,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.6},className:"p-4 rounded-xl",style:{background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx(U,{width:"100%",height:"14px",shimmer:!0,className:"mb-2"}),e.jsx(U,{width:"90%",height:"14px",shimmer:!0,className:"mb-2"}),e.jsx(U,{width:"80%",height:"14px",shimmer:!0})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx(U,{width:"250px",height:"56px",borderRadius:"28px",shimmer:!0,className:"mx-auto"})})]})},Un=({modules:s,progress:t,themeColor:a,reduceMotion:r=!1,className:i=""})=>e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-3 gap-6 ${i}`,children:s.map((o,l)=>{const c=t>=o.activeThreshold;return e.jsxs(y.div,{className:"p-6 rounded-xl relative overflow-hidden",style:{background:`
                radial-gradient(circle at 30% 20%, color-mix(in srgb, ${o.color} ${c?"15":"8"}%, transparent) 0%, transparent 60%),
                rgba(255,255,255,${c?"0.08":"0.04"})
              `,border:`2px solid color-mix(in srgb, ${o.color} ${c?"40":"20"}%, transparent)`,backdropFilter:"blur(12px) saturate(140%)",WebkitBackdropFilter:"blur(12px) saturate(140%)",boxShadow:c?`0 0 20px color-mix(in srgb, ${o.color} 30%, transparent)`:`0 0 8px color-mix(in srgb, ${o.color} 15%, transparent)`,transition:"all 0.6s ease"},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:l*.2},children:[c&&!r&&e.jsx("div",{className:"absolute top-2 right-2 w-3 h-3 rounded-full",style:{background:o.color,boxShadow:`0 0 12px color-mix(in srgb, ${o.color} 80%, transparent)`,animation:"energyPulse 1.5s ease-in-out infinite"}}),e.jsx("div",{className:"flex items-center justify-center gap-3 mb-3",children:e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${c&&!r?"breathing-icon":""}`,style:{background:`
                    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%),
                    linear-gradient(135deg, color-mix(in srgb, ${o.color} 40%, transparent), color-mix(in srgb, ${o.color} 30%, transparent))
                  `,border:`2px solid color-mix(in srgb, ${o.color} 60%, transparent)`,boxShadow:`
                    0 0 20px color-mix(in srgb, ${o.color} 50%, transparent),
                    inset 0 2px 0 rgba(255,255,255,0.3)
                  `},children:e.jsx(j,{Icon:v[o.icon],size:20,style:{color:o.color},variant:"pure"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-base font-bold mb-1",style:{color:o.color},children:o.label}),e.jsx("div",{className:"text-xs text-white/60",children:o.sublabel})]}),c&&!r&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 rounded-b-xl overflow-hidden",style:{background:`linear-gradient(90deg,
                    transparent 0%,
                    ${o.color} 50%,
                    transparent 100%
                  )`,animation:"energyFlow 2s ease-in-out infinite"}})]},o.label)})});export{Wn as A,Cn as B,Mn as C,xn as D,Ln as E,Rs as F,q as G,ye as H,v as I,vs as J,Y as K,vn as L,Cs as M,zn as N,Pn as O,_n as P,Un as Q,j as S,wn as T,yn as U,Dn as W,kn as a,de as b,ws as c,as as d,fn as e,Sn as f,En as g,jn as h,In as i,bn as j,An as k,Tn as l,Rn as m,ys as n,Nn as o,Ae as p,is as q,On as r,Fn as s,on as t,Ke as u,he as v,Bn as w,je as x,$n as y,Hn as z};
